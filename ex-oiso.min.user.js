// ==UserScript==
// @name         OIso++ - OIer的好帮手
// @namespace    http://tampermonkey.net/
// @homepage     https://www.oiso.cf/
// @version      2.5.0
// @description  在洛谷、Codeforces 等网站上提供 OI 检索服务
// @author       OIso 开发团队
// @match        https://www.luogu.com.cn/*
// @match        https://www.oiso.cf/*
// @match        https://*/*lgse-settings*
// @include      https://fastly.jsdelivr.net/*
// @connect      oiso.cf
// @connect      jsdelivr.net
// @connect      oiso.run-eu-central1.goorm.site
// @connect      c.amzcd.top
// @connect      gpt-reverse-api.zeabur.app
// @connect      lab.magiconch.com
// @connect      ai.oisou.link
// @require      https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js
// @require      https://lab.magiconch.com/vue.2.6.11.min.js
// @resource css https://unpkg.com/@waline/client@v2/dist/waline.css
// @icon         https://www.oiso.cf/img/favicon.svg
// @grant          GM_addStyle
// @grant          GM_getValue
// @grant          GM.cookie
// @grant          GM_setValue
// @grant          GM_deleteValue
// @grant          GM_listValues
// @grant          GM_setClipboard
// @grant          GM_xmlhttpRequest
// @grant          GM_getResourceText
// @grant          unsafeWindow
// ==/UserScript==

(()=>{var zo=Object.defineProperty;var Do=(g,I,C)=>I in g?zo(g,I,{enumerable:!0,configurable:!0,writable:!0,value:C}):g[I]=C;var El=(g,I,C)=>(Do(g,typeof I!="symbol"?I+"":I,C),C);function Pl(g,I){localStorage.setItem(g,JSON.stringify(I))}function jl(g){return JSON.parse(localStorage.getItem(g))}function Qo(){let g={\u7CFB\u7EDF\u8BBE\u7F6E:{enabled:!0,desc:"\u5728\u8FD9\u91CC\u8FDB\u884C\u5168\u5C40\u7CFB\u7EDF\u8BBE\u7F6E",config:{refreshCache:{type:"button",desc:"\u6E05\u9664\u7F13\u5B58<b>\u26A0\uFE0F\u8FD9\u4E5F\u4F1A\u6E05\u9664\u5F53\u524D\u6240\u6709\u8BBE\u7F6E</b>",value:"\u6E05\u9664",script:"localStorage.clear();window.location.reload();"},checkUpdate:{type:"button",desc:"\u5F53\u524D\u7248\u672C\uFF1Av2.5.0\uFF0C\u6784\u5EFA\u65F6\u95F4\uFF1A7/25/2023, 7:16:20 AM",value:"\u68C0\u67E5\u66F4\u65B0\uFF08\u6682\u4E0D\u53EF\u7528\uFF09",script:""},about:{type:"text",desc:"\u5173\u4E8E",value:"\uFF08\u9E23\u8C22\u540D\u5355\uFF09"}}},aHelper:{enabled:!0,desc:"\u4F7F\u7528 AI \u670D\u52A1\uFF0C\u5E2E\u60A8\u7FFB\u8BD1\u3001\u5206\u6790\u9898\u76EE\uFF01",config:{uuid:{type:"text",desc:"\u7CFB\u7EDF\u5206\u914D\u7684GPT\u63A5\u53E3\u4FE1\u606F",value:"\u6682\u65E0\u4FE1\u606F"},refresh:{type:"button",desc:"\u5982\u679CAI\u670D\u52A1\u4E0D\u7A33\u5B9A\uFF0C\u53EF\u5C1D\u8BD5\u6E05\u9664\u5F53\u524D\u5206\u914D",value:"\u6E05\u9664\u5F53\u524D\u5206\u914D",script:'localStorage.removeItem("chatID");let nowCfg = localStorage.getItem("exOIsoCFG");nowCfg = JSON.parse(nowCfg);nowCfg.aHelper.config.uuid.value = "\u5C1A\u672A\u5206\u914D\u3002\u4F7F\u7528AI\u670D\u52A1\u81EA\u52A8\u5206\u914D\u3002";localStorage.setItem("exOIsoCFG", JSON.stringify(nowCfg));window.location.reload();'}}},bbsTools:{enabled:!0,desc:"\u8BBA\u575B\u5DE5\u5177\u7BB1\uFF0C\u5C3D\u60C5\u6295\u7968\u3001\u5907\u4EFD\u3001\u67E5\u770B\uFF01<br/>\u540E\u7AEF\u7531<a href='https://github.com/extend-luogu/luogu-discuss-log' target='_blank'>\u5F00\u6E90\u5E16\u5B50\u4FDD\u5B58\u5DE5\u5177</a>\u4E8C\u6B21\u5F00\u53D1\u3002\u611F\u8C22\u539F\u4F5C\u8005 <a href='//www.luogu.com.cn/user/237496' target='_blank'>__OwO__</a> \u4E0E <a href='//www.luogu.com.cn/user/37084' target='_blank'>Yemaster</a> \uFF01",config:{voteShow:{type:"bool",desc:"\u663E\u793A\u6295\u7968\u529F\u80FD",value:!0},toolShow:{type:"bool",desc:"\u663E\u793A\u5907\u4EFD\u6309\u94AE",value:!0},btnShow:{type:"bool",desc:"\u201C\u5F15\u7528\u56DE\u590D\u201D\u201C\u590D\u5236Md\u201D\u529F\u80FD",value:!0},autoSave:{type:"bool",desc:"\u5F53\u60A8\u5728\u5237\u5E16\u5B50\u65F6\uFF0C\u81EA\u52A8\u4FDD\u5B58\u5E16\u5B50",value:!0},waline:{type:"bool",desc:"\u542F\u7528 Waline \u8BC4\u8BBA\u7CFB\u7EDF\uFF0C\u6765\u533F\u540D\u8BC4\u8BBA\uFF08\u4E0Elg.oiso.cf\u540C\u6B65\uFF09\uFF01",value:!0}}},easyCaptcha:{enabled:!0,desc:"\u597D\u7528\u7684\u9A8C\u8BC1\u7801\u81EA\u52A8\u586B\u5145\uFF01",config:{}},easyMarkdown:{enabled:!0,desc:"\u968F\u5904\u590D\u5236 Markdown \u6E90\u7801\uFF01\u5982\u4E2A\u4EBA\u4E3B\u9875\u3001\u7287\u7287\u7B49\uFF01",config:{}},eloNameColor:{enabled:!0,desc:"\u540D\u5B57\u989C\u8272\u589E\u5F3A\uFF0C\u6839\u636E Elo \u503C\u53D8\u8272\uFF0C\u67E5\u770B\u7528\u6237\u540D\u5B57\u672A\u6765\u98CE\u5411\uFF01",config:{}},live2d:{enabled:!0,desc:"\u840C\u840C\u54D2\u770B\u677F\u5A18\u63D2\u4EF6\uFF0C\u53EF\u56DB\u5904\u62D6\u52A8\uFF01",config:{LOL:{type:"textArea",desc:"\u5728\u6B64\u7F16\u8F91LOL\u811A\u672C\u4EE3\u7801",value:`body click 600 text:\u26A1\uFE0F
body keydown 600 text:\u2328\uFE0F`}}},LGSE:{enabled:!0,desc:"LGSE \u52A0\u5165\u5566\uFF01QQ\u8868\u60C5\u66FF\u6362\u4E0E\u67E5\u8BE2\uFF01\u6280\u672F\u652F\u6301\uFF1A@<a href='https://www.luogu.com.cn/user/765440' target='_blank'>hycJuRuo</a><br/><b>\u8BF7\u6CE8\u610F\uFF1A\u76EE\u524D\u6682\u65F6\u65E0\u6CD5\u963B\u6B62 LGSE \u5728\u8BBE\u7F6E\u9875\u52A0\u8F7D\u3002\u5982\u679C\u9700\u8981\u963B\u6B62\u5176\u52A0\u8F7D\uFF0C\u9700\u8981\u5173\u95ED\u6574\u4E2A\u7528\u6237\u811A\u672C\uFF01</b>",config:{}},msgMarkdown:{enabled:!0,desc:"\u5728\u79C1\u4FE1\u9875\u9762\u652F\u6301\u57FA\u7840 Markdown \u6E32\u67D3\uFF0C\u81EA\u52A8\u8BC6\u522B\u94FE\u63A5\u3001\u663E\u793A\u94FE\u63A5\u4E2D\u7684\u56FE\u7247\uFF01",config:{}},nbnhhsh:{enabled:!0,desc:"\u300C\u80FD\u4E0D\u80FD\u597D\u597D\u8BF4\u8BDD\uFF1F\u300D \u62FC\u97F3\u9996\u5B57\u6BCD\u7F29\u5199\u7FFB\u8BD1\u5DE5\u5177\u3002\u8BE5\u9879\u76EE\u5F00\u6E90\u5730\u5740\uFF1A<a href='https://github.com/itorr/nbnhhsh'>https://github.com/itorr/nbnhhsh</a>\u3002\u5728\u4EFB\u4F55\u5730\u65B9\u9009\u4E2D\u6587\u672C\uFF0C\u5C31\u80FD\u770B\u5230\u8BE6\u7EC6\u89E3\u91CA\u3002",config:{}},onlineReport:{enabled:!1,desc:"\u5728\u7EBF\u72B6\u6001\u62A5\u544A\uFF0C\u6BCF\u9694\u4E00\u5206\u949F\u81EA\u52A8\u66F4\u65B0\u5728\u7EBF\u65F6\u95F4\u81F3\u60A8\u7684\u4E2A\u4EBA\u7B7E\u540D\uFF01<br/><b>\u6CE8\u610F\uFF1A\u60A8\u5F53\u524D\u7684\u7B7E\u540D\u4F1A\u88AB\u8986\u76D6\u4E14\u65E0\u4ECE\u627E\u56DE\uFF01</b>",config:{text:{type:"string",desc:"\u6A21\u7248\uFF0C{time}\u53EF\u6307\u4EE3\u5F53\u524D\u65F6\u95F4",value:"> \u6700\u540E\u5728\u7EBF\u65F6\u95F4\uFF1A{time} < \u7531 exOIso \u53D1\u9001\u6FC0\u5149"},duration:{type:"number",desc:"\u66F4\u65B0\u95F4\u9694\uFF08\u5206\u949F\uFF09",value:1}}},quickSearch:{enabled:!0,desc:"\u6309\u4E0B Ctrl + Alt \uFF08Control + Option\uFF09 \uFF0C\u5524\u8D77\u5FEB\u901F\u641C\u7D22\uFF0C\u652F\u6301\u667A\u80FD\u62FC\u97F3\u8054\u60F3\uFF01",config:{backgroundBlur:{type:"number",desc:"\u80CC\u666F\u6BDB\u73BB\u7483\u6A21\u7CCA\u5EA6\uFF08 0 \u8868\u793A\u5173\u95ED\uFF0C\u53D6\u51B3\u4E8E\u60A8\u7684\u7535\u8111\u6027\u80FD\uFF09",value:1}}},walineBenben:{enabled:!0,desc:"\u5728\u9996\u9875\u663E\u793A\u7531 Waline \u9A71\u52A8\u7684\u533F\u540D\u7287\u7287\u7CFB\u7EDF\u3002",config:{}}};if(!jl("exOIsoCFG"))Pl("exOIsoCFG",g);else{let I=jl("exOIsoCFG");for(let C in g)if(I[C]===void 0)I[C]=g[C];else{I[C].desc=g[C].desc;for(let A in g[C].config)I[C].config[A]===void 0?I[C].config[A]=g[C].config[A]:I[C].config[A].desc=g[C].config[A].desc}for(let C in I)g[C]===void 0&&delete I[C];Pl("exOIsoCFG",I)}}Qo();var xo=unsafeWindow;var Ol=g=>[g.ctrlKey?"Ctrl":"",g.shiftKey?"Shift":"",g.altKey?"Alt":"",g.key.toInitialCase()].join(""),To=jQuery.extend({double:(g,I,C)=>[g(I),g(C)]});jQuery.fn.extend({whenKey(g,I){typeof g=="object"?this.on("keydown",C=>{let A=g[Ol(C)];A&&A(C)}):this.on("keydown",C=>{Ol(C)===g&&I(C)})}});var _l=(g,I={})=>new Promise((C,A)=>{GM_xmlhttpRequest({url:g,method:"GET",headers:I,onload:l=>{let i;try{i=JSON.parse(l.responseText)}catch{}C({raw:l,data:i})},onerror:A})});var yg=(g,...I)=>xo.console.log(`%c[OIso++] ${g}`,"color: #008080;",...I);var $g=(g,I)=>{let C=JSON.parse(localStorage.getItem("cache"));C==null&&(C={}),C[g]!==null&&C[g]&&C[g].updateTime&&new Date().getTime()-C[g].updateTime<1e3*60*60*24&&I(C[g]),GM_xmlhttpRequest({method:"GET",url:g,onload(A){let l={responseText:A.responseText,status:A.status,updateTime:new Date().getTime()};C[g]=l,localStorage.setItem("cache",JSON.stringify(C)),I(l)}})},FI=(g,I)=>{let C=JSON.parse(localStorage.getItem("pendantCache"));if(C!==null&&C.updateTime!==null&&new Date().getTime()-C.updateTime<1e3*60*60*24){if(C[g]===void 0||C[g]==null){I({responseText:"False"});return}I({responseText:C[g]});return}GM_xmlhttpRequest({method:"GET",url:"https://online.oiso.cf/pendant/getall",onload:A=>{if(C=JSON.parse(A.responseText),C.updateTime=new Date().getTime(),localStorage.setItem("pendantCache",JSON.stringify(C)),C[g]===void 0||C[g]==null){I({responseText:"False"});return}I({responseText:C[g]})}})},$l=g=>new Promise((I,C)=>{let A=JSON.parse(localStorage.getItem("eloCache"));if(A!==null&&A.updateTime!==null&&new Date().getTime()-A.updateTime<1e3*60*60*24&&A[g]!==void 0){if(A[g]===void 0||A[g]==null){I({responseText:"Null"});return}I({responseText:A[g]});return}To.ajax({url:`https://www.luogu.com.cn/user/${g}?_contentOnly=1`,type:"GET",success:l=>{let i;try{i=l.currentData.user.elo.rating}catch{i=null}if(A===null&&(A={}),A[g]=i,A.updateTime=new Date().getTime(),localStorage.setItem("eloCache",JSON.stringify(A)),A[g]===void 0||A[g]==null){I({responseText:"Null"});return}I({responseText:A[g]})},error:l=>{C(l)}})}),ql=(g,I,C)=>{let l=document.querySelector('meta[name="csrf-token"]').getAttribute("content");unsafeWindow.window.goPost=function(){let o=new XMLHttpRequest;o.open("POST",g),o.setRequestHeader("x-csrf-token",l),o.setRequestHeader("x-requested-with","XMLHttpRequest"),o.setRequestHeader("content-type","application/json"),o.onload=function(){typeof window.callback=="function"&&C(o.responseText)},o.send(JSON.stringify(I))};let i=document.createElement("script"),e="setTimeout(() => { window.goPost() }, 100);";unsafeWindow.window.document.body.appendChild(i),i.innerText=e},MA=g=>{let I=JSON.parse(localStorage.getItem("exOIsoCFG"));return!!(I[g]===void 0||I[g].enabled===void 0||I[g].enabled)},qg=g=>JSON.parse(localStorage.getItem("exOIsoCFG"))[g];var Eo={reg:(g,I,C)=>{let A=window.location.href;g=`https://www.luogu.com.cn${g}`,A.search(g)===0&&(MA(I)||I==="controlPanel"||I==="pendantRender"?(yg(`(\u7CFB\u7EDF) \u6B63\u5728\u8FD0\u884C "${I}" \u6A21\u5757\u3002`),C()):yg(`(\u7CFB\u7EDF) "${I}" \u6A21\u5757\u5DF2\u7981\u7528\u3002`))},regInAll:(g,I,C)=>{window.location.href.search(g)===0&&(MA(I)||I==="controlPanel"||I==="pendantRender"?(yg(`(\u7CFB\u7EDF) \u6B63\u5728\u8FD0\u884C "${I}" \u6A21\u5757\u3002`),C()):yg(`(\u7CFB\u7EDF) "${I}" \u6A21\u5757\u5DF2\u7981\u7528\u3002`))}},eg=Eo;eg.reg("/","voteShow",()=>{if(qg("bbsTools").config.voteShow.value===!1)return;let g=qg("bbsTools").config,I=document.querySelectorAll("a[href^='/discuss/show?postid=']"),C=[];for(let A=0;A<I.length;A++){let l=I[A].getAttribute("href").split("=")[1];if(C.push(l),g.autoSave.value){let i=`https://lgbbs.oiso.cf/save.php?url=https://www.luogu.com.cn/discuss/${l}?page=1`;GM_xmlhttpRequest({method:"GET",url:i,onload:()=>{}})}}GM_xmlhttpRequest({method:"POST",url:"https://online.oiso.cf/lgbbs/getlist",data:JSON.stringify(C),headers:{"Content-Type":"application/json"},onload:A=>{if(JSON.parse(A.responseText).code===200){let l=JSON.parse(A.responseText);for(let i=0;i<I.length;i++){let e=I[i].getAttribute("href").split("=")[1],o=l[e],t=I[i].innerHTML;I[i].innerHTML=`${t} <div style="float:right;">[&#8593;${o.for} &#8595;${o.against}]</div>`}}}})});(function(){"use strict";function g(u){if(typeof u!="string"&&(u=""+u),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(u))throw new TypeError("Invalid character in header field name");return u.toLowerCase()}function I(u){return typeof u!="string"&&(u=""+u),u}function C(u){this.map={},u instanceof C?u.forEach(function(G,p){this.append(p,G)},this):u&&Object.getOwnPropertyNames(u).forEach(function(G){this.append(G,u[G])},this)}function A(u){return u.bodyUsed?b.reject(new TypeError("Already read")):void(u.bodyUsed=!0)}function l(u){return new b(function(G,p){u.onload=function(){G(u.result)},u.onerror=function(){p(u.error)}})}function i(u){var G=new FileReader;return G.readAsArrayBuffer(u),l(G)}function e(u){var G=new FileReader;return G.readAsText(u),l(G)}function o(){return this.bodyUsed=!1,this._initBody=function(u){if(this._bodyInit=u,typeof u=="string")this._bodyText=u;else if(r.blob&&Blob.prototype.isPrototypeOf(u))this._bodyBlob=u;else if(r.formData&&FormData.prototype.isPrototypeOf(u))this._bodyFormData=u;else{if(u)throw Error("unsupported BodyInit type");this._bodyText=""}},r.blob?(this.blob=function(){var u=A(this);if(u)return u;if(this._bodyBlob)return b.resolve(this._bodyBlob);if(this._bodyFormData)throw Error("could not read FormData body as blob");return b.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(i)},this.text=function(){var u=A(this);if(u)return u;if(this._bodyBlob)return e(this._bodyBlob);if(this._bodyFormData)throw Error("could not read FormData body as text");return b.resolve(this._bodyText)}):this.text=function(){var u=A(this);return u||b.resolve(this._bodyText)},r.formData&&(this.formData=function(){return this.text().then(c)}),this.json=function(){return this.text().then(JSON.parse)},this}function t(u){var G=u.toUpperCase();return m.indexOf(G)>-1?G:u}function n(u,G){if(G=G||{},this.url=u,this.credentials=G.credentials||"omit",this.headers=new C(G.headers),this.method=t(G.method||"GET"),this.mode=G.mode||null,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&G.body)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(G.body)}function c(u){var G=new FormData;return u.trim().split("&").forEach(function(p){if(p){var V=p.split("="),R=V.shift().replace(/\+/g," "),L=V.join("=").replace(/\+/g," ");G.append(decodeURIComponent(R),decodeURIComponent(L))}}),G}function s(u){var G=new C,p=u.trim().split(`
`);return p.forEach(function(V){var R=V.trim().split(":"),L=R.shift().trim(),M=R.join(":").trim();G.append(L,M)}),G}function d(u,G){G||(G={}),this._initBody(u),this.type="default",this.url=null,this.status=G.status,this.ok=this.status>=200&&this.status<300,this.statusText=G.statusText,this.headers=G.headers instanceof C?G.headers:new C(G.headers),this.url=G.url||""}var b=window.Bluebird||window.Promise;if(!self.GM_fetch){C.prototype.append=function(u,G){u=g(u),G=I(G);var p=this.map[u];p||(p=[],this.map[u]=p),p.push(G)},C.prototype.delete=function(u){delete this.map[g(u)]},C.prototype.get=function(u){var G=this.map[g(u)];return G?G[0]:null},C.prototype.getAll=function(u){return this.map[g(u)]||[]},C.prototype.has=function(u){return this.map.hasOwnProperty(g(u))},C.prototype.set=function(u,G){this.map[g(u)]=[I(G)]},C.prototype.forEach=function(u,G){Object.getOwnPropertyNames(this.map).forEach(function(p){this.map[p].forEach(function(V){u.call(G,V,p,this)},this)},this)};var r={blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in self},m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];o.call(n.prototype),o.call(d.prototype),self.Headers=C,self.Request=n,self.Response=d,self.GM_fetch=function(u,G){var p;return p=n.prototype.isPrototypeOf(u)&&!G?u:new n(u,G),new b(function(V,R){function L(D,sg,Fg){return D||(/^X-Request-URL:/m.test(sg)?Fg.get("X-Request-URL"):void 0)}var M,x={};x.method=p.method,x.url=p.url,x.synchronous=!1,x.onload=function(D){var sg=D.status;if(100>sg||sg>599)return void R(new TypeError("Network request failed"));var Fg=D.responseHeaders;M=s(Fg);var jg={status:sg,statusText:D.statusText,headers:M,url:L(D.finalUrl,Fg,M)},E=D.responseText;V(new d(E,jg))},x.onerror=function(){R(new TypeError("Network request failed"))},x.headers={},p.headers.forEach(function(D,sg){x.headers[sg]=D}),p._bodyInit!==void 0&&(x.data=p._bodyInit),GM_xmlhttpRequest(x)})},self.GM_fetch.polyfill=!0}})();var Po=["nick","mail","link"],ge=g=>g.filter(I=>Po.includes(I)),Ie=["//unpkg.com/@waline/emojis@1.1.0/weibo"],jo="en-US",Oo=["//unpkg.com/@waline/emojis/tieba/tieba_agree.png","//unpkg.com/@waline/emojis/tieba/tieba_look_down.png","//unpkg.com/@waline/emojis/tieba/tieba_sunglasses.png","//unpkg.com/@waline/emojis/tieba/tieba_pick_nose.png","//unpkg.com/@waline/emojis/tieba/tieba_awkward.png","//unpkg.com/@waline/emojis/tieba/tieba_sleep.png"],_o=g=>new Promise((I,C)=>{if(g.size>128e3)return C(new Error("File too large! File size limit 128KB"));let A=new FileReader;A.readAsDataURL(g),A.onload=()=>I(A.result?.toString()||""),A.onerror=C}),$o=g=>g===!0?'<p class="wl-tex">Tex is not available in preview</p>':'<span class="wl-tex">Tex is not available in preview</span>',qo=g=>{let I=async(C,A={})=>GM_fetch(`https://api.giphy.com/v1/gifs/${C}?${new URLSearchParams({lang:g,limit:"20",rating:"g",api_key:"6CIMLkNMMOhRcXPoMCPkFy4Ybk2XUiMp",...A}).toString()}`).then(l=>l.json()).then(({data:l})=>l.map(i=>({title:i.title,src:i.images.downsized_medium.url})));return{search:C=>I("search",{q:C,offset:"0"}),default:()=>I("trending",{}),more:(C,A=0)=>I("search",{q:C,offset:A.toString()})}},gt=new RegExp(`(${/[\u4E00-\u9FFF\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af\u0400-\u04FF]+|\w+/.source}|${/</.source})|((?:${/(?:^|\s)\/\/(.+?)$/gm.source})|(?:${/\/\*([\S\s]*?)\*\//gm.source}))`,"gmi"),Ce=["23AC69","91C132","F19726","E8552D","1AAB8E","E1147F","2980C1","1BA1E6","9FA0A0","F19726","E30B20","E30B20","A3338B"],zA={},It=g=>{let I=0;return g.replace(gt,(C,A,l)=>{if(l)return`<span style="color: slategray">${l}</span>`;if(A==="<")return"&lt;";let i;zA[A]?i=zA[A]:(i=Ce[I],zA[A]=i);let e=`<span style="color: #${i}">${A}</span>`;return I=++I%Ce.length,e})},Ct=["nick","nickError","mail","mailError","link","optional","placeholder","sofa","submit","like","cancelLike","reply","cancelReply","comment","refresh","more","preview","emoji","uploadImage","seconds","minutes","hours","days","now","uploading","login","logout","admin","sticky","word","wordHint","anonymous","level0","level1","level2","level3","level4","level5","gif","gifSearchPlaceholder","profile","approved","waiting","spam","unsticky","oldest","latest","hottest","reactionTitle"],iC=g=>Object.fromEntries(g.map((I,C)=>[Ct[C],I])),DA=iC(["NickName","NickName cannot be less than 3 bytes.","E-Mail","Please confirm your email address.","Website","Optional","Comment here...","No comment yet.","Submit","Like","Cancel like","Reply","Cancel reply","Comments","Refresh","Load More...","Preview","Emoji","Upload Image","seconds ago","minutes ago","hours ago","days ago","just now","Uploading","Login","logout","Admin","Sticky","Words",`Please input comments between $0 and $1 words!
 Current word number: $2`,"Anonymous","Dwarves","Hobbits","Ents","Wizards","Elves","Maiar","GIF","Search GIF","Profile","Approved","Waiting","Spam","Unsticky","Oldest","Latest","Hottest","What do you think?"]),DC=iC(["\u30CB\u30C3\u30AF\u30CD\u30FC\u30E0","3\u30D0\u30A4\u30C8\u4EE5\u4E0A\u306E\u30CB\u30C3\u30AF\u30CD\u30FC\u30E0\u3092\u3054\u5165\u529B\u304F\u3060\u3055\u3044.","\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9","\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u3092\u3054\u78BA\u8A8D\u304F\u3060\u3055\u3044.","\u30B5\u30A4\u30C8","\u30AA\u30D7\u30B7\u30E7\u30F3","\u3053\u3053\u306B\u30B3\u30E1\u30F3\u30C8","\u30B3\u30E1\u30F3\u30C8\u3057\u307E\u3057\u3087\u3046~","\u63D0\u51FA\u3059\u308B","Like","Cancel like","\u8FD4\u4FE1\u3059\u308B","\u30AD\u30E3\u30F3\u30BB\u30EB","\u30B3\u30E1\u30F3\u30C8","\u66F4\u65B0","\u3055\u3089\u306B\u8AAD\u307F\u8FBC\u3080","\u30D7\u30EC\u30D3\u30E5\u30FC","\u7D75\u6587\u5B57","\u753B\u50CF\u3092\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9","\u79D2\u524D","\u5206\u524D","\u6642\u9593\u524D","\u65E5\u524D","\u305F\u3063\u3060\u4ECA","\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9","\u30ED\u30B0\u30A4\u30F3\u3059\u308B","\u30ED\u30B0\u30A2\u30A6\u30C8","\u7BA1\u7406\u8005","\u30C8\u30C3\u30D7\u306B\u7F6E\u304F","\u30EF\u30FC\u30C9",`\u30B3\u30E1\u30F3\u30C8\u306F $0 \u304B\u3089 $1 \u30EF\u30FC\u30C9\u306E\u9593\u3067\u306A\u3051\u308C\u3070\u306A\u308A\u307E\u305B\u3093!
 \u73FE\u5728\u306E\u5358\u8A9E\u756A\u53F7: $2`,"\u533F\u540D","\u3046\u3048\u306B\u3093","\u306A\u304B\u306B\u3093","\u3057\u3082\u304A\u3057","\u7279\u306B\u3057\u3082\u304A\u3057","\u304B\u3052","\u306A\u306C\u3057","GIF","\u63A2\u3059 GIF","\u500B\u4EBA\u60C5\u5831","\u627F\u8A8D\u6E08\u307F","\u5F85\u3063\u3066\u3044\u308B","\u30B9\u30D1\u30E0","\u3079\u305F\u3064\u304B\u306A\u3044","\u9006\u9806","\u6B63\u9806","\u4EBA\u6C17\u9806","\u3069\u3046\u601D\u3044\u307E\u3059\u304B\uFF1F"]),Ae=iC(["Apelido","Apelido n\xE3o pode ser menor que 3 bytes.","E-Mail","Por favor, confirme seu endere\xE7o de e-mail.","Website","Opcional","Comente aqui...","Nenhum coment\xE1rio, ainda.","Enviar","Like","Cancel like","Responder","Cancelar resposta","Coment\xE1rios","Refrescar","Carregar Mais...","Visualizar","Emoji","Enviar Imagem","segundos atr\xE1s","minutos atr\xE1s","horas atr\xE1s","dias atr\xE1s","agora mesmo","Enviando","Entrar","Sair","Admin","Sticky","Palavras",`Favor enviar coment\xE1rio com $0 a $1 palavras!
 N\xFAmero de palavras atuais: $2`,"An\xF4nimo","Dwarves","Hobbits","Ents","Wizards","Elves","Maiar","GIF","Pesquisar GIF","informa\xE7\xE3o pessoal","Aprovado","Espera","Spam","Unsticky","Mais velho","Mais recentes","Mais quente","O que voc\xEA acha?"]),QA=iC(["\u041F\u0441\u0435\u0432\u0434\u043E\u043D\u0438\u043C","\u041D\u0438\u043A\u043D\u0435\u0439\u043C \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043C\u0435\u043D\u044C\u0448\u0435 3 \u0431\u0430\u0439\u0442.","\u042D\u043B. \u0430\u0434\u0440\u0435\u0441","\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u0430\u0434\u0440\u0435\u0441 \u0432\u0430\u0448\u0435\u0439 \u044D\u043B\u0435\u043A\u0442\u0440\u043E\u043D\u043D\u043E\u0439 \u043F\u043E\u0447\u0442\u044B.","\u0412\u0435\u0431-\u0441\u0430\u0439\u0442","\u041D\u0435\u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u044B\u0439","\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u0437\u0434\u0435\u0441\u044C...","\u041F\u043E\u043A\u0430 \u043D\u0435\u0442 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0435\u0432.","\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C","Like","Cancel like","\u041E\u0442\u0432\u0435\u0447\u0430\u0442\u044C","\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C \u043E\u0442\u0432\u0435\u0442","\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438","\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C","\u0417\u0430\u0433\u0440\u0443\u0437\u0438 \u0431\u043E\u043B\u044C\u0448\u0435...","\u041F\u0440\u0435\u0432\u044C\u044E","\u044D\u043C\u043E\u0434\u0437\u0438","\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435","\u0441\u0435\u043A\u0443\u043D\u0434 \u043D\u0430\u0437\u0430\u0434","\u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043C\u0438\u043D\u0443\u0442 \u043D\u0430\u0437\u0430\u0434","\u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u0447\u0430\u0441\u043E\u0432 \u043D\u0430\u0437\u0430\u0434","\u0434\u043D\u0435\u0439 \u043D\u0430\u0437\u0430\u0434","\u043F\u0440\u044F\u043C\u043E \u0441\u0435\u0439\u0447\u0430\u0441","\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430","\u0410\u0432\u0442\u043E\u0440\u0438\u0437\u043E\u0432\u0430\u0442\u044C\u0441\u044F","\u0412\u044B\u0445\u043E\u0434 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043C\u044B","\u0410\u0434\u043C\u0438\u043D","\u041B\u0438\u043F\u043A\u0438\u0439","\u0421\u043B\u043E\u0432\u0430",`\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u043E\u0442 $0 \u0434\u043E $1 \u0441\u043B\u043E\u0432!
\u041D\u043E\u043C\u0435\u0440 \u0442\u0435\u043A\u0443\u0449\u0435\u0433\u043E \u0441\u043B\u043E\u0432\u0430: $2`,"\u0410\u043D\u043E\u043D\u0438\u043C\u043D\u044B\u0439","Dwarves","Hobbits","Ents","Wizards","Elves","Maiar","GIF","\u041F\u043E\u0438\u0441\u043A GIF","\u041F\u0435\u0440\u0441\u043E\u043D\u0430\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435","\u041E\u0434\u043E\u0431\u0440\u0435\u043D\u043D\u044B\u0439","\u041E\u0436\u0438\u0434\u0430\u044E\u0449\u0438\u0439","\u0421\u043F\u0430\u043C","\u041D\u0435\u043B\u0438\u043F\u043A\u0438\u0439","\u0441\u0430\u043C\u044B\u0439 \u0441\u0442\u0430\u0440\u044B\u0439","\u043F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0439","\u0441\u0430\u043C\u044B\u0439 \u0433\u043E\u0440\u044F\u0447\u0438\u0439","\u0427\u0442\u043E \u0432\u044B \u0434\u0443\u043C\u0430\u0435\u0442\u0435?"]),xA=iC(["\u6635\u79F0","\u6635\u79F0\u4E0D\u80FD\u5C11\u4E8E3\u4E2A\u5B57\u7B26","\u90AE\u7BB1","\u8BF7\u586B\u5199\u6B63\u786E\u7684\u90AE\u4EF6\u5730\u5740","\u7F51\u5740","\u53EF\u9009","\u6B22\u8FCE\u8BC4\u8BBA","\u6765\u53D1\u8BC4\u8BBA\u5427~","\u63D0\u4EA4","\u559C\u6B22","\u53D6\u6D88\u559C\u6B22","\u56DE\u590D","\u53D6\u6D88\u56DE\u590D","\u8BC4\u8BBA","\u5237\u65B0","\u52A0\u8F7D\u66F4\u591A...","\u9884\u89C8","\u8868\u60C5","\u4E0A\u4F20\u56FE\u7247","\u79D2\u524D","\u5206\u949F\u524D","\u5C0F\u65F6\u524D","\u5929\u524D","\u521A\u521A","\u6B63\u5728\u4E0A\u4F20","\u767B\u5F55","\u9000\u51FA","\u535A\u4E3B","\u7F6E\u9876","\u5B57",`\u8BC4\u8BBA\u5B57\u6570\u5E94\u5728 $0 \u5230 $1 \u5B57\u4E4B\u95F4\uFF01
\u5F53\u524D\u5B57\u6570\uFF1A$2`,"\u533F\u540D","\u6F5C\u6C34","\u5192\u6CE1","\u5410\u69FD","\u6D3B\u8DC3","\u8BDD\u75E8","\u4F20\u8BF4","\u8868\u60C5\u5305","\u641C\u7D22\u8868\u60C5\u5305","\u4E2A\u4EBA\u8D44\u6599","\u901A\u8FC7","\u5F85\u5BA1\u6838","\u5783\u573E","\u53D6\u6D88\u7F6E\u9876","\u6309\u5012\u5E8F","\u6309\u6B63\u5E8F","\u6309\u70ED\u5EA6","\u4F60\u8BA4\u4E3A\u8FD9\u7BC7\u6587\u7AE0\u600E\u4E48\u6837\uFF1F"]),le=iC(["\u66B1\u7A31","\u66B1\u7A31\u4E0D\u80FD\u5C11\u65BC3\u500B\u5B57\u5143","\u90F5\u7BB1","\u8ACB\u586B\u5BEB\u6B63\u78BA\u7684\u90F5\u4EF6\u5730\u5740","\u7DB2\u5740","\u53EF\u9078","\u6B61\u8FCE\u7559\u8A00","\u4F86\u767C\u7559\u8A00\u5427~","\u9001\u51FA","\u559C\u6B61","\u53D6\u6D88\u559C\u6B61","\u56DE\u8986","\u53D6\u6D88\u56DE\u8986","\u7559\u8A00","\u91CD\u6574","\u8F09\u5165\u66F4\u591A...","\u9810\u89BD","\u8868\u60C5","\u4E0A\u50B3\u5716\u7247","\u79D2\u524D","\u5206\u9418\u524D","\u5C0F\u6642\u524D","\u5929\u524D","\u525B\u525B","\u6B63\u5728\u4E0A\u50B3","\u767B\u5165","\u767B\u51FA","\u7BA1\u7406\u8005","\u7F6E\u9802","\u5B57",`\u7559\u8A00\u5B57\u6578\u61C9\u5728 $0 \u5230 $1 \u5B57\u4E4B\u9593\uFF01
\u76EE\u524D\u5B57\u6578\uFF1A$2`,"\u533F\u540D","\u6F5B\u6C34","\u5192\u6CE1","\u5410\u69FD","\u6D3B\u8E8D","\u591A\u8A71","\u50B3\u8AAA","\u8868\u60C5\u5305","\u641C\u5C0B\u8868\u60C5\u5305","\u500B\u4EBA\u8CC7\u6599","\u901A\u904E","\u5F85\u5BE9\u6838","\u5783\u573E","\u53D6\u6D88\u7F6E\u9802","\u6700\u65E9","\u6700\u65B0","\u71B1\u9580","\u4F60\u8A8D\u70BA\u9019\u7BC7\u6587\u7AE0\u600E\u9EBC\u6A23\uFF1F"]),TA={zh:xA,"zh-cn":xA,"zh-CN":xA,"zh-tw":le,"zh-TW":le,en:DA,"en-US":DA,"en-us":DA,jp:DC,ja:DC,"jp-jp":DC,"jp-JP":DC,"pt-br":Ae,"pt-BR":Ae,ru:QA,"ru-ru":QA,"ru-RU":QA},Gi={"Content-Type":"application/json"},Cl=(g,I="")=>{if(typeof g=="object"&&g.errno)throw new TypeError(`${I} failed with ${g.errno}: ${g.errmsg}`);return g},bi=({serverURL:g,lang:I,paths:C,type:A,signal:l})=>GM_fetch(`${g}/article?path=${encodeURIComponent(C.join(","))}&type=${encodeURIComponent(A.join(","))}&lang=${I}`,{signal:l}).then(i=>i.json()),Al=({serverURL:g,lang:I,path:C,type:A,action:l})=>GM_fetch(`${g}/article?lang=${I}`,{method:"POST",headers:Gi,body:JSON.stringify({path:C,type:A,action:l})}).then(i=>i.json()),IA=({serverURL:g,lang:I,token:C,objectId:A,comment:l})=>GM_fetch(`${g}/comment/${A}?lang=${I}`,{method:"PUT",headers:{...Gi,Authorization:`Bearer ${C}`},body:JSON.stringify(l)}).then(i=>i.json()).then(i=>Cl(i,"Update comment")),pi=g=>{try{g=decodeURI(g)}catch{}return g},ri=(g="")=>g.replace(/\/$/u,""),hi=g=>/^(https?:)?\/\//.test(g),oA=g=>{let I=ri(g);return hi(I)?I:`https://${I}`},At=g=>Array.isArray(g)?g:!!g&&[0,g],EA=(g,I)=>typeof g=="function"?g:g!==!1&&I,PA="{--waline-white:#000;--waline-light-grey:#666;--waline-dark-grey:#999;--waline-color:#888;--waline-bgcolor:#1e1e1e;--waline-bgcolor-light:#272727;--waline-bgcolor-hover: #444;--waline-border-color:#333;--waline-disable-bgcolor:#444;--waline-disable-color:#272727;--waline-bq-color:#272727;--waline-info-bgcolor:#272727;--waline-info-color:#666}",jA=(g,I)=>{let C=g.toString();for(;C.length<I;)C="0"+C;return C},lt=(g,I,C)=>{if(!g)return"";let A=typeof g=="string"?new Date(g.indexOf(" ")!==-1?g.replace(/-/g,"/"):g):g,l=I.getTime()-A.getTime(),i=Math.floor(l/864e5);if(i===0){let e=l%864e5,o=Math.floor(e/36e5);if(o===0){let t=e%36e5,n=Math.floor(t/6e4);if(n===0){let c=t%6e4;return`${Math.round(c/1e3)} ${C.seconds}`}return`${n} ${C.minutes}`}return`${o} ${C.hours}`}return i<0?C.now:i<8?`${i} ${C.days}`:(e=>{let o=jA(e.getDate(),2),t=jA(e.getMonth()+1,2);return`${jA(e.getFullYear(),2)}-${t}-${o}`})(A)},et=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function pl(g,I){let C=Object.create(null),A=g.split(",");for(let l=0;l<A.length;l++)C[A[l]]=!0;return I?l=>!!C[l.toLowerCase()]:l=>!!C[l]}var bg={},OI=[],DI=()=>{},it=()=>!1,ot=/^on[^a-z]/,yA=g=>ot.test(g),rl=g=>g.startsWith("onUpdate:"),vg=Object.assign,Bi=(g,I)=>{let C=g.indexOf(I);C>-1&&g.splice(C,1)},tt=Object.prototype.hasOwnProperty,ig=(g,I)=>tt.call(g,I),_=Array.isArray,_I=g=>vC(g)==="[object Map]",oC=g=>vC(g)==="[object Set]",ee=g=>vC(g)==="[object Date]",ug=g=>typeof g=="function",Hg=g=>typeof g=="string",rC=g=>typeof g=="symbol",rg=g=>g!==null&&typeof g=="object",yi=g=>rg(g)&&ug(g.then)&&ug(g.catch),Vi=Object.prototype.toString,vC=g=>Vi.call(g),nt=g=>vC(g).slice(8,-1),Xi=g=>vC(g)==="[object Object]",hl=g=>Hg(g)&&g!=="NaN"&&g[0]!=="-"&&""+parseInt(g,10)===g,CA=pl(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),VA=g=>{let I=Object.create(null);return C=>I[C]||(I[C]=g(C))},ct=/-(\w)/g,dI=VA(g=>g.replace(ct,(I,C)=>C?C.toUpperCase():"")),st=/\B([A-Z])/g,tC=VA(g=>g.replace(st,"-$1").toLowerCase()),XA=VA(g=>g.charAt(0).toUpperCase()+g.slice(1)),OA=VA(g=>g?`on${XA(g)}`:""),hC=(g,I)=>!Object.is(g,I),AA=(g,I)=>{for(let C=0;C<g.length;C++)g[C](I)},tA=(g,I,C)=>{Object.defineProperty(g,I,{configurable:!0,enumerable:!1,value:C})},nA=g=>{let I=parseFloat(g);return isNaN(I)?g:I},ie,ll=()=>ie||(ie=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function BC(g){if(_(g)){let I={};for(let C=0;C<g.length;C++){let A=g[C],l=Hg(A)?mt(A):BC(A);if(l)for(let i in l)I[i]=l[i]}return I}return Hg(g)||rg(g)?g:void 0}var at=/;(?![^(]*\))/g,dt=/:([^]+)/,ut=new RegExp("\\/\\*.*?\\*\\/","gs");function mt(g){let I={};return g.replace(ut,"").split(at).forEach(C=>{if(C){let A=C.split(dt);A.length>1&&(I[A[0].trim()]=A[1].trim())}}),I}function Sg(g){let I="";if(Hg(g))I=g;else if(_(g))for(let C=0;C<g.length;C++){let A=Sg(g[C]);A&&(I+=A+" ")}else if(rg(g))for(let C in g)g[C]&&(I+=C+" ");return I.trim()}var Zt=pl("itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly");function oe(g){return!!g||g===""}function xI(g,I){if(g===I)return!0;let C=ee(g),A=ee(I);if(C||A)return!(!C||!A)&&g.getTime()===I.getTime();if(C=rC(g),A=rC(I),C||A)return g===I;if(C=_(g),A=_(I),C||A)return!(!C||!A)&&function(l,i){if(l.length!==i.length)return!1;let e=!0;for(let o=0;e&&o<l.length;o++)e=xI(l[o],i[o]);return e}(g,I);if(C=rg(g),A=rg(I),C||A){if(!C||!A||Object.keys(g).length!==Object.keys(I).length)return!1;for(let l in g){let i=g.hasOwnProperty(l),e=I.hasOwnProperty(l);if(i&&!e||!i&&e||!xI(g[l],I[l]))return!1}}return String(g)===String(I)}function Bl(g,I){return g.findIndex(C=>xI(C,I))}var og=g=>Hg(g)?g:g==null?"":_(g)||rg(g)&&(g.toString===Vi||!ug(g.toString))?JSON.stringify(g,Si,2):String(g),Si=(g,I)=>I&&I.__v_isRef?Si(g,I.value):_I(I)?{[`Map(${I.size})`]:[...I.entries()].reduce((C,[A,l])=>(C[`${A} =>`]=l,C),{})}:oC(I)?{[`Set(${I.size})`]:[...I.values()]}:!rg(I)||_(I)||Xi(I)?I:String(I),Eg,el=class{constructor(I=!1){this.detached=I,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Eg,!I&&Eg&&(this.index=(Eg.scopes||(Eg.scopes=[])).push(this)-1)}get active(){return this._active}run(I){if(this._active){let C=Eg;try{return Eg=this,I()}finally{Eg=C}}}on(){Eg=this}off(){Eg=this.parent}stop(I){if(this._active){let C,A;for(C=0,A=this.effects.length;C<A;C++)this.effects[C].stop();for(C=0,A=this.cleanups.length;C<A;C++)this.cleanups[C]();if(this.scopes)for(C=0,A=this.scopes.length;C<A;C++)this.scopes[C].stop(!0);if(!this.detached&&this.parent&&!I){let l=this.parent.scopes.pop();l&&l!==this&&(this.parent.scopes[this.index]=l,l.index=this.index)}this.parent=void 0,this._active=!1}}};function Wi(){return Eg}var yl=g=>{let I=new Set(g);return I.w=0,I.n=0,I},Ri=g=>(g.w&HI)>0,wi=g=>(g.n&HI)>0,il=new WeakMap,dC=0,HI=1,ol=30,lI,QI=Symbol(""),tl=Symbol(""),yC=class{constructor(I,C=null,A){this.fn=I,this.scheduler=C,this.active=!0,this.deps=[],this.parent=void 0,function(l,i=Eg){i&&i.active&&i.effects.push(l)}(this,A)}run(){if(!this.active)return this.fn();let I=lI,C=YI;for(;I;){if(I===this)return;I=I.parent}try{return this.parent=lI,lI=this,YI=!0,HI=1<<++dC,dC<=ol?(({deps:A})=>{if(A.length)for(let l=0;l<A.length;l++)A[l].w|=HI})(this):te(this),this.fn()}finally{dC<=ol&&(A=>{let{deps:l}=A;if(l.length){let i=0;for(let e=0;e<l.length;e++){let o=l[e];Ri(o)&&!wi(o)?o.delete(A):l[i++]=o,o.w&=~HI,o.n&=~HI}l.length=i}})(this),HI=1<<--dC,lI=this.parent,YI=C,this.parent=void 0,this.deferStop&&this.stop()}}stop(){lI===this?this.deferStop=!0:this.active&&(te(this),this.onStop&&this.onStop(),this.active=!1)}};function te(g){let{deps:I}=g;if(I.length){for(let C=0;C<I.length;C++)I[C].delete(g);I.length=0}}var YI=!0,Ki=[];function VC(){Ki.push(YI),YI=!1}function XC(){let g=Ki.pop();YI=g===void 0||g}function xg(g,I,C){if(YI&&lI){let A=il.get(g);A||il.set(g,A=new Map);let l=A.get(C);l||A.set(C,l=yl()),Hi(l)}}function Hi(g,I){let C=!1;dC<=ol?wi(g)||(g.n|=HI,C=!Ri(g)):C=!g.has(lI),C&&(g.add(lI),lI.deps.push(g))}function yI(g,I,C,A,l,i){let e=il.get(g);if(!e)return;let o=[];if(I==="clear")o=[...e.values()];else if(C==="length"&&_(g)){let t=Number(A);e.forEach((n,c)=>{(c==="length"||c>=t)&&o.push(n)})}else switch(C!==void 0&&o.push(e.get(C)),I){case"add":_(g)?hl(C)&&o.push(e.get("length")):(o.push(e.get(QI)),_I(g)&&o.push(e.get(tl)));break;case"delete":_(g)||(o.push(e.get(QI)),_I(g)&&o.push(e.get(tl)));break;case"set":_I(g)&&o.push(e.get(QI))}if(o.length===1)o[0]&&nl(o[0]);else{let t=[];for(let n of o)n&&t.push(...n);nl(yl(t))}}function nl(g,I){let C=_(g)?g:[...g];for(let A of C)A.computed&&ne(A);for(let A of C)A.computed||ne(A)}function ne(g,I){(g!==lI||g.allowRecurse)&&(g.scheduler?g.scheduler():g.run())}var Gt=pl("__proto__,__v_isRef,__isVue"),Li=new Set(Object.getOwnPropertyNames(Symbol).filter(g=>g!=="arguments"&&g!=="caller").map(g=>Symbol[g]).filter(rC)),bt=Vl(),pt=Vl(!1,!0),rt=Vl(!0),ce=ht();function ht(){let g={};return["includes","indexOf","lastIndexOf"].forEach(I=>{g[I]=function(...C){let A=tg(this);for(let i=0,e=this.length;i<e;i++)xg(A,0,i+"");let l=A[I](...C);return l===-1||l===!1?A[I](...C.map(tg)):l}}),["push","pop","shift","unshift","splice"].forEach(I=>{g[I]=function(...C){VC();let A=tg(this)[I].apply(this,C);return XC(),A}}),g}function Bt(g){let I=tg(this);return xg(I,0,g),I.hasOwnProperty(g)}function Vl(g=!1,I=!1){return function(C,A,l){if(A==="__v_isReactive")return!g;if(A==="__v_isReadonly")return g;if(A==="__v_isShallow")return I;if(A==="__v_raw"&&l===(g?I?Yt:Fi:I?vi:ki).get(C))return C;let i=_(C);if(!g){if(i&&ig(ce,A))return Reflect.get(ce,A,l);if(A==="hasOwnProperty")return Bt}let e=Reflect.get(C,A,l);return(rC(A)?Li.has(A):Gt(A))?e:(g||xg(C,0,A),I?e:Kg(e)?i&&hl(A)?e:e.value:rg(e)?g?FC(e):SC(e):e)}}function Yi(g=!1){return function(I,C,A,l){let i=I[C];if(CC(i)&&Kg(i)&&!Kg(A))return!1;if(!g&&(cA(A)||CC(A)||(i=tg(i),A=tg(A)),!_(I)&&Kg(i)&&!Kg(A)))return i.value=A,!0;let e=_(I)&&hl(C)?Number(C)<I.length:ig(I,C),o=Reflect.set(I,C,A,l);return I===tg(l)&&(e?hC(A,i)&&yI(I,"set",C,A):yI(I,"add",C,A)),o}}var fi={get:bt,set:Yi(),deleteProperty:function(g,I){let C=ig(g,I),A=Reflect.deleteProperty(g,I);return A&&C&&yI(g,"delete",I,void 0),A},has:function(g,I){let C=Reflect.has(g,I);return rC(I)&&Li.has(I)||xg(g,0,I),C},ownKeys:function(g){return xg(g,0,_(g)?"length":QI),Reflect.ownKeys(g)}},yt={get:rt,set:(g,I)=>!0,deleteProperty:(g,I)=>!0},Vt=vg({},fi,{get:pt,set:Yi(!0)}),Xl=g=>g,SA=g=>Reflect.getPrototypeOf(g);function QC(g,I,C=!1,A=!1){let l=tg(g=g.__v_raw),i=tg(I);C||(I!==i&&xg(l,0,I),xg(l,0,i));let{has:e}=SA(l),o=A?Xl:C?Rl:WC;return e.call(l,I)?o(g.get(I)):e.call(l,i)?o(g.get(i)):void(g!==l&&g.get(I))}function xC(g,I=!1){let C=this.__v_raw,A=tg(C),l=tg(g);return I||(g!==l&&xg(A,0,g),xg(A,0,l)),g===l?C.has(g):C.has(g)||C.has(l)}function TC(g,I=!1){return g=g.__v_raw,!I&&xg(tg(g),0,QI),Reflect.get(g,"size",g)}function se(g){g=tg(g);let I=tg(this);return SA(I).has.call(I,g)||(I.add(g),yI(I,"add",g,g)),this}function ae(g,I){I=tg(I);let C=tg(this),{has:A,get:l}=SA(C),i=A.call(C,g);i||(g=tg(g),i=A.call(C,g));let e=l.call(C,g);return C.set(g,I),i?hC(I,e)&&yI(C,"set",g,I):yI(C,"add",g,I),this}function de(g){let I=tg(this),{has:C,get:A}=SA(I),l=C.call(I,g);l||(g=tg(g),l=C.call(I,g)),A&&A.call(I,g);let i=I.delete(g);return l&&yI(I,"delete",g,void 0),i}function ue(){let g=tg(this),I=g.size!==0,C=g.clear();return I&&yI(g,"clear",void 0,void 0),C}function EC(g,I){return function(C,A){let l=this,i=l.__v_raw,e=tg(i),o=I?Xl:g?Rl:WC;return!g&&xg(e,0,QI),i.forEach((t,n)=>C.call(A,o(t),o(n),l))}}function PC(g,I,C){return function(...A){let l=this.__v_raw,i=tg(l),e=_I(i),o=g==="entries"||g===Symbol.iterator&&e,t=g==="keys"&&e,n=l[g](...A),c=C?Xl:I?Rl:WC;return!I&&xg(i,0,t?tl:QI),{next(){let{value:s,done:d}=n.next();return d?{value:s,done:d}:{value:o?[c(s[0]),c(s[1])]:c(s),done:d}},[Symbol.iterator](){return this}}}}function RI(g){return function(...I){return g!=="delete"&&this}}function Xt(){let g={get(l){return QC(this,l)},get size(){return TC(this)},has:xC,add:se,set:ae,delete:de,clear:ue,forEach:EC(!1,!1)},I={get(l){return QC(this,l,!1,!0)},get size(){return TC(this)},has:xC,add:se,set:ae,delete:de,clear:ue,forEach:EC(!1,!0)},C={get(l){return QC(this,l,!0)},get size(){return TC(this,!0)},has(l){return xC.call(this,l,!0)},add:RI("add"),set:RI("set"),delete:RI("delete"),clear:RI("clear"),forEach:EC(!0,!1)},A={get(l){return QC(this,l,!0,!0)},get size(){return TC(this,!0)},has(l){return xC.call(this,l,!0)},add:RI("add"),set:RI("set"),delete:RI("delete"),clear:RI("clear"),forEach:EC(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(l=>{g[l]=PC(l,!1,!1),C[l]=PC(l,!0,!1),I[l]=PC(l,!1,!0),A[l]=PC(l,!0,!0)}),[g,C,I,A]}var[St,Wt,Rt,wt]=Xt();function Sl(g,I){let C=I?g?wt:Rt:g?Wt:St;return(A,l,i)=>l==="__v_isReactive"?!g:l==="__v_isReadonly"?g:l==="__v_raw"?A:Reflect.get(ig(C,l)&&l in A?C:A,l,i)}var Kt={get:Sl(!1,!1)},Ht={get:Sl(!1,!0)},Lt={get:Sl(!0,!1)},ki=new WeakMap,vi=new WeakMap,Fi=new WeakMap,Yt=new WeakMap;function SC(g){return CC(g)?g:Wl(g,!1,fi,Kt,ki)}function FC(g){return Wl(g,!0,yt,Lt,Fi)}function Wl(g,I,C,A,l){if(!rg(g)||g.__v_raw&&(!I||!g.__v_isReactive))return g;let i=l.get(g);if(i)return i;let e=(o=g).__v_skip||!Object.isExtensible(o)?0:function(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}(nt(o));var o;if(e===0)return g;let t=new Proxy(g,e===2?A:C);return l.set(g,t),t}function $I(g){return CC(g)?$I(g.__v_raw):!(!g||!g.__v_isReactive)}function CC(g){return!(!g||!g.__v_isReadonly)}function cA(g){return!(!g||!g.__v_isShallow)}function me(g){return $I(g)||CC(g)}function tg(g){let I=g&&g.__v_raw;return I?tg(I):g}function Ji(g){return tA(g,"__v_skip",!0),g}var WC=g=>rg(g)?SC(g):g,Rl=g=>rg(g)?FC(g):g;function Ni(g){YI&&lI&&Hi((g=tg(g)).dep||(g.dep=yl()))}function Ui(g,I){let C=(g=tg(g)).dep;C&&nl(C)}function Kg(g){return!(!g||g.__v_isRef!==!0)}function Ig(g){return Mi(g,!1)}function ft(g){return Mi(g,!0)}function Mi(g,I){return Kg(g)?g:new cl(g,I)}var cl=class{constructor(I,C){this.__v_isShallow=C,this.dep=void 0,this.__v_isRef=!0,this._rawValue=C?I:tg(I),this._value=C?I:WC(I)}get value(){return Ni(this),this._value}set value(I){let C=this.__v_isShallow||cA(I)||CC(I);I=C?I:tg(I),hC(I,this._rawValue)&&(this._rawValue=I,this._value=C?I:WC(I),Ui(this))}};function Cg(g){return Kg(g)?g.value:g}var kt={get:(g,I,C)=>Cg(Reflect.get(g,I,C)),set:(g,I,C,A)=>{let l=g[I];return Kg(l)&&!Kg(C)?(l.value=C,!0):Reflect.set(g,I,C,A)}};function zi(g){return $I(g)?g:new Proxy(g,kt)}var sl=class{constructor(I,C,A,l){this._setter=C,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this._dirty=!0,this.effect=new yC(I,()=>{this._dirty||(this._dirty=!0,Ui(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!l,this.__v_isReadonly=A}get value(){let I=tg(this);return Ni(I),!I._dirty&&I._cacheable||(I._dirty=!1,I._value=I.effect.run()),I._value}set value(I){this._setter(I)}};function fI(g,I,C,A){let l;try{l=A?g(...A):g()}catch(i){WA(i,I,C)}return l}function aI(g,I,C,A){if(ug(g)){let i=fI(g,I,C,A);return i&&yi(i)&&i.catch(e=>{WA(e,I,C)}),i}let l=[];for(let i=0;i<g.length;i++)l.push(aI(g[i],I,C,A));return l}function WA(g,I,C,A=!0){if(I&&I.vnode,I){let l=I.parent,i=I.proxy,e=C;for(;l;){let t=l.ec;if(t){for(let n=0;n<t.length;n++)if(t[n](g,i,e)===!1)return}l=l.parent}let o=I.appContext.config.errorHandler;if(o)return void fI(o,null,10,[g,i,e])}(function(l,i,e,o=!0){console.error(l)})(g,0,0,A)}var RC=!1,al=!1,kg=[],sI=0,qI=[],bI=null,UI=0,Di=Promise.resolve(),wl=null;function RA(g){let I=wl||Di;return g?I.then(this?g.bind(this):g):I}function Kl(g){kg.length&&kg.includes(g,RC&&g.allowRecurse?sI+1:sI)||(g.id==null?kg.push(g):kg.splice(function(I){let C=sI+1,A=kg.length;for(;C<A;){let l=C+A>>>1;wC(kg[l])<I?C=l+1:A=l}return C}(g.id),0,g),Qi())}function Qi(){RC||al||(al=!0,wl=Di.then(Ti))}function Ze(g,I=RC?sI+1:0){for(;I<kg.length;I++){let C=kg[I];C&&C.pre&&(kg.splice(I,1),I--,C())}}function xi(g){if(qI.length){let I=[...new Set(qI)];if(qI.length=0,bI)return void bI.push(...I);for(bI=I,bI.sort((C,A)=>wC(C)-wC(A)),UI=0;UI<bI.length;UI++)bI[UI]();bI=null,UI=0}}var wC=g=>g.id==null?1/0:g.id,vt=(g,I)=>{let C=wC(g)-wC(I);if(C===0){if(g.pre&&!I.pre)return-1;if(I.pre&&!g.pre)return 1}return C};function Ti(g){al=!1,RC=!0,kg.sort(vt);try{for(sI=0;sI<kg.length;sI++){let I=kg[sI];I&&I.active!==!1&&fI(I,null,14)}}finally{sI=0,kg.length=0,xi(),RC=!1,wl=null,(kg.length||qI.length)&&Ti()}}function Ft(g,I,...C){if(g.isUnmounted)return;let A=g.vnode.props||bg,l=C,i=I.startsWith("update:"),e=i&&I.slice(7);if(e&&e in A){let c=`${e==="modelValue"?"model":e}Modifiers`,{number:s,trim:d}=A[c]||bg;d&&(l=C.map(b=>Hg(b)?b.trim():b)),s&&(l=C.map(nA))}let o,t=A[o=OA(I)]||A[o=OA(dI(I))];!t&&i&&(t=A[o=OA(tC(I))]),t&&aI(t,g,6,l);let n=A[o+"Once"];if(n){if(g.emitted){if(g.emitted[o])return}else g.emitted={};g.emitted[o]=!0,aI(n,g,6,l)}}function Jt(g,I,C=!1){let A=I.emitsCache,l=A.get(g);if(l!==void 0)return l;let i=g.emits,e={};return i?(_(i)?i.forEach(o=>e[o]=null):vg(e,i),rg(g)&&A.set(g,e),e):(rg(g)&&A.set(g,null),null)}function sA(g,I){return!(!g||!yA(I))&&(I=I.slice(2).replace(/Once$/,""),ig(g,I[0].toLowerCase()+I.slice(1))||ig(g,tC(I))||ig(g,I))}var Pg=null,Ei=null;function aA(g){let I=Pg;return Pg=g,Ei=g&&g.type.__scopeId||null,I}function _A(g){let{type:I,vnode:C,proxy:A,withProxy:l,props:i,propsOptions:[e],slots:o,attrs:t,emit:n,render:c,renderCache:s,data:d,setupState:b,ctx:r,inheritAttrs:m}=g,u,G,p=aA(g);try{if(4&C.shapeFlag){let R=l||A;u=cI(c.call(R,R,s,i,b,d,r)),G=t}else{let R=I;u=cI(R.length>1?R(i,{attrs:t,slots:o,emit:n}):R(i,null)),G=I.props?t:Nt(t)}}catch(R){ZC.length=0,WA(R,g,1),u=dg(TI)}let V=u;if(G&&m!==!1){let R=Object.keys(G),{shapeFlag:L}=V;R.length&&7&L&&(e&&R.some(rl)&&(G=Ut(G,e)),V=AC(V,G))}return C.dirs&&(V=AC(V),V.dirs=V.dirs?V.dirs.concat(C.dirs):C.dirs),C.transition&&(V.transition=C.transition),u=V,aA(p),u}var Nt=g=>{let I;for(let C in g)(C==="class"||C==="style"||yA(C))&&((I||(I={}))[C]=g[C]);return I},Ut=(g,I)=>{let C={};for(let A in g)rl(A)&&A.slice(9)in I||(C[A]=g[A]);return C};function Ge(g,I,C){let A=Object.keys(I);if(A.length!==Object.keys(g).length)return!0;for(let l=0;l<A.length;l++){let i=A[l];if(I[i]!==g[i]&&!sA(C,i))return!0}return!1}function be(g,I){return Pi(g,null,I)}var jC={};function gI(g,I,C){return Pi(g,I,C)}function Pi(g,I,{immediate:C,deep:A,flush:l,onTrack:i,onTrigger:e}=bg){var o;let t=Wi()===((o=zg)==null?void 0:o.scope)?zg:null,n,c,s=!1,d=!1;if(Kg(g)?(n=()=>g.value,s=cA(g)):$I(g)?(n=()=>g,A=!0):_(g)?(d=!0,s=g.some(R=>$I(R)||cA(R)),n=()=>g.map(R=>Kg(R)?R.value:$I(R)?zI(R):ug(R)?fI(R,t,2):void 0)):n=ug(g)?I?()=>fI(g,t,2):()=>{if(!t||!t.isUnmounted)return c&&c(),aI(g,t,3,[r])}:DI,I&&A){let R=n;n=()=>zI(R())}let b,r=R=>{c=p.onStop=()=>{fI(R,t,4)}};if(HC){if(r=DI,I?C&&aI(I,t,3,[n(),d?[]:void 0,r]):n(),l!=="sync")return DI;{let R=ln();b=R.__watcherHandles||(R.__watcherHandles=[])}}let m=d?new Array(g.length).fill(jC):jC,u=()=>{if(p.active)if(I){let R=p.run();(A||s||(d?R.some((L,M)=>hC(L,m[M])):hC(R,m)))&&(c&&c(),aI(I,t,3,[R,m===jC?void 0:d&&m[0]===jC?[]:m,r]),m=R)}else p.run()},G;u.allowRecurse=!!I,l==="sync"?G=u:l==="post"?G=()=>Qg(u,t&&t.suspense):(u.pre=!0,t&&(u.id=t.uid),G=()=>Kl(u));let p=new yC(n,G);I?C?u():m=p.run():l==="post"?Qg(p.run.bind(p),t&&t.suspense):p.run();let V=()=>{p.stop(),t&&t.scope&&Bi(t.scope.effects,p)};return b&&b.push(V),V}function zI(g,I){if(!rg(g)||g.__v_skip||(I=I||new Set).has(g))return g;if(I.add(g),Kg(g))zI(g.value,I);else if(_(g))for(let C=0;C<g.length;C++)zI(g[C],I);else if(oC(g)||_I(g))g.forEach(C=>{zI(C,I)});else if(Xi(g))for(let C in g)zI(g[C],I);return g}function OC(g,I){let C=Pg;if(C===null)return g;let A=YA(C)||C.proxy,l=g.dirs||(g.dirs=[]);for(let i=0;i<I.length;i++){let[e,o,t,n=bg]=I[i];e&&(ug(e)&&(e={mounted:e,updated:e}),e.deep&&zI(o),l.push({dir:e,instance:A,value:o,oldValue:void 0,arg:t,modifiers:n}))}return g}function JI(g,I,C,A){let l=g.dirs,i=I&&I.dirs;for(let e=0;e<l.length;e++){let o=l[e];i&&(o.oldValue=i[e].value);let t=o.dir[A];t&&(VC(),aI(t,C,8,[g.el,o,g,I]),XC())}}function JC(g,I){return ug(g)?(()=>vg({name:g.name},I,{setup:g}))():g}var lA=g=>!!g.type.__asyncLoader,Mt=g=>g.type.__isKeepAlive,Hl=g=>(I,C=zg)=>(!HC||g==="sp")&&function(A,l,i=zg,e=!1){if(i){let o=i[A]||(i[A]=[]),t=l.__weh||(l.__weh=(...n)=>{if(i.isUnmounted)return;VC(),kl(i);let c=aI(l,i,A,n);return GC(),XC(),c});return e?o.unshift(t):o.push(t),t}}(g,(...A)=>I(...A),C),NC=Hl("m"),zt=Hl("bum"),wA=Hl("um"),pe="components";function Dt(g,I){return function(C,A,l=!0,i=!1){let e=Pg||zg;if(e){let o=e.type;if(C===pe){let n=function(c,s=!0){return ug(c)?c.displayName||c.name:c.name||s&&c.__name}(o,!1);if(n&&(n===A||n===dI(A)||n===XA(dI(A))))return o}let t=re(e[C]||o[C],A)||re(e.appContext[C],A);return!t&&i?o:t}}(pe,g,!0,I)||g}var Qt=Symbol.for("v-ndc");function re(g,I){return g&&(g[I]||g[dI(I)]||g[XA(dI(I))])}function eI(g,I,C,A){let l,i=C&&C[A];if(_(g)||Hg(g)){l=new Array(g.length);for(let e=0,o=g.length;e<o;e++)l[e]=I(g[e],e,void 0,i&&i[e])}else if(typeof g=="number"){l=new Array(g);for(let e=0;e<g;e++)l[e]=I(e+1,e,void 0,i&&i[e])}else if(rg(g))if(g[Symbol.iterator])l=Array.from(g,(e,o)=>I(e,o,void 0,i&&i[o]));else{let e=Object.keys(g);l=new Array(e.length);for(let o=0,t=e.length;o<t;o++){let n=e[o];l[o]=I(g[n],n,o,i&&i[o])}}else l=[];return C&&(C[A]=l),l}var dl=g=>g?lo(g)?YA(g)||g.proxy:dl(g.parent):null,mC=vg(Object.create(null),{$:g=>g,$el:g=>g.vnode.el,$data:g=>g.data,$props:g=>g.props,$attrs:g=>g.attrs,$slots:g=>g.slots,$refs:g=>g.refs,$parent:g=>dl(g.parent),$root:g=>dl(g.root),$emit:g=>g.emit,$options:g=>g.type,$forceUpdate:g=>g.f||(g.f=()=>Kl(g.update)),$nextTick:g=>g.n||(g.n=RA.bind(g.proxy)),$watch:g=>DI}),$A=(g,I)=>g!==bg&&!g.__isScriptSetup&&ig(g,I),xt={get({_:g},I){let{ctx:C,setupState:A,data:l,props:i,accessCache:e,type:o,appContext:t}=g,n;if(I[0]!=="$"){let b=e[I];if(b!==void 0)switch(b){case 1:return A[I];case 2:return l[I];case 4:return C[I];case 3:return i[I]}else{if($A(A,I))return e[I]=1,A[I];if(l!==bg&&ig(l,I))return e[I]=2,l[I];if((n=g.propsOptions[0])&&ig(n,I))return e[I]=3,i[I];if(C!==bg&&ig(C,I))return e[I]=4,C[I];e[I]=0}}let c=mC[I],s,d;return c?(I==="$attrs"&&xg(g,0,I),c(g)):(s=o.__cssModules)&&(s=s[I])?s:C!==bg&&ig(C,I)?(e[I]=4,C[I]):(d=t.config.globalProperties,ig(d,I)?d[I]:void 0)},set({_:g},I,C){let{data:A,setupState:l,ctx:i}=g;return $A(l,I)?(l[I]=C,!0):A!==bg&&ig(A,I)?(A[I]=C,!0):!ig(g.props,I)&&(I[0]!=="$"||!(I.slice(1)in g))&&(i[I]=C,!0)},has({_:{data:g,setupState:I,accessCache:C,ctx:A,appContext:l,propsOptions:i}},e){let o;return!!C[e]||g!==bg&&ig(g,e)||$A(I,e)||(o=i[0])&&ig(o,e)||ig(A,e)||ig(mC,e)||ig(l.config.globalProperties,e)},defineProperty(g,I,C){return C.get!=null?g._.accessCache[I]=0:ig(C,"value")&&this.set(g,I,C.value,null),Reflect.defineProperty(g,I,C)}};function he(g){return _(g)?g.reduce((I,C)=>(I[C]=null,I),{}):g}function dA(g,I,C,A=!1){let{mixins:l,extends:i}=I;i&&dA(g,i,C,!0),l&&l.forEach(e=>dA(g,e,C,!0));for(let e in I)if(!(A&&e==="expose")){let o=Tt[e]||C&&C[e];g[e]=o?o(g[e],I[e]):I[e]}return g}var Tt={data:Be,props:Ve,emits:Ve,methods:cC,computed:cC,beforeCreate:Mg,created:Mg,beforeMount:Mg,mounted:Mg,beforeUpdate:Mg,updated:Mg,beforeDestroy:Mg,beforeUnmount:Mg,destroyed:Mg,unmounted:Mg,activated:Mg,deactivated:Mg,errorCaptured:Mg,serverPrefetch:Mg,components:cC,directives:cC,watch:function(g,I){if(!g)return I;if(!I)return g;let C=vg(Object.create(null),g);for(let A in I)C[A]=Mg(g[A],I[A]);return C},provide:Be,inject:function(g,I){return cC(ye(g),ye(I))}};function Be(g,I){return I?g?function(){return vg(ug(g)?g.call(this,this):g,ug(I)?I.call(this,this):I)}:I:g}function ye(g){if(_(g)){let I={};for(let C=0;C<g.length;C++)I[g[C]]=g[C];return I}return g}function Mg(g,I){return g?[...new Set([].concat(g,I))]:I}function cC(g,I){return g?vg(Object.create(null),g,I):I}function Ve(g,I){return g?_(g)&&_(I)?[...new Set([...g,...I])]:vg(Object.create(null),he(g),he(I??{})):I}function ji(){return{app:null,config:{isNativeTag:it,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}var Et=0;function Pt(g,I){return function(C,A=null){ug(C)||(C=vg({},C)),A==null||rg(A)||(A=null);let l=ji(),i=new Set,e=!1,o=l.app={_uid:Et++,_component:C,_props:A,_container:null,_context:l,_instance:null,version:en,get config(){return l.config},set config(t){},use:(t,...n)=>(i.has(t)||(t&&ug(t.install)?(i.add(t),t.install(o,...n)):ug(t)&&(i.add(t),t(o,...n))),o),mixin:t=>o,component:(t,n)=>n?(l.components[t]=n,o):l.components[t],directive:(t,n)=>n?(l.directives[t]=n,o):l.directives[t],mount(t,n,c){if(!e){let s=dg(C,A);return s.appContext=l,n&&I?I(s,t):g(s,t,c),e=!0,o._container=t,t.__vue_app__=o,YA(s.component)||s.component.proxy}},unmount(){e&&(g(null,o._container),delete o._container.__vue_app__)},provide:(t,n)=>(l.provides[t]=n,o),runWithContext(t){uA=o;try{return t()}finally{uA=null}}};return o}}var uA=null;function KA(g,I,C=!1){let A=zg||Pg;if(A||uA){let l=A?A.parent==null?A.vnode.appContext&&A.vnode.appContext.provides:A.parent.provides:uA._context.provides;if(l&&g in l)return l[g];if(arguments.length>1)return C&&ug(I)?I.call(A&&A.proxy):I}}function jt(g,I,C,A=!1){let l={},i={};tA(i,LA,1),g.propsDefaults=Object.create(null),Oi(g,I,l,i);for(let e in g.propsOptions[0])e in l||(l[e]=void 0);C?g.props=A?l:Wl(l,!1,Vt,Ht,vi):g.type.props?g.props=l:g.props=i,g.attrs=i}function Oi(g,I,C,A){let[l,i]=g.propsOptions,e,o=!1;if(I)for(let t in I){if(CA(t))continue;let n=I[t],c;l&&ig(l,c=dI(t))?i&&i.includes(c)?(e||(e={}))[c]=n:C[c]=n:sA(g.emitsOptions,t)||t in A&&n===A[t]||(A[t]=n,o=!0)}if(i){let t=tg(C),n=e||bg;for(let c=0;c<i.length;c++){let s=i[c];C[s]=ul(l,t,s,n[s],g,!ig(n,s))}}return o}function ul(g,I,C,A,l,i){let e=g[C];if(e!=null){let o=ig(e,"default");if(o&&A===void 0){let t=e.default;if(e.type!==Function&&!e.skipFactory&&ug(t)){let{propsDefaults:n}=l;C in n?A=n[C]:(kl(l),A=n[C]=t.call(null,I),GC())}else A=t}e[0]&&(i&&!o?A=!1:!e[1]||A!==""&&A!==tC(C)||(A=!0))}return A}function Ot(g,I,C=!1){let A=I.propsCache,l=A.get(g);if(l)return l;let i=g.props,e={},o=[];if(!i)return rg(g)&&A.set(g,OI),OI;if(_(i))for(let n=0;n<i.length;n++){let c=dI(i[n]);Xe(c)&&(e[c]=bg)}else if(i)for(let n in i){let c=dI(n);if(Xe(c)){let s=i[n],d=e[c]=_(s)||ug(s)?{type:s}:vg({},s);if(d){let b=Re(Boolean,d.type),r=Re(String,d.type);d[0]=b>-1,d[1]=r<0||b<r,(b>-1||ig(d,"default"))&&o.push(c)}}}let t=[e,o];return rg(g)&&A.set(g,t),t}function Xe(g){return g[0]!=="$"}function Se(g){let I=g&&g.toString().match(/^\s*(function|class) (\w+)/);return I?I[2]:g===null?"null":""}function We(g,I){return Se(g)===Se(I)}function Re(g,I){return _(I)?I.findIndex(C=>We(C,g)):ug(I)&&We(I,g)?0:-1}var _i=g=>g[0]==="_"||g==="$stable",Ll=g=>_(g)?g.map(cI):[cI(g)],_t=(g,I,C)=>{if(I._n)return I;let A=function(l,i=Pg,e){if(!i||l._n)return l;let o=(...t)=>{o._d&&we(-1);let n=aA(i),c;try{c=l(...t)}finally{aA(n),o._d&&we(1)}return c};return o._n=!0,o._c=!0,o._d=!0,o}((...l)=>Ll(I(...l)),C);return A._c=!1,A},$i=(g,I,C)=>{let A=g._ctx;for(let l in g){if(_i(l))continue;let i=g[l];if(ug(i))I[l]=_t(0,i,A);else if(i!=null){let e=Ll(i);I[l]=()=>e}}},qi=(g,I)=>{let C=Ll(I);g.slots.default=()=>C},$t=(g,I)=>{if(32&g.vnode.shapeFlag){let C=I._;C?(g.slots=tg(I),tA(I,"_",C)):$i(I,g.slots={})}else g.slots={},I&&qi(g,I);tA(g.slots,LA,1)},qt=(g,I,C)=>{let{vnode:A,slots:l}=g,i=!0,e=bg;if(32&A.shapeFlag){let o=I._;o?C&&o===1?i=!1:(vg(l,I),C||o!==1||delete l._):(i=!I.$stable,$i(I,l)),e=I}else I&&(qi(g,I),e={default:1});if(i)for(let o in l)_i(o)||o in e||delete l[o]};function ml(g,I,C,A,l=!1){if(_(g))return void g.forEach((d,b)=>ml(d,I&&(_(I)?I[b]:I),C,A,l));if(lA(A)&&!l)return;let i=4&A.shapeFlag?YA(A.component)||A.component.proxy:A.el,e=l?null:i,{i:o,r:t}=g,n=I&&I.r,c=o.refs===bg?o.refs={}:o.refs,s=o.setupState;if(n!=null&&n!==t&&(Hg(n)?(c[n]=null,ig(s,n)&&(s[n]=null)):Kg(n)&&(n.value=null)),ug(t))fI(t,o,12,[e,c]);else{let d=Hg(t),b=Kg(t);if(d||b){let r=()=>{if(g.f){let m=d?ig(s,t)?s[t]:c[t]:t.value;l?_(m)&&Bi(m,i):_(m)?m.includes(i)||m.push(i):d?(c[t]=[i],ig(s,t)&&(s[t]=c[t])):(t.value=[i],g.k&&(c[g.k]=t.value))}else d?(c[t]=e,ig(s,t)&&(s[t]=e)):b&&(t.value=e,g.k&&(c[g.k]=e))};e?(r.id=-1,Qg(r,C)):r()}}}var Qg=function(g,I){var C;I&&I.pendingBranch?_(g)?I.effects.push(...g):I.effects.push(g):(_(C=g)?qI.push(...C):bI&&bI.includes(C,C.allowRecurse?UI+1:UI)||qI.push(C),Qi())};function gn(g){return function(I,C){ll().__VUE__=!0;let{insert:A,remove:l,patchProp:i,createElement:e,createText:o,createComment:t,setText:n,setElementText:c,parentNode:s,nextSibling:d,setScopeId:b=DI,insertStaticContent:r}=I,m=(a,Z,h,X=null,y=null,W=null,K=!1,w=null,S=!!Z.dynamicChildren)=>{if(a===Z)return;a&&!sC(a,Z)&&(X=AI(a),Wg(a,y,W,!0),a=null),Z.patchFlag===-2&&(S=!1,Z.dynamicChildren=null);let{type:B,ref:Y,shapeFlag:H}=Z;switch(B){case HA:u(a,Z,h,X);break;case TI:G(a,Z,h,X);break;case qA:a==null&&p(Z,h,X,K);break;case pg:E(a,Z,h,X,y,W,K,w,S);break;default:1&H?L(a,Z,h,X,y,W,K,w,S):6&H?j(a,Z,h,X,y,W,K,w,S):(64&H||128&H)&&B.process(a,Z,h,X,y,W,K,w,S,tI)}Y!=null&&y&&ml(Y,a&&a.ref,W,Z||a,!Z)},u=(a,Z,h,X)=>{if(a==null)A(Z.el=o(Z.children),h,X);else{let y=Z.el=a.el;Z.children!==a.children&&n(y,Z.children)}},G=(a,Z,h,X)=>{a==null?A(Z.el=t(Z.children||""),h,X):Z.el=a.el},p=(a,Z,h,X)=>{[a.el,a.anchor]=r(a.children,Z,h,X,a.el,a.anchor)},V=({el:a,anchor:Z},h,X)=>{let y;for(;a&&a!==Z;)y=d(a),A(a,h,X),a=y;A(Z,h,X)},R=({el:a,anchor:Z})=>{let h;for(;a&&a!==Z;)h=d(a),l(a),a=h;l(Z)},L=(a,Z,h,X,y,W,K,w,S)=>{K=K||Z.type==="svg",a==null?M(Z,h,X,y,W,K,w,S):sg(a,Z,y,W,K,w,S)},M=(a,Z,h,X,y,W,K,w)=>{let S,B,{type:Y,props:H,shapeFlag:f,transition:k,dirs:U}=a;if(S=a.el=e(a.type,W,H&&H.is,H),8&f?c(S,a.children):16&f&&D(a.children,S,null,X,y,W&&Y!=="foreignObject",K,w),U&&JI(a,null,X,"created"),x(S,a,a.scopeId,K,X),H){for(let gg in H)gg==="value"||CA(gg)||i(S,gg,null,H[gg],W,a.children,X,y,Xg);"value"in H&&i(S,"value",null,H.value),(B=H.onVnodeBeforeMount)&&nI(B,X,a)}U&&JI(a,null,X,"beforeMount");let Q=(!y||y&&!y.pendingBranch)&&k&&!k.persisted;Q&&k.beforeEnter(S),A(S,Z,h),((B=H&&H.onVnodeMounted)||Q||U)&&Qg(()=>{B&&nI(B,X,a),Q&&k.enter(S),U&&JI(a,null,X,"mounted")},y)},x=(a,Z,h,X,y)=>{if(h&&b(a,h),X)for(let W=0;W<X.length;W++)b(a,X[W]);if(y&&Z===y.subTree){let W=y.vnode;x(a,W,W.scopeId,W.slotScopeIds,y.parent)}},D=(a,Z,h,X,y,W,K,w,S=0)=>{for(let B=S;B<a.length;B++){let Y=a[B]=w?wI(a[B]):cI(a[B]);m(null,Y,Z,h,X,y,W,K,w)}},sg=(a,Z,h,X,y,W,K)=>{let w=Z.el=a.el,{patchFlag:S,dynamicChildren:B,dirs:Y}=Z;S|=16&a.patchFlag;let H=a.props||bg,f=Z.props||bg,k;h&&NI(h,!1),(k=f.onVnodeBeforeUpdate)&&nI(k,h,Z,a),Y&&JI(Z,a,h,"beforeUpdate"),h&&NI(h,!0);let U=y&&Z.type!=="foreignObject";if(B?Fg(a.dynamicChildren,B,w,h,X,U,W):K||Bg(a,Z,w,null,h,X,U,W,!1),S>0){if(16&S)jg(w,Z,H,f,h,X,y);else if(2&S&&H.class!==f.class&&i(w,"class",null,f.class,y),4&S&&i(w,"style",H.style,f.style,y),8&S){let Q=Z.dynamicProps;for(let gg=0;gg<Q.length;gg++){let ng=Q[gg],Lg=H[ng],Ng=f[ng];Ng===Lg&&ng!=="value"||i(w,ng,Lg,Ng,y,a.children,h,X,Xg)}}1&S&&a.children!==Z.children&&c(w,Z.children)}else K||B!=null||jg(w,Z,H,f,h,X,y);((k=f.onVnodeUpdated)||Y)&&Qg(()=>{k&&nI(k,h,Z,a),Y&&JI(Z,a,h,"updated")},X)},Fg=(a,Z,h,X,y,W,K)=>{for(let w=0;w<Z.length;w++){let S=a[w],B=Z[w],Y=S.el&&(S.type===pg||!sC(S,B)||70&S.shapeFlag)?s(S.el):h;m(S,B,Y,null,X,y,W,K,!0)}},jg=(a,Z,h,X,y,W,K)=>{if(h!==X){if(h!==bg)for(let w in h)CA(w)||w in X||i(a,w,h[w],null,K,Z.children,y,W,Xg);for(let w in X){if(CA(w))continue;let S=X[w],B=h[w];S!==B&&w!=="value"&&i(a,w,B,S,K,Z.children,y,W,Xg)}"value"in X&&i(a,"value",h.value,X.value)}},E=(a,Z,h,X,y,W,K,w,S)=>{let B=Z.el=a?a.el:o(""),Y=Z.anchor=a?a.anchor:o(""),{patchFlag:H,dynamicChildren:f,slotScopeIds:k}=Z;k&&(w=w?w.concat(k):k),a==null?(A(B,h,X),A(Y,h,X),D(Z.children,h,Y,y,W,K,w,S)):H>0&&64&H&&f&&a.dynamicChildren?(Fg(a.dynamicChildren,f,h,y,W,K,w),(Z.key!=null||y&&Z===y.subTree)&&go(a,Z,!0)):Bg(a,Z,h,Y,y,W,K,w,S)},j=(a,Z,h,X,y,W,K,w,S)=>{Z.slotScopeIds=w,a==null?512&Z.shapeFlag?y.ctx.activate(Z,h,X,K,S):q(Z,h,X,y,W,K,S):Ag(a,Z,S)},q=(a,Z,h,X,y,W,K)=>{let w=a.component=function(S,B,Y){let H=S.type,f=(B?B.appContext:S.appContext)||In,k={uid:Cn++,vnode:S,type:H,parent:B,appContext:f,root:null,next:null,subTree:null,effect:null,update:null,scope:new el(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:B?B.provides:Object.create(f.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Ot(H,f),emitsOptions:Jt(H,f),emit:null,emitted:null,propsDefaults:bg,inheritAttrs:H.inheritAttrs,ctx:bg,data:bg,props:bg,attrs:bg,slots:bg,refs:bg,setupState:bg,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:Y,suspenseId:Y?Y.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return k.ctx={_:k},k.root=B?B.root:k,k.emit=Ft.bind(null,k),S.ce&&S.ce(k),k}(a,X,y);if(Mt(a)&&(w.ctx.renderer=tI),function(S,B=!1){HC=B;let{props:Y,children:H}=S.vnode,f=lo(S);jt(S,Y,f,B),$t(S,H);let k=f?function(U,Q){let gg=U.type;U.accessCache=Object.create(null),U.proxy=Ji(new Proxy(U.ctx,xt));let{setup:ng}=gg;if(ng){let Lg=U.setupContext=ng.length>1?function(Rg){let ZI=GI=>{Rg.exposed=GI||{}};return{get attrs(){return function(GI){return GI.attrsProxy||(GI.attrsProxy=new Proxy(GI.attrs,{get:(hg,Yg)=>(xg(GI,0,"$attrs"),hg[Yg])}))}(Rg)},slots:Rg.slots,emit:Rg.emit,expose:ZI}}(U):null;kl(U),VC();let Ng=fI(ng,U,0,[U.props,Lg]);if(XC(),GC(),yi(Ng)){if(Ng.then(GC,GC),Q)return Ng.then(Rg=>{Le(U,Rg,Q)}).catch(Rg=>{WA(Rg,U,0)});U.asyncDep=Ng}else Le(U,Ng,Q)}else eo(U,Q)}(S,B):void 0;HC=!1}(w),w.asyncDep){if(y&&y.registerDep(w,ag),!a.el){let S=w.subTree=dg(TI);G(null,S,Z,h)}}else ag(w,a,Z,h,y,W,K)},Ag=(a,Z,h)=>{let X=Z.component=a.component;if(function(y,W,K){let{props:w,children:S,component:B}=y,{props:Y,children:H,patchFlag:f}=W,k=B.emitsOptions;if(W.dirs||W.transition)return!0;if(!(K&&f>=0))return!(!S&&!H||H&&H.$stable)||w!==Y&&(w?!Y||Ge(w,Y,k):!!Y);if(1024&f)return!0;if(16&f)return w?Ge(w,Y,k):!!Y;if(8&f){let U=W.dynamicProps;for(let Q=0;Q<U.length;Q++){let gg=U[Q];if(Y[gg]!==w[gg]&&!sA(k,gg))return!0}}return!1}(a,Z,h)){if(X.asyncDep&&!X.asyncResolved)return void Gg(X,Z,h);X.next=Z,function(y){let W=kg.indexOf(y);W>sI&&kg.splice(W,1)}(X.update),X.update()}else Z.el=a.el,X.vnode=Z},ag=(a,Z,h,X,y,W,K)=>{let w=()=>{if(a.isMounted){let Y,{next:H,bu:f,u:k,parent:U,vnode:Q}=a,gg=H;NI(a,!1),H?(H.el=Q.el,Gg(a,H,K)):H=Q,f&&AA(f),(Y=H.props&&H.props.onVnodeBeforeUpdate)&&nI(Y,U,H,Q),NI(a,!0);let ng=_A(a),Lg=a.subTree;a.subTree=ng,m(Lg,ng,s(Lg.el),AI(Lg),a,y,W),H.el=ng.el,gg===null&&function({vnode:Ng,parent:Rg},ZI){for(;Rg&&Rg.subTree===Ng;)(Ng=Rg.vnode).el=ZI,Rg=Rg.parent}(a,ng.el),k&&Qg(k,y),(Y=H.props&&H.props.onVnodeUpdated)&&Qg(()=>nI(Y,U,H,Q),y)}else{let Y,{el:H,props:f}=Z,{bm:k,m:U,parent:Q}=a,gg=lA(Z);if(NI(a,!1),k&&AA(k),!gg&&(Y=f&&f.onVnodeBeforeMount)&&nI(Y,Q,Z),NI(a,!0),H&&F){let ng=()=>{a.subTree=_A(a),F(H,a.subTree,a,y,null)};gg?Z.type.__asyncLoader().then(()=>!a.isUnmounted&&ng()):ng()}else{let ng=a.subTree=_A(a);m(null,ng,h,X,a,y,W),Z.el=ng.el}if(U&&Qg(U,y),!gg&&(Y=f&&f.onVnodeMounted)){let ng=Z;Qg(()=>nI(Y,Q,ng),y)}(256&Z.shapeFlag||Q&&lA(Q.vnode)&&256&Q.vnode.shapeFlag)&&a.a&&Qg(a.a,y),a.isMounted=!0,Z=h=X=null}},S=a.effect=new yC(w,()=>Kl(B),a.scope),B=a.update=()=>S.run();B.id=a.uid,NI(a,!0),B()},Gg=(a,Z,h)=>{Z.component=a;let X=a.vnode.props;a.vnode=Z,a.next=null,function(y,W,K,w){let{props:S,attrs:B,vnode:{patchFlag:Y}}=y,H=tg(S),[f]=y.propsOptions,k=!1;if(!(w||Y>0)||16&Y){let U;Oi(y,W,S,B)&&(k=!0);for(let Q in H)W&&(ig(W,Q)||(U=tC(Q))!==Q&&ig(W,U))||(f?!K||K[Q]===void 0&&K[U]===void 0||(S[Q]=ul(f,H,Q,void 0,y,!0)):delete S[Q]);if(B!==H)for(let Q in B)W&&ig(W,Q)||(delete B[Q],k=!0)}else if(8&Y){let U=y.vnode.dynamicProps;for(let Q=0;Q<U.length;Q++){let gg=U[Q];if(sA(y.emitsOptions,gg))continue;let ng=W[gg];if(f)if(ig(B,gg))ng!==B[gg]&&(B[gg]=ng,k=!0);else{let Lg=dI(gg);S[Lg]=ul(f,H,Lg,ng,y,!1)}else ng!==B[gg]&&(B[gg]=ng,k=!0)}}k&&yI(y,"set","$attrs")}(a,Z.props,X,h),qt(a,Z.children,h),VC(),Ze(),XC()},Bg=(a,Z,h,X,y,W,K,w,S=!1)=>{let B=a&&a.children,Y=a?a.shapeFlag:0,H=Z.children,{patchFlag:f,shapeFlag:k}=Z;if(f>0){if(128&f)return void Tg(B,H,h,X,y,W,K,w,S);if(256&f)return void Dg(B,H,h,X,y,W,K,w,S)}8&k?(16&Y&&Xg(B,y,W),H!==B&&c(h,H)):16&Y?16&k?Tg(B,H,h,X,y,W,K,w,S):Xg(B,y,W,!0):(8&Y&&c(h,""),16&k&&D(H,h,X,y,W,K,w,S))},Dg=(a,Z,h,X,y,W,K,w,S)=>{Z=Z||OI;let B=(a=a||OI).length,Y=Z.length,H=Math.min(B,Y),f;for(f=0;f<H;f++){let k=Z[f]=S?wI(Z[f]):cI(Z[f]);m(a[f],k,h,null,y,W,K,w,S)}B>Y?Xg(a,y,W,!0,!1,H):D(Z,h,X,y,W,K,w,S,H)},Tg=(a,Z,h,X,y,W,K,w,S)=>{let B=0,Y=Z.length,H=a.length-1,f=Y-1;for(;B<=H&&B<=f;){let k=a[B],U=Z[B]=S?wI(Z[B]):cI(Z[B]);if(!sC(k,U))break;m(k,U,h,null,y,W,K,w,S),B++}for(;B<=H&&B<=f;){let k=a[H],U=Z[f]=S?wI(Z[f]):cI(Z[f]);if(!sC(k,U))break;m(k,U,h,null,y,W,K,w,S),H--,f--}if(B>H){if(B<=f){let k=f+1,U=k<Y?Z[k].el:X;for(;B<=f;)m(null,Z[B]=S?wI(Z[B]):cI(Z[B]),h,U,y,W,K,w,S),B++}}else if(B>f)for(;B<=H;)Wg(a[B],y,W,!0),B++;else{let k=B,U=B,Q=new Map;for(B=U;B<=f;B++){let hg=Z[B]=S?wI(Z[B]):cI(Z[B]);hg.key!=null&&Q.set(hg.key,B)}let gg,ng=0,Lg=f-U+1,Ng=!1,Rg=0,ZI=new Array(Lg);for(B=0;B<Lg;B++)ZI[B]=0;for(B=k;B<=H;B++){let hg=a[B];if(ng>=Lg){Wg(hg,y,W,!0);continue}let Yg;if(hg.key!=null)Yg=Q.get(hg.key);else for(gg=U;gg<=f;gg++)if(ZI[gg-U]===0&&sC(hg,Z[gg])){Yg=gg;break}Yg===void 0?Wg(hg,y,W,!0):(ZI[Yg-U]=B+1,Yg>=Rg?Rg=Yg:Ng=!0,m(hg,Z[Yg],h,null,y,W,K,w,S),ng++)}let GI=Ng?function(hg){let Yg=hg.slice(),Ug=[0],SI,UA,_g,WI,MC,Mo=hg.length;for(SI=0;SI<Mo;SI++){let zC=hg[SI];if(zC!==0){if(UA=Ug[Ug.length-1],hg[UA]<zC){Yg[SI]=UA,Ug.push(SI);continue}for(_g=0,WI=Ug.length-1;_g<WI;)MC=_g+WI>>1,hg[Ug[MC]]<zC?_g=MC+1:WI=MC;zC<hg[Ug[_g]]&&(_g>0&&(Yg[SI]=Ug[_g-1]),Ug[_g]=SI)}}for(_g=Ug.length,WI=Ug[_g-1];_g-- >0;)Ug[_g]=WI,WI=Yg[WI];return Ug}(ZI):OI;for(gg=GI.length-1,B=Lg-1;B>=0;B--){let hg=U+B,Yg=Z[hg],Ug=hg+1<Y?Z[hg+1].el:X;ZI[B]===0?m(null,Yg,h,Ug,y,W,K,w,S):Ng&&(gg<0||B!==GI[gg]?Og(Yg,h,Ug,2):gg--)}}},Og=(a,Z,h,X,y=null)=>{let{el:W,type:K,transition:w,children:S,shapeFlag:B}=a;if(6&B)return void Og(a.component.subTree,Z,h,X);if(128&B)return void a.suspense.move(Z,h,X);if(64&B)return void K.move(a,Z,h,tI);if(K===pg){A(W,Z,h);for(let Y=0;Y<S.length;Y++)Og(S[Y],Z,h,X);return void A(a.anchor,Z,h)}if(K===qA)return void V(a,Z,h);if(X!==2&&1&B&&w)if(X===0)w.beforeEnter(W),A(W,Z,h),Qg(()=>w.enter(W),y);else{let{leave:Y,delayLeave:H,afterLeave:f}=w,k=()=>A(W,Z,h),U=()=>{Y(W,()=>{k(),f&&f()})};H?H(W,k,U):U()}else A(W,Z,h)},Wg=(a,Z,h,X=!1,y=!1)=>{let{type:W,props:K,ref:w,children:S,dynamicChildren:B,shapeFlag:Y,patchFlag:H,dirs:f}=a;if(w!=null&&ml(w,null,h,a,!0),256&Y)return void Z.ctx.deactivate(a);let k=1&Y&&f,U=!lA(a),Q;if(U&&(Q=K&&K.onVnodeBeforeUnmount)&&nI(Q,Z,a),6&Y)uI(a.component,h,X);else{if(128&Y)return void a.suspense.unmount(h,X);k&&JI(a,null,Z,"beforeUnmount"),64&Y?a.type.remove(a,Z,h,y,tI,X):B&&(W!==pg||H>0&&64&H)?Xg(B,Z,h,!1,!0):(W===pg&&384&H||!y&&16&Y)&&Xg(S,Z,h),X&&Jg(a)}(U&&(Q=K&&K.onVnodeUnmounted)||k)&&Qg(()=>{Q&&nI(Q,Z,a),k&&JI(a,null,Z,"unmounted")},h)},Jg=a=>{let{type:Z,el:h,anchor:X,transition:y}=a;if(Z===pg)return void oI(h,X);if(Z===qA)return void R(a);let W=()=>{l(h),y&&!y.persisted&&y.afterLeave&&y.afterLeave()};if(1&a.shapeFlag&&y&&!y.persisted){let{leave:K,delayLeave:w}=y,S=()=>K(h,W);w?w(a.el,W,S):S()}else W()},oI=(a,Z)=>{let h;for(;a!==Z;)h=d(a),l(a),a=h;l(Z)},uI=(a,Z,h)=>{let{bum:X,scope:y,update:W,subTree:K,um:w}=a;X&&AA(X),y.stop(),W&&(W.active=!1,Wg(K,a,Z,h)),w&&Qg(w,Z),Qg(()=>{a.isUnmounted=!0},Z),Z&&Z.pendingBranch&&!Z.isUnmounted&&a.asyncDep&&!a.asyncResolved&&a.suspenseId===Z.pendingId&&(Z.deps--,Z.deps===0&&Z.resolve())},Xg=(a,Z,h,X=!1,y=!1,W=0)=>{for(let K=W;K<a.length;K++)Wg(a[K],Z,h,X,y)},AI=a=>6&a.shapeFlag?AI(a.component.subTree):128&a.shapeFlag?a.suspense.next():d(a.anchor||a.el),mI=(a,Z,h)=>{a==null?Z._vnode&&Wg(Z._vnode,null,null,!0):m(Z._vnode||null,a,Z,null,null,null,h),Ze(),xi(),Z._vnode=a},tI={p:m,um:Wg,m:Og,r:Jg,mt:q,mc:D,pc:Bg,pbc:Fg,n:AI,o:I},J,F;return C&&([J,F]=C(tI)),{render:mI,hydrate:J,createApp:Pt(mI,J)}}(g)}function NI({effect:g,update:I},C){g.allowRecurse=I.allowRecurse=C}function go(g,I,C=!1){let A=g.children,l=I.children;if(_(A)&&_(l))for(let i=0;i<A.length;i++){let e=A[i],o=l[i];1&o.shapeFlag&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=l[i]=wI(l[i]),o.el=e.el),C||go(e,o)),o.type===HA&&(o.el=e.el)}}var pg=Symbol.for("v-fgt"),HA=Symbol.for("v-txt"),TI=Symbol.for("v-cmt"),qA=Symbol.for("v-stc"),ZC=[],iI=null;function v(g=!1){ZC.push(iI=g?null:[])}var KC=1;function we(g){KC+=g}function Io(g){return g.dynamicChildren=KC>0?iI||OI:null,ZC.pop(),iI=ZC[ZC.length-1]||null,KC>0&&iI&&iI.push(g),g}function z(g,I,C,A,l,i){return Io(T(g,I,C,A,l,i,!0))}function VI(g,I,C,A,l){return Io(dg(g,I,C,A,l,!0))}function Zl(g){return!!g&&g.__v_isVNode===!0}function sC(g,I){return g.type===I.type&&g.key===I.key}var LA="__vInternal",Co=({key:g})=>g??null,eA=({ref:g,ref_key:I,ref_for:C})=>(typeof g=="number"&&(g=""+g),g!=null?Hg(g)||Kg(g)||ug(g)?{i:Pg,r:g,k:I,f:!!C}:g:null);function T(g,I=null,C=null,A=0,l=null,i=g===pg?0:1,e=!1,o=!1){let t={__v_isVNode:!0,__v_skip:!0,type:g,props:I,key:I&&Co(I),ref:I&&eA(I),scopeId:Ei,slotScopeIds:null,children:C,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:A,dynamicProps:l,dynamicChildren:null,appContext:null,ctx:Pg};return o?(Yl(t,C),128&i&&g.normalize(t)):C&&(t.shapeFlag|=Hg(C)?8:16),KC>0&&!e&&iI&&(t.patchFlag>0||6&i)&&t.patchFlag!==32&&iI.push(t),t}var dg=function(g,I=null,C=null,A=0,l=null,i=!1){if(g&&g!==Qt||(g=TI),Zl(g)){let t=AC(g,I,!0);return C&&Yl(t,C),KC>0&&!i&&iI&&(6&t.shapeFlag?iI[iI.indexOf(g)]=t:iI.push(t)),t.patchFlag|=-2,t}e=g,ug(e)&&"__vccOpts"in e&&(g=g.__vccOpts);var e;if(I){I=function(c){return c?me(c)||LA in c?vg({},c):c:null}(I);let{class:t,style:n}=I;t&&!Hg(t)&&(I.class=Sg(t)),rg(n)&&(me(n)&&!_(n)&&(n=vg({},n)),I.style=BC(n))}let o=Hg(g)?1:(t=>t.__isSuspense)(g)?128:(t=>t.__isTeleport)(g)?64:rg(g)?4:ug(g)?2:0;return T(g,I,C,A,l,o,i,!0)};function AC(g,I,C=!1){let{props:A,ref:l,patchFlag:i,children:e}=g,o=I?function(...t){let n={};for(let c=0;c<t.length;c++){let s=t[c];for(let d in s)if(d==="class")n.class!==s.class&&(n.class=Sg([n.class,s.class]));else if(d==="style")n.style=BC([n.style,s.style]);else if(yA(d)){let b=n[d],r=s[d];!r||b===r||_(b)&&b.includes(r)||(n[d]=b?[].concat(b,r):r)}else d!==""&&(n[d]=s[d])}return n}(A||{},I):A;return{__v_isVNode:!0,__v_skip:!0,type:g.type,props:o,key:o&&Co(o),ref:I&&I.ref?C&&l?_(l)?l.concat(eA(I)):[l,eA(I)]:eA(I):l,scopeId:g.scopeId,slotScopeIds:g.slotScopeIds,children:e,target:g.target,targetAnchor:g.targetAnchor,staticCount:g.staticCount,shapeFlag:g.shapeFlag,patchFlag:I&&g.type!==pg?i===-1?16:16|i:i,dynamicProps:g.dynamicProps,dynamicChildren:g.dynamicChildren,appContext:g.appContext,dirs:g.dirs,transition:g.transition,component:g.component,suspense:g.suspense,ssContent:g.ssContent&&AC(g.ssContent),ssFallback:g.ssFallback&&AC(g.ssFallback),el:g.el,anchor:g.anchor,ctx:g.ctx,ce:g.ce}}function LI(g=" ",I=0){return dg(HA,null,g,I)}function lg(g="",I=!1){return I?(v(),VI(TI,null,g)):dg(TI,null,g)}function cI(g){return g==null||typeof g=="boolean"?dg(TI):_(g)?dg(pg,null,g.slice()):typeof g=="object"?wI(g):dg(HA,null,String(g))}function wI(g){return g.el===null&&g.patchFlag!==-1||g.memo?g:AC(g)}function Yl(g,I){let C=0,{shapeFlag:A}=g;if(I==null)I=null;else if(_(I))C=16;else if(typeof I=="object"){if(65&A){let l=I.default;return void(l&&(l._c&&(l._d=!1),Yl(g,l()),l._c&&(l._d=!0)))}{C=32;let l=I._;l||LA in I?l===3&&Pg&&(Pg.slots._===1?I._=1:(I._=2,g.patchFlag|=1024)):I._ctx=Pg}}else ug(I)?(I={default:I,_ctx:Pg},C=32):(I=String(I),64&A?(C=16,I=[LI(I)]):C=8);g.children=I,g.shapeFlag|=C}function nI(g,I,C,A=null){aI(g,I,7,[C,A])}var In=ji(),Cn=0,zg=null,Ao=()=>zg||Pg,fl,jI,Ke="__VUE_INSTANCE_SETTERS__";(jI=ll()[Ke])||(jI=ll()[Ke]=[]),jI.push(g=>zg=g),fl=g=>{jI.length>1?jI.forEach(I=>I(g)):jI[0](g)};var kl=g=>{fl(g),g.scope.on()},GC=()=>{zg&&zg.scope.off(),fl(null)};function lo(g){return 4&g.vnode.shapeFlag}var He,HC=!1;function Le(g,I,C){ug(I)?g.type.__ssrInlineRender?g.ssrRender=I:g.render=I:rg(I)&&(g.setupState=zi(I)),eo(g,C)}function eo(g,I,C){let A=g.type;if(!g.render){if(!I&&He&&!A.render){let l=A.template||function(i){let e=i.type,{mixins:o,extends:t}=e,{mixins:n,optionsCache:c,config:{optionMergeStrategies:s}}=i.appContext,d=c.get(e),b;return d?b=d:n.length||o||t?(b={},n.length&&n.forEach(r=>dA(b,r,s,!0)),dA(b,e,s)):b=e,rg(e)&&c.set(e,b),b}(g).template;if(l){let{isCustomElement:i,compilerOptions:e}=g.appContext.config,{delimiters:o,compilerOptions:t}=A,n=vg(vg({isCustomElement:i,delimiters:o},e),t);A.render=He(l,n)}}g.render=A.render||DI}}function YA(g){if(g.exposed)return g.exposeProxy||(g.exposeProxy=new Proxy(zi(Ji(g.exposed)),{get:(I,C)=>C in I?I[C]:C in mC?mC[C](g):void 0,has:(I,C)=>C in I||C in mC}))}var wg=(g,I)=>function(C,A,l=!1){let i,e,o=ug(C);return o?(i=C,e=DI):(i=C.get,e=C.set),new sl(i,e,o||!e,l)}(g,0,HC);function cg(g,I,C){let A=arguments.length;return A===2?rg(I)&&!_(I)?Zl(I)?dg(g,null,[I]):dg(g,I):dg(g,null,I):(A>3?C=Array.prototype.slice.call(arguments,2):A===3&&Zl(C)&&(C=[C]),dg(g,I,C))}var An=Symbol.for("v-scx"),ln=()=>KA(An),en="3.3.2",MI=typeof document<"u"?document:null,Ye=MI&&MI.createElement("template"),on={insert:(g,I,C)=>{I.insertBefore(g,C||null)},remove:g=>{let I=g.parentNode;I&&I.removeChild(g)},createElement:(g,I,C,A)=>{let l=I?MI.createElementNS("http://www.w3.org/2000/svg",g):MI.createElement(g,C?{is:C}:void 0);return g==="select"&&A&&A.multiple!=null&&l.setAttribute("multiple",A.multiple),l},createText:g=>MI.createTextNode(g),createComment:g=>MI.createComment(g),setText:(g,I)=>{g.nodeValue=I},setElementText:(g,I)=>{g.textContent=I},parentNode:g=>g.parentNode,nextSibling:g=>g.nextSibling,querySelector:g=>MI.querySelector(g),setScopeId(g,I){g.setAttribute(I,"")},insertStaticContent(g,I,C,A,l,i){let e=C?C.previousSibling:I.lastChild;if(l&&(l===i||l.nextSibling))for(;I.insertBefore(l.cloneNode(!0),C),l!==i&&(l=l.nextSibling););else{Ye.innerHTML=A?`<svg>${g}</svg>`:g;let o=Ye.content;if(A){let t=o.firstChild;for(;t.firstChild;)o.appendChild(t.firstChild);o.removeChild(t)}I.insertBefore(o,C)}return[e?e.nextSibling:I.firstChild,C?C.previousSibling:I.lastChild]}},fe=/\s*!important$/;function Gl(g,I,C){if(_(C))C.forEach(A=>Gl(g,I,A));else if(C==null&&(C=""),I.startsWith("--"))g.setProperty(I,C);else{let A=function(l,i){let e=gl[i];if(e)return e;let o=dI(i);if(o!=="filter"&&o in l)return gl[i]=o;o=XA(o);for(let t=0;t<ke.length;t++){let n=ke[t]+o;if(n in l)return gl[i]=n}return i}(g,I);fe.test(C)?g.setProperty(tC(A),C.replace(fe,""),"important"):g[A]=C}}var ke=["Webkit","Moz","ms"],gl={},ve="http://www.w3.org/1999/xlink";function pI(g,I,C,A){g.addEventListener(I,C,A)}function tn(g,I,C,A,l=null){let i=g._vei||(g._vei={}),e=i[I];if(A&&e)e.value=A;else{let[o,t]=function(n){let c;if(Fe.test(n)){let d;for(c={};d=n.match(Fe);)n=n.slice(0,n.length-d[0].length),c[d[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):tC(n.slice(2)),c]}(I);if(A){let n=i[I]=function(c,s){let d=b=>{if(b._vts){if(b._vts<=d.attached)return}else b._vts=Date.now();aI(function(r,m){if(_(m)){let u=r.stopImmediatePropagation;return r.stopImmediatePropagation=()=>{u.call(r),r._stopped=!0},m.map(G=>p=>!p._stopped&&G&&G(p))}return m}(b,d.value),s,5,[b])};return d.value=c,d.attached=cn(),d}(A,l);pI(g,o,n,t)}else e&&(function(n,c,s,d){n.removeEventListener(c,s,d)}(g,o,e,t),i[I]=void 0)}}var Fe=/(?:Once|Passive|Capture)$/,Il=0,nn=Promise.resolve(),cn=()=>Il||(nn.then(()=>Il=0),Il=Date.now()),Je=/^on[a-z]/,kI=g=>{let I=g.props["onUpdate:modelValue"]||!1;return _(I)?C=>AA(I,C):I};function sn(g){g.target.composing=!0}function Ne(g){let I=g.target;I.composing&&(I.composing=!1,I.dispatchEvent(new Event("input")))}var bl={created(g,{modifiers:{lazy:I,trim:C,number:A}},l){g._assign=kI(l);let i=A||l.props&&l.props.type==="number";pI(g,I?"change":"input",e=>{if(e.target.composing)return;let o=g.value;C&&(o=o.trim()),i&&(o=nA(o)),g._assign(o)}),C&&pI(g,"change",()=>{g.value=g.value.trim()}),I||(pI(g,"compositionstart",sn),pI(g,"compositionend",Ne),pI(g,"change",Ne))},mounted(g,{value:I}){g.value=I??""},beforeUpdate(g,{value:I,modifiers:{lazy:C,trim:A,number:l}},i){if(g._assign=kI(i),g.composing||document.activeElement===g&&g.type!=="range"&&(C||A&&g.value.trim()===I||(l||g.type==="number")&&nA(g.value)===I))return;let e=I??"";g.value!==e&&(g.value=e)}},an={deep:!0,created(g,I,C){g._assign=kI(C),pI(g,"change",()=>{let A=g._modelValue,l=lC(g),i=g.checked,e=g._assign;if(_(A)){let o=Bl(A,l),t=o!==-1;if(i&&!t)e(A.concat(l));else if(!i&&t){let n=[...A];n.splice(o,1),e(n)}}else if(oC(A)){let o=new Set(A);i?o.add(l):o.delete(l),e(o)}else e(io(g,i))})},mounted:Ue,beforeUpdate(g,I,C){g._assign=kI(C),Ue(g,I,C)}};function Ue(g,{value:I,oldValue:C},A){g._modelValue=I,_(I)?g.checked=Bl(I,A.props.value)>-1:oC(I)?g.checked=I.has(A.props.value):I!==C&&(g.checked=xI(I,io(g,!0)))}var dn={created(g,{value:I},C){g.checked=xI(I,C.props.value),g._assign=kI(C),pI(g,"change",()=>{g._assign(lC(g))})},beforeUpdate(g,{value:I,oldValue:C},A){g._assign=kI(A),I!==C&&(g.checked=xI(I,A.props.value))}},un={deep:!0,created(g,{value:I,modifiers:{number:C}},A){let l=oC(I);pI(g,"change",()=>{let i=Array.prototype.filter.call(g.options,e=>e.selected).map(e=>C?nA(lC(e)):lC(e));g._assign(g.multiple?l?new Set(i):i:i[0])}),g._assign=kI(A)},mounted(g,{value:I}){Me(g,I)},beforeUpdate(g,I,C){g._assign=kI(C)},updated(g,{value:I}){Me(g,I)}};function Me(g,I){let C=g.multiple;if(!C||_(I)||oC(I)){for(let A=0,l=g.options.length;A<l;A++){let i=g.options[A],e=lC(i);if(C)_(I)?i.selected=Bl(I,e)>-1:i.selected=I.has(e);else if(xI(lC(i),I))return void(g.selectedIndex!==A&&(g.selectedIndex=A))}C||g.selectedIndex===-1||(g.selectedIndex=-1)}}function lC(g){return"_value"in g?g._value:g.value}function io(g,I){let C=I?"_trueValue":"_falseValue";return C in g?g[C]:I}var mn={created(g,I,C){_C(g,I,C,null,"created")},mounted(g,I,C){_C(g,I,C,null,"mounted")},beforeUpdate(g,I,C,A){_C(g,I,C,A,"beforeUpdate")},updated(g,I,C,A){_C(g,I,C,A,"updated")}};function _C(g,I,C,A,l){let i=function(e,o){switch(e){case"SELECT":return un;case"TEXTAREA":return bl;default:switch(o){case"checkbox":return an;case"radio":return dn;default:return bl}}}(g.tagName,C.props&&C.props.type)[l];i&&i(g,I,C,A)}var ze={beforeMount(g,{value:I},{transition:C}){g._vod=g.style.display==="none"?"":g.style.display,C&&I?C.beforeEnter(g):aC(g,I)},mounted(g,{value:I},{transition:C}){C&&I&&C.enter(g)},updated(g,{value:I,oldValue:C},{transition:A}){!I!=!C&&(A?I?(A.beforeEnter(g),aC(g,!0),A.enter(g)):A.leave(g,()=>{aC(g,!1)}):aC(g,I))},beforeUnmount(g,{value:I}){aC(g,I)}};function aC(g,I){g.style.display=I?g._vod:"none"}var Zn=vg({patchProp:(g,I,C,A,l=!1,i,e,o,t)=>{I==="class"?function(n,c,s){let d=n._vtc;d&&(c=(c?[c,...d]:[...d]).join(" ")),c==null?n.removeAttribute("class"):s?n.setAttribute("class",c):n.className=c}(g,A,l):I==="style"?function(n,c,s){let d=n.style,b=Hg(s);if(s&&!b){if(c&&!Hg(c))for(let r in c)s[r]==null&&Gl(d,r,"");for(let r in s)Gl(d,r,s[r])}else{let r=d.display;b?c!==s&&(d.cssText=s):c&&n.removeAttribute("style"),"_vod"in n&&(d.display=r)}}(g,C,A):yA(I)?rl(I)||tn(g,I,0,A,e):(I[0]==="."?(I=I.slice(1),1):I[0]==="^"?(I=I.slice(1),0):function(n,c,s,d){return d?c==="innerHTML"||c==="textContent"||!!(c in n&&Je.test(c)&&ug(s)):c==="spellcheck"||c==="draggable"||c==="translate"||c==="form"||c==="list"&&n.tagName==="INPUT"||c==="type"&&n.tagName==="TEXTAREA"||Je.test(c)&&Hg(s)?!1:c in n}(g,I,A,l))?function(n,c,s,d,b,r,m){if(c==="innerHTML"||c==="textContent")return d&&m(d,b,r),void(n[c]=s??"");let u=n.tagName;if(c==="value"&&u!=="PROGRESS"&&!u.includes("-")){n._value=s;let p=s??"";return(u==="OPTION"?n.getAttribute("value"):n.value)!==p&&(n.value=p),void(s==null&&n.removeAttribute(c))}let G=!1;if(s===""||s==null){let p=typeof n[c];p==="boolean"?s=oe(s):s==null&&p==="string"?(s="",G=!0):p==="number"&&(s=0,G=!0)}try{n[c]=s}catch{}G&&n.removeAttribute(c)}(g,I,A,i,e,o,t):(I==="true-value"?g._trueValue=A:I==="false-value"&&(g._falseValue=A),function(n,c,s,d,b){if(d&&c.startsWith("xlink:"))s==null?n.removeAttributeNS(ve,c.slice(6,c.length)):n.setAttributeNS(ve,c,s);else{let r=Zt(c);s==null||r&&!oe(s)?n.removeAttribute(c):n.setAttribute(c,r?"":s)}}(g,I,A,l))}},on),De,Gn=(...g)=>{let I=(De||(De=gn(Zn))).createApp(...g),{mount:C}=I;return I.mount=A=>{let l=function(o){return Hg(o)?document.querySelector(o):o}(A);if(!l)return;let i=I._component;ug(i)||i.render||i.template||(i.template=l.innerHTML),l.innerHTML="";let e=C(l,!1,l instanceof SVGElement);return l instanceof Element&&(l.removeAttribute("v-cloak"),l.setAttribute("data-v-app","")),e},I};function bC(g){return!!Wi()&&(function(I){Eg&&Eg.cleanups.push(I)}(g),!0)}function rI(g){return typeof g=="function"?g():Cg(g)}var mA=typeof window<"u",ZA=()=>{};function oo(g,I){return function(...C){return new Promise((A,l)=>{Promise.resolve(g(()=>I.apply(this,C),{fn:I,thisArg:this,args:C})).then(A).catch(l)})}}var Qe=g=>g();function bn(g,I=200,C={}){return oo(function(A,l={}){let i,e,o=ZA,t=n=>{clearTimeout(n),o(),o=ZA};return n=>{let c=rI(A),s=rI(l.maxWait);return i&&t(i),c<=0||s!==void 0&&s<=0?(e&&(t(e),e=null),Promise.resolve(n())):new Promise((d,b)=>{o=l.rejectOnCancel?b:d,s&&!e&&(e=setTimeout(()=>{i&&t(i),e=null,d(n())},s)),i=setTimeout(()=>{e&&t(e),e=null,d(n())},c)})}}(I,C),g)}function to(g,I=!0){Ao()?NC(g):I?g():RA(g)}var xe=Object.getOwnPropertySymbols,pn=Object.prototype.hasOwnProperty,rn=Object.prototype.propertyIsEnumerable,hn=(g,I)=>{var C={};for(var A in g)pn.call(g,A)&&I.indexOf(A)<0&&(C[A]=g[A]);if(g!=null&&xe)for(var A of xe(g))I.indexOf(A)<0&&rn.call(g,A)&&(C[A]=g[A]);return C},Bn=Object.defineProperty,yn=Object.defineProperties,Vn=Object.getOwnPropertyDescriptors,GA=Object.getOwnPropertySymbols,no=Object.prototype.hasOwnProperty,co=Object.prototype.propertyIsEnumerable,Te=(g,I,C)=>I in g?Bn(g,I,{enumerable:!0,configurable:!0,writable:!0,value:C}):g[I]=C,Xn=(g,I)=>{for(var C in I||(I={}))no.call(I,C)&&Te(g,C,I[C]);if(GA)for(var C of GA(I))co.call(I,C)&&Te(g,C,I[C]);return g},Sn=(g,I)=>yn(g,Vn(I)),Wn=(g,I)=>{var C={};for(var A in g)no.call(g,A)&&I.indexOf(A)<0&&(C[A]=g[A]);if(g!=null&&GA)for(var A of GA(g))I.indexOf(A)<0&&co.call(g,A)&&(C[A]=g[A]);return C};function Rn(g,I,C={}){let A=C,{eventFilter:l}=A,i=Wn(A,["eventFilter"]),{eventFilter:e,pause:o,resume:t,isActive:n}=function(s=Qe){let d=Ig(!0);return{isActive:FC(d),pause:function(){d.value=!1},resume:function(){d.value=!0},eventFilter:(...b)=>{d.value&&s(...b)}}}(l);return{stop:function(s,d,b={}){let r=b,{eventFilter:m=Qe}=r,u=hn(r,["eventFilter"]);return gI(s,oo(m,d),u)}(g,I,Sn(Xn({},i),{eventFilter:e})),pause:o,resume:t,isActive:n}}function wn(g){var I;let C=rI(g);return(I=C?.$el)!=null?I:C}var bA=mA?window:void 0,so=mA?window.document:void 0;function Ee(...g){let I,C,A,l;if(typeof g[0]=="string"||Array.isArray(g[0])?([C,A,l]=g,I=bA):[I,C,A,l]=g,!I)return ZA;Array.isArray(C)||(C=[C]),Array.isArray(A)||(A=[A]);let i=[],e=()=>{i.forEach(n=>n()),i.length=0},o=gI(()=>[wn(I),rI(l)],([n,c])=>{e(),n&&i.push(...C.flatMap(s=>A.map(d=>((b,r,m,u)=>(b.addEventListener(r,m,u),()=>b.removeEventListener(r,m,u)))(n,s,d,c))))},{immediate:!0,flush:"post"}),t=()=>{o(),e()};return bC(t),t}var $C=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},qC="__vueuse_ssr_handlers__",Kn=Hn();function Hn(){return qC in $C||($C[qC]=$C[qC]||{}),$C[qC]}var Ln=Object.defineProperty,Pe=Object.getOwnPropertySymbols,Yn=Object.prototype.hasOwnProperty,fn=Object.prototype.propertyIsEnumerable,je=(g,I,C)=>I in g?Ln(g,I,{enumerable:!0,configurable:!0,writable:!0,value:C}):g[I]=C,Oe=(g,I)=>{for(var C in I||(I={}))Yn.call(I,C)&&je(g,C,I[C]);if(Pe)for(var C of Pe(I))fn.call(I,C)&&je(g,C,I[C]);return g},kn={boolean:{read:g=>g==="true",write:g=>String(g)},object:{read:g=>JSON.parse(g),write:g=>JSON.stringify(g)},number:{read:g=>Number.parseFloat(g),write:g=>String(g)},any:{read:g=>g,write:g=>String(g)},string:{read:g=>g,write:g=>String(g)},map:{read:g=>new Map(JSON.parse(g)),write:g=>JSON.stringify(Array.from(g.entries()))},set:{read:g=>new Set(JSON.parse(g)),write:g=>JSON.stringify(Array.from(g))},date:{read:g=>new Date(g),write:g=>g.toISOString()}},_e="vueuse-storage";function eC(g,I,C,A={}){var l;let{flush:i="pre",deep:e=!0,listenToStorageChanges:o=!0,writeDefaults:t=!0,mergeDefaults:n=!1,shallow:c,window:s=bA,eventFilter:d,onError:b=L=>{console.error(L)}}=A,r=(c?ft:Ig)(I);if(!C)try{C=function(L,M){return Kn[L]||M}("getDefaultStorage",()=>{var L;return(L=bA)==null?void 0:L.localStorage})()}catch(L){b(L)}if(!C)return r;let m=rI(I),u=function(L){return L==null?"any":L instanceof Set?"set":L instanceof Map?"map":L instanceof Date?"date":typeof L=="boolean"?"boolean":typeof L=="string"?"string":typeof L=="object"?"object":Number.isNaN(L)?"any":"number"}(m),G=(l=A.serializer)!=null?l:kn[u],{pause:p,resume:V}=Rn(r,()=>function(L){try{if(L==null)C.removeItem(g);else{let M=G.write(L),x=C.getItem(g);x!==M&&(C.setItem(g,M),s&&s.dispatchEvent(new CustomEvent(_e,{detail:{key:g,oldValue:x,newValue:M,storageArea:C}})))}}catch(M){b(M)}}(r.value),{flush:i,deep:e,eventFilter:d});return s&&o&&(Ee(s,"storage",R),Ee(s,_e,function(L){R(L.detail)})),R(),r;function R(L){if(!L||L.storageArea===C){if(L&&L.key==null)r.value=m;else if(!L||L.key===g){p();try{r.value=function(M){let x=M?M.newValue:C.getItem(g);if(x==null)return t&&m!==null&&C.setItem(g,G.write(m)),m;if(!M&&n){let D=G.read(x);return typeof n=="function"?n(D,m):u!=="object"||Array.isArray(D)?D:Oe(Oe({},m),D)}return typeof x!="string"?x:G.read(x)}(L)}catch(M){b(M)}finally{L?RA(V):V()}}}}}var vn=Object.defineProperty,$e=Object.getOwnPropertySymbols,Fn=Object.prototype.hasOwnProperty,Jn=Object.prototype.propertyIsEnumerable,qe=(g,I,C)=>I in g?vn(g,I,{enumerable:!0,configurable:!0,writable:!0,value:C}):g[I]=C;function Nn(g={}){let{controls:I=!1,interval:C="requestAnimationFrame"}=g,A=Ig(new Date),l=()=>A.value=new Date,i=C==="requestAnimationFrame"?function(e,o={}){let{immediate:t=!0,window:n=bA}=o,c=Ig(!1),s=0,d=null;function b(u){c.value&&n&&(e({delta:u-s,timestamp:u}),s=u,d=n.requestAnimationFrame(b))}function r(){!c.value&&n&&(c.value=!0,d=n.requestAnimationFrame(b))}function m(){c.value=!1,d!=null&&n&&(n.cancelAnimationFrame(d),d=null)}return t&&r(),bC(m),{isActive:FC(c),pause:m,resume:r}}(l,{immediate:!0}):function(e,o=1e3,t={}){let{immediate:n=!0,immediateCallback:c=!1}=t,s=null,d=Ig(!1);function b(){s&&(clearInterval(s),s=null)}function r(){d.value=!1,b()}function m(){let u=rI(o);u<=0||(d.value=!0,c&&e(),b(),s=setInterval(e,u))}return n&&mA&&m(),(Kg(o)||typeof o=="function")&&bC(gI(o,()=>{d.value&&mA&&m()})),bC(r),{isActive:d,pause:r,resume:m}}(l,C,{immediate:!0});return I?((e,o)=>{for(var t in o||(o={}))Fn.call(o,t)&&qe(e,t,o[t]);if($e)for(var t of $e(o))Jn.call(o,t)&&qe(e,t,o[t]);return e})({now:A},i):A}function Un(g,I=ZA,C={}){let{immediate:A=!0,manual:l=!1,type:i="text/javascript",async:e=!0,crossOrigin:o,referrerPolicy:t,noModule:n,defer:c,document:s=so,attrs:d={}}=C,b=Ig(null),r=null,m=(p=!0)=>(r||(r=(V=>new Promise((R,L)=>{let M=sg=>(b.value=sg,R(sg),sg);if(!s)return void R(!1);let x=!1,D=s.querySelector(`script[src="${rI(g)}"]`);D?D.hasAttribute("data-loaded")&&M(D):(D=s.createElement("script"),D.type=i,D.async=e,D.src=rI(g),c&&(D.defer=c),o&&(D.crossOrigin=o),n&&(D.noModule=n),t&&(D.referrerPolicy=t),Object.entries(d).forEach(([sg,Fg])=>D?.setAttribute(sg,Fg)),x=!0),D.addEventListener("error",sg=>L(sg)),D.addEventListener("abort",sg=>L(sg)),D.addEventListener("load",()=>{D.setAttribute("data-loaded","true"),I(D),M(D)}),x&&(D=s.head.appendChild(D)),V||M(D)}))(p)),r),u=()=>{if(!s)return;r=null,b.value&&(b.value=null);let p=s.querySelector(`script[src="${rI(g)}"]`);p&&s.head.removeChild(p)};var G;return A&&!l&&to(m),l||(G=u,Ao()&&wA(G)),{scriptTag:b,load:m,unload:u}}var Mn=0,zn=g=>{let I=eC("WALINE_EMOJI",{}),C=Boolean(/@[0-9]+\.[0-9]+\.[0-9]+/.test(g));if(C){let A=I.value[g];if(A)return Promise.resolve(A)}return GM_fetch(`${g}/info.json`).then(A=>A.json()).then(A=>{let l={folder:g,...A};return C&&(I.value[g]=l),l})},gi=(g,I="",C="",A="")=>`${I?`${I}/`:""}${C}${g}${A?`.${A}`:""}`,ao=g=>{g.name!=="AbortError"&&console.error(g.message)},Dn=g=>g instanceof HTMLElement?g:typeof g=="string"?document.querySelector(g):null,Qn=g=>g.type.includes("image"),Ii=g=>{let I=Array.from(g).find(Qn);return I?I.getAsFile():null};function xn(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}var EI={async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1},uo=/[&<>"']/,Tn=new RegExp(uo.source,"g"),mo=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,En=new RegExp(mo.source,"g"),Pn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ci=g=>Pn[g];function fg(g,I){if(I){if(uo.test(g))return g.replace(Tn,Ci)}else if(mo.test(g))return g.replace(En,Ci);return g}var jn=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function Zo(g){return g.replace(jn,(I,C)=>(C=C.toLowerCase())==="colon"?":":C.charAt(0)==="#"?C.charAt(1)==="x"?String.fromCharCode(parseInt(C.substring(2),16)):String.fromCharCode(+C.substring(1)):"")}var On=/(^|[^\[])\^/g;function Zg(g,I){g=typeof g=="string"?g:g.source,I=I||"";let C={replace:(A,l)=>(l=(l=l.source||l).replace(On,"$1"),g=g.replace(A,l),C),getRegex:()=>new RegExp(g,I)};return C}var _n=/[^\w:]/g,$n=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function Ai(g,I,C){if(g){let A;try{A=decodeURIComponent(Zo(C)).replace(_n,"").toLowerCase()}catch{return null}if(A.indexOf("javascript:")===0||A.indexOf("vbscript:")===0||A.indexOf("data:")===0)return null}I&&!$n.test(C)&&(C=function(A,l){gA[" "+A]||(qn.test(A)?gA[" "+A]=A+"/":gA[" "+A]=iA(A,"/",!0)),A=gA[" "+A];let i=A.indexOf(":")===-1;return l.substring(0,2)==="//"?i?l:A.replace(gc,"$1")+l:l.charAt(0)==="/"?i?l:A.replace(Ic,"$1")+l:A+l}(I,C));try{C=encodeURI(C).replace(/%25/g,"%")}catch{return null}return C}var gA={},qn=/^[^:]+:\/*[^/]*$/,gc=/^([^:]+:)[\s\S]*$/,Ic=/^([^:]+:\/*[^/]*)[\s\S]*$/,pA={exec:function(){}};function li(g,I){let C=g.replace(/\|/g,(l,i,e)=>{let o=!1,t=i;for(;--t>=0&&e[t]==="\\";)o=!o;return o?"|":" |"}).split(/ \|/),A=0;if(C[0].trim()||C.shift(),C.length>0&&!C[C.length-1].trim()&&C.pop(),C.length>I)C.splice(I);else for(;C.length<I;)C.push("");for(;A<C.length;A++)C[A]=C[A].trim().replace(/\\\|/g,"|");return C}function iA(g,I,C){let A=g.length;if(A===0)return"";let l=0;for(;l<A;){let i=g.charAt(A-l-1);if(i!==I||C){if(i===I||!C)break;l++}else l++}return g.slice(0,A-l)}function ei(g,I){if(I<1)return"";let C="";for(;I>1;)1&I&&(C+=g),I>>=1,g+=g;return C+g}function ii(g,I,C,A){let l=I.href,i=I.title?fg(I.title):null,e=g[1].replace(/\\([\[\]])/g,"$1");if(g[0].charAt(0)!=="!"){A.state.inLink=!0;let o={type:"link",raw:C,href:l,title:i,text:e,tokens:A.inlineTokens(e)};return A.state.inLink=!1,o}return{type:"image",raw:C,href:l,title:i,text:fg(e)}}var LC=class{constructor(I){this.options=I||EI}space(I){let C=this.rules.block.newline.exec(I);if(C&&C[0].length>0)return{type:"space",raw:C[0]}}code(I){let C=this.rules.block.code.exec(I);if(C){let A=C[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:C[0],codeBlockStyle:"indented",text:this.options.pedantic?A:iA(A,`
`)}}}fences(I){let C=this.rules.block.fences.exec(I);if(C){let A=C[0],l=function(i,e){let o=i.match(/^(\s+)(?:```)/);if(o===null)return e;let t=o[1];return e.split(`
`).map(n=>{let c=n.match(/^\s+/);if(c===null)return n;let[s]=c;return s.length>=t.length?n.slice(t.length):n}).join(`
`)}(A,C[3]||"");return{type:"code",raw:A,lang:C[2]?C[2].trim().replace(this.rules.inline._escapes,"$1"):C[2],text:l}}}heading(I){let C=this.rules.block.heading.exec(I);if(C){let A=C[2].trim();if(/#$/.test(A)){let l=iA(A,"#");this.options.pedantic?A=l.trim():l&&!/ $/.test(l)||(A=l.trim())}return{type:"heading",raw:C[0],depth:C[1].length,text:A,tokens:this.lexer.inline(A)}}}hr(I){let C=this.rules.block.hr.exec(I);if(C)return{type:"hr",raw:C[0]}}blockquote(I){let C=this.rules.block.blockquote.exec(I);if(C){let A=C[0].replace(/^ *>[ \t]?/gm,""),l=this.lexer.state.top;this.lexer.state.top=!0;let i=this.lexer.blockTokens(A);return this.lexer.state.top=l,{type:"blockquote",raw:C[0],tokens:i,text:A}}}list(I){let C=this.rules.block.list.exec(I);if(C){let A,l,i,e,o,t,n,c,s,d,b,r,m=C[1].trim(),u=m.length>1,G={type:"list",raw:"",ordered:u,start:u?+m.slice(0,-1):"",loose:!1,items:[]};m=u?`\\d{1,9}\\${m.slice(-1)}`:`\\${m}`,this.options.pedantic&&(m=u?m:"[*+-]");let p=new RegExp(`^( {0,3}${m})((?:[	 ][^\\n]*)?(?:\\n|$))`);for(;I&&(r=!1,C=p.exec(I))&&!this.rules.block.hr.test(I);){if(A=C[0],I=I.substring(A.length),c=C[2].split(`
`,1)[0].replace(/^\t+/,R=>" ".repeat(3*R.length)),s=I.split(`
`,1)[0],this.options.pedantic?(e=2,b=c.trimLeft()):(e=C[2].search(/[^ ]/),e=e>4?1:e,b=c.slice(e),e+=C[1].length),t=!1,!c&&/^ *$/.test(s)&&(A+=s+`
`,I=I.substring(s.length+1),r=!0),!r){let R=new RegExp(`^ {0,${Math.min(3,e-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),L=new RegExp(`^ {0,${Math.min(3,e-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),M=new RegExp(`^ {0,${Math.min(3,e-1)}}(?:\`\`\`|~~~)`),x=new RegExp(`^ {0,${Math.min(3,e-1)}}#`);for(;I&&(d=I.split(`
`,1)[0],s=d,this.options.pedantic&&(s=s.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!M.test(s))&&!x.test(s)&&!R.test(s)&&!L.test(I);){if(s.search(/[^ ]/)>=e||!s.trim())b+=`
`+s.slice(e);else{if(t||c.search(/[^ ]/)>=4||M.test(c)||x.test(c)||L.test(c))break;b+=`
`+s}t||s.trim()||(t=!0),A+=d+`
`,I=I.substring(d.length+1),c=s.slice(e)}}G.loose||(n?G.loose=!0:/\n *\n *$/.test(A)&&(n=!0)),this.options.gfm&&(l=/^\[[ xX]\] /.exec(b),l&&(i=l[0]!=="[ ] ",b=b.replace(/^\[[ xX]\] +/,""))),G.items.push({type:"list_item",raw:A,task:!!l,checked:i,loose:!1,text:b}),G.raw+=A}G.items[G.items.length-1].raw=A.trimRight(),G.items[G.items.length-1].text=b.trimRight(),G.raw=G.raw.trimRight();let V=G.items.length;for(o=0;o<V;o++)if(this.lexer.state.top=!1,G.items[o].tokens=this.lexer.blockTokens(G.items[o].text,[]),!G.loose){let R=G.items[o].tokens.filter(M=>M.type==="space"),L=R.length>0&&R.some(M=>/\n.*\n/.test(M.raw));G.loose=L}if(G.loose)for(o=0;o<V;o++)G.items[o].loose=!0;return G}}html(I){let C=this.rules.block.html.exec(I);if(C){let A={type:"html",raw:C[0],pre:!this.options.sanitizer&&(C[1]==="pre"||C[1]==="script"||C[1]==="style"),text:C[0]};if(this.options.sanitize){let l=this.options.sanitizer?this.options.sanitizer(C[0]):fg(C[0]);A.type="paragraph",A.text=l,A.tokens=this.lexer.inline(l)}return A}}def(I){let C=this.rules.block.def.exec(I);if(C){let A=C[1].toLowerCase().replace(/\s+/g," "),l=C[2]?C[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",i=C[3]?C[3].substring(1,C[3].length-1).replace(this.rules.inline._escapes,"$1"):C[3];return{type:"def",tag:A,raw:C[0],href:l,title:i}}}table(I){let C=this.rules.block.table.exec(I);if(C){let A={type:"table",header:li(C[1]).map(l=>({text:l})),align:C[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:C[3]&&C[3].trim()?C[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(A.header.length===A.align.length){A.raw=C[0];let l,i,e,o,t=A.align.length;for(l=0;l<t;l++)/^ *-+: *$/.test(A.align[l])?A.align[l]="right":/^ *:-+: *$/.test(A.align[l])?A.align[l]="center":/^ *:-+ *$/.test(A.align[l])?A.align[l]="left":A.align[l]=null;for(t=A.rows.length,l=0;l<t;l++)A.rows[l]=li(A.rows[l],A.header.length).map(n=>({text:n}));for(t=A.header.length,i=0;i<t;i++)A.header[i].tokens=this.lexer.inline(A.header[i].text);for(t=A.rows.length,i=0;i<t;i++)for(o=A.rows[i],e=0;e<o.length;e++)o[e].tokens=this.lexer.inline(o[e].text);return A}}}lheading(I){let C=this.rules.block.lheading.exec(I);if(C)return{type:"heading",raw:C[0],depth:C[2].charAt(0)==="="?1:2,text:C[1],tokens:this.lexer.inline(C[1])}}paragraph(I){let C=this.rules.block.paragraph.exec(I);if(C){let A=C[1].charAt(C[1].length-1)===`
`?C[1].slice(0,-1):C[1];return{type:"paragraph",raw:C[0],text:A,tokens:this.lexer.inline(A)}}}text(I){let C=this.rules.block.text.exec(I);if(C)return{type:"text",raw:C[0],text:C[0],tokens:this.lexer.inline(C[0])}}escape(I){let C=this.rules.inline.escape.exec(I);if(C)return{type:"escape",raw:C[0],text:fg(C[1])}}tag(I){let C=this.rules.inline.tag.exec(I);if(C)return!this.lexer.state.inLink&&/^<a /i.test(C[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(C[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(C[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(C[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:C[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(C[0]):fg(C[0]):C[0]}}link(I){let C=this.rules.inline.link.exec(I);if(C){let A=C[2].trim();if(!this.options.pedantic&&/^</.test(A)){if(!/>$/.test(A))return;let e=iA(A.slice(0,-1),"\\");if((A.length-e.length)%2==0)return}else{let e=function(o,t){if(o.indexOf(t[1])===-1)return-1;let n=o.length,c=0,s=0;for(;s<n;s++)if(o[s]==="\\")s++;else if(o[s]===t[0])c++;else if(o[s]===t[1]&&(c--,c<0))return s;return-1}(C[2],"()");if(e>-1){let o=(C[0].indexOf("!")===0?5:4)+C[1].length+e;C[2]=C[2].substring(0,e),C[0]=C[0].substring(0,o).trim(),C[3]=""}}let l=C[2],i="";if(this.options.pedantic){let e=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(l);e&&(l=e[1],i=e[3])}else i=C[3]?C[3].slice(1,-1):"";return l=l.trim(),/^</.test(l)&&(l=this.options.pedantic&&!/>$/.test(A)?l.slice(1):l.slice(1,-1)),ii(C,{href:l&&l.replace(this.rules.inline._escapes,"$1"),title:i&&i.replace(this.rules.inline._escapes,"$1")},C[0],this.lexer)}}reflink(I,C){let A;if((A=this.rules.inline.reflink.exec(I))||(A=this.rules.inline.nolink.exec(I))){let l=(A[2]||A[1]).replace(/\s+/g," ");if(l=C[l.toLowerCase()],!l){let i=A[0].charAt(0);return{type:"text",raw:i,text:i}}return ii(A,l,A[0],this.lexer)}}emStrong(I,C,A=""){let l=this.rules.inline.emStrong.lDelim.exec(I);if(!l||l[3]&&A.match(/[\p{L}\p{N}]/u))return;let i=l[1]||l[2]||"";if(!i||i&&(A===""||this.rules.inline.punctuation.exec(A))){let e=l[0].length-1,o,t,n=e,c=0,s=l[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(s.lastIndex=0,C=C.slice(-1*I.length+e);(l=s.exec(C))!=null;){if(o=l[1]||l[2]||l[3]||l[4]||l[5]||l[6],!o)continue;if(t=o.length,l[3]||l[4]){n+=t;continue}if((l[5]||l[6])&&e%3&&!((e+t)%3)){c+=t;continue}if(n-=t,n>0)continue;t=Math.min(t,t+n+c);let d=I.slice(0,e+l.index+(l[0].length-o.length)+t);if(Math.min(e,t)%2){let r=d.slice(1,-1);return{type:"em",raw:d,text:r,tokens:this.lexer.inlineTokens(r)}}let b=d.slice(2,-2);return{type:"strong",raw:d,text:b,tokens:this.lexer.inlineTokens(b)}}}}codespan(I){let C=this.rules.inline.code.exec(I);if(C){let A=C[2].replace(/\n/g," "),l=/[^ ]/.test(A),i=/^ /.test(A)&&/ $/.test(A);return l&&i&&(A=A.substring(1,A.length-1)),A=fg(A,!0),{type:"codespan",raw:C[0],text:A}}}br(I){let C=this.rules.inline.br.exec(I);if(C)return{type:"br",raw:C[0]}}del(I){let C=this.rules.inline.del.exec(I);if(C)return{type:"del",raw:C[0],text:C[2],tokens:this.lexer.inlineTokens(C[2])}}autolink(I,C){let A=this.rules.inline.autolink.exec(I);if(A){let l,i;return A[2]==="@"?(l=fg(this.options.mangle?C(A[1]):A[1]),i="mailto:"+l):(l=fg(A[1]),i=l),{type:"link",raw:A[0],text:l,href:i,tokens:[{type:"text",raw:l,text:l}]}}}url(I,C){let A;if(A=this.rules.inline.url.exec(I)){let l,i;if(A[2]==="@")l=fg(this.options.mangle?C(A[0]):A[0]),i="mailto:"+l;else{let e;do e=A[0],A[0]=this.rules.inline._backpedal.exec(A[0])[0];while(e!==A[0]);l=fg(A[0]),i=A[1]==="www."?"http://"+A[0]:A[0]}return{type:"link",raw:A[0],text:l,href:i,tokens:[{type:"text",raw:l,text:l}]}}}inlineText(I,C){let A=this.rules.inline.text.exec(I);if(A){let l;return l=this.lexer.state.inRawBlock?this.options.sanitize?this.options.sanitizer?this.options.sanitizer(A[0]):fg(A[0]):A[0]:fg(this.options.smartypants?C(A[0]):A[0]),{type:"text",raw:A[0],text:l}}}},P={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:pA,lheading:/^((?:.|\n(?!\n))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/,_label:/(?!\s*\])(?:\\.|[^\[\]\\])+/,_title:/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/};P.def=Zg(P.def).replace("label",P._label).replace("title",P._title).getRegex(),P.bullet=/(?:[*+-]|\d{1,9}[.)])/,P.listItemStart=Zg(/^( *)(bull) */).replace("bull",P.bullet).getRegex(),P.list=Zg(P.list).replace(/bull/g,P.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+P.def.source+")").getRegex(),P._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",P._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,P.html=Zg(P.html,"i").replace("comment",P._comment).replace("tag",P._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),P.paragraph=Zg(P._paragraph).replace("hr",P.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",P._tag).getRegex(),P.blockquote=Zg(P.blockquote).replace("paragraph",P.paragraph).getRegex(),P.normal={...P},P.gfm={...P.normal,table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"},P.gfm.table=Zg(P.gfm.table).replace("hr",P.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",P._tag).getRegex(),P.gfm.paragraph=Zg(P._paragraph).replace("hr",P.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",P.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",P._tag).getRegex(),P.pedantic={...P.normal,html:Zg(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",P._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:pA,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Zg(P.normal._paragraph).replace("hr",P.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",P.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()};var N={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:pA,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^(?:[^_*\\]|\\.)*?\_\_(?:[^_*\\]|\\.)*?\*(?:[^_*\\]|\\.)*?(?=\_\_)|(?:[^*\\]|\\.)+(?=[^*])|[punct_](\*+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|(?:[^punct*_\s\\]|\\.)(\*+)(?=[^punct*_\s])/,rDelimUnd:/^(?:[^_*\\]|\\.)*?\*\*(?:[^_*\\]|\\.)*?\_(?:[^_*\\]|\\.)*?(?=\*\*)|(?:[^_\\]|\\.)+(?=[^_])|[punct*](\_+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:pA,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};function Cc(g){return g.replace(/---/g,"\u2014").replace(/--/g,"\u2013").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1\u2018").replace(/'/g,"\u2019").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1\u201C").replace(/"/g,"\u201D").replace(/\.{3}/g,"\u2026")}function oi(g){let I,C,A="",l=g.length;for(I=0;I<l;I++)C=g.charCodeAt(I),Math.random()>.5&&(C="x"+C.toString(16)),A+="&#"+C+";";return A}N._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~",N.punctuation=Zg(N.punctuation).replace(/punctuation/g,N._punctuation).getRegex(),N.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g,N.escapedEmSt=/(?:^|[^\\])(?:\\\\)*\\[*_]/g,N._comment=Zg(P._comment).replace("(?:-->|$)","-->").getRegex(),N.emStrong.lDelim=Zg(N.emStrong.lDelim).replace(/punct/g,N._punctuation).getRegex(),N.emStrong.rDelimAst=Zg(N.emStrong.rDelimAst,"g").replace(/punct/g,N._punctuation).getRegex(),N.emStrong.rDelimUnd=Zg(N.emStrong.rDelimUnd,"g").replace(/punct/g,N._punctuation).getRegex(),N._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g,N._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,N._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,N.autolink=Zg(N.autolink).replace("scheme",N._scheme).replace("email",N._email).getRegex(),N._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,N.tag=Zg(N.tag).replace("comment",N._comment).replace("attribute",N._attribute).getRegex(),N._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,N._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/,N._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,N.link=Zg(N.link).replace("label",N._label).replace("href",N._href).replace("title",N._title).getRegex(),N.reflink=Zg(N.reflink).replace("label",N._label).replace("ref",P._label).getRegex(),N.nolink=Zg(N.nolink).replace("ref",P._label).getRegex(),N.reflinkSearch=Zg(N.reflinkSearch,"g").replace("reflink",N.reflink).replace("nolink",N.nolink).getRegex(),N.normal={...N},N.pedantic={...N.normal,strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:Zg(/^!?\[(label)\]\((.*?)\)/).replace("label",N._label).getRegex(),reflink:Zg(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",N._label).getRegex()},N.gfm={...N.normal,escape:Zg(N.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},N.gfm.url=Zg(N.gfm.url,"i").replace("email",N.gfm._extended_email).getRegex(),N.breaks={...N.gfm,br:Zg(N.br).replace("{2,}","*").getRegex(),text:Zg(N.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()};var hI=class{constructor(I){this.tokens=[],this.tokens.links=Object.create(null),this.options=I||EI,this.options.tokenizer=this.options.tokenizer||new LC,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let C={block:P.normal,inline:N.normal};this.options.pedantic?(C.block=P.pedantic,C.inline=N.pedantic):this.options.gfm&&(C.block=P.gfm,this.options.breaks?C.inline=N.breaks:C.inline=N.gfm),this.tokenizer.rules=C}static get rules(){return{block:P,inline:N}}static lex(I,C){return new hI(C).lex(I)}static lexInline(I,C){return new hI(C).inlineTokens(I)}lex(I){let C;for(I=I.replace(/\r\n|\r/g,`
`),this.blockTokens(I,this.tokens);C=this.inlineQueue.shift();)this.inlineTokens(C.src,C.tokens);return this.tokens}blockTokens(I,C=[]){let A,l,i,e;for(I=this.options.pedantic?I.replace(/\t/g,"    ").replace(/^ +$/gm,""):I.replace(/^( *)(\t+)/gm,(o,t,n)=>t+"    ".repeat(n.length));I;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(o=>!!(A=o.call({lexer:this},I,C))&&(I=I.substring(A.raw.length),C.push(A),!0))))if(A=this.tokenizer.space(I))I=I.substring(A.raw.length),A.raw.length===1&&C.length>0?C[C.length-1].raw+=`
`:C.push(A);else if(A=this.tokenizer.code(I))I=I.substring(A.raw.length),l=C[C.length-1],!l||l.type!=="paragraph"&&l.type!=="text"?C.push(A):(l.raw+=`
`+A.raw,l.text+=`
`+A.text,this.inlineQueue[this.inlineQueue.length-1].src=l.text);else if(A=this.tokenizer.fences(I))I=I.substring(A.raw.length),C.push(A);else if(A=this.tokenizer.heading(I))I=I.substring(A.raw.length),C.push(A);else if(A=this.tokenizer.hr(I))I=I.substring(A.raw.length),C.push(A);else if(A=this.tokenizer.blockquote(I))I=I.substring(A.raw.length),C.push(A);else if(A=this.tokenizer.list(I))I=I.substring(A.raw.length),C.push(A);else if(A=this.tokenizer.html(I))I=I.substring(A.raw.length),C.push(A);else if(A=this.tokenizer.def(I))I=I.substring(A.raw.length),l=C[C.length-1],!l||l.type!=="paragraph"&&l.type!=="text"?this.tokens.links[A.tag]||(this.tokens.links[A.tag]={href:A.href,title:A.title}):(l.raw+=`
`+A.raw,l.text+=`
`+A.raw,this.inlineQueue[this.inlineQueue.length-1].src=l.text);else if(A=this.tokenizer.table(I))I=I.substring(A.raw.length),C.push(A);else if(A=this.tokenizer.lheading(I))I=I.substring(A.raw.length),C.push(A);else{if(i=I,this.options.extensions&&this.options.extensions.startBlock){let o=1/0,t=I.slice(1),n;this.options.extensions.startBlock.forEach(function(c){n=c.call({lexer:this},t),typeof n=="number"&&n>=0&&(o=Math.min(o,n))}),o<1/0&&o>=0&&(i=I.substring(0,o+1))}if(this.state.top&&(A=this.tokenizer.paragraph(i)))l=C[C.length-1],e&&l.type==="paragraph"?(l.raw+=`
`+A.raw,l.text+=`
`+A.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=l.text):C.push(A),e=i.length!==I.length,I=I.substring(A.raw.length);else if(A=this.tokenizer.text(I))I=I.substring(A.raw.length),l=C[C.length-1],l&&l.type==="text"?(l.raw+=`
`+A.raw,l.text+=`
`+A.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=l.text):C.push(A);else if(I){let o="Infinite loop on byte: "+I.charCodeAt(0);if(this.options.silent){console.error(o);break}throw new Error(o)}}return this.state.top=!0,C}inline(I,C=[]){return this.inlineQueue.push({src:I,tokens:C}),C}inlineTokens(I,C=[]){let A,l,i,e,o,t,n=I;if(this.tokens.links){let c=Object.keys(this.tokens.links);if(c.length>0)for(;(e=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)c.includes(e[0].slice(e[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,e.index)+"["+ei("a",e[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(e=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,e.index)+"["+ei("a",e[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(e=this.tokenizer.rules.inline.escapedEmSt.exec(n))!=null;)n=n.slice(0,e.index+e[0].length-2)+"++"+n.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex),this.tokenizer.rules.inline.escapedEmSt.lastIndex--;for(;I;)if(o||(t=""),o=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(c=>!!(A=c.call({lexer:this},I,C))&&(I=I.substring(A.raw.length),C.push(A),!0))))if(A=this.tokenizer.escape(I))I=I.substring(A.raw.length),C.push(A);else if(A=this.tokenizer.tag(I))I=I.substring(A.raw.length),l=C[C.length-1],l&&A.type==="text"&&l.type==="text"?(l.raw+=A.raw,l.text+=A.text):C.push(A);else if(A=this.tokenizer.link(I))I=I.substring(A.raw.length),C.push(A);else if(A=this.tokenizer.reflink(I,this.tokens.links))I=I.substring(A.raw.length),l=C[C.length-1],l&&A.type==="text"&&l.type==="text"?(l.raw+=A.raw,l.text+=A.text):C.push(A);else if(A=this.tokenizer.emStrong(I,n,t))I=I.substring(A.raw.length),C.push(A);else if(A=this.tokenizer.codespan(I))I=I.substring(A.raw.length),C.push(A);else if(A=this.tokenizer.br(I))I=I.substring(A.raw.length),C.push(A);else if(A=this.tokenizer.del(I))I=I.substring(A.raw.length),C.push(A);else if(A=this.tokenizer.autolink(I,oi))I=I.substring(A.raw.length),C.push(A);else if(this.state.inLink||!(A=this.tokenizer.url(I,oi))){if(i=I,this.options.extensions&&this.options.extensions.startInline){let c=1/0,s=I.slice(1),d;this.options.extensions.startInline.forEach(function(b){d=b.call({lexer:this},s),typeof d=="number"&&d>=0&&(c=Math.min(c,d))}),c<1/0&&c>=0&&(i=I.substring(0,c+1))}if(A=this.tokenizer.inlineText(i,Cc))I=I.substring(A.raw.length),A.raw.slice(-1)!=="_"&&(t=A.raw.slice(-1)),o=!0,l=C[C.length-1],l&&l.type==="text"?(l.raw+=A.raw,l.text+=A.text):C.push(A);else if(I){let c="Infinite loop on byte: "+I.charCodeAt(0);if(this.options.silent){console.error(c);break}throw new Error(c)}}else I=I.substring(A.raw.length),C.push(A);return C}},YC=class{constructor(I){this.options=I||EI}code(I,C,A){let l=(C||"").match(/\S*/)[0];if(this.options.highlight){let i=this.options.highlight(I,l);i!=null&&i!==I&&(A=!0,I=i)}return I=I.replace(/\n$/,"")+`
`,l?'<pre><code class="'+this.options.langPrefix+fg(l)+'">'+(A?I:fg(I,!0))+`</code></pre>
`:"<pre><code>"+(A?I:fg(I,!0))+`</code></pre>
`}blockquote(I){return`<blockquote>
${I}</blockquote>
`}html(I){return I}heading(I,C,A,l){return this.options.headerIds?`<h${C} id="${this.options.headerPrefix+l.slug(A)}">${I}</h${C}>
`:`<h${C}>${I}</h${C}>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(I,C,A){let l=C?"ol":"ul";return"<"+l+(C&&A!==1?' start="'+A+'"':"")+`>
`+I+"</"+l+`>
`}listitem(I){return`<li>${I}</li>
`}checkbox(I){return"<input "+(I?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(I){return`<p>${I}</p>
`}table(I,C){return C&&(C=`<tbody>${C}</tbody>`),`<table>
<thead>
`+I+`</thead>
`+C+`</table>
`}tablerow(I){return`<tr>
${I}</tr>
`}tablecell(I,C){let A=C.header?"th":"td";return(C.align?`<${A} align="${C.align}">`:`<${A}>`)+I+`</${A}>
`}strong(I){return`<strong>${I}</strong>`}em(I){return`<em>${I}</em>`}codespan(I){return`<code>${I}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(I){return`<del>${I}</del>`}link(I,C,A){if((I=Ai(this.options.sanitize,this.options.baseUrl,I))===null)return A;let l='<a href="'+I+'"';return C&&(l+=' title="'+C+'"'),l+=">"+A+"</a>",l}image(I,C,A){if((I=Ai(this.options.sanitize,this.options.baseUrl,I))===null)return A;let l=`<img src="${I}" alt="${A}"`;return C&&(l+=` title="${C}"`),l+=this.options.xhtml?"/>":">",l}text(I){return I}},rA=class{strong(I){return I}em(I){return I}codespan(I){return I}del(I){return I}html(I){return I}text(I){return I}link(I,C,A){return""+A}image(I,C,A){return""+A}br(){return""}},hA=class{constructor(){this.seen={}}serialize(I){return I.toLowerCase().trim().replace(/<[!\/a-z].*?>/gi,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(I,C){let A=I,l=0;if(this.seen.hasOwnProperty(A)){l=this.seen[I];do l++,A=I+"-"+l;while(this.seen.hasOwnProperty(A))}return C||(this.seen[I]=l,this.seen[A]=0),A}slug(I,C={}){let A=this.serialize(I);return this.getNextSafeSlug(A,C.dryrun)}},BI=class{constructor(I){this.options=I||EI,this.options.renderer=this.options.renderer||new YC,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new rA,this.slugger=new hA}static parse(I,C){return new BI(C).parse(I)}static parseInline(I,C){return new BI(C).parseInline(I)}parse(I,C=!0){let A,l,i,e,o,t,n,c,s,d,b,r,m,u,G,p,V,R,L,M="",x=I.length;for(A=0;A<x;A++)if(d=I[A],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[d.type]&&(L=this.options.extensions.renderers[d.type].call({parser:this},d),L!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(d.type)))M+=L||"";else switch(d.type){case"space":continue;case"hr":M+=this.renderer.hr();continue;case"heading":M+=this.renderer.heading(this.parseInline(d.tokens),d.depth,Zo(this.parseInline(d.tokens,this.textRenderer)),this.slugger);continue;case"code":M+=this.renderer.code(d.text,d.lang,d.escaped);continue;case"table":for(c="",n="",e=d.header.length,l=0;l<e;l++)n+=this.renderer.tablecell(this.parseInline(d.header[l].tokens),{header:!0,align:d.align[l]});for(c+=this.renderer.tablerow(n),s="",e=d.rows.length,l=0;l<e;l++){for(t=d.rows[l],n="",o=t.length,i=0;i<o;i++)n+=this.renderer.tablecell(this.parseInline(t[i].tokens),{header:!1,align:d.align[i]});s+=this.renderer.tablerow(n)}M+=this.renderer.table(c,s);continue;case"blockquote":s=this.parse(d.tokens),M+=this.renderer.blockquote(s);continue;case"list":for(b=d.ordered,r=d.start,m=d.loose,e=d.items.length,s="",l=0;l<e;l++)G=d.items[l],p=G.checked,V=G.task,u="",G.task&&(R=this.renderer.checkbox(p),m?G.tokens.length>0&&G.tokens[0].type==="paragraph"?(G.tokens[0].text=R+" "+G.tokens[0].text,G.tokens[0].tokens&&G.tokens[0].tokens.length>0&&G.tokens[0].tokens[0].type==="text"&&(G.tokens[0].tokens[0].text=R+" "+G.tokens[0].tokens[0].text)):G.tokens.unshift({type:"text",text:R}):u+=R),u+=this.parse(G.tokens,m),s+=this.renderer.listitem(u,V,p);M+=this.renderer.list(s,b,r);continue;case"html":M+=this.renderer.html(d.text);continue;case"paragraph":M+=this.renderer.paragraph(this.parseInline(d.tokens));continue;case"text":for(s=d.tokens?this.parseInline(d.tokens):d.text;A+1<x&&I[A+1].type==="text";)d=I[++A],s+=`
`+(d.tokens?this.parseInline(d.tokens):d.text);M+=C?this.renderer.paragraph(s):s;continue;default:{let D='Token with "'+d.type+'" type was not found.';if(this.options.silent)return void console.error(D);throw new Error(D)}}return M}parseInline(I,C){C=C||this.renderer;let A,l,i,e="",o=I.length;for(A=0;A<o;A++)if(l=I[A],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[l.type]&&(i=this.options.extensions.renderers[l.type].call({parser:this},l),i!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(l.type)))e+=i||"";else switch(l.type){case"escape":case"text":e+=C.text(l.text);break;case"html":e+=C.html(l.text);break;case"link":e+=C.link(l.href,l.title,this.parseInline(l.tokens,C));break;case"image":e+=C.image(l.href,l.title,l.text);break;case"strong":e+=C.strong(this.parseInline(l.tokens,C));break;case"em":e+=C.em(this.parseInline(l.tokens,C));break;case"codespan":e+=C.codespan(l.text);break;case"br":e+=C.br();break;case"del":e+=C.del(this.parseInline(l.tokens,C));break;default:{let t='Token with "'+l.type+'" type was not found.';if(this.options.silent)return void console.error(t);throw new Error(t)}}return e}},gC=class{constructor(I){this.options=I||EI}preprocess(I){return I}postprocess(I){return I}};El(gC,"passThroughHooks",new Set(["preprocess","postprocess"]));function Go(g,I){return(C,A,l)=>{typeof A=="function"&&(l=A,A=null);let i={...A},e=function(o,t,n){return c=>{if(c.message+=`
Please report this to https://github.com/markedjs/marked.`,o){let s="<p>An error occurred:</p><pre>"+fg(c.message+"",!0)+"</pre>";return t?Promise.resolve(s):n?void n(null,s):s}if(t)return Promise.reject(c);if(!n)throw c;n(c)}}((A={...O.defaults,...i}).silent,A.async,l);if(C==null)return e(new Error("marked(): input parameter is undefined or null"));if(typeof C!="string")return e(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(C)+", string expected"));if(function(o){o&&o.sanitize&&!o.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}(A),A.hooks&&(A.hooks.options=A),l){let o=A.highlight,t;try{A.hooks&&(C=A.hooks.preprocess(C)),t=g(C,A)}catch(s){return e(s)}let n=function(s){let d;if(!s)try{A.walkTokens&&O.walkTokens(t,A.walkTokens),d=I(t,A),A.hooks&&(d=A.hooks.postprocess(d))}catch(b){s=b}return A.highlight=o,s?e(s):l(null,d)};if(!o||o.length<3||(delete A.highlight,!t.length))return n();let c=0;return O.walkTokens(t,function(s){s.type==="code"&&(c++,setTimeout(()=>{o(s.text,s.lang,function(d,b){if(d)return n(d);b!=null&&b!==s.text&&(s.text=b,s.escaped=!0),c--,c===0&&n()})},0))}),void(c===0&&n())}if(A.async)return Promise.resolve(A.hooks?A.hooks.preprocess(C):C).then(o=>g(o,A)).then(o=>A.walkTokens?Promise.all(O.walkTokens(o,A.walkTokens)).then(()=>o):o).then(o=>I(o,A)).then(o=>A.hooks?A.hooks.postprocess(o):o).catch(e);try{A.hooks&&(C=A.hooks.preprocess(C));let o=g(C,A);A.walkTokens&&O.walkTokens(o,A.walkTokens);let t=I(o,A);return A.hooks&&(t=A.hooks.postprocess(t)),t}catch(o){return e(o)}}}function O(g,I,C){return Go(hI.lex,BI.parse)(g,I,C)}O.options=O.setOptions=function(g){var I;return O.defaults={...O.defaults,...g},I=O.defaults,EI=I,O},O.getDefaults=xn,O.defaults=EI,O.use=function(...g){let I=O.defaults.extensions||{renderers:{},childTokens:{}};g.forEach(C=>{let A={...C};if(A.async=O.defaults.async||A.async||!1,C.extensions&&(C.extensions.forEach(l=>{if(!l.name)throw new Error("extension name required");if(l.renderer){let i=I.renderers[l.name];I.renderers[l.name]=i?function(...e){let o=l.renderer.apply(this,e);return o===!1&&(o=i.apply(this,e)),o}:l.renderer}if(l.tokenizer){if(!l.level||l.level!=="block"&&l.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");I[l.level]?I[l.level].unshift(l.tokenizer):I[l.level]=[l.tokenizer],l.start&&(l.level==="block"?I.startBlock?I.startBlock.push(l.start):I.startBlock=[l.start]:l.level==="inline"&&(I.startInline?I.startInline.push(l.start):I.startInline=[l.start]))}l.childTokens&&(I.childTokens[l.name]=l.childTokens)}),A.extensions=I),C.renderer){let l=O.defaults.renderer||new YC;for(let i in C.renderer){let e=l[i];l[i]=(...o)=>{let t=C.renderer[i].apply(l,o);return t===!1&&(t=e.apply(l,o)),t}}A.renderer=l}if(C.tokenizer){let l=O.defaults.tokenizer||new LC;for(let i in C.tokenizer){let e=l[i];l[i]=(...o)=>{let t=C.tokenizer[i].apply(l,o);return t===!1&&(t=e.apply(l,o)),t}}A.tokenizer=l}if(C.hooks){let l=O.defaults.hooks||new gC;for(let i in C.hooks){let e=l[i];gC.passThroughHooks.has(i)?l[i]=o=>{if(O.defaults.async)return Promise.resolve(C.hooks[i].call(l,o)).then(n=>e.call(l,n));let t=C.hooks[i].call(l,o);return e.call(l,t)}:l[i]=(...o)=>{let t=C.hooks[i].apply(l,o);return t===!1&&(t=e.apply(l,o)),t}}A.hooks=l}if(C.walkTokens){let l=O.defaults.walkTokens;A.walkTokens=function(i){let e=[];return e.push(C.walkTokens.call(this,i)),l&&(e=e.concat(l.call(this,i))),e}}O.setOptions(A)})},O.walkTokens=function(g,I){let C=[];for(let A of g)switch(C=C.concat(I.call(O,A)),A.type){case"table":for(let l of A.header)C=C.concat(O.walkTokens(l.tokens,I));for(let l of A.rows)for(let i of l)C=C.concat(O.walkTokens(i.tokens,I));break;case"list":C=C.concat(O.walkTokens(A.items,I));break;default:O.defaults.extensions&&O.defaults.extensions.childTokens&&O.defaults.extensions.childTokens[A.type]?O.defaults.extensions.childTokens[A.type].forEach(function(l){C=C.concat(O.walkTokens(A[l],I))}):A.tokens&&(C=C.concat(O.walkTokens(A.tokens,I)))}return C},O.parseInline=Go(hI.lexInline,BI.parseInline),O.Parser=BI,O.parser=BI.parse,O.Renderer=YC,O.TextRenderer=rA,O.Lexer=hI,O.lexer=hI.lex,O.Tokenizer=LC,O.Slugger=hA,O.Hooks=gC,O.parse=O;var Ac=/\$.*?\$/,lc=/^\$(.*?)\$/,ec=/^(?:\s{0,3})\$\$((?:[^\n]|\n[^\n])+?)\n{0,1}\$\$/,bo=(g="",I={})=>g.replace(/:(.+?):/g,(C,A)=>I[A]?`<img class="wl-emoji" src="${I[A]}" alt="${A}">`:C),ic=(g,{emojiMap:I,highlighter:C,texRenderer:A})=>{if(O.setOptions({highlight:C||void 0,breaks:!0,smartLists:!0,smartypants:!0}),A){let l=(i=>[{name:"blockMath",level:"block",tokenizer(e){let o=ec.exec(e);if(o!==null)return{type:"html",raw:o[0],text:i(!0,o[1])}}},{name:"inlineMath",level:"inline",start(e){let o=e.search(Ac);return o!==-1?o:e.length},tokenizer(e){let o=lc.exec(e);if(o!==null)return{type:"html",raw:o[0],text:i(!1,o[1])}}}])(A);O.use({extensions:l})}return O.parse(bo(g,I))},ti=g=>g.dataset.path||g.getAttribute("id"),oc=({serverURL:g,path:I=window.location.pathname,selector:C=".waline-comment-count",lang:A=navigator.language})=>{let l=new AbortController,i=document.querySelectorAll(C);return i.length&&(({serverURL:e,lang:o,paths:t,signal:n})=>GM_fetch(`${e}/comment?type=count&url=${encodeURIComponent(t.join(","))}&lang=${o}`,{signal:n}).then(c=>c.json()).then(c=>Array.isArray(c)?c:[c]))({serverURL:oA(g),paths:Array.from(i).map(e=>pi(e.dataset.path||e.getAttribute("id")||I)),lang:A,signal:l.signal}).then(e=>{i.forEach((o,t)=>{o.innerText=e[t].toString()})}).catch(ao),l.abort.bind(l)},ni=({size:g})=>cg("svg",{class:"wl-close-icon",viewBox:"0 0 1024 1024",width:g,height:g},[cg("path",{d:"M697.173 85.333h-369.92c-144.64 0-241.92 101.547-241.92 252.587v348.587c0 150.613 97.28 252.16 241.92 252.16h369.92c144.64 0 241.494-101.547 241.494-252.16V337.92c0-151.04-96.854-252.587-241.494-252.587z",fill:"currentColor"}),cg("path",{d:"m640.683 587.52-75.947-75.861 75.904-75.862a37.29 37.29 0 0 0 0-52.778 37.205 37.205 0 0 0-52.779 0l-75.946 75.818-75.862-75.946a37.419 37.419 0 0 0-52.821 0 37.419 37.419 0 0 0 0 52.821l75.947 75.947-75.776 75.733a37.29 37.29 0 1 0 52.778 52.821l75.776-75.776 75.947 75.947a37.376 37.376 0 0 0 52.779-52.821z",fill:"#888"})]),tc=()=>cg("svg",{viewBox:"0 0 1024 1024",width:"24",height:"24"},cg("path",{d:"m341.013 394.667 27.755 393.45h271.83l27.733-393.45h64.106l-28.01 397.952a64 64 0 0 1-63.83 59.498H368.768a64 64 0 0 1-63.83-59.52l-28.053-397.93h64.128zm139.307 19.818v298.667h-64V414.485h64zm117.013 0v298.667h-64V414.485h64zM181.333 288h640v64h-640v-64zm453.483-106.667v64h-256v-64h256z",fill:"red"})),nc=()=>cg("svg",{viewBox:"0 0 1024 1024",width:"24",height:"24"},cg("path",{d:"M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z",fill:"currentColor"})),cc=()=>cg("svg",{viewBox:"0 0 1024 1024",width:"24",height:"24"},[cg("path",{d:"M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z",fill:"currentColor"}),cg("path",{d:"M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z",fill:"currentColor"})]),sc=({active:g=!1})=>cg("svg",{viewBox:"0 0 1024 1024",width:"24",height:"24"},[cg("path",{d:"M850.654 323.804c-11.042-25.625-26.862-48.532-46.885-68.225-20.022-19.61-43.258-34.936-69.213-45.73-26.78-11.124-55.124-16.727-84.375-16.727-40.622 0-80.256 11.123-114.698 32.135A214.79 214.79 0 0 0 512 241.819a214.79 214.79 0 0 0-23.483-16.562c-34.442-21.012-74.076-32.135-114.698-32.135-29.25 0-57.595 5.603-84.375 16.727-25.872 10.711-49.19 26.12-69.213 45.73-20.105 19.693-35.843 42.6-46.885 68.225-11.453 26.615-17.303 54.877-17.303 83.963 0 27.439 5.603 56.03 16.727 85.117 9.31 24.307 22.659 49.52 39.715 74.981 27.027 40.293 64.188 82.316 110.33 124.915 76.465 70.615 152.189 119.394 155.402 121.371l19.528 12.525c8.652 5.52 19.776 5.52 28.427 0l19.529-12.525c3.213-2.06 78.854-50.756 155.401-121.371 46.143-42.6 83.304-84.622 110.33-124.915 17.057-25.46 30.487-50.674 39.716-74.981 11.124-29.087 16.727-57.678 16.727-85.117.082-29.086-5.768-57.348-17.221-83.963z"+(g?"":"M512 761.5S218.665 573.55 218.665 407.767c0-83.963 69.461-152.023 155.154-152.023 60.233 0 112.473 33.618 138.181 82.727 25.708-49.109 77.948-82.727 138.18-82.727 85.694 0 155.155 68.06 155.155 152.023C805.335 573.551 512 761.5 512 761.5z"),fill:g?"red":"currentColor"})]),ac=()=>cg("svg",{viewBox:"0 0 1024 1024",width:"24",height:"24"},[cg("path",{d:"M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0",fill:"currentColor"}),cg("path",{d:"M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0",fill:"currentColor"})]),dc=()=>cg("svg",{width:"16",height:"16",ariaHidden:"true"},cg("path",{d:"M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z",fill:"currentColor"})),uc=()=>cg("svg",{viewBox:"0 0 1024 1024",width:"24",height:"24"},cg("path",{d:"M810.667 213.333a64 64 0 0 1 64 64V704a64 64 0 0 1-64 64H478.336l-146.645 96.107a21.333 21.333 0 0 1-33.024-17.856V768h-85.334a64 64 0 0 1-64-64V277.333a64 64 0 0 1 64-64h597.334zm0 64H213.333V704h149.334v63.296L459.243 704h351.424V277.333zm-271.36 213.334v64h-176.64v-64h176.64zm122.026-128v64H362.667v-64h298.666z",fill:"currentColor"})),mc=()=>cg("svg",{viewBox:"0 0 1024 1024",width:"24",height:"24"},cg("path",{d:"M813.039 318.772L480.53 651.278H360.718V531.463L693.227 198.961C697.904 194.284 704.027 192 710.157 192C716.302 192 722.436 194.284 727.114 198.961L813.039 284.88C817.72 289.561 820 295.684 820 301.825C820 307.95 817.72 314.093 813.039 318.772ZM710.172 261.888L420.624 551.431V591.376H460.561L750.109 301.825L710.172 261.888ZM490.517 291.845H240.906V771.09H720.156V521.479C720.156 504.947 733.559 491.529 750.109 491.529C766.653 491.529 780.063 504.947 780.063 521.479V791.059C780.063 813.118 762.18 831 740.125 831H220.937C198.882 831 181 813.118 181 791.059V271.872C181 249.817 198.882 231.935 220.937 231.935H490.517C507.06 231.935 520.47 245.352 520.47 261.888C520.47 278.424 507.06 291.845 490.517 291.845Z",fill:"currentColor"})),Zc=()=>cg("svg",{class:"verified-icon",viewBox:"0 0 1024 1024",width:"14",height:"14"},cg("path",{d:"m894.4 461.56-54.4-63.2c-10.4-12-18.8-34.4-18.8-50.4v-68c0-42.4-34.8-77.2-77.2-77.2h-68c-15.6 0-38.4-8.4-50.4-18.8l-63.2-54.4c-27.6-23.6-72.8-23.6-100.8 0l-62.8 54.8c-12 10-34.8 18.4-50.4 18.4h-69.2c-42.4 0-77.2 34.8-77.2 77.2v68.4c0 15.6-8.4 38-18.4 50l-54 63.6c-23.2 27.6-23.2 72.4 0 100l54 63.6c10 12 18.4 34.4 18.4 50v68.4c0 42.4 34.8 77.2 77.2 77.2h69.2c15.6 0 38.4 8.4 50.4 18.8l63.2 54.4c27.6 23.6 72.8 23.6 100.8 0l63.2-54.4c12-10.4 34.4-18.8 50.4-18.8h68c42.4 0 77.2-34.8 77.2-77.2v-68c0-15.6 8.4-38.4 18.8-50.4l54.4-63.2c23.2-27.6 23.2-73.2-.4-100.8zm-216-25.2-193.2 193.2a30 30 0 0 1-42.4 0l-96.8-96.8a30.16 30.16 0 0 1 0-42.4c11.6-11.6 30.8-11.6 42.4 0l75.6 75.6 172-172c11.6-11.6 30.8-11.6 42.4 0 11.6 11.6 11.6 30.8 0 42.4z",fill:"#27ae60"})),fC=({size:g=100})=>cg("svg",{width:g,height:g,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid"},cg("circle",{cx:50,cy:50,fill:"none",stroke:"currentColor",strokeWidth:"4",r:"40","stroke-dasharray":"85 30"},cg("animateTransform",{attributeName:"transform",type:"rotate",repeatCount:"indefinite",dur:"1s",values:"0 50 50;360 50 50",keyTimes:"0;1"}))),Gc=()=>cg("svg",{width:24,height:24,fill:"currentcolor",viewBox:"0 0 24 24"},[cg("path",{style:"transform: translateY(0.5px)",d:"M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"}),cg("path",{d:"M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"})]),ci=null,po=()=>ci||(ci=eC("WALINE_LIKE",[])),si=null,bc=()=>si??(si=eC("WALINE_REACTION",{})),BA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ro={},IC={},kC={},pc=BA&&BA.__awaiter||function(g,I,C,A){return new(C||(C=Promise))(function(l,i){function e(n){try{t(A.next(n))}catch(c){i(c)}}function o(n){try{t(A.throw(n))}catch(c){i(c)}}function t(n){var c;n.done?l(n.value):(c=n.value,c instanceof C?c:new C(function(s){s(c)})).then(e,o)}t((A=A.apply(g,I||[])).next())})},rc=BA&&BA.__generator||function(g,I){var C,A,l,i,e={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function o(t){return function(n){return function(c){if(C)throw new TypeError("Generator is already executing.");for(;e;)try{if(C=1,A&&(l=2&c[0]?A.return:c[0]?A.throw||((l=A.return)&&l.call(A),0):A.next)&&!(l=l.call(A,c[1])).done)return l;switch(A=0,l&&(c=[2&c[0],l.value]),c[0]){case 0:case 1:l=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,A=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(l=e.trys,!((l=l.length>0&&l[l.length-1])||c[0]!==6&&c[0]!==2)){e=0;continue}if(c[0]===3&&(!l||c[1]>l[0]&&c[1]<l[3])){e.label=c[1];break}if(c[0]===6&&e.label<l[1]){e.label=l[1],l=c;break}if(l&&e.label<l[2]){e.label=l[2],e.ops.push(c);break}l[2]&&e.ops.pop(),e.trys.pop();continue}c=I.call(g,e)}catch(s){c=[6,s],A=0}finally{C=l=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([t,n])}}};Object.defineProperty(kC,"__esModule",{value:!0}),kC.ReCaptchaInstance=void 0;var hc=function(){function g(I,C,A){this.siteKey=I,this.recaptchaID=C,this.recaptcha=A,this.styleContainer=null}return g.prototype.execute=function(I){return pc(this,void 0,void 0,function(){return rc(this,function(C){return[2,this.recaptcha.enterprise?this.recaptcha.enterprise.execute(this.recaptchaID,{action:I}):this.recaptcha.execute(this.recaptchaID,{action:I})]})})},g.prototype.getSiteKey=function(){return this.siteKey},g.prototype.hideBadge=function(){this.styleContainer===null&&(this.styleContainer=document.createElement("style"),this.styleContainer.innerHTML=".grecaptcha-badge{visibility:hidden !important;}",document.head.appendChild(this.styleContainer))},g.prototype.showBadge=function(){this.styleContainer!==null&&(document.head.removeChild(this.styleContainer),this.styleContainer=null)},g}();kC.ReCaptchaInstance=hc,Object.defineProperty(IC,"__esModule",{value:!0}),IC.getInstance=IC.load=void 0;var KI,Bc=kC;(function(g){g[g.NOT_LOADED=0]="NOT_LOADED",g[g.LOADING=1]="LOADING",g[g.LOADED=2]="LOADED"})(KI||(KI={}));var ai=function(){function g(){}return g.load=function(I,C){if(C===void 0&&(C={}),typeof document>"u")return Promise.reject(new Error("This is a library for the browser!"));if(g.getLoadingState()===KI.LOADED)return g.instance.getSiteKey()===I?Promise.resolve(g.instance):Promise.reject(new Error("reCAPTCHA already loaded with different site key!"));if(g.getLoadingState()===KI.LOADING)return I!==g.instanceSiteKey?Promise.reject(new Error("reCAPTCHA already loaded with different site key!")):new Promise(function(l,i){g.successfulLoadingConsumers.push(function(e){return l(e)}),g.errorLoadingRunnable.push(function(e){return i(e)})});g.instanceSiteKey=I,g.setLoadingState(KI.LOADING);var A=new g;return new Promise(function(l,i){A.loadScript(I,C.useRecaptchaNet||!1,C.useEnterprise||!1,C.renderParameters?C.renderParameters:{},C.customUrl).then(function(){g.setLoadingState(KI.LOADED);var e=A.doExplicitRender(grecaptcha,I,C.explicitRenderParameters?C.explicitRenderParameters:{},C.useEnterprise||!1),o=new Bc.ReCaptchaInstance(I,e,grecaptcha);g.successfulLoadingConsumers.forEach(function(t){return t(o)}),g.successfulLoadingConsumers=[],C.autoHideBadge&&o.hideBadge(),g.instance=o,l(o)}).catch(function(e){g.errorLoadingRunnable.forEach(function(o){return o(e)}),g.errorLoadingRunnable=[],i(e)})})},g.getInstance=function(){return g.instance},g.setLoadingState=function(I){g.loadingState=I},g.getLoadingState=function(){return g.loadingState===null?KI.NOT_LOADED:g.loadingState},g.prototype.loadScript=function(I,C,A,l,i){var e=this;C===void 0&&(C=!1),A===void 0&&(A=!1),l===void 0&&(l={}),i===void 0&&(i="");var o=document.createElement("script");o.setAttribute("recaptcha-v3-script","");var t="https://www.google.com/recaptcha/api.js";C&&(t=A?"https://recaptcha.net/recaptcha/enterprise.js":"https://recaptcha.net/recaptcha/api.js"),A&&(t="https://www.google.com/recaptcha/enterprise.js"),i&&(t=i),l.render&&(l.render=void 0);var n=this.buildQueryString(l);return o.src=t+"?render=explicit"+n,new Promise(function(c,s){o.addEventListener("load",e.waitForScriptToLoad(function(){c(o)},A),!1),o.onerror=function(d){g.setLoadingState(KI.NOT_LOADED),s(d)},document.head.appendChild(o)})},g.prototype.buildQueryString=function(I){return Object.keys(I).length<1?"":"&"+Object.keys(I).filter(function(C){return!!I[C]}).map(function(C){return C+"="+I[C]}).join("&")},g.prototype.waitForScriptToLoad=function(I,C){var A=this;return function(){window.grecaptcha===void 0?setTimeout(function(){A.waitForScriptToLoad(I,C)},g.SCRIPT_LOAD_DELAY):C?window.grecaptcha.enterprise.ready(function(){I()}):window.grecaptcha.ready(function(){I()})}},g.prototype.doExplicitRender=function(I,C,A,l){var i={sitekey:C,badge:A.badge,size:A.size,tabindex:A.tabindex};return A.container?l?I.enterprise.render(A.container,i):I.render(A.container,i):l?I.enterprise.render(i):I.render(i)},g.loadingState=null,g.instance=null,g.instanceSiteKey=null,g.successfulLoadingConsumers=[],g.errorLoadingRunnable=[],g.SCRIPT_LOAD_DELAY=25,g}();IC.load=ai.load,IC.getInstance=ai.getInstance,function(g){Object.defineProperty(g,"__esModule",{value:!0}),g.ReCaptchaInstance=g.getInstance=g.load=void 0;var I=IC;Object.defineProperty(g,"load",{enumerable:!0,get:function(){return I.load}}),Object.defineProperty(g,"getInstance",{enumerable:!0,get:function(){return I.getInstance}});var C=kC;Object.defineProperty(g,"ReCaptchaInstance",{enumerable:!0,get:function(){return C.ReCaptchaInstance}})}(ro);var di={},ui=null,vl=()=>ui??(ui=eC("WALINE_USER",{})),yc={key:0,class:"wl-reaction"},Vc=["textContent"],Xc={class:"wl-reaction-list"},Sc=["onClick"],Wc={class:"wl-reaction-img"},Rc=["src","alt"],wc=["textContent"],Kc=["textContent"],Hc=JC({__name:"ArticleReaction",setup(g,{expose:I}){I();let C=bc(),A=KA("config"),l=Ig(-1),i=Ig([]),e=wg(()=>A.value.locale),o=wg(()=>A.value.reaction.length>0),t=wg(()=>{let{reaction:c,path:s}=A.value;return c.map((d,b)=>({icon:d,desc:e.value[`reaction${b}`],active:C.value[s]===b}))}),n;return NC(()=>{gI(()=>[A.value.serverURL,A.value.path],()=>{(async()=>{if(o.value){let{serverURL:c,lang:s,path:d,reaction:b}=A.value,r=new AbortController;n=r.abort.bind(r);let m=await bi({serverURL:c,lang:s,paths:[d],type:b.map((u,G)=>`reaction${G}`),signal:r.signal});if(Array.isArray(m)||typeof m=="number")return;i.value=b.map((u,G)=>m[`reaction${G}`])}})()},{immediate:!0})}),wA(()=>n?.()),(c,s)=>t.value.length?(v(),z("div",yc,[T("div",{class:"wl-reaction-title",textContent:og(e.value.reactionTitle)},null,8,Vc),T("ul",Xc,[(v(!0),z(pg,null,eI(t.value,({active:d,icon:b,desc:r},m)=>(v(),z("li",{key:m,class:Sg(["wl-reaction-item",{active:d}]),onClick:u=>(async G=>{if(l.value===-1){let{serverURL:p,lang:V,path:R}=A.value,L=C.value[R];l.value=G,L!==void 0&&(await Al({serverURL:p,lang:V,path:R,type:`reaction${L}`,action:"desc"}),i.value[L]=Math.max(i.value[L]-1,0)),L!==G&&(await Al({serverURL:p,lang:V,path:R,type:`reaction${G}`}),i.value[G]=(i.value[G]||0)+1),L===G?delete C.value[R]:C.value[R]=G,l.value=-1}})(m)},[T("div",Wc,[T("img",{src:b,alt:r},null,8,Rc),l.value===m?(v(),VI(Cg(fC),{key:0,class:"wl-reaction-loading"})):(v(),z("div",{key:1,class:"wl-reaction-votes",textContent:og(i.value[m]||0)},null,8,wc))]),T("div",{class:"wl-reaction-text",textContent:og(r)},null,8,Kc)],10,Sc))),128))])])):lg("v-if",!0)}}),UC=(g,I)=>{let C=g.__vccOpts||g;for(let[A,l]of I)C[A]=l;return C},Lc=UC(Hc,[["__file","ArticleReaction.vue"]]),pC=new Map;function Yc(g){var I=pC.get(g);I&&I.destroy()}function fc(g){var I=pC.get(g);I&&I.update()}var uC=null;typeof window>"u"?((uC=function(g){return g}).destroy=function(g){return g},uC.update=function(g){return g}):((uC=function(g,I){return g&&Array.prototype.forEach.call(g.length?g:[g],function(C){return function(A){if(A&&A.nodeName&&A.nodeName==="TEXTAREA"&&!pC.has(A)){var l,i=null,e=window.getComputedStyle(A),o=(l=A.value,function(){n({testForHeightReduction:l===""||!A.value.startsWith(l),restoreTextAlign:null}),l=A.value}),t=function(s){A.removeEventListener("autosize:destroy",t),A.removeEventListener("autosize:update",c),A.removeEventListener("input",o),window.removeEventListener("resize",c),Object.keys(s).forEach(function(d){return A.style[d]=s[d]}),pC.delete(A)}.bind(A,{height:A.style.height,resize:A.style.resize,textAlign:A.style.textAlign,overflowY:A.style.overflowY,overflowX:A.style.overflowX,wordWrap:A.style.wordWrap});A.addEventListener("autosize:destroy",t),A.addEventListener("autosize:update",c),A.addEventListener("input",o),window.addEventListener("resize",c),A.style.overflowX="hidden",A.style.wordWrap="break-word",pC.set(A,{destroy:t,update:c}),c()}function n(s){var d,b,r=s.restoreTextAlign,m=r===void 0?null:r,u=s.testForHeightReduction,G=u===void 0||u,p=e.overflowY;if(A.scrollHeight!==0&&(e.resize==="vertical"?A.style.resize="none":e.resize==="both"&&(A.style.resize="horizontal"),G&&(d=function(R){for(var L=[];R&&R.parentNode&&R.parentNode instanceof Element;)R.parentNode.scrollTop&&L.push([R.parentNode,R.parentNode.scrollTop]),R=R.parentNode;return function(){return L.forEach(function(M){var x=M[0],D=M[1];x.style.scrollBehavior="auto",x.scrollTop=D,x.style.scrollBehavior=null})}}(A),A.style.height=""),b=e.boxSizing==="content-box"?A.scrollHeight-(parseFloat(e.paddingTop)+parseFloat(e.paddingBottom)):A.scrollHeight+parseFloat(e.borderTopWidth)+parseFloat(e.borderBottomWidth),e.maxHeight!=="none"&&b>parseFloat(e.maxHeight)?(e.overflowY==="hidden"&&(A.style.overflow="scroll"),b=parseFloat(e.maxHeight)):e.overflowY!=="hidden"&&(A.style.overflow="hidden"),A.style.height=b+"px",m&&(A.style.textAlign=m),d&&d(),i!==b&&(A.dispatchEvent(new Event("autosize:resized",{bubbles:!0})),i=b),p!==e.overflow&&!m)){var V=e.textAlign;e.overflow==="hidden"&&(A.style.textAlign=V==="start"?"end":"start"),n({restoreTextAlign:V,testForHeightReduction:!0})}}function c(){n({testForHeightReduction:!0,restoreTextAlign:null})}}(C)}),g}).destroy=function(g){return g&&Array.prototype.forEach.call(g.length?g:[g],Yc),g},uC.update=function(g){return g&&Array.prototype.forEach.call(g.length?g:[g],fc),g});var mi=uC,kc=["data-index"],vc=["src","title","onClick"],Fc=JC({__name:"ImageWall",props:{items:{default:()=>[]},columnWidth:{default:300},gap:{default:0}},emits:["insert"],setup(g,{expose:I}){let C=g;I();let A=null,l=Ig(null),i=Ig({}),e=Ig([]),o=()=>{let s=Math.floor((l.value.getBoundingClientRect().width+C.gap)/(C.columnWidth+C.gap));return s>0?s:1},t=async s=>{if(s>=C.items.length)return;await RA();let d=Array.from(l.value?.children||[]).reduce((b,r)=>r.getBoundingClientRect().height<b.getBoundingClientRect().height?r:b);e.value[Number(d.dataset.index)].push(s),await t(s+1)},n=async(s=!1)=>{if(e.value.length===o()&&!s)return;var d;e.value=(d=o(),new Array(d).fill(null).map(()=>[]));let b=window.scrollY;await t(0),window.scrollTo({top:b})},c=s=>{i.value[s.target.src]=!0};return NC(()=>{n(!0),A=new ResizeObserver(()=>{n()}),A.observe(l.value),gI(()=>[C.items],()=>{i.value={},n(!0)}),gI(()=>[C.columnWidth,C.gap],()=>{n()})}),zt(()=>A.unobserve(l.value)),(s,d)=>(v(),z("div",{ref_key:"wall",ref:l,class:"wl-gallery",style:BC({gap:`${s.gap}px`})},[(v(!0),z(pg,null,eI(e.value,(b,r)=>(v(),z("div",{key:r,class:"wl-gallery-column","data-index":r,style:BC({gap:`${s.gap}px`})},[(v(!0),z(pg,null,eI(b,m=>(v(),z(pg,{key:m},[i.value[s.items[m].src]?lg("v-if",!0):(v(),VI(Cg(fC),{key:0,size:36,style:{margin:"20px auto"}})),T("img",{class:"wl-gallery-item",src:s.items[m].src,title:s.items[m].title,loading:"lazy",onLoad:c,onClick:u=>s.$emit("insert",`![](${s.items[m].src})`)},null,40,vc)],64))),128))],12,kc))),128))],4))}}),Jc=UC(Fc,[["__file","ImageWall.vue"]]),Nc={class:"wl-comment"},Uc={key:0,class:"wl-login-info"},Mc={class:"wl-avatar"},zc=["title"],Dc=["title"],Qc=["src"],xc=["title","textContent"],Tc={class:"wl-panel"},Ec=["for","textContent"],Pc=["id","onUpdate:modelValue","name","type"],jc=["placeholder"],Oc={class:"wl-preview"},_c=T("hr",null,null,-1),$c=["innerHTML"],qc={class:"wl-footer"},gs={class:"wl-actions"},Is={href:"https://guides.github.com/features/mastering-markdown/",title:"Markdown Guide","aria-label":"Markdown is supported",class:"wl-action",target:"_blank",rel:"noopener noreferrer"},Cs=["title"],As=["title"],ls=["title"],es=["title"],is={class:"wl-info"},os=T("div",{class:"wl-captcha-container"},null,-1),ts={class:"wl-text-number"},ns={key:0},cs=["textContent"],ss=["textContent"],as=["disabled"],ds=["placeholder"],us={key:1,class:"wl-loading"},ms={key:0,class:"wl-tab-wrapper"},Zs=["title","onClick"],Gs=["src","alt"],bs={key:0,class:"wl-tabs"},ps=["onClick"],rs=["src","alt","title"],hs=["title"],Bs=JC({__name:"CommentBox",props:{edit:{default:null},rootId:{default:""},replyId:{default:""},replyUser:{default:""}},emits:["log","cancelEdit","cancelReply","submit"],setup(g,{expose:I,emit:C}){let A=g;I();let l=KA("config"),i=eC("WALINE_COMMENT_BOX_EDITOR",""),e=eC("WALINE_USER_META",{nick:"",mail:"",link:""}),o=vl(),t=Ig({}),n=Ig(null),c=Ig(null),s=Ig(null),d=Ig(null),b=Ig(null),r=Ig(null),m=Ig(null),u=Ig({tabs:[],map:{}}),G=Ig(0),p=Ig(!1),V=Ig(!1),R=Ig(!1),L=Ig(""),M=Ig(0),x=SC({loading:!0,list:[]}),D=Ig(0),sg=Ig(!1),Fg=Ig(""),jg=Ig(!1),E=Ig(!1),j=wg(()=>l.value.locale),q=wg(()=>Boolean(o.value?.token)),Ag=wg(()=>l.value.imageUploader!==!1),ag=J=>{let F=n.value,a=F.selectionStart,Z=F.selectionEnd||0,h=F.scrollTop;i.value=F.value.substring(0,a)+J+F.value.substring(Z,F.value.length),F.focus(),F.selectionStart=a+J.length,F.selectionEnd=a+J.length,F.scrollTop=h},Gg=J=>{let F=J.key;(J.ctrlKey||J.metaKey)&&F==="Enter"&&Wg()},Bg=J=>{let F=`![${l.value.locale.uploading} ${J.name}]()`;return ag(F),Promise.resolve().then(()=>l.value.imageUploader(J)).then(a=>{i.value=i.value.replace(F,`\r
![${J.name}](${a})`)}).catch(a=>{alert(a.message),i.value=i.value.replace(F,"")})},Dg=J=>{if(J.dataTransfer?.items){let F=Ii(J.dataTransfer.items);F&&Ag.value&&(Bg(F),J.preventDefault())}},Tg=J=>{if(J.clipboardData){let F=Ii(J.clipboardData.items);F&&Ag.value&&Bg(F)}},Og=()=>{let J=c.value;J.files&&Ag.value&&Bg(J.files[0]).then(()=>{J.value=""})},Wg=async()=>{let{serverURL:J,lang:F,login:a,wordLimit:Z,requiredMeta:h,recaptchaV3Key:X,turnstileKey:y}=l.value,W=await(async()=>{if(!navigator)return"";let{userAgentData:B}=navigator,Y=navigator.userAgent;if(!B||B.platform!=="Windows")return Y;let{platformVersion:H}=await B.getHighEntropyValues(["platformVersion"]);return H&&parseInt(H.split(".")[0])>=13&&(Y=Y.replace("Windows NT 10.0","Windows NT 11.0")),Y})(),K={comment:Fg.value,nick:e.value.nick,mail:e.value.mail,link:e.value.link,url:l.value.path,ua:W};if(o.value?.token)K.nick=o.value.display_name,K.mail=o.value.email,K.link=o.value.url;else{if(a==="force")return;if(h.indexOf("nick")>-1&&!K.nick)return t.value.nick?.focus(),alert(j.value.nickError);if(h.indexOf("mail")>-1&&!K.mail||K.mail&&(w=K.mail,!et.test(w)))return t.value.mail?.focus(),alert(j.value.mailError);K.nick||(K.nick=j.value.anonymous)}var w;if(K.comment){if(!sg.value)return alert(j.value.wordHint.replace("$0",Z[0].toString()).replace("$1",Z[1].toString()).replace("$2",M.value.toString()));K.comment=bo(K.comment,u.value.map),A.replyId&&A.rootId&&(K.pid=A.replyId,K.rid=A.rootId,K.at=A.replyUser),jg.value=!0;try{X&&(K.recaptchaV3=await(H=>{let f=di[H]??(di[H]=ro.load(H,{useRecaptchaNet:!0,autoHideBadge:!0}));return{execute:k=>f.then(U=>U.execute(k))}})(X).execute("social")),y&&(K.turnstile=await(S=y,{execute:H=>new Promise(f=>{Un("https://challenges.cloudflare.com/turnstile/v0/api.js",()=>{let k=window?.turnstile,U={sitekey:S,action:H,size:"compact",callback(Q){f(Q)}};k?.ready(()=>k?.render(".wl-captcha-container",U))},{async:!1})})}).execute("social"));let B={serverURL:J,lang:F,token:o.value?.token,comment:K},Y=await(A.edit?IA({objectId:A.edit.objectId,...B}):(({serverURL:H,lang:f,token:k,comment:U})=>{let Q={"Content-Type":"application/json"};return k&&(Q.Authorization=`Bearer ${k}`),GM_fetch(`${H}/comment?lang=${f}`,{method:"POST",headers:Q,body:JSON.stringify(U)}).then(gg=>gg.json())})(B));if(jg.value=!1,Y.errmsg)return alert(Y.errmsg);C("submit",Y.data),i.value="",L.value="",A.replyId&&C("cancelReply"),A.edit?.objectId&&C("cancelEdit")}catch(B){jg.value=!1,alert(B.message)}var S}else n.value?.focus()},Jg=J=>{J.preventDefault();let{lang:F,serverURL:a}=l.value;(({lang:Z,serverURL:h})=>{let X=(window.innerWidth-450)/2,y=(window.innerHeight-450)/2,W=window.open(`${h}/ui/login?lng=${encodeURIComponent(Z)}`,"_blank",`width=450,height=450,left=${X},top=${y},scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no`);return W?.postMessage({type:"TOKEN",data:null},"*"),new Promise(K=>{let w=({data:S})=>{S&&typeof S=="object"&&S.type==="userInfo"&&S.data.token&&(W?.close(),window.removeEventListener("message",w),K(S.data))};window.addEventListener("message",w)})})({serverURL:a,lang:F}).then(Z=>{o.value=Z,(Z.remember?localStorage:sessionStorage).setItem("WALINE_USER",JSON.stringify(Z)),C("log")})},oI=()=>{o.value={},localStorage.setItem("WALINE_USER","null"),sessionStorage.setItem("WALINE_USER","null"),C("log")},uI=J=>{J.preventDefault();let{lang:F,serverURL:a}=l.value,Z=(window.innerWidth-800)/2,h=(window.innerHeight-800)/2,X=new URLSearchParams({lng:F,token:o.value.token});window.open(`${a}/ui/profile?${X.toString()}`,"_blank",`width=800,height=800,left=${Z},top=${h},scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no`)?.postMessage({type:"TOKEN",data:o.value.token},"*")},Xg=J=>{s.value?.contains(J.target)||d.value?.contains(J.target)||(p.value=!1),b.value?.contains(J.target)||r.value?.contains(J.target)||(V.value=!1)},AI=async J=>{let{scrollTop:F,clientHeight:a,scrollHeight:Z}=J.target,h=(a+F)/Z,X=l.value.search,y=m.value?.value||"";h<.9||x.loading||E.value||(x.loading=!0,(X.more&&x.list.length?await X.more(y,x.list.length):await X.search(y)).length?x.list=[...x.list,...X.more&&x.list.length?await X.more(y,x.list.length):await X.search(y)]:E.value=!0,x.loading=!1,setTimeout(()=>{J.target.scrollTop=F},50))},mI=bn(J=>{x.list=[],E.value=!1,AI(J)},300);gI([l,M],([J,F])=>{let{wordLimit:a}=J;a?F<a[0]&&a[0]!==0?(D.value=a[0],sg.value=!1):F>a[1]?(D.value=a[1],sg.value=!1):(D.value=a[1],sg.value=!0):(D.value=0,sg.value=!0)},{immediate:!0});let tI=({data:J})=>{J&&J.type==="profile"&&(o.value={...o.value,...J.data},[localStorage,sessionStorage].filter(F=>F.getItem("WALINE_USER")).forEach(F=>F.setItem("WALINE_USER",JSON.stringify(o))))};return NC(()=>{document.body.addEventListener("click",Xg),window.addEventListener("message",tI),A.edit?.objectId&&(i.value=A.edit.orig),gI(V,async J=>{if(!J)return;let F=l.value.search;m.value&&(m.value.value=""),x.loading=!0,x.list=F.default?await F.default():await F.search(""),x.loading=!1}),gI(()=>i.value,J=>{let{highlighter:F,texRenderer:a}=l.value;Fg.value=J,L.value=ic(J,{emojiMap:u.value.map,highlighter:F,texRenderer:a}),M.value=(Z=>((h=>h.match(/[\w\d\s,.\u00C0-\u024F\u0400-\u04FF]+/giu))(Z)?.reduce((h,X)=>h+(X.trim()===""?0:X.trim().split(/\s+/u).length),0)||0)+((h=>h.match(/[\u4E00-\u9FD5]/gu))(Z)?.length||0))(J),J?mi(n.value):mi.destroy(n.value)},{immediate:!0}),gI(()=>l.value.emoji,J=>{return(F=J,Promise.all(F.map(a=>typeof a=="string"?zn(ri(a)):Promise.resolve(a))).then(a=>{let Z={tabs:[],map:{}};return a.forEach(h=>{let{name:X,folder:y,icon:W,prefix:K,type:w,items:S}=h;Z.tabs.push({name:X,icon:gi(W,y,K,w),items:S.map(B=>{let Y=`${K||""}${B}`;return Z.map[Y]=gi(B,y,K,w),Y})})}),Z})).then(a=>{u.value=a});var F},{immediate:!0})}),wA(()=>{document.body.removeEventListener("click",Xg),window.removeEventListener("message",tI)}),(J,F)=>(v(),z("div",Nc,[Cg(l).login!=="disable"&&q.value&&!J.edit?.objectId?(v(),z("div",Uc,[T("div",Mc,[T("button",{type:"submit",class:"wl-logout-btn",title:j.value.logout,onClick:oI},[dg(Cg(ni),{size:14})],8,zc),T("a",{href:"#",class:"wl-login-nick","aria-label":"Profile",title:j.value.profile,onClick:uI},[T("img",{src:Cg(o).avatar,alt:"avatar"},null,8,Qc)],8,Dc)]),T("a",{href:"#",class:"wl-login-nick","aria-label":"Profile",title:j.value.profile,onClick:uI,textContent:og(Cg(o).display_name)},null,8,xc)])):lg("v-if",!0),T("div",Tc,[Cg(l).login!=="force"&&Cg(l).meta.length&&!q.value?(v(),z("div",{key:0,class:Sg(["wl-header",`item${Cg(l).meta.length}`])},[(v(!0),z(pg,null,eI(Cg(l).meta,a=>(v(),z("div",{key:a,class:"wl-header-item"},[T("label",{for:`wl-${a}`,textContent:og(j.value[a]+(Cg(l).requiredMeta.includes(a)||!Cg(l).requiredMeta.length?"":`(${j.value.optional})`))},null,8,Ec),OC(T("input",{id:`wl-${a}`,ref_for:!0,ref:Z=>{Z&&(t.value[a]=Z)},"onUpdate:modelValue":Z=>Cg(e)[a]=Z,class:Sg(["wl-input",`wl-${a}`]),name:a,type:a==="mail"?"email":"text"},null,10,Pc),[[mn,Cg(e)[a]]])]))),128))],2)):lg("v-if",!0),OC(T("textarea",{id:"wl-edit",ref_key:"editorRef",ref:n,"onUpdate:modelValue":F[0]||(F[0]=a=>Kg(i)?i.value=a:null),class:"wl-editor",placeholder:J.replyUser?`@${J.replyUser}`:j.value.placeholder,onKeydown:Gg,onDrop:Dg,onPaste:Tg},null,40,jc),[[bl,Cg(i)]]),OC(T("div",Oc,[_c,T("h4",null,og(j.value.preview)+":",1),T("div",{class:"wl-content",innerHTML:L.value},null,8,$c)],512),[[ze,R.value]]),T("div",qc,[T("div",gs,[T("a",Is,[dg(Cg(dc))]),OC(T("button",{ref_key:"emojiButtonRef",ref:s,type:"button",class:Sg(["wl-action",{active:p.value}]),title:j.value.emoji,onClick:F[1]||(F[1]=a=>p.value=!p.value)},[dg(Cg(nc))],10,Cs),[[ze,u.value.tabs.length]]),Cg(l).search?(v(),z("button",{key:0,ref_key:"gifButtonRef",ref:b,type:"button",class:Sg(["wl-action",{active:V.value}]),title:j.value.gif,onClick:F[2]||(F[2]=a=>V.value=!V.value)},[dg(Cg(Gc))],10,As)):lg("v-if",!0),T("input",{id:"wl-image-upload",ref_key:"imageUploadRef",ref:c,class:"upload",type:"file",accept:".png,.jpg,.jpeg,.webp,.bmp,.gif",onChange:Og},null,544),Ag.value?(v(),z("label",{key:1,for:"wl-image-upload",class:"wl-action",title:j.value.uploadImage},[dg(Cg(cc))],8,ls)):lg("v-if",!0),T("button",{type:"button",class:Sg(["wl-action",{active:R.value}]),title:j.value.preview,onClick:F[3]||(F[3]=a=>R.value=!R.value)},[dg(Cg(ac))],10,es)]),T("div",is,[os,T("div",ts,[LI(og(M.value)+" ",1),Cg(l).wordLimit?(v(),z("span",ns,[LI("  /  "),T("span",{class:Sg({illegal:!sg.value}),textContent:og(D.value)},null,10,cs)])):lg("v-if",!0),LI("  "+og(j.value.word),1)]),Cg(l).login==="disable"||q.value?lg("v-if",!0):(v(),z("button",{key:0,type:"button",class:"wl-btn",onClick:Jg,textContent:og(j.value.login)},null,8,ss)),Cg(l).login!=="force"||q.value?(v(),z("button",{key:1,type:"submit",class:"primary wl-btn",title:"Cmd|Ctrl + Enter",disabled:jg.value,onClick:Wg},[jg.value?(v(),VI(Cg(fC),{key:0,size:16})):(v(),z(pg,{key:1},[LI(og(j.value.submit),1)],64))],8,as)):lg("v-if",!0)]),T("div",{ref_key:"gifPopupRef",ref:r,class:Sg(["wl-gif-popup",{display:V.value}])},[T("input",{ref_key:"gifSearchInputRef",ref:m,type:"text",placeholder:j.value.gifSearchPlaceholder,onInput:F[4]||(F[4]=(...a)=>Cg(mI)&&Cg(mI)(...a))},null,40,ds),x.list.length?(v(),VI(Jc,{key:0,items:x.list,"column-width":200,gap:6,onInsert:F[5]||(F[5]=a=>ag(a)),onScroll:AI},null,8,["items"])):lg("v-if",!0),x.loading?(v(),z("div",us,[dg(Cg(fC),{size:30})])):lg("v-if",!0)],2),T("div",{ref_key:"emojiPopupRef",ref:d,class:Sg(["wl-emoji-popup",{display:p.value}])},[(v(!0),z(pg,null,eI(u.value.tabs,(a,Z)=>(v(),z(pg,{key:a.name},[Z===G.value?(v(),z("div",ms,[(v(!0),z(pg,null,eI(a.items,h=>(v(),z("button",{key:h,type:"button",title:h,onClick:X=>ag(`:${h}:`)},[p.value?(v(),z("img",{key:0,class:"wl-emoji",src:u.value.map[h],alt:h,loading:"lazy",referrerPolicy:"no-referrer"},null,8,Gs)):lg("v-if",!0)],8,Zs))),128))])):lg("v-if",!0)],64))),128)),u.value.tabs.length>1?(v(),z("div",bs,[(v(!0),z(pg,null,eI(u.value.tabs,(a,Z)=>(v(),z("button",{key:a.name,type:"button",class:Sg(["wl-tab",{active:G.value===Z}]),onClick:h=>G.value=Z},[T("img",{class:"wl-emoji",src:a.icon,alt:a.name,title:a.name,loading:"lazy",referrerPolicy:"no-referrer"},null,8,rs)],10,ps))),128))])):lg("v-if",!0)],2)])]),J.replyId||J.edit?.objectId?(v(),z("button",{key:1,type:"button",class:"wl-close",title:j.value.cancelReply,onClick:F[6]||(F[6]=a=>J.$emit(J.replyId?"cancelReply":"cancelEdit"))},[dg(Cg(ni),{size:24})],8,hs)):lg("v-if",!0)]))}}),ho=UC(Bs,[["__file","CommentBox.vue"]]),ys=["id"],Vs={class:"wl-user","aria-hidden":"true"},Xs=["src"],Ss={class:"wl-card"},Ws={class:"wl-head"},Rs=["href"],ws={key:1,class:"wl-nick"},Ks=["textContent"],Hs=["textContent"],Ls=["textContent"],Ys=["textContent"],fs=["textContent"],ks={class:"wl-comment-actions"},vs=["title"],Fs=["textContent"],Js=["title"],Ns={class:"wl-meta","aria-hidden":"true"},Us=["data-value","textContent"],Ms=["data-value","textContent"],zs=["data-value","textContent"],Ds=["innerHTML"],Qs={key:1,class:"wl-admin-actions"},xs={class:"wl-comment-status"},Ts=["disabled","onClick","textContent"],Es={key:3,class:"wl-quote"},Ps=UC(JC({__name:"CommentCard",props:{comment:{},edit:{default:null},rootId:{},reply:{default:null}},emits:["log","submit","delete","edit","like","status","sticky","reply"],setup(g){let I=g,C=["approved","waiting","spam"],A=KA("config"),l=po(),i=Nn(),e=vl(),o=wg(()=>A.value.locale),t=wg(()=>{let{link:m}=I.comment;return m?hi(m)?m:`https://${m}`:""}),n=wg(()=>l.value.includes(I.comment.objectId)),c=wg(()=>lt(I.comment.insertedAt,i.value,o.value)),s=wg(()=>e.value.type==="administrator"),d=wg(()=>I.comment.user_id&&e.value.objectId===I.comment.user_id),b=wg(()=>I.comment.objectId===I.reply?.objectId),r=wg(()=>I.comment.objectId===I.edit?.objectId);return(m,u)=>{let G=Dt("CommentCard",!0);return v(),z("div",{id:m.comment.objectId,class:"wl-card-item"},[T("div",Vs,[m.comment.avatar?(v(),z("img",{key:0,src:m.comment.avatar},null,8,Xs)):lg("v-if",!0),m.comment.type?(v(),VI(Cg(Zc),{key:1})):lg("v-if",!0)]),T("div",Ss,[T("div",Ws,[t.value?(v(),z("a",{key:0,class:"wl-nick",href:t.value,target:"_blank",rel:"nofollow noopener noreferrer"},og(m.comment.nick),9,Rs)):(v(),z("span",ws,og(m.comment.nick),1)),m.comment.type==="administrator"?(v(),z("span",{key:2,class:"wl-badge",textContent:og(o.value.admin)},null,8,Ks)):lg("v-if",!0),m.comment.label?(v(),z("span",{key:3,class:"wl-badge",textContent:og(m.comment.label)},null,8,Hs)):lg("v-if",!0),m.comment.sticky?(v(),z("span",{key:4,class:"wl-badge",textContent:og(o.value.sticky)},null,8,Ls)):lg("v-if",!0),m.comment.level!==void 0&&m.comment.level>=0?(v(),z("span",{key:5,class:Sg(`wl-badge level${m.comment.level}`),textContent:og(o.value[`level${m.comment.level}`]||`Level ${m.comment.level}`)},null,10,Ys)):lg("v-if",!0),T("span",{class:"wl-time",textContent:og(c.value)},null,8,fs),T("div",ks,[s.value||d.value?(v(),z("button",{key:0,type:"button",class:"wl-edit",onClick:u[0]||(u[0]=()=>m.$emit("edit",m.comment))},[dg(Cg(mc))])):lg("v-if",!0),s.value||d.value?(v(),z("button",{key:1,type:"button",class:"wl-delete",onClick:u[1]||(u[1]=p=>m.$emit("delete",m.comment))},[dg(Cg(tc))])):lg("v-if",!0),T("button",{type:"button",class:"wl-like",title:n.value?o.value.cancelLike:o.value.like,onClick:u[2]||(u[2]=p=>m.$emit("like",m.comment))},[dg(Cg(sc),{active:n.value},null,8,["active"]),"like"in m.comment?(v(),z("span",{key:0,textContent:og(m.comment.like)},null,8,Fs)):lg("v-if",!0)],8,vs),T("button",{type:"button",class:Sg(["wl-reply",{active:b.value}]),title:b.value?o.value.cancelReply:o.value.reply,onClick:u[3]||(u[3]=p=>m.$emit("reply",b.value?null:m.comment))},[dg(Cg(uc))],10,Js)])]),T("div",Ns,[m.comment.addr?(v(),z("span",{key:0,class:"wl-addr","data-value":m.comment.addr,textContent:og(m.comment.addr)},null,8,Us)):lg("v-if",!0),m.comment.browser?(v(),z("span",{key:1,class:"wl-browser","data-value":m.comment.browser,textContent:og(m.comment.browser)},null,8,Ms)):lg("v-if",!0),m.comment.os?(v(),z("span",{key:2,class:"wl-os","data-value":m.comment.os,textContent:og(m.comment.os)},null,8,zs)):lg("v-if",!0)]),r.value?lg("v-if",!0):(v(),z("div",{key:0,class:"wl-content",innerHTML:m.comment.comment},null,8,Ds)),s.value&&!r.value?(v(),z("div",Qs,[T("span",xs,[(v(),z(pg,null,eI(C,p=>T("button",{key:p,type:"submit",class:Sg(`wl-btn wl-${p}`),disabled:m.comment.status===p,onClick:V=>m.$emit("status",{status:p,comment:m.comment}),textContent:og(o.value[p])},null,10,Ts)),64))]),s.value&&!m.comment.rid?(v(),z("button",{key:0,type:"submit",class:"wl-btn wl-sticky",onClick:u[4]||(u[4]=p=>m.$emit("sticky",m.comment))},og(m.comment.sticky?o.value.unsticky:o.value.sticky),1)):lg("v-if",!0)])):lg("v-if",!0),b.value||r.value?(v(),z("div",{key:2,class:Sg({"wl-reply-wrapper":b.value,"wl-edit-wrapper":r.value})},[dg(ho,{edit:m.edit,"reply-id":m.reply?.objectId,"reply-user":m.comment.nick,"root-id":m.rootId,onLog:u[5]||(u[5]=p=>m.$emit("log")),onCancelReply:u[6]||(u[6]=p=>m.$emit("reply",null)),onCancelEdit:u[7]||(u[7]=p=>m.$emit("edit",null)),onSubmit:u[8]||(u[8]=p=>m.$emit("submit",p))},null,8,["edit","reply-id","reply-user","root-id"])],2)):lg("v-if",!0),m.comment.children?(v(),z("div",Es,[(v(!0),z(pg,null,eI(m.comment.children,p=>(v(),VI(G,{key:p.objectId,comment:p,reply:m.reply,edit:m.edit,"root-id":m.rootId,onLog:u[9]||(u[9]=V=>m.$emit("log")),onDelete:u[10]||(u[10]=V=>m.$emit("delete",V)),onEdit:u[11]||(u[11]=V=>m.$emit("edit",V)),onLike:u[12]||(u[12]=V=>m.$emit("like",V)),onReply:u[13]||(u[13]=V=>m.$emit("reply",V)),onStatus:u[14]||(u[14]=V=>m.$emit("status",V)),onSticky:u[15]||(u[15]=V=>m.$emit("sticky",V)),onSubmit:u[16]||(u[16]=V=>m.$emit("submit",V))},null,8,["comment","reply","edit","root-id"]))),128))])):lg("v-if",!0)])],8,ys)}}}),[["__file","CommentCard.vue"]]),js="2.15.5",Os={"data-waline":""},_s={class:"wl-meta-head"},$s={class:"wl-count"},qs=["textContent"],ga={class:"wl-sort"},Ia=["onClick"],Ca={class:"wl-cards"},Aa={key:1,class:"wl-operation"},la=["textContent"],ea={key:0,class:"wl-loading"},ia=["textContent"],oa={key:2,class:"wl-operation"},ta=["textContent"],na={key:3,class:"wl-power"},ca=T("a",{href:"https://github.com/walinejs/waline",target:"_blank",rel:"noopener noreferrer"}," Waline ",-1),sa=JC({__name:"WalineComment",props:["serverURL","path","meta","requiredMeta","dark","commentSorting","lang","locale","pageSize","wordLimit","emoji","login","highlighter","texRenderer","imageUploader","search","copyright","recaptchaV3Key","turnstileKey","reaction"],setup(g){let I=g,C={latest:"insertedAt_desc",oldest:"insertedAt_asc",hottest:"like_desc"},A=Object.keys(C),l=vl(),i=po(),e=Ig("loading"),o=Ig(0),t=Ig(1),n=Ig(0),c=wg(()=>(({serverURL:E,path:j=location.pathname,lang:q=typeof navigator>"u"?"en-US":navigator.language,locale:Ag,emoji:ag=Ie,meta:Gg=["nick","mail","link"],requiredMeta:Bg=[],dark:Dg=!1,pageSize:Tg=10,wordLimit:Og,imageUploader:Wg,highlighter:Jg,texRenderer:oI,copyright:uI=!0,login:Xg="enable",search:AI,reaction:mI,recaptchaV3Key:tI="",turnstileKey:J="",commentSorting:F="latest",...a})=>({serverURL:oA(E),path:pi(j),locale:{...TA[q]||TA[jo],...typeof Ag=="object"?Ag:{}},wordLimit:At(Og),meta:ge(Gg),requiredMeta:ge(Bg),imageUploader:EA(Wg,_o),highlighter:EA(Jg,It),texRenderer:EA(oI,$o),lang:Object.keys(TA).includes(q)?q:"en-US",dark:Dg,emoji:typeof ag=="boolean"?ag?Ie:[]:ag,pageSize:Tg,login:Xg,copyright:uI,search:AI!==!1&&(typeof AI=="object"?AI:qo(q)),recaptchaV3Key:tI,turnstileKey:J,reaction:Array.isArray(mI)?mI:mI===!0?Oo:[],commentSorting:F,...a}))(I)),s=Ig(c.value.commentSorting),d=Ig([]),b=Ig(null),r=Ig(null),m=wg(()=>{return typeof(E=c.value.dark)=="string"?E==="auto"?`@media(prefers-color-scheme:dark){body${PA}}`:`${E}${PA}`:E===!0?`:root${PA}`:"";var E}),u=wg(()=>c.value.locale),G;(function(E,j={}){let q=Ig(!1),{document:Ag=so,immediate:ag=!0,manual:Gg=!1,id:Bg="vueuse_styletag_"+ ++Mn}=j,Dg=Ig(E),Tg=()=>{},Og=()=>{if(!Ag)return;let Jg=Ag.getElementById(Bg)||Ag.createElement("style");Jg.isConnected||(Jg.type="text/css",Jg.id=Bg,j.media&&(Jg.media=j.media),Ag.head.appendChild(Jg)),q.value||(Tg=gI(Dg,oI=>{Jg.textContent=oI},{immediate:!0}),q.value=!0)},Wg=()=>{Ag&&q.value&&(Tg(),Ag.head.removeChild(Ag.getElementById(Bg)),q.value=!1)};ag&&!Gg&&to(Og),Gg||bC(Wg),FC(q)})(m,{id:"waline-darkmode"});let p=E=>{let{serverURL:j,path:q,pageSize:Ag}=c.value,ag=new AbortController;e.value="loading",G?.(),(({serverURL:Gg,lang:Bg,path:Dg,page:Tg,pageSize:Og,sortBy:Wg,signal:Jg,token:oI})=>{let uI={};return oI&&(uI.Authorization=`Bearer ${oI}`),GM_fetch(`${Gg}/comment?path=${encodeURIComponent(Dg)}&pageSize=${Og}&page=${Tg}&lang=${Bg}&sortBy=${Wg}`,{signal:Jg,headers:uI}).then(Xg=>Xg.json()).then(Xg=>Cl(Xg,"Get comment data"))})({serverURL:j,lang:c.value.lang,path:q,pageSize:Ag,sortBy:C[s.value],page:E,signal:ag.signal,token:l.value?.token}).then(Gg=>{e.value="success",o.value=Gg.count,d.value.push(...Gg.data),t.value=E,n.value=Gg.totalPages}).catch(Gg=>{Gg.name!=="AbortError"&&(console.error(Gg.message),e.value="error")}),G=ag.abort.bind(ag)},V=()=>p(t.value+1),R=()=>{o.value=0,d.value=[],p(1)},L=E=>{b.value=E},M=E=>{r.value=E},x=E=>{if(r.value)r.value.comment=E.comment,r.value.orig=E.orig;else if(E.rid){let j=d.value.find(({objectId:q})=>q===E.rid);if(!j)return;Array.isArray(j.children)||(j.children=[]),j.children.push(E)}else d.value.unshift(E),o.value+=1},D=async({comment:E,status:j})=>{if(E.status===j)return;let{serverURL:q,lang:Ag}=c.value;await IA({serverURL:q,lang:Ag,token:l.value?.token,objectId:E.objectId,comment:{status:j}}),E.status=j},sg=async E=>{if(E.rid)return;let{serverURL:j,lang:q}=c.value;await IA({serverURL:j,lang:q,token:l.value?.token,objectId:E.objectId,comment:{sticky:E.sticky?0:1}}),E.sticky=!E.sticky},Fg=async({objectId:E})=>{if(!confirm("Are you sure you want to delete this comment?"))return;let{serverURL:j,lang:q}=c.value;await(({serverURL:Ag,lang:ag,token:Gg,objectId:Bg})=>GM_fetch(`${Ag}/comment/${Bg}?lang=${ag}`,{method:"DELETE",headers:{Authorization:`Bearer ${Gg}`}}).then(Dg=>Dg.json()).then(Dg=>Cl(Dg,"Delete comment")))({serverURL:j,lang:q,token:l.value?.token,objectId:E}),d.value.some((Ag,ag)=>Ag.objectId===E?(d.value=d.value.filter((Gg,Bg)=>Bg!==ag),!0):Ag.children.some((Gg,Bg)=>Gg.objectId===E&&(d.value[ag].children=Ag.children.filter((Dg,Tg)=>Tg!==Bg),!0)))},jg=async E=>{let{serverURL:j,lang:q}=c.value,{objectId:Ag}=E,ag=i.value.includes(Ag);await IA({serverURL:j,lang:q,objectId:Ag,token:l.value?.token,comment:{like:!ag}}),ag?i.value=i.value.filter(Gg=>Gg!==Ag):(i.value=[...i.value,Ag],i.value.length>50&&(i.value=i.value.slice(-50))),E.like=(E.like||0)+(ag?-1:1)};return function(E,j){if(zg){let q=zg.provides,Ag=zg.parent&&zg.parent.provides;Ag===q&&(q=zg.provides=Object.create(Ag)),q[E]=j}}("config",c),NC(()=>{gI(()=>[I.serverURL,I.path],()=>R(),{immediate:!0})}),wA(()=>G?.()),(E,j)=>(v(),z("div",Os,[dg(Lc),b.value?lg("v-if",!0):(v(),VI(ho,{key:0,onLog:R,onSubmit:x})),T("div",_s,[T("div",$s,[o.value?(v(),z("span",{key:0,class:"wl-num",textContent:og(o.value)},null,8,qs)):lg("v-if",!0),LI(" "+og(u.value.comment),1)]),T("ul",ga,[(v(!0),z(pg,null,eI(Cg(A),q=>(v(),z("li",{key:q,class:Sg([q===s.value?"active":""]),onClick:Ag=>(ag=>{s.value!==ag&&(s.value=ag,R())})(q)},og(u.value[q]),11,Ia))),128))])]),T("div",Ca,[(v(!0),z(pg,null,eI(d.value,q=>(v(),VI(Ps,{key:q.objectId,"root-id":q.objectId,comment:q,reply:b.value,edit:r.value,onLog:R,onReply:L,onEdit:M,onSubmit:x,onStatus:D,onDelete:Fg,onSticky:sg,onLike:jg},null,8,["root-id","comment","reply","edit"]))),128))]),e.value==="error"?(v(),z("div",Aa,[T("button",{type:"button",class:"wl-btn",onClick:R,textContent:og(u.value.refresh)},null,8,la)])):(v(),z(pg,{key:2},[e.value==="loading"?(v(),z("div",ea,[dg(Cg(fC),{size:30})])):d.value.length?t.value<n.value?(v(),z("div",oa,[T("button",{type:"button",class:"wl-btn",onClick:V,textContent:og(u.value.more)},null,8,ta)])):lg("v-if",!0):(v(),z("div",{key:1,class:"wl-empty",textContent:og(u.value.sofa)},null,8,ia))],64)),c.value.copyright?(v(),z("div",na,[LI(" Powered by "),ca,LI(" v"+og(Cg(js)),1)])):lg("v-if",!0)]))}}),aa=UC(sa,[["__file","WalineComment.vue"]]),Zi=(g,I)=>{I.forEach((C,A)=>{C.innerText=g[A].toString()})},da=({serverURL:g,path:I=window.location.pathname,selector:C=".waline-pageview-count",update:A=!0,lang:l=navigator.language})=>{let i=new AbortController,e=Array.from(document.querySelectorAll(C)),o=c=>{let s=ti(c);return s!==null&&I!==s},t=c=>(({serverURL:s,lang:d,paths:b,signal:r})=>bi({serverURL:s,lang:d,paths:b,type:["time"],signal:r}).then(m=>Array.isArray(m)?m:[m]))({serverURL:oA(g),paths:c.map(s=>ti(s)||I),lang:l,signal:i.signal}).then(s=>Zi(s,c)).catch(ao);if(A){let c=e.filter(d=>!o(d)),s=e.filter(o);(n={serverURL:oA(g),path:I,lang:l},Al({...n,type:"time",action:"inc"})).then(d=>Zi(new Array(c.length).fill(d),c)),s.length&&t(s)}else t(e);var n;return i.abort.bind(i)},fA=({el:g="#waline",path:I=window.location.pathname,comment:C=!1,pageview:A=!1,...l})=>{let i=g?Dn(g):null;if(g&&!i)throw new Error("Option 'el' do not match any domElement!");if(!l.serverURL)throw new Error("Option 'serverURL' is missing!");let e=SC({...l}),o=SC({comment:C,pageview:A,path:I}),t=i?Gn(()=>cg(aa,{path:o.path,...e})):null;t&&t.mount(i);let n=be(()=>{o.comment&&oc({serverURL:e.serverURL,path:o.path,selector:typeof o.comment=="string"?o.comment:void 0})}),c=be(()=>{o.pageview&&da({serverURL:e.serverURL,path:o.path,selector:typeof o.pageview=="string"?o.pageview:void 0})});return{el:i,update:({comment:s,pageview:d,path:b=window.location.pathname,...r}={})=>{Object.entries(r).forEach(([m,u])=>{e[m]=u}),o.path=b,s!==void 0&&(o.comment=s),d!==void 0&&(o.pageview=d)},destroy:()=>{t?.unmount(),n(),c()}}};function Bo(g){let I=/([\\`\*_\{\}\[\]\(\)\#\+\-\.!])/g;return g=g.replace(I,"\\$1"),g}function yo(g){let I=/^[ \n\t]/;for(;I.test(g);)g=g.replace(I,"");return g}function Vo(g){let I=/[ \n\t]$/;for(;I.test(g);)g=g.replace(I,"");return g}function II(g,I=!1,C=!1){if(g.nodeType===1){let A="";for(let l=0;l<g.childNodes.length;l++)A+=kA(g.childNodes[l],l===0,l===g.childNodes.length-1);return A}if(g.nodeType===3){let A=g.data;return I&&(A=yo(A)),C&&(A=Vo(A)),Bo(A)}return""}function kA(g,I=!1,C=!1){if(g.nodeType===1){if(g.className.indexOf("exlg")!==-1)return"";if(g.classList.contains("katex"))return`$${g.childNodes[0].childNodes[0].childNodes[0].childNodes[1].innerHTML}$`;if(g.tagName==="SCRIPT"||g.tagName==="STYLE")return"";if(g.tagName==="P")return`${II(g)}
`;if(g.tagName==="BR")return`  
`;if(g.tagName==="HR")return`
---
`;if(g.tagName==="A")return`[${II(g)}](${g.href}${g.title!==""?` "${g.title}"`:""})`;if(g.tagName==="IMG")return`![${g.alt!==""?g.alt:""}](${g.src}${g.title!==""?` "${g.title}"`:""})`;if(g.tagName==="CODE"){if(g.classList.contains("hljs")){let A=g.classList[0];return`
\`\`\`${A.startsWith("language-")?A.substring(9):""}
${g.innerText}
\`\`\`
`}return`\`${g.innerText}\``}if(g.tagName.startsWith("H"))return`${"#".repeat(parseInt(g.tagName.substring(1),10))} ${II(g)}
`;if(g.tagName==="STRONG")return`**${II(g)}**`;if(g.tagName==="EM")return`_${II(g)}_`;if(g.tagName==="DEL")return`~~${II(g)}~~`;if(g.tagName==="TABLE"){let A="|";for(let l=0;l<g.children[0].children[0].children.length;l++)A+=`${II(g.children[0].children[0].children[l],l===0,l===g.children[0].children[0].children.length-1)}|`;A+=`
|`;for(let l=0;l<g.children[0].children[0].children.length;l++)A+=`${g.children[0].children[0].children[l].style.textAlign==="left"||g.children[0].children[0].children[l].style.textAlign==="center"?":":""}-${g.children[0].children[0].children[l].style.textAlign==="right"||g.children[0].children[0].children[l].style.textAlign==="center"?":":""}|`;for(let l=0;l<g.children[1].children.length;l++){A+=`
|`;for(let i=0;i<g.children[1].children[l].children.length;i++)A+=`${II(g.children[1].children[l].children[i],i===0,i===g.children[1].children[l].children.length-1)}|`}return A+=`
`,A}if(g.tagName==="UL"){let A="";for(let l=0;l<g.children.length;l++)A+=`- ${II(g.children[l],l===0,l===g.children.length-1)}
`;return A}if(g.tagName==="OL"){let A="";for(let l=0;l<g.children.length;l++)A+=`1.  ${II(g.children[l],l===0,l===g.children.length-1)}
`;return A}return g.tagName==="BLOCKQUOTE"?`> ${II(g).replaceAll(`
`,`
> `)}
`:g.tagName==="IFRAME"?g.src.split("?")[0]==="https://www.bilibili.com/blackboard/webplayer/embed-old.html"?`![](Bilibili:${g.src.split("?")[1].split("&")[0].split("=")[1]})`:"":II(g)}if(g.nodeType===3){let A=g.data;return I&&(A=yo(A)),C&&(A=Vo(A)),Bo(A)}return""}eg.reg("/","easyMarkdown",()=>{if(window.location.pathname==="/"){let g=setInterval(()=>{if(document.querySelector("a[name='feed-reply']")){clearInterval(g);let C=document.querySelectorAll("a[name='feed-reply']");for(let A=0;A<C.length;A++){let l=C[A],i=l.parentElement.parentElement.parentElement.children[1],e=document.createElement("a");e.innerHTML="\u590D\u5236Md",e.onclick=()=>{GM_setClipboard(kA(i))},l.parentElement.appendChild(e)}}})}else if(window.location.pathname.startsWith("/user")){let I=`https://www.luogu.com.cn/user/${window.location.pathname.substring(6)}?_contentOnly`;fetch(I).then(C=>C.text()).then(C=>{let A=JSON.parse(C).currentData.user.introduction==null?"\u8FD9\u4E2A\u4EBA\u5F88\u61D2\uFF0C\u4EC0\u4E48\u90FD\u6CA1\u5199":JSON.parse(C).currentData.user.introduction,l=`<div id="copyMdBt" data-v-36d4a8df="" data-v-f9624136="" style="float: right;"><!----> <button data-v-7ade990c="" data-v-36d4a8df="" type="button" class="lfe-form-sz-small" data-v-f9624136="" style="border-color: rgb(52, 152, 219); color: rgb(52, 152, 219); background-color: rgba(52, 152, 219, 0);">
            \u590D\u5236Md
          </button></div>`,i=document.createElement("div");i.innerHTML=l,i.onclick=()=>{GM_setClipboard(A)};let e=document.querySelectorAll(".card.padding-default")[document.querySelectorAll(".card.padding-default").length-1];e.insertBefore(i,e.children[0])})}});eg.reg("/discuss","pannelTool",()=>{if(location.href.indexOf("list")!=-1)return;let g=qg("bbsTools").config,I;try{I=window.location.href.match(/[0-9]+/)[0]}catch{return}if(g.btnShow.value){let C=document.querySelectorAll("a[data-fd-username]");for(let A=0;A<C.length;A+=1){let l=C[A].getAttribute("data-fd-username"),i=C[A].parentElement.parentElement.parentElement.children[1].innerText,e=C[A].parentElement.parentElement.parentElement.children[1],o=i.replace(/\n/g,"");o.length>100&&(o=`${o.substring(0,100)}\u2026\u2026`);let t=document.createElement("a");t.setAttribute("href","javascript: scrollToId('replyarea');"),t.onclick=()=>{setEditorVal(`@${l}
> ${o}

`)},t.innerText="\u5F15\u7528\u56DE\u590D",C[A].parentElement.appendChild(t);let n=document.createElement("a");n.setAttribute("href","javascript: void(0);"),n.onclick=()=>{let c=kA(e);GM_setClipboard(c)},n.innerText="\u590D\u5236Md",C[A].parentElement.appendChild(n);for(let c=0;c<C[A].parentElement.children.length;c+=1)C[A].parentElement.children[c].innerText==="\u56DE\u590D"&&(C[A].parentElement.children[c].innerText="@TA")}}if(g.toolShow.value&&setTimeout(()=>{let C=document.getElementsByClassName("am-panel")[0];C.children[0].innerHTML+=`
        <a id="forbutton" class="am-btn am-btn-primary am-btn-sm" style="margin-top: 5px;" num=0>\u{1F44D}_\u6B21\u70B9\u8D5E</a><span>&nbsp;</span><a class="am-btn am-btn-danger am-btn-sm" name="save-discuss" id="againstbutton" style="margin-top: 5px;" num=0>\u{1F44E}_\u6B21\u8E29</a>
        <br>
        <button id="savebbsbutton" class="am-btn am-btn-success am-btn-sm" style="margin-top: 5px;">\u70B9\u51FB\u4FDD\u5B58</button><span>&nbsp;</span><a class="am-btn am-btn-warning am-btn-sm" name="save-discuss" target='_blank' href="https://lg.oiso.cf/show/?id=${I}" style="margin-top: 5px;">\u524D\u5F80\u5907\u4EFD</a>
        `,document.getElementById("savebbsbutton").addEventListener("click",()=>{document.getElementById("savebbsbutton").innerHTML="\u4FDD\u5B58\u4E2D\u2026\u2026";let A=`https://lgbbs.oiso.cf/save.php?url=https://www.luogu.com.cn/discuss/${I}?page=1`;GM_xmlhttpRequest({method:"GET",url:A,onload:l=>{l.responseText==="success"?(document.getElementById("savebbsbutton").innerHTML="\u4FDD\u5B58\u6210\u529F\uFF01",setTimeout(()=>{document.getElementById("savebbsbutton").innerHTML="\u518D\u6B21\u4FDD\u5B58"},1e3)):(document.getElementById("savebbsbutton").innerHTML="\u4FDD\u5B58\u5931\u8D25qwq",setTimeout(()=>{document.getElementById("savebbsbutton").innerHTML="\u91CD\u65B0\u4FDD\u5B58"},1e3))}})}),document.getElementById("forbutton").addEventListener("click",()=>{document.getElementById("forbutton").innerHTML="\u8D5E\u6210\u4E2D\u2026\u2026";let A=`https://online.oiso.cf/lgbbs/for?id=${I}`;GM_xmlhttpRequest({method:"GET",url:A,onload:l=>{JSON.parse(l.responseText).code===200?(document.getElementById("forbutton").innerHTML="\u70B9\u8D5E\u6210\u529F\uFF01",setTimeout(()=>{let i=document.getElementById("forbutton").getAttribute("num");document.getElementById("forbutton").setAttribute("num",parseInt(i,10)+1),document.getElementById("forbutton").innerHTML=`\u{1F44D}${parseInt(i,10)+1}\u6B21\u70B9\u8D5E`},1e3)):(document.getElementById("forbutton").innerHTML="\u8D5E\u6210\u5931\u8D25qwq",setTimeout(()=>{let i=document.getElementById("forbutton").getAttribute("num");document.getElementById("forbutton").innerHTML=`\u{1F44D}${i}\u6B21\u70B9\u8D5E`},1e3))}})}),document.getElementById("againstbutton").addEventListener("click",()=>{document.getElementById("againstbutton").innerHTML="\u53CD\u5BF9\u4E2D\u2026\u2026";let A=`https://online.oiso.cf/lgbbs/against?id=${I}`;GM_xmlhttpRequest({method:"GET",url:A,onload:l=>{JSON.parse(l.responseText).code===200?(document.getElementById("againstbutton").innerHTML="\u8E29\u6210\u529F\uFF01",setTimeout(()=>{let i=document.getElementById("againstbutton").getAttribute("num");document.getElementById("againstbutton").setAttribute("num",parseInt(i,10)+1),document.getElementById("againstbutton").innerHTML=`\u{1F44E}${parseInt(i,10)+1}\u6B21\u8E29`},1e3)):(document.getElementById("againstbutton").innerHTML="\u53CD\u5BF9\u5931\u8D25qwq",setTimeout(()=>{let i=document.getElementById("againstbutton").getAttribute("num");document.getElementById("againstbutton").innerHTML=`\u{1F44E}${i}\u6B21\u8E29`},1e3))}})}),GM_xmlhttpRequest({method:"GET",url:`https://online.oiso.cf/lgbbs/get?id=${I}`,onload:A=>{if(JSON.parse(A.responseText).code===200){let l=JSON.parse(A.responseText);document.getElementById("forbutton").setAttribute("num",l.for),document.getElementById("forbutton").innerHTML=`\u{1F44D}${l.for}\u6B21\u70B9\u8D5E`,document.getElementById("againstbutton").setAttribute("num",l.against),document.getElementById("againstbutton").innerHTML=`\u{1F44E}${l.against}\u6B21\u8E29`}}})},50),g.autoSave.value){let C=`https://lgbbs.oiso.cf/save.php?url=${location.href}`;GM_xmlhttpRequest({method:"GET",url:C,onload:()=>{}})}if(g.waline.value){GM_addStyle(GM_getResourceText("css"));let C=document.getElementsByClassName("am-panel am-panel-default lg-summary")[0],A=document.createElement("div");A.setAttribute("id","waline"),A.setAttribute("class","am-panel am-panel-default lg-summary"),C.parentNode.appendChild(A);let l=location.href.split("/")[4].split("?")[0];fA({el:"#waline",serverURL:"https://waline.oiso.cf",path:"/show/"+l,dark:"auto",reaction:!0})}});eg.reg("/","pendantRender",()=>{function g(){let C=document.getElementsByClassName("am-comment-avatar");for(let i=0;i<C.length;i++){let e=C[i],o=e.src.split("/")[5].split(".")[0],t=document.createElement("img");FI(o,n=>{n.responseText!=="False"&&(t.src=n.responseText,t.className="am-comment-avatar-pendant",t.style.top="0",t.style.left="0",t.style.height=`${e.clientHeight}px`,t.style.transform="scale(1.35)",t.style.marginLeft=`-${e.clientWidth}px`,t.style.borderRadius="5%",t.style.opacity="0.75",e.parentNode.insertBefore(t,e.nextSibling))})}let A=document.getElementsByClassName("avatar")[0];if(A){let i=A.src.split("/")[5].split(".")[0];FI(i,e=>{if(e.responseText!=="False"){let o=document.createElement("img");o.src=e.responseText,o.className="am-comment-avatar-pendant",o.style.height=`${A.clientHeight}px`,o.style.marginLeft=`-${A.clientWidth}px`,o.style.transform="scale(1.35)",o.style.borderRadius="5%",o.style.opacity="0.75",o.style.position="absolute",A.parentNode.insertBefore(o,A.nextSibling)}})}let l=window.innerWidth<=576;if(location.href.indexOf("https://www.luogu.com.cn/user/")!==-1){let i;if(document.getElementsByClassName("avatar")[1+l]){let e=document.getElementsByClassName("avatar")[1+l];i=e.src.split("/")[5].split(".")[0],FI(i,o=>{if(o.responseText!=="False"){let t=document.createElement("img");t.src=o.responseText,t.className="am-comment-avatar-pendant",l?(t.style.bottom="-36px",t.style.left=".75em"):(t.style.bottom="24px",t.style.left="24px"),t.style.height=`${e.clientHeight}px`,t.style.width=`${e.clientWidth}px`,t.style.transform="scale(1.35)",t.style.borderRadius="5%",t.style.opacity="0.75",t.style.position="absolute",e.parentNode.insertBefore(t,e.nextSibling)}})}if(document.getElementsByClassName("avatar")[2+l])for(let e=2+l;e<document.getElementsByClassName("avatar").length;e++)FI(i,o=>{if(o.responseText!=="False"){let t=document.getElementsByClassName("avatar")[e],n=document.createElement("img");n.src=o.responseText,n.className="am-comment-avatar-pendant",n.style.top="10px",n.style.left="0px",n.style.height="60px",n.style.transform="scale(1.35)",n.style.borderRadius="5%",n.style.opacity="0.75",n.style.position="absolute",t.parentNode.insertBefore(n,t.nextSibling)}})}else if(location.href.indexOf("https://www.luogu.com.cn/record/list")!==-1)for(let i=1;i<document.getElementsByClassName("avatar").length;i++){let e=document.getElementsByClassName("avatar")[i],o=e.children[0].src.split("/")[5].split(".")[0];FI(o,t=>{if(t.responseText!=="False"){let n=document.createElement("img");n.src=t.responseText,n.className="am-comment-avatar-pendant",n.style.marginLeft="-40px",n.style.marginTop="12px",n.style.height=n.style.width="35px",n.style.transform="scale(1.35)",n.style.borderRadius="5%",n.style.opacity="0.75",e.parentNode.insertBefore(n,e.nextSibling)}})}else if(location.href.indexOf("https://www.luogu.com.cn/problem/solution/")!==-1)for(let i=1;i<document.getElementsByClassName("avatar").length;i++){let e=document.getElementsByClassName("avatar")[i],o=document.getElementsByClassName("avatar")[i].src.split("/")[5].split(".")[0];FI(o,t=>{if(t.responseText!=="False"){let n=document.createElement("img");n.src=t.responseText,n.className="am-comment-avatar-pendant",n.style.marginLeft="-3em",n.style.marginTop="0px",n.style.height=n.style.width="2em",n.style.transform="scale(1.35)",n.style.borderRadius="5%",n.style.opacity="0.75",e.parentNode.insertBefore(n,e.nextSibling)}})}}function I(){let C=document.querySelectorAll("img.am-comment-avatar-pendant");for(let A=0;A<C.length;A++)C[A].remove();g()}window.addEventListener("click",()=>{setTimeout(I,750)}),window.addEventListener("resize",()=>{setTimeout(I,750)}),setTimeout(()=>{g()},750)});function vA(g,I){localStorage.setItem(g,JSON.stringify(I))}function ua(g){return JSON.parse(localStorage.getItem(g))}function ma(){try{let i=document.getElementById("waifu");i.style.transition="all 0.5s",i.style.top=screen.height-550+"px",i.style.left="100px"}catch{}let g=document.createElement("div");g.style.left="calc(100px + 550px)",g.style.top=screen.height-500+"px",g.style.position="fixed",g.style.width="30%",g.style.height="50%",g.style.backgroundColor="rgba(255,255,255,0)",g.id="exOIsoPanel",g.classList.add("noScrollBar");let I=`
    .noScrollBar::-webkit-scrollbar {
        display: none;
      }`,C=document.createElement("style");C.type="text/css",C.appendChild(document.createTextNode(I)),document.head.appendChild(C),window.matchMedia("(prefers-color-scheme: dark)").matches&&(g.style.backgroundColor="rgba(50,50,50,0)",g.style.color="white"),g.style.zIndex="1001",g.style.paddingTop="10px",g.style.paddingBottom="10px",g.style.overflow="auto",g.style.transition="all 0.5s",g.style.opacity="0",g.style.transform="translate(-50%, -50%) scale(0.5)",document.body.appendChild(g),setTimeout(()=>{g.style.opacity="1",g.style.transform="translate(-50%, -50%) scale(1)"},0);let A=ua("exOIsoCFG"),l=document.createElement("style");l.innerHTML=`
    .target {
        position: relative;
        margin: 10px;
        padding: 10px;
        border-radius: 5px;
        margin-left: 20px;
        margin-right: 20px;
        background-color: rgba(255, 255, 255, 0.95);
        transition: all 0.3s;
        z-index: 999003;
      }
      
      /*
      .target:hover {
        transform: translate(-3px, -3px) !important;
        box-shadow: 3px 3px 1px rgba(0, 0, 0, 0.5) !important;
        border-image: linear-gradient(to bottom right, red, orange, yellow, green, cyan, blue, purple, red) 3 3 3 3 !important;
        border-style: solid;
        border-width: 3px;
        position: relative;
        transition: all 0.3s;
      }
      
      .target:hover::after {
        opacity: 0;
      }
      */

      .panelTitle {
        letter-spacing: 3px;
        font-family: cursive;
      }

      input[type=checkbox].switch{
        outline: none;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        position: relative;
        width: 3.5rem;
        height: 1.8rem;
        border-radius: 50px;
        border: 1px solid #ccc;
        background-color: #ccc;
    }
    input[type=checkbox].switch::after{
        content: '';
        display: inline-block;
        width: 1.7rem;
        height: 1.7rem;
        border-radius: 50%;
        background-color: #fff;
        box-shadow: 0 0 2px #999;
        transition: left 0.1s linear;
        position: absolute;
        top: 0;
        left: 0;
    }
    input[type=checkbox].switch:checked{
        background-color: #1ab394;
    }
    input[type=checkbox].switch:checked::after{
        position: absolute;
        top: 0;
        left: 50%;
    }            
    `,document.head.appendChild(l);for(let i in A){let e=A[i],o=document.createElement("div");o.className="target",window.matchMedia("(prefers-color-scheme: dark)").matches&&(o.style.backgroundColor="rgba(50,50,50,0.95)"),o.onmouseenter=()=>{o.style.transform="translate(-3px,-3px)",o.style.boxShadow="3px 3px 10px rgba(0,0,0,0.5)",o.style.transition="all 0.3s"},o.onmouseleave=()=>{o.style.transform="translate(1.5px,1.5px)",o.style.boxShadow="none",o.style.transition="all 0.35s",setTimeout(()=>{o.style.transform="translate(0,0)",o.style.boxShadow="none",o.style.transition="all 0.1s"},350)};let t=document.createElement("div");t.style.marginBottom="10px",t.style.display="flex",t.style.justifyContent="space-between",t.style.alignItems="center";let n=document.createElement("span");if(n.innerHTML=`${i}`,n.style.marginRight="10px",n.style.fontWeight="bold",n.style.fontSize="2rem",t.appendChild(n),t.className="panelTitle",i!=="\u7CFB\u7EDF\u8BBE\u7F6E"){let b=document.createElement("input");b.type="checkbox",b.className="switch",b.checked=e.enabled,b.style.marginRight="10px",b.onchange=()=>{e.enabled=b.checked,vA("exOIsoCFG",A)},t.appendChild(b)}o.appendChild(t);let c=document.createElement("hr");c.style.marginBottom="10px",o.appendChild(c);let s=document.createElement("div");s.style.marginBottom="10px",s.innerHTML=e.desc,s.style.fontSize="small",s.style.opacity="0.8",o.appendChild(s);let d=document.createElement("div");d.style.marginBottom="10px";for(let b in e.config){let r=e.config[b],m=document.createElement("div");m.style.marginBottom="5px";let u=document.createElement("span");u.style.marginRight="5px",u.innerHTML=`[${b}]`,u.style.fontWeight="bold",u.style.fontSize="smaller",m.appendChild(u);let G=document.createElement("span");if(G.style.marginRight="5px",G.innerHTML=r.desc,G.style.fontSize="small",G.style.opacity="0.8",m.appendChild(G),r.type==="bool"){let p=document.createElement("input");p.type="checkbox",p.className="switch",p.checked=r.value,p.style.marginRight="5px",p.onchange=()=>{r.value=p.checked,vA("exOIsoCFG",A)},m.appendChild(p)}else if(r.type==="string"||r.type==="number"){let p=document.createElement("input");p.style.marginRight="5px",p.style.border="1px solid #ccc",p.style.borderRadius="5px",p.style.padding="5px",p.value=r.value,m.appendChild(p);let V=document.createElement("button");V.style.marginRight="5px",V.style.border="1px solid #ccc",V.style.borderRadius="5px",V.style.padding="5px",V.innerHTML="\u4FDD\u5B58",V.onclick=()=>{r.value=p.value,vA("exOIsoCFG",A),V.innerHTML="\u5DF2\u4FDD\u5B58",V.disabled=!0,setTimeout(()=>{V.innerHTML="\u4FDD\u5B58",V.disabled=!1},1e3)},m.appendChild(V)}else if(r.type==="button"){if(b!=="checkUpdate"){let p=document.createElement("button");p.style.marginRight="5px",p.style.border="1px solid #ccc",p.style.borderRadius="5px",p.style.padding="5px",p.innerHTML=r.value,p.setAttribute("onclick",r.script),m.appendChild(p),p.addEventListener("click",()=>{p.innerHTML="\u6210\u529F",p.disabled=!0,setTimeout(()=>{p.innerHTML=r.value,p.disabled=!1},1e3)})}}else if(r.type==="text"){let p=document.createElement("span");p.style.marginRight="5px",p.innerHTML=r.value,m.appendChild(p)}else if(r.type==="textArea"){let p=document.createElement("textarea");p.style.marginRight="5px",p.style.border="1px solid #ccc",p.style.borderRadius="5px",p.style.padding="5px",p.value=r.value,m.appendChild(p);let V=document.createElement("button");V.style.marginRight="5px",V.style.border="1px solid #ccc",V.style.borderRadius="5px",V.style.padding="5px",V.innerHTML="\u4FDD\u5B58",V.onclick=()=>{r.value=p.value,vA("exOIsoCFG",A),V.innerHTML="\u5DF2\u4FDD\u5B58",V.disabled=!0,setTimeout(()=>{V.innerHTML="\u4FDD\u5B58",V.disabled=!1},1e3)},m.appendChild(V)}d.appendChild(m)}o.appendChild(d),g.appendChild(o),g.addEventListener("scroll",()=>{let b=o.getBoundingClientRect(),r=g.getBoundingClientRect();b.top>r.bottom?(o.style.transition="all 0.5s ease-out",o.style.transform="translateX(-100px)",o.style.opacity="0"):(o.style.transition="all 0.5s ease-in",o.style.transform="translateX(0px)",o.style.opacity="1")})}}function Xo(){document.getElementById("exOIsoPanel").style.opacity="0",setTimeout(()=>{document.body.removeChild(document.getElementById("exOIsoPanel"))},500);try{let C=document.getElementById("waifu");var g=GM_getValue("waifu_left",screen.width-350),I=GM_getValue("waifu_top",screen.height-400);C.style.left=g+"px",C.style.top=I+"px",C.style.transition="all 0.5s",setTimeout(()=>{C.style.transition="none"},500)}catch{}}eg.reg("/","quickSearch",()=>{document.addEventListener("keydown",g=>{if(g.altKey&&g.ctrlKey){let t=function(){I.style.opacity="0",C.style.opacity="0",window.searchBoxOpened=!1,Xo(),setTimeout(()=>{document.body.removeChild(I),document.body.removeChild(C)},500)},s=function(){if(window.sugStatus===!0)return;let d=`https://online.oiso.cf/suggestion?q=${A.value}`;window.sugStatus=!0,$g(d,b=>{let r=JSON.parse(b.responseText),{hits:m}=r.hits;$("#suggestionContainer").empty();let u=$("#suggestionContainer");for(let G in m)u.append(`<div style="height:35px;" onclick="gosug(\`${m[G]._source.name}\`)">${m[G]._source.name}</div>`);window.sugStatus=!1})};if(window.searchBoxOpened===!0){window.searchBoxOpened=!1,Xo(),document.getElementById("mask").style.opacity="0",document.getElementById("searchBox").style.opacity="0",setTimeout(()=>{document.body.removeChild(document.getElementById("mask")),document.body.removeChild(document.getElementById("searchBox"))},500);return}ma(),window.searchBoxOpened=!0;let I=document.createElement("div");I.id="mask",I.style.position="fixed",I.style.top="0",I.style.left="0",I.style.width="100%",I.style.height="100%",I.style.background="rgba(0, 0, 0, 0.5)",I.style.backdropFilter=`blur(${qg("quickSearch").config.backgroundBlur.value}px)`,I.style.transition="opacity 0.5s",I.style.opacity="0",I.style.zIndex="1000",setTimeout(()=>{I.style.opacity="1"},0),document.body.appendChild(I);let C=document.createElement("div");C.id="searchBox",C.style.position="fixed",C.style.top="15%",C.style.left="50%",C.style.transform="translate(-50%, -50%)",C.style.width="620px",C.style.height="50px",C.style.borderRadius="20px",C.style.background="#fff",C.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.2)",C.style.transition="opacity 0.5s",C.style.opacity="0",C.style.zIndex="1001",window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(C.style.background="#333"),setTimeout(()=>{C.style.opacity="1"},0),document.body.appendChild(C);let A=document.createElement("input");if(A.id="searchBoxInput",A.style.position="absolute",A.style.top="0",A.style.left="0",A.style.width="550px",A.style.height="50px",A.style.lineHeight="50px",A.style.paddingLeft="20px",A.style.fontSize="20px",A.style.border="none",A.style.outline="none",A.style.backgroundColor="transparent",A.style.borderRadius="5px 0 0 5px",A.style.cursor="text",A.style.zIndex="1002",A.placeholder="\u641C\u7D22\u9898\u76EE\u3001\u5E16\u5B50\u3001\u9898\u89E3\u3001\u535A\u5BA2\u3001\u7528\u6237",A.autofocus=!0,window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches){let d=`#searchBoxInput::placeholder {
                    color: white;
                }
                `,b=document.createElement("style");b.type="text/css",b.appendChild(document.createTextNode(d)),document.getElementsByTagName("head")[0].appendChild(b),A.style.color="#fff"}C.appendChild(A),A.addEventListener("keydown",d=>{d.keyCode===13&&window.open(`https://www.oiso.cf/search?q=${A.value}`)}),A.addEventListener("input",()=>{s(A.value)});let l=document.createElement("div");l.style.position="absolute",l.style.top="0",l.style.right="0",l.style.width="50px",l.style.height="50px",l.style.lineHeight="50px",l.style.textAlign="center",l.style.fontSize="20px",l.style.fontWeight="bold",l.style.cursor="pointer",l.style.fill="currentColor",l.style.zIndex="1002",l.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>',window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(l.style.color="#fff"),l.style.transform="translateY(5px)",l.onclick=function(){window.open(`https://www.oiso.cf/search?q=${A.value}`)},C.appendChild(l);let i=`#suggestionContainer div {
                /* border-radius: 15px; */
                display: -webkit-box;
                -webkit-box-orient: vertical;
                -webkit-line-clamp: 1;
                overflow: hidden;
                clear: both;
                height: 30px;
                padding-left: 20px;
                line-height: 30px;
                cursor: pointer;
                background: rgba(0, 0, 0, 0.09);
                color: rgba(255, 255, 255, .8);
                transition: .25s;
            }
            #suggestionContainer {
                overflow: hidden;
                z-index: 1145141919810;
                border-radius: 15px;
                transition: .25s;
                -webkit-backdrop-filter: blur(30px) saturate(1.25);
                backdrop-filter: blur(30px) saturate(1.25);
                box-shadow: rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px;
            }
            #suggestionContainer div:hover {
                background: rgba(0, 0, 0, 0.27);
                color: rgba(255, 255, 255, .8);
                transition: .25s;
            }`,e=document.createElement("style");e.type="text/css",e.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(e);let o=document.createElement("div");o.id="suggestionContainer",o.style.height="auto",o.style.opacity="1",o.style.display="block",o.style.position="absolute",o.style.top="50px",o.style.transform="translateX(-50%);",o.style.width="620px",window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(o.style.backgroundColor="#333"),C.appendChild(o),I.addEventListener("click",()=>{t()}),document.addEventListener("keydown",d=>{d.keyCode===27&&t()});let n=`function gosug(name) {
                document.getElementById("searchBoxInput").value = (name);
                window.open("https://www.oiso.cf/search?q=" + name);
            }`,c=document.createElement("script");c.type="text/javascript",c.innerHTML=n,document.getElementsByTagName("body")[0].appendChild(c)}})});(function(){"use strict";function g(e){return Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:e}let I;function C(e,o,t){if(!e||sessionStorage.getItem("waifu-text")&&sessionStorage.getItem("waifu-text")>t)return;I&&(clearTimeout(I),I=null),e=g(e),sessionStorage.setItem("waifu-text",t);let n=document.getElementById("waifu-tips");n.innerHTML=e,n.classList.add("waifu-tips-active"),I=setTimeout(()=>{sessionStorage.removeItem("waifu-text"),n.classList.remove("waifu-tips-active")},o)}class A{constructor(o){let{apiPath:t,cdnPath:n}=o,c=!1;if(typeof n=="string")c=!0,n.endsWith("/")||(n+="/");else{if(typeof t!="string")throw"Invalid initWidget argument!";t.endsWith("/")||(t+="/")}this.useCDN=c,this.apiPath=t,this.cdnPath=n}async loadModelList(){this.modelList={models:["bilibili-live/22"],messages:["\u6765\u81EA Bilibili Live \u7684 22 \u54E6 ~"]}}async loadModel(o,t,n){localStorage.setItem("modelId",o),localStorage.setItem("modelTexturesId",t),C(n,4e3,10),this.useCDN?(this.modelList||await this.loadModelList(),setTimeout(()=>{let c=g(this.modelList.models[o]);loadlive2d("live2d","https://www.luogu.com.cn/fe/api/problem/downloadAttachment/rjg3qdqi")},100)):(loadlive2d("live2d",`${this.apiPath}get/?id=${o}-${t}`),console.log(`Live2D \u6A21\u578B ${o}-${t} \u52A0\u8F7D\u5B8C\u6210`))}async loadRandModel(){let o=localStorage.getItem("modelId"),t=localStorage.getItem("modelTexturesId");this.useCDN?(this.modelList||await this.loadModelList(),setTimeout(()=>{let n=g(this.modelList.models[o]);loadlive2d("live2d","https://www.luogu.com.cn/fe/api/problem/downloadAttachment/rjg3qdqi"),C("\u6211\u7684\u65B0\u8863\u670D\u597D\u770B\u561B\uFF1F",4e3,10)},100)):$g(`${this.apiPath}rand_textures/?id=${o}-${t}`,n=>{let c=JSON.parse(n.responseText);c.textures.id!==1||t!==1&&t!==0?this.loadModel(o,c.textures.id,"\u6211\u7684\u65B0\u8863\u670D\u597D\u770B\u561B\uFF1F"):C("\u6211\u8FD8\u6CA1\u6709\u5176\u4ED6\u8863\u670D\u5462\uFF01",4e3,10)})}async loadOtherModel(){let o=localStorage.getItem("modelId");this.useCDN?(this.modelList||await this.loadModelList(),setTimeout(()=>{let t=++o>=this.modelList.models.length?0:o;this.loadModel(t,0,this.modelList.messages[t])},100)):$g(`${this.apiPath}switch/?id=${o}`,t=>{let n=JSON.parse(t.responseText);this.loadModel(n.model.id,0,n.model.message)})}}let l={hitokoto:{icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M512 240c0 114.9-114.6 208-256 208c-37.1 0-72.3-6.4-104.1-17.9c-11.9 8.7-31.3 20.6-54.3 30.6C73.6 471.1 44.7 480 16 480c-6.5 0-12.3-3.9-14.8-9.9c-2.5-6-1.1-12.8 3.4-17.4l0 0 0 0 0 0 0 0 .3-.3c.3-.3 .7-.7 1.3-1.4c1.1-1.2 2.8-3.1 4.9-5.7c4.1-5 9.6-12.4 15.2-21.6c10-16.6 19.5-38.4 21.4-62.9C17.7 326.8 0 285.1 0 240C0 125.1 114.6 32 256 32s256 93.1 256 208z"/></svg>',callback:function(){$g("https://v1.hitokoto.cn",e=>{let o=JSON.parse(e.responseText),t=`\u8FD9\u53E5\u4E00\u8A00\u6765\u81EA <span>\u300C${o.from}\u300D</span>\uFF0C\u662F <span>${o.creator}</span> \u5728 hitokoto.cn \u6295\u7A3F\u7684\u3002`;C(o.hitokoto,6e3,9),setTimeout(()=>{C(t,4e3,9)},6e3)})}},asteroids:{icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L277.3 424.9l-40.1 74.5c-5.2 9.7-16.3 14.6-27 11.9S192 499 192 488V392c0-5.3 1.8-10.5 5.1-14.7L362.4 164.7c2.5-7.1-6.5-14.3-13-8.4L170.4 318.2l-32 28.9 0 0c-9.2 8.3-22.3 10.6-33.8 5.8l-85-35.4C8.4 312.8 .8 302.2 .1 290s5.5-23.7 16.1-29.8l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg>',callback:()=>{window.Asteroids?(window.ASTEROIDSPLAYERS||(window.ASTEROIDSPLAYERS=[]),window.ASTEROIDSPLAYERS.push(new Asteroids)):$g("https://fastly.jsdelivr.net/gh/stevenjoezhang/asteroids/asteroids.js",e=>{let o=document.createElement("script");o.innerHTML=e.responseText,document.head.appendChild(o)})}},"switch-model":{icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M399 384.2C376.9 345.8 335.4 320 288 320H224c-47.4 0-88.9 25.8-111 64.2c35.2 39.2 86.2 63.8 143 63.8s107.8-24.7 143-63.8zM512 256c0 141.4-114.6 256-256 256S0 397.4 0 256S114.6 0 256 0S512 114.6 512 256zM256 272c39.8 0 72-32.2 72-72s-32.2-72-72-72s-72 32.2-72 72s32.2 72 72 72z"/></svg>',callback:()=>{}},"switch-texture":{icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M320 64c0-35.3-28.7-64-64-64s-64 28.7-64 64s28.7 64 64 64s64-28.7 64-64zm-96 96c-35.3 0-64 28.7-64 64v48c0 17.7 14.3 32 32 32h1.8l11.1 99.5c1.8 16.2 15.5 28.5 31.8 28.5h38.7c16.3 0 30-12.3 31.8-28.5L318.2 304H320c17.7 0 32-14.3 32-32V224c0-35.3-28.7-64-64-64H224zM132.3 394.2c13-2.4 21.7-14.9 19.3-27.9s-14.9-21.7-27.9-19.3c-32.4 5.9-60.9 14.2-82 24.8c-10.5 5.3-20.3 11.7-27.8 19.6C6.4 399.5 0 410.5 0 424c0 21.4 15.5 36.1 29.1 45c14.7 9.6 34.3 17.3 56.4 23.4C130.2 504.7 190.4 512 256 512s125.8-7.3 170.4-19.6c22.1-6.1 41.8-13.8 56.4-23.4c13.7-8.9 29.1-23.6 29.1-45c0-13.5-6.4-24.5-14-32.6c-7.5-7.9-17.3-14.3-27.8-19.6c-21-10.6-49.5-18.9-82-24.8c-13-2.4-25.5 6.3-27.9 19.3s6.3 25.5 19.3 27.9c30.2 5.5 53.7 12.8 69 20.5c3.2 1.6 5.8 3.1 7.9 4.5c3.6 2.4 3.6 7.2 0 9.6c-8.8 5.7-23.1 11.8-43 17.3C374.3 457 318.5 464 256 464s-118.3-7-157.7-17.9c-19.9-5.5-34.2-11.6-43-17.3c-3.6-2.4-3.6-7.2 0-9.6c2.1-1.4 4.8-2.9 7.9-4.5c15.3-7.7 38.8-14.9 69-20.5z"/></svg>',callback:()=>{}},photo:{icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M220.6 121.2L271.1 96 448 96v96H333.2c-21.9-15.1-48.5-24-77.2-24s-55.2 8.9-77.2 24H64V128H192c9.9 0 19.7-2.3 28.6-6.8zM0 128V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H271.1c-9.9 0-19.7 2.3-28.6 6.8L192 64H160V48c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16l0 16C28.7 64 0 92.7 0 128zM344 304c0 48.6-39.4 88-88 88s-88-39.4-88-88s39.4-88 88-88s88 39.4 88 88z"/></svg>',callback:()=>{C("\u7167\u597D\u4E86\u561B\uFF0C\u662F\u4E0D\u662F\u5F88\u53EF\u7231\u5462\uFF1F",6e3,9),Live2D.captureName="photo.png",Live2D.captureFrame=!0}},info:{icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M256 512c141.4 0 256-114.6 256-256S397.4 0 256 0S0 114.6 0 256S114.6 512 256 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-144c-17.7 0-32-14.3-32-32s14.3-32 32-32s32 14.3 32 32s-14.3 32-32 32z"/></svg>',callback:()=>{open("https://github.com/stevenjoezhang/live2d-widget")}},quit:{icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3 265.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256 310.6 150.6z"/></svg>',callback:()=>{localStorage.setItem("waifu-display",Date.now()),C("\u613F\u4F60\u6709\u4E00\u5929\u80FD\u4E0E\u91CD\u8981\u7684\u4EBA\u91CD\u9022\u3002",2e3,11),document.getElementById("waifu").style.bottom="-500px",setTimeout(()=>{document.getElementById("waifu").style.display="none",document.getElementById("waifu-toggle").classList.add("waifu-toggle-active")},3e3)}}};function i(e){let o=new A(e);function t(n){let c,s=!1,d=n.message.default;window.addEventListener("mousemove",()=>s=!0),window.addEventListener("keydown",()=>s=!0),setInterval(()=>{s?(s=!1,clearInterval(c),c=null):c||(c=setInterval(()=>{C(d,6e3,9)},2e4))},1e3),C(function(r){if(location.pathname==="/")for(let{hour:G,text:p}of r){let V=new Date,R=G.split("-")[0],L=G.split("-")[1]||R;if(R<=V.getHours()&&V.getHours()<=L)return p}let m=`\u6B22\u8FCE\u9605\u8BFB<span>\u300C${document.title.split(" - ")[0]}\u300D</span>`,u;if(document.referrer!==""){let G=new URL(document.referrer),p=G.hostname.split(".")[1],V={baidu:"\u767E\u5EA6",so:"360\u641C\u7D22",google:"\u8C37\u6B4C\u641C\u7D22"};return location.hostname===G.hostname?m:(u=p in V?V[p]:G.hostname,`Hello\uFF01\u6765\u81EA <span>${u}</span> \u7684\u670B\u53CB<br>${m}`)}return m}(n.time),7e3,11),window.addEventListener("mouseover",r=>{for(let{selector:m,text:u}of n.mouseover)if(r.target.matches(m))return u=g(u),u=u.replace("{text}",r.target.innerText),void C(u,4e3,8)}),window.addEventListener("click",r=>{for(let{selector:m,text:u}of n.click)if(r.target.matches(m))return u=g(u),u=u.replace("{text}",r.target.innerText),void C(u,4e3,8)}),n.seasons.forEach(({date:r,text:m})=>{let u=new Date,G=r.split("-")[0],p=r.split("-")[1]||G;G.split("/")[0]<=u.getMonth()+1&&u.getMonth()+1<=p.split("/")[0]&&G.split("/")[1]<=u.getDate()&&u.getDate()<=p.split("/")[1]&&(m=(m=g(m)).replace("{year}",u.getFullYear()),d.push(m))});let b=()=>{};console.log("%c",b),b.toString=()=>{C(n.message.console,6e3,9)},window.addEventListener("copy",()=>{C(n.message.copy,6e3,9)}),window.addEventListener("visibilitychange",()=>{document.hidden||C(n.message.visibilitychange,6e3,9)})}localStorage.removeItem("waifu-display"),sessionStorage.removeItem("waifu-text"),document.body.insertAdjacentHTML("beforeend",`<div id="waifu">
            <div id="waifu-tips"></div>
            <canvas id="live2d" width="800" height="800"></canvas>
            <div id="waifu-tool"></div>
        </div>`),setTimeout(()=>{document.getElementById("waifu").style.bottom=0},0),function(){l["switch-model"].callback=()=>o.loadOtherModel(),l["switch-texture"].callback=()=>o.loadRandModel(),Array.isArray(e.tools)||(e.tools=Object.keys(l));for(let n of e.tools)if(l[n]){let{icon:c,callback:s}=l[n];document.getElementById("waifu-tool").insertAdjacentHTML("beforeend",`<span id="waifu-tool-${n}">${c}</span>`),document.getElementById(`waifu-tool-${n}`).addEventListener("click",s)}}(),function(){let n=localStorage.getItem("modelId"),c=localStorage.getItem("modelTexturesId");n===null&&(n=1,c=53),o.loadModel(n,c),$g(e.waifuPath,s=>{let d=JSON.parse(s.responseText);t(d)})}()}window.initWidget=function(e,o){typeof e=="string"&&(e={waifuPath:e,apiPath:o}),document.body.insertAdjacentHTML("beforeend",`<div id="waifu-toggle">
            <span>\u770B\u677F\u5A18</span>
        </div>`);let t=document.getElementById("waifu-toggle");t.addEventListener("click",()=>{t.classList.remove("waifu-toggle-active"),t.getAttribute("first-time")?(i(e),t.removeAttribute("first-time")):(localStorage.removeItem("waifu-display"),document.getElementById("waifu").style.display="",setTimeout(()=>{document.getElementById("waifu").style.bottom=0},0))}),localStorage.getItem("waifu-display")&&Date.now()-localStorage.getItem("waifu-display")<=864e5?(t.setAttribute("first-time",!0),setTimeout(()=>{t.classList.add("waifu-toggle-active")},0)):i(e)}})();var FA;function So(g,I,C){if(!g||sessionStorage.getItem("waifu-text")&&sessionStorage.getItem("waifu-text")>C)return;FA&&(clearTimeout(FA),FA=null),sessionStorage.setItem("waifu-text",C);let A=document.getElementById("waifu-tips");A.innerHTML=g,A.classList.add("waifu-tips-active"),FA=setTimeout(()=>{sessionStorage.removeItem("waifu-text"),A.classList.remove("waifu-tips-active")},I)}function Za(){let g=qg("live2d").config.LOL.value;if(g=="")return;let I=g.split(`
`);console.log(I);for(let C=0;C<I.length;C++)try{let A=I[C].split(" "),l=A[0].length+A[1].length+A[2].length+3,i=I[C].substr(l),e=i.substring(0,i.indexOf(":")),o=i.substr(i.indexOf(":")+1);e=="text"?document.querySelector(A[0]).addEventListener(A[1],()=>{So(o.replaceAll("<","&lt;").replaceAll(">","&gt;"),A[2],9)}):document.querySelector(A[0]).addEventListener(A[1],()=>{So(o.replaceAll("<","&lt;").replaceAll(">","&gt;"),A[2],9)})}catch{}}eg.reg("/","live2d",()=>{let g="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/";function I(C,A){return new Promise((l,i)=>{let e;A==="css"?(e=document.createElement("style"),$g(C,o=>{e.innerText=o.responseText})):A==="js"&&(e=document.createElement("script"),$g(C,o=>{e.text=o.responseText})),e&&(e.onload=()=>l(C),e.onerror=()=>i(C),document.head.appendChild(e))})}screen.width>=768&&(I(`${g}waifu.css`,"css"),I("https://www.oiso.cf/js/live2d.js?random=random","js"),setTimeout(()=>{initWidget({waifuPath:`${g}waifu-tips.json`,cdnPath:"https://fastly.jsdelivr.net/gh/fghrsh/live2d_api/",tools:["hitokoto","asteroids","photo","info"]})},100),setTimeout(()=>{document.getElementById("waifu").style.zIndex=999999,document.getElementById("waifu").setAttribute("draggable","true");var C=document.documentElement.clientWidth;document.getElementById("waifu").style.left=C-350+"px";var A=document.getElementById("waifu"),l=0,i=0,e=!1,o=GM_getValue("waifu_left",C-350),t=GM_getValue("waifu_top",screen.height-400);A.style.left=o+"px",A.style.top=t+"px",A.addEventListener("mousedown",function(n){l=n.clientX-A.offsetLeft,i=n.clientY-A.offsetTop,e=!0}),document.addEventListener("mousemove",function(n){if(e){n.preventDefault();var c=n.clientX-l,s=n.clientY-i;A.style.left=c+"px",A.style.top=s+"px",GM_setValue("waifu_left",c),GM_setValue("waifu_top",s)}}),document.getElementById("waifu").addEventListener("mouseup",function(){e=!1})},200)),console.log(`
    \u304F__,.\u30D8\u30FD.        /  ,\u30FC\uFF64 \u3009
            \uFF3C ', !-\u2500\u2010-i  /  /\xB4
            \uFF0F\uFF40\uFF70'       L/\uFF0F\uFF40\u30FD\uFF64
            /   \uFF0F,   /|   ,   ,       ',
        \uFF72   / /-\u2010/  \uFF49  L_ \uFF8A \u30FD!   i
            \uFF9A \uFF8D 7\uFF72\uFF40\uFF84   \uFF9A'\uFF67-\uFF84\uFF64!\u30CF|   |
            !,/7 '0'     \xB40i\u30BD|    |
            |.\u4ECE"    _     ,,,, / |./    |
            \uFF9A'| i\uFF1E.\uFF64,,__  _,.\u30A4 /   .i   |
                \uFF9A'| | / k_\uFF17_/\uFF9A'\u30FD,  \uFF8A.  |
                | |/i \u3008|/   i  ,.\uFF8D |  i  |
                .|/ /  \uFF49\uFF1A    \uFF8D!    \uFF3C  |
                k\u30FD>\uFF64\uFF8A    _,.\uFF8D\uFF64    /\uFF64!
                !'\u3008//\uFF40\uFF34\xB4', \uFF3C \uFF40'7'\uFF70r'
                \uFF9A'\u30FDL__|___i,___,\u30F3\uFF9A|\u30CE
                    \uFF84-,/  |___./
                    '\uFF70'    !_,.:
    `),Za()});function Wo(){let g="https://www.luogu.com.cn/api/user/updateSlogan",I=new Date,C=I.getFullYear(),A=I.getMonth()+1,l=I.getDate(),i=I.getHours(),e=I.getMinutes(),o=`${C}\u5E74${A}\u6708${l}\u65E5${i}\u65F6${e}\u5206`,t=qg("onlineReport").config.text.value;t=t.replace("{time}",o),ql(g,{slogan:t},()=>{})}eg.reg("/","onlineReport",()=>{Wo(),setInterval(()=>{Wo()},Number(qg("onlineReport").config.duration.value)*60*1e3)});function Ga(g){return g.includes("<img")||g.includes("<code")||g.includes("<a")||g.includes("<b")||g.includes("<i")||g.includes("<del")||g.includes("<blockquote")||g.includes("<li")||g.includes("<hr")||g.includes("<pre")||(g=g.replace(/!\[(.+?)\]\((.+?)\)/g,"<img src='$2' alt='$1' />"),g=g.replace(/`(.+?)`/g,"<code>$1</code>"),g=g.replace(/\[(.+?)\]\((.+?)\)/g,"<a href='$2'>$1</a>"),g=g.replace(/\*\*(.+?)\*\*/g,"<b>$1</b>"),g=g.replace(/\*(.+?)\*/g,"<i>$1</i>"),g=g.replace(/~~(.+?)~~/g,"<del>$1</del>"),g=g.replace(/\n>(.+?)\n/g,"<blockquote>$1</blockquote>"),g=g.replace(/\n\* (.+?)\n/g,"<li>$1</li>"),g=g.replace(/\n---\n/g,"<hr />"),g=g.replace(/\n```(.+?)\n(.+?)\n```/g,"<pre><code class='$1'>$2</code></pre>"),g=g.replace(/(http|https):\/\/[^\s\u4e00-\u9fa5]*/g,I=>I.endsWith(".jpg")||I.endsWith(".png")||I.endsWith(".jpeg")?`<img src="${I}" style="max-width:100%;" />`:`<a href="${I}">${I}</a>`)),g}function Ro(){let g=document.querySelectorAll(".message");for(let I in g){let C=g[I];C.innerHTML=Ga(C.innerHTML)}}eg.reg("/chat","msgMarkdown",()=>{setTimeout(()=>{Ro()},1e3),document.addEventListener("click",()=>{setTimeout(()=>{Ro()},500)})});function wo(g){let I="https://oiso.run-eu-central1.goorm.site/api/ocr",C=new FormData;C.append("image",g.replace("data:image/png;base64,","")),GM_xmlhttpRequest({method:"POST",url:I,data:C,onload:A=>{let l=JSON.parse(A.responseText),i=document.querySelector("input[name='captcha']");if(l.result.length!==4||!/^[0-9a-zA-Z]+$/.test(l.result)){document.querySelector(".captcha").click(),i.value="\u5931\u8D25\u91CD\u8BD5\u4E2D...";return}i.value=l.result}})}function ba(g){let I="https://oiso.run-eu-central1.goorm.site/api/ocr",C=new FormData;C.append("image",g.replace("data:image/png;base64,","")),GM_xmlhttpRequest({method:"POST",url:I,data:C,onload:A=>{let l=JSON.parse(A.responseText),i=document.querySelector(".swal2-input");yg("easyCaptcha",l.result),i.value=l.result,document.querySelector(".swal2-confirm").click(),setTimeout(()=>{window.is_solving_captcha=!1},3e3)}})}function pa(){let g=document.querySelector("#--swal-image-hosting-upload-captcha");!g||window.is_solving_captcha===!0||setTimeout(()=>{window.is_solving_captcha=!0;let I=document.createElement("canvas"),C=I.getContext("2d");I.width=g.width,I.height=g.height,C.drawImage(g,0,0);let A=I.toDataURL("image/png"),l=document.querySelector(".swal2-input");l.value="OIso++ \u6B63\u5728\u586B\u5145\u9A8C\u8BC1\u7801...",ba(A)},1500)}eg.reg("/","easyCaptcha",()=>{location.pathname.startsWith("/image")?setInterval(pa,300):setTimeout(()=>{let g=document.querySelector(".captcha");if(g){let I=document.createElement("canvas"),C=I.getContext("2d");I.width=g.width,I.height=g.height,C.drawImage(g,0,0);let A=I.toDataURL("image/png");wo(A)}g.addEventListener("load",()=>{setTimeout(()=>{let I=document.createElement("canvas"),C=I.getContext("2d");I.width=g.width,I.height=g.height,C.drawImage(g,0,0);let A=I.toDataURL("image/png");wo(A)},0)})},1e3)});eg.reg("/","eloNameColor",()=>{yg("eloNameColor","eloNameColor loaded");let g=C=>C==="Null"?"#bdb7af":(C=parseInt(C,10),C>=2600?"#a561c1":C>=1700?"#e95849":C>=1500?"#e88a36":C>=1300?"#ffcc88":C>=1e3?"#6bbf6b":"#bdb7af"),I=async()=>{let C=$(".am-comment-meta");yg("eloNameColor",C);for(let A=0;A<C.length;A++){let l=C[A],i=l.childNodes[2],e=l.childNodes[2].text,o=$(l.childNodes[2]).attr("href"),t=/\/\d+$/,n=o.match(t)[0].slice(1);yg("eloNameColor",e,n);let c=window.getComputedStyle(i,null).getPropertyValue("color"),s=await $l(n);yg("eloNameColor",s.responseText),$(l).append(s.responseText);let b=`linear-gradient(to right, ${g(s.responseText)}, ${c})`;$(i).css("background",b),$(i).css("-webkit-background-clip","text"),$(i).css("-webkit-text-fill-color","transparent")}yg("eloNameColor",C)};setTimeout(()=>{I()},750)});var vI=!1;function mg(g){yg("lgse",g)}function Fl(){mg("Clearing cache"),GM_setValue("cache/expired",new Date().getTime().toString())}function Ko(){return parseInt(GM_getValue("cache/expired","0"),10)}function Jl(g,I){mg(`Finding cache: ${g}`);let C=new Date,A=new Date().getTime();C.setTime(parseInt(GM_getValue(`cache/time_${g}`,"0"),10));let l={};A-C>864e5?(mg("Cache miss"),GM_xmlhttpRequest({method:"GET",url:g,onload(i){mg(`Request success: HTTP ${i.status}, Content: ${i.responseText}`),l={error:!1,status:i.status,content:i.responseText},i.status===200&&(GM_setValue(`cache/content_${g}`,JSON.stringify(l)),GM_setValue(`cache/time_${g}`,new Date().getTime().toString())),I(l)},onerror(i){mg(`Request failed: HTTP ${i.status}`),l={error:!0,status:i.status},I(l)}})):(mg("Cache hit"),l=JSON.parse(GM_getValue(`cache/content_${g}`)),I(l))}function Ho(g,I){eg.reg("/","LGSE",g),eg.regInAll("https://.*/.*lgse-settings.*","LGSE",I)}var XI="{{version}}",ra="2.2.0",Vg,PI=[[".am-comment-bd",[/^\/$/,/^\/discuss\/.*$/]],[".content",[/^\/user\/.*$/]],[".message",[/^\/chat.*$/]]];function ha(){for(let g=0;g<PI.length;g++)for(let I=0;I<PI[g][1].length;I++)if(PI[g][1][I].test(document.location.pathname))return!0;return!1}function Ba(){let g=[];for(let I=0;I<PI.length;I++)for(let C=0;C<PI[I][1].length;C++)PI[I][1][C].test(document.location.pathname)&&(g[g.length]=document.querySelectorAll(PI[I][0]));return g}var CI=[["aini","\u7231\u4F60"],["aiq","\u7231\u60C5"],["am","\u50B2\u6162"],["azgc","\u6697\u4E2D\u89C2\u5BDF"],["baiy","\u767D\u773C"],["bangbangt","\u68D2\u68D2\u7CD6"],["banzz","\u642C\u7816\u4E2D"],["baojin","\u7206\u7B4B"],["bb","\u4FBF\u4FBF"],["bkx","\u4E0D\u5F00\u5FC3"],["bl","\u98D9\u6CEA"],["bp","\u97AD\u70AE"],["bq","\u62B1\u62F3"],["bs","\u9119\u89C6"],["bt","\u62DC\u6258"],["bu","\u4E0D"],["bz","\u95ED\u5634"],["cd","\u83DC\u5200"],["cg","\u5403\u74DC"],["ch","\u64E6\u6C57"],["cha","\u8336"],["chi","\u5403"],["cj","\u5DEE\u52B2"],["cp","\u949E\u7968"],["cs","\u6CA7\u6851"],["cy","\u5472\u7259"],["dan","\u86CB"],["dao","\u5200"],["dax","\u5927\u7B11"],["db","\u60A0\u95F2"],["dg","\u86CB\u7CD5"],["dk","\u5927\u54ED"],["dl","\u706F\u7B3C"],["doge","\u72D7\u5934"],["dx","\u51CB\u8C22"],["dy","\u5F97\u610F"],["dz","\u70B9\u8D5E"],["ee","\u5443"],["emm","\u55EF..."],["fad","\u53D1\u6296"],["fan","\u996D"],["fd","\u53D1\u5446"],["fendou","\u594B\u6597"],["fj","\u98DE\u673A"],["fn","\u6124\u6012"],["fw","\u98DE\u543B"],["gg","\u5C34\u5C2C"],["gy","\u52FE\u5F15"],["gz","\u9F13\u638C"],["hanx","\u61A8\u7B11"],["haob","\u597D\u68D2"],["hb","\u7EA2\u5305"],["hc","\u82B1\u75F4"],["hd","\u597D\u7684"],["hec","\u559D\u5F69"],["hhd","\u5475\u5475\u54D2"],["hn","\u559D\u5976"],["hp","\u5BB3\u6015"],["hq","\u54C8\u6B20"],["hsh","\u6325\u624B"],["ht","\u56DE\u5934"],["huaix","\u574F\u7B11"],["hx","\u5BB3\u7F9E"],["jd","\u6FC0\u52A8"],["jh","\u83CA\u82B1"],["jiaybb","\u52A0\u6CB9\u62B1\u62B1"],["jiaybs","\u52A0\u6CB9\u5FC5\u80DC"],["jie","\u9965\u997F"],["jk","\u60CA\u6050"],["jw","\u8857\u821E"],["jx","\u60CA\u559C"],["jy","\u60CA\u8BB6"],["ka","\u53EF\u7231"],["kb","\u62A0\u9F3B"],["kel","\u53EF\u601C"],["kf","\u5496\u5561"],["kg","K\u6B4C"],["kk","\u5FEB\u54ED\u4E86"],["kl","\u9AB7\u9AC5"],["kt","\u78D5\u5934"],["kuk","\u9177"],["kun","\u56F0"],["kzht","\u53E3\u7F69\u62A4\u4F53"],["lb","\u6CEA\u5954"],["lengh","\u51B7\u6C57"],["lh","\u6D41\u6C57"],["ll","\u6D41\u6CEA"],["lm","\u51B7\u6F20"],["lq","\u7BEE\u7403"],["lw","\u793C\u7269"],["lyj","\u8FA3\u773C\u775B"],["mdfq","\u5FD9\u5230\u98DE\u8D77"],["mg","\u73AB\u7470"],["mm","\u5356\u840C"],["ng","\u96BE\u8FC7"],["nkt","\u8111\u58F3\u75BC"],["oh","\u6004\u706B"],["oy","\u5662\u54DF"],["pch","\u74E2\u866B"],["pj","\u5564\u9152"],["pp","\u4E52\u4E53"],["px","\u55B7\u8840"],["pz","\u6487\u5634"],["qd","\u7CD7\u5927\u4E86"],["qiang","\u5F3A"],["qiao","\u6572"],["qidao","\u7948\u7977"],["qq","\u4EB2\u4EB2"],["qt","\u62F3\u5934"],["ruo","\u8E29"],["sa","\u793A\u7231"],["se","\u8272"],["sh","\u9001\u82B1"],["shd","\u95EA\u7535"],["shl","\u80DC\u5229"],["shq","\u624B\u67AA"],["shuai","\u8870"],["shui","\u7761"],["shxi","\u53CC\u559C"],["sr","\u9A9A\u6270"],["tiao","\u8DF3\u8DF3"],["tl","\u6258\u8138"],["tnl","\u592A\u96BE\u4E86"],["tp","\u8C03\u76AE"],["ts","\u6258\u816E"],["tsh","\u8DF3\u7EF3"],["tt","\u5934\u79C3"],["tuu","\u5410"],["tx","\u5077\u7B11"],["ty","\u592A\u9633"],["wbk","\u6211\u4E0D\u770B"],["whl","\u95EE\u53F7\u8138"],["wl","\u65E0\u804A"],["wn","\u65E0\u5948"],["wosl","\u6211\u9178\u4E86"],["wq","\u59D4\u5C48"],["ws","\u63E1\u624B"],["wul","\u6342\u8138"],["wx","\u5FAE\u7B11"],["wzm","\u6211\u6700\u7F8E"],["xhx","\u5C0F\u6CB3\u87F9"],["xia","\u5413"],["xig","\u897F\u74DC"],["xin","\u7231\u5FC3"],["xjj","\u5C0F\u7EA0\u7ED3"],["xk","\u7B11\u54ED"],["xs","\u5FC3\u788E"],["xu","\u5618"],["xw","\u732E\u543B"],["xy","\u5C0F\u6837"],["xyx","\u659C\u773C\u7B11"],["yao","\u836F"],["yb","\u62E5\u62B1"],["yhh","\u53F3\u54FC\u54FC"],["yiw","\u7591\u95EE"],["yl","\u6708\u4EAE"],["youl","\u5E7D\u7075"],["youtj","\u53F3\u592A\u6781"],["yt","\u7F8A\u9A7C"],["yun","\u6655"],["yx","\u9634\u9669"],["zhd","\u70B8\u5F39"],["zhem","\u6298\u78E8"],["zhh","\u5DE6\u54FC\u54FC"],["zhm","\u5492\u9A82"],["zhq","\u8F6C\u5708"],["zj","\u518D\u89C1"],["zk","\u6293\u72C2"],["zq","\u8DB3\u7403"],["zt","\u732A\u5934"],["zuotj","\u5DE6\u592A\u6781"],["zyj","\u7728\u773C\u775B"]],ya="/%EMOJI%([^<A-Za-z][^>]*<)",Ml='<span style="color: #c8c8c8; font-size: 0.3em;">/%EMOJI%</span><img src="%SOURCE%" alt="%NAME%" title="%NAME%" width="28px" height="28px">$1';function fo(g){if(g.nodeType===1){if(g.tagName==="A"||g.tagName==="CODE")return[!1,g.outerHTML];let I=g.childNodes,C=!1,A="";for(let l=0;l<I.length;l++){let i=fo(I[l]);C=C||i[0],A+=i[1]}return C&&(g.innerHTML=A),[C,g.outerHTML]}if(g.nodeType===3){let I=!1,C=`>${g.data} <`;for(let A=0;A<CI.length;A++){let l=new RegExp(ya.replace(/%EMOJI%/g,CI[A][0]),"g"),i=Ml.replace(/%EMOJI%/g,CI[A][0]).replace(/%NAME%/g,CI[A][1]);for(;l.test(C);)C=C.replace(l,i),I=!0}return[I,C.substring(1,C.length-2)]}return[!1,""]}function ko(){let g=Ba(),I=!1;for(let C=0;C<g.length;C++)for(let A=0;A<g[C].length;A++)if(g[C][A].lgse_replaced!=="true"){let l=fo(g[C][A]);I=I||l[0],g[C][A].lgse_replaced="true"}I&&mg("Replaced"),setTimeout(ko,1e3)}var zl=`<style>
    .se-ent {
        z-index: 100;
        position: fixed;
        left: 30px;
        bottom: 30px;
        border-radius: 5px;
        background-color: #fff;
        padding: 11px;
        width: auto;
        height: auto;
        cursor: pointer;
    }
    .se-ent:hover {
        background-color: #ccc;
    }
    .se-mnu {
        z-index: 999;
        position: fixed;
        top: 30px;
        left: 30px;
        border-radius: 5px;
        background-color: #fff;
        padding: 5px;
        display: none;
        width: max(35%, 300px);
        height: calc(100% - 130px);
        border: 1px solid #0e90d2;
    }
    .se-emj {
        float: left;
        background-color: #eee;
        width: calc(28px + 7em);
        height: auto;
        border-radius: 2px;
        margin: 5px;
    }
    .se-emj:hover {
        background-color: #ccc;
    }
    .se-ipt {
        width: calc(100% - 10px);
        height: 1.5em;
        margin-top: 0.25em;
        margin-bottom: 0.25em;
    }
    .se-dsp {
        width: auto;
        height: auto;
        overflow: auto;
    }
    .se-hlt {
        color: #e67e22;
    }
</style>
<div class="se-ent" id="se-ent" oncontextmenu="window.open('https://lgse.heyc.eu.org/lgse-settings-${ra}.html')" title="\u53F3\u952E\u6253\u5F00\u8BBE\u7F6E" status="ordinary">
    <img src="%SOURCE_CY%" width="28px" height="28px">
</div>
<div class="se-mnu" id="se-mnu">
    <div class="se-dsp" id="se-srh">
        <input type="text" class="se-ipt" id="se-ipt" placeholder="\u641C\u7D22\u8868\u60C5...">
        <div class="se-dsp" id="se-dsp"></div>
    </div>
    <div class="se-dsp" id="se-upd" style="display: none;">
        <center id="se-upm"><b>LGSE \u66F4\u65B0</b><br></center>
        <div class="se-dsp" id="se-cgl" style="display: none;"><center><b>\u66F4\u65B0\u65E5\u5FD7</b><br></center></div>
    </div>
</div>`,nC=0,Nl=0,Dl='<div class="se-emj"><img src="%SOURCE%" alt="/%EMOJI%" width="28px" height="28px">  %TEXT%</div>',Lo='<span class="se-hlt">%TEXT%</span>';function vo(){let g=document.getElementById("se-ipt").value,I="";for(let C=0;C<CI.length;C++)(g===""||CI[C][0].replace(g,"")!==CI[C][0]||CI[C][1].replace(g,"")!==CI[C][1])&&(I+=Dl.replace(/%EMOJI%/g,CI[C][0]).replace(/%TEXT%/g,`${CI[C][0].replaceAll(g,Lo.replace(/%TEXT%/g,g))}<br>${CI[C][1].replaceAll(g,Lo.replace(/%TEXT%/g,g))}`));document.getElementById("se-dsp").innerHTML=I}function Ul(){(Vg["srh-emj"]||document.getElementById("se-upd").innerText!=="")&&(nC=1-nC,document.getElementById("se-mnu").style.display=nC===0?"none":"grid"),Vg["srh-emj"]&&nC===1&&(document.getElementById("se-ipt").focus(),vo())}function Fo(){Nl=1-Nl,document.getElementById("se-cgl").style.display=Nl===0?"none":"block"}function Va(){$("body").append(zl),Vg["srh-emj"]||(document.getElementById("se-srh").style.display="none"),document.getElementById("se-mnu").addEventListener("click",g=>{document.getElementById("se-mnu").style.display="grid",g.stopPropagation()}),document.getElementById("se-ent").addEventListener("click",g=>{Ul(),g.stopPropagation()}),document.addEventListener("click",()=>{nC&&Ul()}),document.getElementById("se-ipt").addEventListener("input",()=>{vo()}),document.addEventListener("keydown",g=>{g.key==="Escape"&&nC&&Ul()})}var Xa=/^[0-9]+\.[0-9]+\.[0-9]+$/g,Sa="https://lgse-source.heyc.eu.org/version",Wa="https://lgse-source.heyc.eu.org/changelog.txt",Ra=`<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="28px" width="28px">
    <circle cx="14" cy="14" r="14" stroke-width="0" fill="#fe4c61" />
    <line x1="14" y1="5" x2="5" y2="14" stroke="#fff" stroke-width="3" stroke-linecap="round" />
    <line x1="14" y1="5" x2="23" y2="14" stroke="#fff" stroke-width="3" stroke-linecap="round" />
    <line x1="14" y1="5" x2="14" y2="23" stroke="#fff" stroke-width="3" stroke-linecap="round" />
</svg>`,Ql='<img src="%SOURCE_CY%" width="28px" height="28px">';function wa(g){$("#se-upm").append(`\u5F53\u524D <b><span style="color: #e67e22;">${XI}</span></b> --&gt; \u6700\u65B0 <b><span style="color: #52c41a;">${g}</span></b><br><a href="https://lgse-source.heyc.eu.org/LuoguShowEmoji.min.user.js" style="font-size: 0.7em">\u70B9\u51FB\u5347\u7EA7</a> <a id="se_cgl" style="font-size: 0.7em">\u663E\u793A/\u9690\u85CF\u66F4\u65B0\u65E5\u5FD7</a>`),document.getElementById("se_cgl").addEventListener("click",()=>{Fo()}),mg("Popped upgrade content")}function Ka(g){$("#se-upm").append(`\u5F53\u524D <b><span style="color: #52c41a;">${XI}</span></b> &lt;-- \u6700\u65B0 <b><span style="color: #e67e22;">${g}</span></b><br><a href="https://lgse-source.heyc.eu.org/LuoguShowEmoji.min.user.js" style="font-size: 0.7em">\u70B9\u51FB\u964D\u7EA7</a> <a id="se_cgl" style="font-size: 0.7em">\u663E\u793A/\u9690\u85CF\u66F4\u65B0\u65E5\u5FD7</a>`),document.getElementById("se_cgl").addEventListener("click",()=>{Fo()}),mg("Popped downgrade content")}function Ha(){$("#se-upm").append(`\u5F53\u524D <b><span style="color: #52c41a;">${XI}</span></b> --- <b><span style="color: #e67e22;">\u5931\u8D25\uFF01</span></b>`),mg("Popped CFU failed content")}function Jo(){document.getElementById("se-ent").status===null||document.getElementById("se-ent").status==="ordinary"?(document.getElementById("se-ent").innerHTML=Ra,document.getElementById("se-ent").status="update-icon"):(document.getElementById("se-ent").innerHTML=Ql,document.getElementById("se-ent").status="ordinary"),setTimeout(Jo,1e3)}function La(g){!g.error&&g.status===200?(mg("Get update log success"),$("#se-cgl").append(marked.parse(g.content))):mg("Get update log failed")}function Ya(g){!g.error&&g.status===200&&Xa.test(g.content)?(mg(`Get version success: CV ${XI} | LV ${g.content}`),g.content>XI&&(wa(g.content),Jo()),g.content<XI&&Ka(g.content),g.content!==XI&&(document.getElementById("se-upd").style.display="block",Jl(Wa,La))):(mg("Get version failed"),Ha())}var JA=["https://cdn.jsdelivr.net/gh/hyc1230/qqemoji/56x56/%EMOJI%.gif","https://ghproxy.com/https://raw.githubusercontent.com/hyc1230/qqemoji/master/56x56/%EMOJI%.gif","https://qqemoji.heyc.eu.org/56x56/%EMOJI%.gif","https://qqemoji.netlify.app/56x56/%EMOJI%.gif"],Yo={"rep-emj":!0,"srh-emj":!0,"img-src":2,"chk-upd":!0},NA=["rep-emj","srh-emj","img-src","chk-upd"];function fa(){try{let g=GM_getValue(`${vI?"":"LGSE_"}settings`,"{}");mg(`Settings: ${g}`),Vg=JSON.parse(g)}catch(g){mg(`ERROR ${g}`),mg("Using default settings"),Vg=Yo}for(let g=0;g<NA.length;g++)Vg[NA[g]]==null&&(Vg[NA[g]]=Yo[NA[g]])}function ka(){mg("Loading for Luogu"),Ml=Ml.replace(/%SOURCE%/g,JA[Vg["img-src"]]),zl=zl.replace(/%SOURCE_CY%/g,JA[Vg["img-src"]].replace(/%EMOJI%/g,"cy")),Dl=Dl.replace(/%SOURCE%/g,JA[Vg["img-src"]]),Ql=Ql.replace(/%SOURCE_CY%/g,JA[Vg["img-src"]].replace(/%EMOJI%/g,"cy")),Vg["rep-emj"]&&ha()&&(mg("Started replacing"),ko()),Va(),Vg["chk-upd"]&&vI&&Jl(Sa,Ya)}var va=`<style>
    .se-clr {
        z-index: 999;
        position: fixed;
        right: 30px;
        bottom: 30px;
        border-radius: 5px;
        border: 0px;
        padding-top: .5em;
        padding-bottom: .5em;
        padding-left: 1em;
        padding-right: 1em;
        color: #fff;
        background-color: rgb(52, 152, 219);
        font-size: 1em;
        cursor: pointer;
    }
    .se-clr:hover {
        background-color: rgba(52, 152, 219, 0.9);
    }
</style>
<button class="se-clr" id="se-clr">\u6E05\u9664 LGSE \u7F13\u5B58</button>`;function Fa(){mg("Loading for Settings page"),document.getElementById("rep-emj").checked=Vg["rep-emj"],document.getElementById("srh-emj").checked=Vg["srh-emj"],document.getElementById("img-src").selectedIndex=Vg["img-src"],document.getElementById("chk-upd").checked=Vg["chk-upd"],document.getElementById("status").style.color="#52c41a",document.getElementById("status").innerText="\u52A0\u8F7D\u5B8C\u6210",document.getElementById("info").innerText=JSON.stringify(Vg),$("body").append(va),document.getElementById("se-clr").addEventListener("click",()=>{let g=new Date().getTime(),I=Ko();g-I<6e5?window.alert(`\u8DDD\u79BB\u4E0A\u6B21\u6E05\u9664\u7F13\u5B58\u8FD8\u6CA1\u6709 10 \u5206\u949F\uFF0C\u8BF7\u5728 ${Math.ceil((6e5-(g-I))/6e4)} \u5206\u949F\u540E\u91CD\u8BD5\u3002`):(Fl(),window.alert("\u6E05\u9664\u7F13\u5B58\u6210\u529F\uFF0C\u8BF7\u5237\u65B0\u5176\u5B83\u9875\u9762\u4EE5\u4F7F\u66F4\u6539\u751F\u6548\u3002"))}),vI||(document.getElementById("se-clr").style.display="none")}function No(){let g=document.getElementById("info").innerText;g!==""&&g!==JSON.stringify(Vg)&&(Vg=JSON.parse(g),GM_setValue(`${vI?"":"LGSE_"}settings`,g),document.getElementById("status").style.color="#52c41a",document.getElementById("status").innerText="\u5DF2\u4FDD\u5B58",mg("Saved")),setInterval(No,1e3)}function Uo(){mg("Started"),fa()}function Ja(){vI&&GM_getValue(`${vI?"":"LGSE_"}ver`,"")!==XI&&(mg("Installed version not match"),Fl(),GM_setValue(`${vI?"":"LGSE_"}ver`,XI))}function Na(){try{Uo(),Ja(),ka()}catch(g){mg(`ERROR ${g}`),mg("Crash")}}function Ua(){try{Uo(),Fa(),No()}catch(g){mg(`ERROR ${g}`),mg("Crash")}}Ho(Na,Ua);eg.reg("/","controlPanel",()=>{yg("controlPanel","\u63A7\u5236\u9762\u677F\u6B63\u5728\u52A0\u8F7D\u3002"),setTimeout(()=>{let g=document.getElementsByClassName("user-nav")[0];g.tagName==="DIV"&&(g=g.children[0]);let I=document.createElement("a");I.className="am-btn am-btn-success am-btn-sm",I.style.borderRadius="5px",I.style.fontSize="13px",I.style.marginBottom="0",I.style.padding="0.5em 1em",I.style.fontWeight="400",I.style.lineHeight="1.2",I.style.textAlign="center",I.style.whiteSpace="nowrap",I.style.backgroundImage="none",I.style.border="1px solid transparent",I.style.cursor="pointer",I.style.outline="0",I.style.webkitAppearance="none",I.style.userSelect="none",I.style.webkitTransition="background-color 300ms ease-out,border-color 300ms ease-out",I.style.transition="background-color 300ms ease-out,border-color 300ms ease-out",I.innerHTML="<b>OIso++</b>",I.style.marginRight="10px",I.style.boxShadow="0 0 10px rgba(0,0,0,0.5)",I.style.color="white",I.style.background="green",I.onclick=()=>{let C=new KeyboardEvent("keydown",{key:"Control",ctrlKey:!0,altKey:!0});document.dispatchEvent(C)},g.insertBefore(I,g.firstChild)},1e3)});function xl(g){return g=g.replace(/^#\s+(.*)$/gm,"<h1>$1</h1>"),g=g.replace(/^##\s+(.*)$/gm,"<h2>$1</h2>"),g=g.replace(/^###\s+(.*)$/gm,"<h3>$1</h3>"),g=g.replace(/^####\s+(.*)$/gm,"<h4>$1</h4>"),g=g.replace(/^#####\s+(.*)$/gm,"<h5>$1</h5>"),g=g.replace(/^######\s+(.*)$/gm,"<h6>$1</h6>"),g=g.replace(/\*\*(.*)\*\*/g,"<strong>$1</strong>"),g=g.replace(/\*(.*)\*/g,"<em>$1</em>"),g=g.replace(/\[(.*)\]\((.*)\)/g,'<a href="$2">$1</a>'),g=g.replace(/```(.*)\n([\s\S]*?)\n```/g,'<pre><code class="$1">$2</code></pre>'),g=g.replace(/`(.*)`/g,"<code>$1</code>"),g=g.replace(/^(?!<h|<p|<ul|<ol|<li|<pre|<code)(.*)$/gm,"<p>$1</p>"),g}function Ma(g,I){window.isTranslating=!0;let C="",A=I.innerHTML,l="http://ai.oisou.link/translate",i=g;new Promise((c,s)=>{GM_xmlhttpRequest({url:l,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(i),responseType:"stream",onreadystatechange:n,onloadstart:d=>{let b=d.response.getReader(),r=new TextDecoder,m=()=>{b.read().then(({done:u,value:G})=>{if(u)return I.innerHTML=`${A}<blockquote>${xl(C)}</blockquote>`,window.isTranslating=!1,C;let p=r.decode(G);console.log(p);try{let V={choices:[{delta:{content:p}}]};V.choices[0].delta.content&&(V.choices[0].delta.content=V.choices[0].delta.content.replace(/\\n/g,"<br/>"),C+=V.choices[0].delta.content,I.innerHTML=`${A}<blockquote>${xl(C)}</blockquote>`)}catch{let R=p.split(`
`);for(let L of R)try{let M=JSON.parse(L);M.choices[0].delta.content&&(M.choices[0].delta.content===`
`&&(M.choices[0].delta.content="<br>"),C+=M.choices[0].delta.content,I.innerHTML=`${A}<blockquote>${xl(C)}</blockquote>`)}catch{}}m()})};m()}})}).then(()=>{});function o(c){class s{get(r){return this[r.toLowerCase()]}}let d=new s;for(let b of c.trim().split(`
`)){let[r,...m]=b.split(":");r&&(d[r.trim().toLowerCase()]=m.join(":").trim())}return d}let t=2;function n(c){let{readyState:s,responseHeaders:d,status:b,statusText:r}=c;if(s===t){let m=o(d);b===0&&console.warn("status is 0!",{status:b,statusText:r})}}}eg.reg("/problem","aHelper",()=>{let g=setInterval(()=>{if(document.querySelector(".action")){clearInterval(g);let I=document.querySelector(".action"),C=document.createElement("a");C.setAttribute("colorscheme","default"),C.setAttribute("class","color-default"),C.setAttribute("href","javascript:void 0");let A='<svg data-v-52a98731="" data-v-0640126c="" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="markdown" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="svg-inline--fa fa-language fa-w-20"><path data-v-52a98731="" data-v-0640126c="" fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3 0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1 .1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2L179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4c.9 .6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9l-18.9-11.3c-4.5-2.7-8.8-5.5-13.1-8.5c-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8l-12.2-12.2c-7.8-7.8-7.8-20.5 0-28.3s20.5-7.8 28.3 0l14.6 14.6 .5 .5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z" class=""></path></svg>';C.innerHTML=`${A} AI\u7FFB\u8BD1`,C.style.marginRight="10px",C.addEventListener("click",async()=>{C.setAttribute("disabled","disabled");let l=document.querySelectorAll(".marked"),i=0;await new Promise(e=>{let o=setInterval(()=>{if(!window.isTranslating){window.isTranslating=!0;let t=l[i],n=t.innerHTML;t.innerHTML+="<hr/>",Ma(n,t),i+=1,i>=l.length&&clearInterval(o),e()}},100)})}),I.insertBefore(C,I.firstChild)}},200)});function Tl(g){return g=g.replace(/^#\s+(.*)$/gm,"<h1>$1</h1>"),g=g.replace(/^##\s+(.*)$/gm,"<h2>$1</h2>"),g=g.replace(/^###\s+(.*)$/gm,"<h3>$1</h3>"),g=g.replace(/^####\s+(.*)$/gm,"<h4>$1</h4>"),g=g.replace(/^#####\s+(.*)$/gm,"<h5>$1</h5>"),g=g.replace(/^######\s+(.*)$/gm,"<h6>$1</h6>"),g=g.replace(/\*\*(.*)\*\*/g,"<strong>$1</strong>"),g=g.replace(/\*(.*)\*/g,"<em>$1</em>"),g=g.replace(/\[(.*)\]\((.*)\)/g,'<a href="$2">$1</a>'),g=g.replace(/```(.*)\n([\s\S]*?)\n```/g,'<pre><code class="$1">$2</code></pre>'),g=g.replace(/`(.*)`/g,"<code>$1</code>"),g=g.replace(/^(?!<h|<p|<ul|<ol|<li|<pre|<code)(.*)$/gm,"<p>$1</p>"),g}function za(g,I,C){let A="",l=I.innerHTML,i=`http://ai.oisou.link/solution/Luogu ${String(C)}`;new Promise(()=>{GM_xmlhttpRequest({url:i,method:"GET",headers:{"Content-Type":"application/json"},responseType:"stream",onerror:()=>{I.innerHTML=`${l}<blockquote>AI \u670D\u52A1\u6682\u4E0D\u53EF\u7528\uFF0C\u5DF2\u4E0A\u62A5\u7BA1\u7406\u5458\u5904\u7406\u3002\u5DF2\u5C1D\u8BD5\u4E3A\u60A8\u5237\u65B0AI\u53E3\u4EE4\uFF0C\u60A8\u53EF\u4EE5\u5237\u65B0\u9875\u9762\u540E\u91CD\u8BD5\u3002</blockquote>`},onreadystatechange:n,onloadstart:c=>{try{let s=c.response.getReader(),d=new TextDecoder,b=()=>{s.read().then(({done:r,value:m})=>{if(r)return I.innerHTML=`${l}${Tl(A)}`,A;let u=d.decode(m);console.log(u);try{let G={choices:[{delta:{content:u}}]};G.choices[0].delta.content&&(G.choices[0].delta.content=G.choices[0].delta.content.replace(/\\n/g,"<br/>"),A+=G.choices[0].delta.content,I.innerHTML=`${l}${Tl(A)}`)}catch(G){console.log("oiso++",G);let p=u.split(`
`);for(let V of p)try{let R=JSON.parse(V);R.choices[0].delta.content&&(R.choices[0].delta.content===`
`&&(R.choices[0].delta.content="<br>"),A+=R.choices[0].delta.content,I.innerHTML=`${l}${Tl(A)}`)}catch{}}b()})};b()}catch(s){console.log("[debug1] oiso++",s)}}})}).then(()=>{});function o(c){class s{get(r){return this[r.toLowerCase()]}}let d=new s;for(let b of c.trim().split(`
`)){let[r,...m]=b.split(":");r&&(d[r.trim().toLowerCase()]=m.join(":").trim())}return d}let t=2;function n(c){let{readyState:s,responseHeaders:d,status:b,statusText:r,response:m}=c;if(s===t){let u=o(d),G;b===0?(console.warn("status is 0!",{status:b,statusText:r}),G=new Response(m,{headers:u})):G=new Response(m,{headers:u,status:b,statusText:r})}}}eg.reg("/problem","aHelper",()=>{let g=setInterval(()=>{if(document.querySelector(".action")){clearInterval(g);let I=document.querySelector(".action"),C=document.createElement("a");C.setAttribute("colorscheme","default"),C.setAttribute("class","color-default"),C.setAttribute("href","javascript:void 0");let A='<svg data-v-52a98731="" data-v-0640126c="" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="pen" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="svg-inline--fa fa-pen fa-w-20"><path data-v-52a98731="" data-v-0640126c="" fill="currentColor" d="M362.7 19.3L314.3 67.7 444.3 197.7l48.4-48.4c25-25 25-65.5 0-90.5L453.3 19.3c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2C-1.5 489.7 .8 498.8 7 505s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L421.7 220.3 291.7 90.3z" class=""></path></svg>';C.innerHTML=`${A} AI\u89E3\u6790`,C.style.marginRight="10px",C.addEventListener("click",async()=>{let l=document.getElementById("solvingPanel");l&&l.remove();let i=document.getElementsByClassName("action")[0].parentElement.lastChild.innerText,e='<div data-v-f9624136="" data-v-52a98731="" class="card padding-default" data-v-6febb0e8=""><h3 data-v-52a98731="" data-v-f9624136="" class="lfe-h3">AI \u89E3\u6790</h3> <span data-v-52a98731="" data-v-f9624136="" id="solvingContent"></span></div>',o=document.createElement("div");o.innerHTML=e,o.id="solvingPanel",document.getElementsByClassName("side")[0].insertBefore(o,document.getElementsByClassName("side")[0].firstChild);let t=document.getElementById("solvingContent"),c=window.location.href.split("/")[4];console.log(c),za(i,t,c)}),I.insertBefore(C,I.firstChild)}},200)});eg.reg("/","nbnhhsh",()=>{let g=((I,C)=>{let A="https://lab.magiconch.com/api/nbnhhsh/",l=(G,p,V,R)=>GM_xmlhttpRequest({method:G,url:p,data:JSON.stringify(V),headers:{"content-type":"application/json"},onload:L=>R(L.responseText?JSON.parse(L.responseText):null)}),i={},e=(G,p)=>{if(G=G.match(/[a-z0-9]{2,}/ig).join(","),i[G])return p(i[G]);e._request&&e._request.abort(),u.loading=!0,e._request=l("POST",A+"guess",{text:G},V=>{i[G]=V,p(V),u.loading=!1})},o=G=>{let p=prompt("\u8F93\u5165\u7F29\u5199\u5BF9\u5E94\u6587\u5B57 \u672B\u5C3E\u53EF\u901A\u8FC7\u62EC\u53F7\u5305\u88F9\uFF08\u7B80\u7565\u6CE8\u660E\u6765\u6E90\uFF09","");!p||!p.trim||!p.trim()||l("POST",A+"translation/"+G,{text:p},()=>{alert("\u611F\u8C22\u5BF9\u597D\u597D\u8BF4\u8BDD\u9879\u76EE\u7684\u652F\u6301\uFF01\u5BA1\u6838\u901A\u8FC7\u540E\u8FD9\u6761\u5BF9\u5E94\u5C06\u4F1A\u751F\u6548")})},t=G=>G.map(p=>{let V=p.match(/^(.+?)([（\(](.+?)[）\)])?$/);return V.length===4?{text:V[1],sub:V[3]}:{text:p}}),n=G=>{let p=getSelection().toString().trim();return p&&/[a-z0-9]/i.test(p)?p:null},c=G=>{let p=getSelection().getRangeAt(0).getBoundingClientRect(),V=document.activeElement;["TEXTAREA","INPUT"].includes(V.tagName)&&(p=V.getBoundingClientRect());let R=document.documentElement.scrollTop||document.body.scrollTop,L=Math.floor(R+p.top+p.height),M=Math.floor(p.left);L===0&&M===0&&(u.show=!1),u.top=L,u.left=M},s=G=>{n()?setTimeout(s,300):u.show=!1},d=G=>{let p=n();u.show=!!p&&/[a-z0-9]/i.test(p),u.show&&(c(),e(p,V=>{V.length?u.tags=V:u.show=!1}),setTimeout(s,300))},b=G=>{setTimeout(d,1)};document.body.addEventListener("mouseup",b),document.body.addEventListener("keyup",b);let r=G=>{r._el.innerHTML=G;let p=r._el.children[0];return document.body.appendChild(p),p};r._el=document.createElement("div"),r(`<style>${C}</style>`);let m=r(I),u=new Vue({el:m,data:{tags:[],show:!1,loading:!1,top:0,left:0},methods:{submitTran:o,transArrange:t}});return{guess:e,submitTran:o,transArrange:t}})(`
<div class="nbnhhsh-box nbnhhsh-box-pop" v-if="show" :style="{top:top+'px',left:left+'px'}" @mousedown.prevent>
	<div class="nbnhhsh-loading" v-if="loading">
		\u52A0\u8F7D\u4E2D\u2026
	</div>
	<div class="nbnhhsh-tag-list" v-else-if="tags.length">
		<div class="nbnhhsh-tag-item" v-for="tag in tags">
			<h4>{{tag.name}}</h4>
			<div class="nbnhhsh-tran-list" v-if="tag.trans">
				<span class="nbnhhsh-tran-item" v-for="tran in transArrange(tag.trans)">
					{{tran.text}}<sub v-if="tran.sub">{{tran.sub}}</sub>
				</span>
			</div>
			<div class="nbnhhsh-notran-box" v-else-if="tag.trans===null">
				\u65E0\u5BF9\u5E94\u6587\u5B57
			</div>
			<div v-else-if="tag.inputting && tag.inputting.length !==0">
				<div class="nbnhhsh-inputting-list">
					<h5>\u6709\u53EF\u80FD\u662F</h5>
					<span class="nbnhhsh-inputting-item" v-for="input in tag.inputting">{{input}}</span>
				</div>
			</div>
			<div class="nbnhhsh-notran-box" v-else @click.prevent="submitTran(tag.name)">
				\u5C1A\u672A\u5F55\u5165\uFF0C\u6211\u6765\u63D0\u4EA4\u5BF9\u5E94\u6587\u5B57
			</div>
			<a v-if="tag.trans!==null" @click.prevent="submitTran(tag.name)" class="nbnhhsh-add-btn" title="\u6211\u6765\u63D0\u4EA4\u5BF9\u5E94\u6587\u5B57"></a>
		</div>
	</div>
</div>
`,`
.nbnhhsh-box{
	font:400 14px/1.4 sans-serif;
	color:#333;
}
.nbnhhsh-box-pop{
	position: absolute;
	z-index:99999999999;
	width: 340px;
	background:#FFF;
	box-shadow: 0 3px 30px -4px rgba(0,0,0,.3);
	margin: 10px 0 100px 0;
}
.nbnhhsh-box-pop::before{
	content: '';
	position: absolute;
	top:-7px;
	left:8px;
	width: 0;
	height: 0;
	border:7px solid transparent;

	border-top:1px;
	border-bottom-color:#FFF;
}
.nbnhhsh-box sub{
	vertical-align: middle;
	
	background: rgba(0,0,0,.07);
	color: #777;
	font-size: 12px;
	line-height:16px;
	display: inline-block;
	padding: 0 3px;
	margin:-2px 0 0 2px;
	border-radius: 2px;
	letter-spacing: -0.6px;
	bottom:0;
}
.nbnhhsh-tag-list{
	/*padding:4px 0;*/
}
.nbnhhsh-tag-item{
	padding:4px 14px;
	position: relative;
}
.nbnhhsh-tag-item:nth-child(even){
	background: rgba(0, 99, 255, 0.06);
}
.nbnhhsh-tag-item h4{
	font-weight:bold;
	font-size:20px;
	line-height:28px;
	letter-spacing: 1.5px;
	margin:0;
}
.nbnhhsh-tran-list{
	color:#444;
	padding: 0 0 4px 0;
	line-height:18px;
}
.nbnhhsh-tran-item{
	display: inline-block;
	padding: 2px 15px 2px 0;
}

.nbnhhsh-inputting-list{
	color:#222;
	padding: 0 0 4px 0;
}
.nbnhhsh-inputting-list h5{
	font-size:12px;
	line-height:24px;
	color:#999;
	margin:0;
}
.nbnhhsh-inputting-item{
	margin-right:14px;
	display:inline-block;
}
.nbnhhsh-notran-box{
	padding:4px 0;
	color:#999;
	cursor: pointer;
}
.nbnhhsh-add-btn{
	position: absolute;
	top:0;
	right:0;
	width: 30px;
	line-height: 30px;
	text-align: center;
	color: #0059ff;
	font-size: 16px;
	font-weight: bold;
	cursor: pointer;
}
.nbnhhsh-add-btn:after{
	content: '+';
}
.nbnhhsh-loading{
	text-align: center;
	color:#999;
	padding:20px 0;
}
`)});eg.reg("/","walineBenben",()=>{location.pathname==="/"&&(GM_addStyle(GM_getResourceText("css")),setTimeout(()=>{let g=document.querySelectorAll(".lg-article")[9],I=`<div class="lg-article">
                    <ul class="am-nav am-nav-pills am-nav-justify" id="home-center-nav">
                        <li class="feed-selector" data-mode="waline" id="openWaline"><a style="cursor: pointer">\u533F\u540D\u7287\u7287</a></li>
                        <li class="feed-selector" data-mode="livestream" id="openLivestream"><a style="cursor: pointer">OIso \u76F4\u64AD\u95F4</a></li>
                    </ul>
                </div>`;g.insertAdjacentHTML("afterend",I),document.querySelector("#openWaline").addEventListener("click",()=>{document.getElementsByClassName("feed-selector")[0].classList.remove("am-active"),document.getElementsByClassName("feed-selector")[1].classList.remove("am-active"),document.getElementsByClassName("feed-selector")[2].setAttribute("class","feed-selector am-active"),document.getElementsByClassName("feed-selector")[3].classList.remove("am-active"),fA({el:"#feed",serverURL:"https://waline.oiso.cf",path:"/",dark:"auto"})}),document.querySelector("#openLivestream").addEventListener("click",()=>{document.getElementsByClassName("feed-selector")[0].classList.remove("am-active"),document.getElementsByClassName("feed-selector")[1].classList.remove("am-active"),document.getElementsByClassName("feed-selector")[3].setAttribute("class","feed-selector am-active"),document.getElementsByClassName("feed-selector")[2].classList.remove("am-active"),document.getElementById("feed").innerHTML="loading...",_l("https://online.oiso.cf/live/list").then(C=>{let A=C.data;console.log(A);let l="https://www.oiso.cf/img/fishing.flv";A.data&&(l=A.data[0].flv),document.getElementById("feed").classList.add("flvplayer-app"),yg("flvUrl",l);let i="LyogZXNsaW50LWRpc2FibGUgKi8KIWZ1bmN0aW9uKGUsIHQpIHsKICAib2JqZWN0IiA9PSB0eXBlb2YgZXhwb3J0cyAmJiAib2JqZWN0IiA9PSB0eXBlb2YgbW9kdWxlID8gbW9kdWxlLmV4cG9ydHMgPSB0KCkgOiAiZnVuY3Rpb24iID09IHR5cGVvZiBkZWZpbmUgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShbXSwgdCkgOiAib2JqZWN0IiA9PSB0eXBlb2YgZXhwb3J0cyA/IGV4cG9ydHMubXBlZ3RzID0gdCgpIDogZS5tcGVndHMgPSB0KCkKfSh3aW5kb3csIChmdW5jdGlvbigpIHsKICByZXR1cm4gZnVuY3Rpb24oZSkgewogICAgICB2YXIgdCA9IHt9OwogICAgICBmdW5jdGlvbiBpKG4pIHsKICAgICAgICAgIGlmICh0W25dKQogICAgICAgICAgICAgIHJldHVybiB0W25dLmV4cG9ydHM7CiAgICAgICAgICB2YXIgciA9IHRbbl0gPSB7CiAgICAgICAgICAgICAgaTogbiwKICAgICAgICAgICAgICBsOiAhMSwKICAgICAgICAgICAgICBleHBvcnRzOiB7fQogICAgICAgICAgfTsKICAgICAgICAgIHJldHVybiBlW25dLmNhbGwoci5leHBvcnRzLCByLCByLmV4cG9ydHMsIGkpLAogICAgICAgICAgci5sID0gITAsCiAgICAgICAgICByLmV4cG9ydHMKICAgICAgfQogICAgICByZXR1cm4gaS5tID0gZSwKICAgICAgaS5jID0gdCwKICAgICAgaS5kID0gZnVuY3Rpb24oZSwgdCwgbikgewogICAgICAgICAgaS5vKGUsIHQpIHx8IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCB0LCB7CiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITAsCiAgICAgICAgICAgICAgZ2V0OiBuCiAgICAgICAgICB9KQogICAgICB9CiAgICAgICwKICAgICAgaS5yID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBTeW1ib2wudG9TdHJpbmdUYWcgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIFN5bWJvbC50b1N0cmluZ1RhZywgewogICAgICAgICAgICAgIHZhbHVlOiAiTW9kdWxlIgogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgIl9fZXNNb2R1bGUiLCB7CiAgICAgICAgICAgICAgdmFsdWU6ICEwCiAgICAgICAgICB9KQogICAgICB9CiAgICAgICwKICAgICAgaS50ID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgaWYgKDEgJiB0ICYmIChlID0gaShlKSksCiAgICAgICAgICA4ICYgdCkKICAgICAgICAgICAgICByZXR1cm4gZTsKICAgICAgICAgIGlmICg0ICYgdCAmJiAib2JqZWN0IiA9PSB0eXBlb2YgZSAmJiBlICYmIGUuX19lc01vZHVsZSkKICAgICAgICAgICAgICByZXR1cm4gZTsKICAgICAgICAgIHZhciBuID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgIGlmIChpLnIobiksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobiwgImRlZmF1bHQiLCB7CiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITAsCiAgICAgICAgICAgICAgdmFsdWU6IGUKICAgICAgICAgIH0pLAogICAgICAgICAgMiAmIHQgJiYgInN0cmluZyIgIT0gdHlwZW9mIGUpCiAgICAgICAgICAgICAgZm9yICh2YXIgciBpbiBlKQogICAgICAgICAgICAgICAgICBpLmQobiwgciwgZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVbdF0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAuYmluZChudWxsLCByKSk7CiAgICAgICAgICByZXR1cm4gbgogICAgICB9CiAgICAgICwKICAgICAgaS5uID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgdmFyIHQgPSBlICYmIGUuX19lc01vZHVsZSA/IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiBlLmRlZmF1bHQKICAgICAgICAgIH0KICAgICAgICAgIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUKICAgICAgICAgIH0KICAgICAgICAgIDsKICAgICAgICAgIHJldHVybiBpLmQodCwgImEiLCB0KSwKICAgICAgICAgIHQKICAgICAgfQogICAgICAsCiAgICAgIGkubyA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkKICAgICAgfQogICAgICAsCiAgICAgIGkucCA9ICIiLAogICAgICBpKGkucyA9IDE0KQogIH0oW2Z1bmN0aW9uKGUsIHQsIGkpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IGkoNikKICAgICAgICAsIHIgPSBpLm4obikKICAgICAgICAsIHMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGZ1bmN0aW9uIGUoKSB7fQogICAgICAgICAgcmV0dXJuIGUuZSA9IGZ1bmN0aW9uKHQsIGkpIHsKICAgICAgICAgICAgICB0ICYmICFlLkZPUkNFX0dMT0JBTF9UQUcgfHwgKHQgPSBlLkdMT0JBTF9UQUcpOwogICAgICAgICAgICAgIHZhciBuID0gIlsiICsgdCArICJdID4gIiArIGk7CiAgICAgICAgICAgICAgZS5FTkFCTEVfQ0FMTEJBQ0sgJiYgZS5lbWl0dGVyLmVtaXQoImxvZyIsICJlcnJvciIsIG4pLAogICAgICAgICAgICAgIGUuRU5BQkxFX0VSUk9SICYmIChjb25zb2xlLmVycm9yID8gY29uc29sZS5lcnJvcihuKSA6IGNvbnNvbGUud2FybiA/IGNvbnNvbGUud2FybihuKSA6IGNvbnNvbGUubG9nKG4pKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5pID0gZnVuY3Rpb24odCwgaSkgewogICAgICAgICAgICAgIHQgJiYgIWUuRk9SQ0VfR0xPQkFMX1RBRyB8fCAodCA9IGUuR0xPQkFMX1RBRyk7CiAgICAgICAgICAgICAgdmFyIG4gPSAiWyIgKyB0ICsgIl0gPiAiICsgaTsKICAgICAgICAgICAgICBlLkVOQUJMRV9DQUxMQkFDSyAmJiBlLmVtaXR0ZXIuZW1pdCgibG9nIiwgImluZm8iLCBuKSwKICAgICAgICAgICAgICBlLkVOQUJMRV9JTkZPICYmIChjb25zb2xlLmluZm8gPyBjb25zb2xlLmluZm8obikgOiBjb25zb2xlLmxvZyhuKSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUudyA9IGZ1bmN0aW9uKHQsIGkpIHsKICAgICAgICAgICAgICB0ICYmICFlLkZPUkNFX0dMT0JBTF9UQUcgfHwgKHQgPSBlLkdMT0JBTF9UQUcpOwogICAgICAgICAgICAgIHZhciBuID0gIlsiICsgdCArICJdID4gIiArIGk7CiAgICAgICAgICAgICAgZS5FTkFCTEVfQ0FMTEJBQ0sgJiYgZS5lbWl0dGVyLmVtaXQoImxvZyIsICJ3YXJuIiwgbiksCiAgICAgICAgICAgICAgZS5FTkFCTEVfV0FSTiAmJiAoY29uc29sZS53YXJuID8gY29uc29sZS53YXJuKG4pIDogY29uc29sZS5sb2cobikpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLmQgPSBmdW5jdGlvbih0LCBpKSB7CiAgICAgICAgICAgICAgdCAmJiAhZS5GT1JDRV9HTE9CQUxfVEFHIHx8ICh0ID0gZS5HTE9CQUxfVEFHKTsKICAgICAgICAgICAgICB2YXIgbiA9ICJbIiArIHQgKyAiXSA+ICIgKyBpOwogICAgICAgICAgICAgIGUuRU5BQkxFX0NBTExCQUNLICYmIGUuZW1pdHRlci5lbWl0KCJsb2ciLCAiZGVidWciLCBuKSwKICAgICAgICAgICAgICBlLkVOQUJMRV9ERUJVRyAmJiAoY29uc29sZS5kZWJ1ZyA/IGNvbnNvbGUuZGVidWcobikgOiBjb25zb2xlLmxvZyhuKSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUudiA9IGZ1bmN0aW9uKHQsIGkpIHsKICAgICAgICAgICAgICB0ICYmICFlLkZPUkNFX0dMT0JBTF9UQUcgfHwgKHQgPSBlLkdMT0JBTF9UQUcpOwogICAgICAgICAgICAgIHZhciBuID0gIlsiICsgdCArICJdID4gIiArIGk7CiAgICAgICAgICAgICAgZS5FTkFCTEVfQ0FMTEJBQ0sgJiYgZS5lbWl0dGVyLmVtaXQoImxvZyIsICJ2ZXJib3NlIiwgbiksCiAgICAgICAgICAgICAgZS5FTkFCTEVfVkVSQk9TRSAmJiBjb25zb2xlLmxvZyhuKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZQogICAgICB9KCk7CiAgICAgIHMuR0xPQkFMX1RBRyA9ICJtcGVndHMuanMiLAogICAgICBzLkZPUkNFX0dMT0JBTF9UQUcgPSAhMSwKICAgICAgcy5FTkFCTEVfRVJST1IgPSAhMCwKICAgICAgcy5FTkFCTEVfSU5GTyA9ICEwLAogICAgICBzLkVOQUJMRV9XQVJOID0gITAsCiAgICAgIHMuRU5BQkxFX0RFQlVHID0gITAsCiAgICAgIHMuRU5BQkxFX1ZFUkJPU0UgPSAhMCwKICAgICAgcy5FTkFCTEVfQ0FMTEJBQ0sgPSAhMSwKICAgICAgcy5lbWl0dGVyID0gbmV3IHIuYSwKICAgICAgdC5hID0gcwogIH0KICAsIGZ1bmN0aW9uKGUsIHQsIGkpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB0LmEgPSB7CiAgICAgICAgICBJT19FUlJPUjogImlvX2Vycm9yIiwKICAgICAgICAgIERFTVVYX0VSUk9SOiAiZGVtdXhfZXJyb3IiLAogICAgICAgICAgSU5JVF9TRUdNRU5UOiAiaW5pdF9zZWdtZW50IiwKICAgICAgICAgIE1FRElBX1NFR01FTlQ6ICJtZWRpYV9zZWdtZW50IiwKICAgICAgICAgIExPQURJTkdfQ09NUExFVEU6ICJsb2FkaW5nX2NvbXBsZXRlIiwKICAgICAgICAgIFJFQ09WRVJFRF9FQVJMWV9FT0Y6ICJyZWNvdmVyZWRfZWFybHlfZW9mIiwKICAgICAgICAgIE1FRElBX0lORk86ICJtZWRpYV9pbmZvIiwKICAgICAgICAgIE1FVEFEQVRBX0FSUklWRUQ6ICJtZXRhZGF0YV9hcnJpdmVkIiwKICAgICAgICAgIFNDUklQVERBVEFfQVJSSVZFRDogInNjcmlwdGRhdGFfYXJyaXZlZCIsCiAgICAgICAgICBUSU1FRF9JRDNfTUVUQURBVEFfQVJSSVZFRDogInRpbWVkX2lkM19tZXRhZGF0YV9hcnJpdmVkIiwKICAgICAgICAgIFBFU19QUklWQVRFX0RBVEFfREVTQ1JJUFRPUjogInBlc19wcml2YXRlX2RhdGFfZGVzY3JpcHRvciIsCiAgICAgICAgICBQRVNfUFJJVkFURV9EQVRBX0FSUklWRUQ6ICJwZXNfcHJpdmF0ZV9kYXRhX2Fycml2ZWQiLAogICAgICAgICAgU1RBVElTVElDU19JTkZPOiAic3RhdGlzdGljc19pbmZvIiwKICAgICAgICAgIFJFQ09NTUVORF9TRUVLUE9JTlQ6ICJyZWNvbW1lbmRfc2Vla3BvaW50IgogICAgICB9CiAgfQogICwgZnVuY3Rpb24oZSwgdCwgaSkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGkuZCh0LCAiYyIsIChmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiByCiAgICAgIH0KICAgICAgKSksCiAgICAgIGkuZCh0LCAiYiIsIChmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBzCiAgICAgIH0KICAgICAgKSksCiAgICAgIGkuZCh0LCAiYSIsIChmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgICAgKSk7CiAgICAgIHZhciBuID0gaSgzKQogICAgICAgICwgciA9IHsKICAgICAgICAgIGtJZGxlOiAwLAogICAgICAgICAga0Nvbm5lY3Rpbmc6IDEsCiAgICAgICAgICBrQnVmZmVyaW5nOiAyLAogICAgICAgICAga0Vycm9yOiAzLAogICAgICAgICAga0NvbXBsZXRlOiA0CiAgICAgIH0KICAgICAgICAsIHMgPSB7CiAgICAgICAgICBPSzogIk9LIiwKICAgICAgICAgIEVYQ0VQVElPTjogIkV4Y2VwdGlvbiIsCiAgICAgICAgICBIVFRQX1NUQVRVU19DT0RFX0lOVkFMSUQ6ICJIdHRwU3RhdHVzQ29kZUludmFsaWQiLAogICAgICAgICAgQ09OTkVDVElOR19USU1FT1VUOiAiQ29ubmVjdGluZ1RpbWVvdXQiLAogICAgICAgICAgRUFSTFlfRU9GOiAiRWFybHlFb2YiLAogICAgICAgICAgVU5SRUNPVkVSQUJMRV9FQVJMWV9FT0Y6ICJVbnJlY292ZXJhYmxlRWFybHlFb2YiCiAgICAgIH0KICAgICAgICAsIGEgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGZ1bmN0aW9uIGUoZSkgewogICAgICAgICAgICAgIHRoaXMuX3R5cGUgPSBlIHx8ICJ1bmRlZmluZWQiLAogICAgICAgICAgICAgIHRoaXMuX3N0YXR1cyA9IHIua0lkbGUsCiAgICAgICAgICAgICAgdGhpcy5fbmVlZFN0YXNoID0gITEsCiAgICAgICAgICAgICAgdGhpcy5fb25Db250ZW50TGVuZ3RoS25vd24gPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uVVJMUmVkaXJlY3QgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uRGF0YUFycml2YWwgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uRXJyb3IgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uQ29tcGxldGUgPSBudWxsCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX3N0YXR1cyA9IHIua0lkbGUsCiAgICAgICAgICAgICAgdGhpcy5fb25Db250ZW50TGVuZ3RoS25vd24gPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uVVJMUmVkaXJlY3QgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uRGF0YUFycml2YWwgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uRXJyb3IgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uQ29tcGxldGUgPSBudWxsCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5pc1dvcmtpbmcgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RhdHVzID09PSByLmtDb25uZWN0aW5nIHx8IHRoaXMuX3N0YXR1cyA9PT0gci5rQnVmZmVyaW5nCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJ0eXBlIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90eXBlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgInN0YXR1cyIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RhdHVzCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgIm5lZWRTdGFzaEJ1ZmZlciIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbmVlZFN0YXNoCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgIm9uQ29udGVudExlbmd0aEtub3duIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vbkNvbnRlbnRMZW5ndGhLbm93bgogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX29uQ29udGVudExlbmd0aEtub3duID0gZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJvblVSTFJlZGlyZWN0IiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vblVSTFJlZGlyZWN0CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fb25VUkxSZWRpcmVjdCA9IGUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAib25EYXRhQXJyaXZhbCIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb25EYXRhQXJyaXZhbAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX29uRGF0YUFycml2YWwgPSBlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgIm9uRXJyb3IiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29uRXJyb3IKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICB0aGlzLl9vbkVycm9yID0gZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJvbkNvbXBsZXRlIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vbkNvbXBsZXRlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fb25Db21wbGV0ZSA9IGUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgZS5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgbi5jKCJVbmltcGxlbWVudGVkIGFic3RyYWN0IGZ1bmN0aW9uISIpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5hYm9ydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRocm93IG5ldyBuLmMoIlVuaW1wbGVtZW50ZWQgYWJzdHJhY3QgZnVuY3Rpb24hIikKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUKICAgICAgfSgpCiAgfQogICwgZnVuY3Rpb24oZSwgdCwgaSkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGkuZCh0LCAiZCIsIChmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBzCiAgICAgIH0KICAgICAgKSksCiAgICAgIGkuZCh0LCAiYSIsIChmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgICAgKSksCiAgICAgIGkuZCh0LCAiYiIsIChmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBvCiAgICAgIH0KICAgICAgKSksCiAgICAgIGkuZCh0LCAiYyIsIChmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBoCiAgICAgIH0KICAgICAgKSk7CiAgICAgIHZhciBuLCByID0gKG4gPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICByZXR1cm4gKG4gPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgewogICAgICAgICAgICAgIF9fcHJvdG9fXzogW10KICAgICAgICAgIH1pbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICBlLl9fcHJvdG9fXyA9IHQKICAgICAgICAgIH0KICAgICAgICAgIHx8IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHQpCiAgICAgICAgICAgICAgICAgIHQuaGFzT3duUHJvcGVydHkoaSkgJiYgKGVbaV0gPSB0W2ldKQogICAgICAgICAgfQogICAgICAgICAgKShlLCB0KQogICAgICB9CiAgICAgICwKICAgICAgZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgZnVuY3Rpb24gaSgpIHsKICAgICAgICAgICAgICB0aGlzLmNvbnN0cnVjdG9yID0gZQogICAgICAgICAgfQogICAgICAgICAgbihlLCB0KSwKICAgICAgICAgIGUucHJvdG90eXBlID0gbnVsbCA9PT0gdCA/IE9iamVjdC5jcmVhdGUodCkgOiAoaS5wcm90b3R5cGUgPSB0LnByb3RvdHlwZSwKICAgICAgICAgIG5ldyBpKQogICAgICB9CiAgICAgICksIHMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGZ1bmN0aW9uIGUoZSkgewogICAgICAgICAgICAgIHRoaXMuX21lc3NhZ2UgPSBlCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAibmFtZSIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gIlJ1bnRpbWVFeGNlcHRpb24iCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgIm1lc3NhZ2UiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21lc3NhZ2UKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgZS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uYW1lICsgIjogIiArIHRoaXMubWVzc2FnZQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZQogICAgICB9KCksIGEgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICBmdW5jdGlvbiB0KHQpIHsKICAgICAgICAgICAgICByZXR1cm4gZS5jYWxsKHRoaXMsIHQpIHx8IHRoaXMKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByKHQsIGUpLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQucHJvdG90eXBlLCAibmFtZSIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gIklsbGVnYWxTdGF0ZUV4Y2VwdGlvbiIKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgdAogICAgICB9KHMpLCBvID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgZnVuY3Rpb24gdCh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuY2FsbCh0aGlzLCB0KSB8fCB0aGlzCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcih0LCBlKSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LnByb3RvdHlwZSwgIm5hbWUiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICJJbnZhbGlkQXJndW1lbnRFeGNlcHRpb24iCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIHQKICAgICAgfShzKSwgaCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgIGZ1bmN0aW9uIHQodCkgewogICAgICAgICAgICAgIHJldHVybiBlLmNhbGwodGhpcywgdCkgfHwgdGhpcwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHIodCwgZSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodC5wcm90b3R5cGUsICJuYW1lIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAiTm90SW1wbGVtZW50ZWRFeGNlcHRpb24iCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIHQKICAgICAgfShzKQogIH0KICAsIGZ1bmN0aW9uKGUsIHQsIGkpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbiA9IHt9OwogICAgICAhZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgZSA9IHNlbGYubmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpCiAgICAgICAgICAgICwgdCA9IC8oZWRnZSlcLyhbXHcuXSspLy5leGVjKGUpIHx8IC8ob3ByKVtcL10oW1x3Ll0rKS8uZXhlYyhlKSB8fCAvKGNocm9tZSlbIFwvXShbXHcuXSspLy5leGVjKGUpIHx8IC8oaWVtb2JpbGUpW1wvXShbXHcuXSspLy5leGVjKGUpIHx8IC8odmVyc2lvbikoYXBwbGV3ZWJraXQpWyBcL10oW1x3Ll0rKS4qKHNhZmFyaSlbIFwvXShbXHcuXSspLy5leGVjKGUpIHx8IC8od2Via2l0KVsgXC9dKFtcdy5dKykuKih2ZXJzaW9uKVsgXC9dKFtcdy5dKykuKihzYWZhcmkpWyBcL10oW1x3Ll0rKS8uZXhlYyhlKSB8fCAvKHdlYmtpdClbIFwvXShbXHcuXSspLy5leGVjKGUpIHx8IC8ob3BlcmEpKD86Lip2ZXJzaW9ufClbIFwvXShbXHcuXSspLy5leGVjKGUpIHx8IC8obXNpZSkgKFtcdy5dKykvLmV4ZWMoZSkgfHwgZS5pbmRleE9mKCJ0cmlkZW50IikgPj0gMCAmJiAvKHJ2KSg/Ojp8ICkoW1x3Ll0rKS8uZXhlYyhlKSB8fCBlLmluZGV4T2YoImNvbXBhdGlibGUiKSA8IDAgJiYgLyhmaXJlZm94KVsgXC9dKFtcdy5dKykvLmV4ZWMoZSkgfHwgW10KICAgICAgICAgICAgLCBpID0gLyhpcGFkKS8uZXhlYyhlKSB8fCAvKGlwb2QpLy5leGVjKGUpIHx8IC8od2luZG93cyBwaG9uZSkvLmV4ZWMoZSkgfHwgLyhpcGhvbmUpLy5leGVjKGUpIHx8IC8oa2luZGxlKS8uZXhlYyhlKSB8fCAvKGFuZHJvaWQpLy5leGVjKGUpIHx8IC8od2luZG93cykvLmV4ZWMoZSkgfHwgLyhtYWMpLy5leGVjKGUpIHx8IC8obGludXgpLy5leGVjKGUpIHx8IC8oY3JvcykvLmV4ZWMoZSkgfHwgW10KICAgICAgICAgICAgLCByID0gewogICAgICAgICAgICAgIGJyb3dzZXI6IHRbNV0gfHwgdFszXSB8fCB0WzFdIHx8ICIiLAogICAgICAgICAgICAgIHZlcnNpb246IHRbMl0gfHwgdFs0XSB8fCAiMCIsCiAgICAgICAgICAgICAgbWFqb3JWZXJzaW9uOiB0WzRdIHx8IHRbMl0gfHwgIjAiLAogICAgICAgICAgICAgIHBsYXRmb3JtOiBpWzBdIHx8ICIiCiAgICAgICAgICB9CiAgICAgICAgICAgICwgcyA9IHt9OwogICAgICAgICAgaWYgKHIuYnJvd3NlcikgewogICAgICAgICAgICAgIHNbci5icm93c2VyXSA9ICEwOwogICAgICAgICAgICAgIHZhciBhID0gci5tYWpvclZlcnNpb24uc3BsaXQoIi4iKTsKICAgICAgICAgICAgICBzLnZlcnNpb24gPSB7CiAgICAgICAgICAgICAgICAgIG1ham9yOiBwYXJzZUludChyLm1ham9yVmVyc2lvbiwgMTApLAogICAgICAgICAgICAgICAgICBzdHJpbmc6IHIudmVyc2lvbgogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgYS5sZW5ndGggPiAxICYmIChzLnZlcnNpb24ubWlub3IgPSBwYXJzZUludChhWzFdLCAxMCkpLAogICAgICAgICAgICAgIGEubGVuZ3RoID4gMiAmJiAocy52ZXJzaW9uLmJ1aWxkID0gcGFyc2VJbnQoYVsyXSwgMTApKQogICAgICAgICAgfQogICAgICAgICAgaWYgKHIucGxhdGZvcm0gJiYgKHNbci5wbGF0Zm9ybV0gPSAhMCksCiAgICAgICAgICAocy5jaHJvbWUgfHwgcy5vcHIgfHwgcy5zYWZhcmkpICYmIChzLndlYmtpdCA9ICEwKSwKICAgICAgICAgIHMucnYgfHwgcy5pZW1vYmlsZSkgewogICAgICAgICAgICAgIHMucnYgJiYgZGVsZXRlIHMucnY7CiAgICAgICAgICAgICAgci5icm93c2VyID0gIm1zaWUiLAogICAgICAgICAgICAgIHMubXNpZSA9ICEwCiAgICAgICAgICB9CiAgICAgICAgICBpZiAocy5lZGdlKSB7CiAgICAgICAgICAgICAgZGVsZXRlIHMuZWRnZTsKICAgICAgICAgICAgICByLmJyb3dzZXIgPSAibXNlZGdlIiwKICAgICAgICAgICAgICBzLm1zZWRnZSA9ICEwCiAgICAgICAgICB9CiAgICAgICAgICBpZiAocy5vcHIpIHsKICAgICAgICAgICAgICByLmJyb3dzZXIgPSAib3BlcmEiLAogICAgICAgICAgICAgIHMub3BlcmEgPSAhMAogICAgICAgICAgfQogICAgICAgICAgaWYgKHMuc2FmYXJpICYmIHMuYW5kcm9pZCkgewogICAgICAgICAgICAgIHIuYnJvd3NlciA9ICJhbmRyb2lkIiwKICAgICAgICAgICAgICBzLmFuZHJvaWQgPSAhMAogICAgICAgICAgfQogICAgICAgICAgZm9yICh2YXIgbyBpbiBzLm5hbWUgPSByLmJyb3dzZXIsCiAgICAgICAgICBzLnBsYXRmb3JtID0gci5wbGF0Zm9ybSwKICAgICAgICAgIG4pCiAgICAgICAgICAgICAgbi5oYXNPd25Qcm9wZXJ0eShvKSAmJiBkZWxldGUgbltvXTsKICAgICAgICAgIE9iamVjdC5hc3NpZ24obiwgcykKICAgICAgfSgpLAogICAgICB0LmEgPSBuCiAgfQogICwgZnVuY3Rpb24oZSwgdCwgaSkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHQuYSA9IHsKICAgICAgICAgIE9LOiAiT0siLAogICAgICAgICAgRk9STUFUX0VSUk9SOiAiRm9ybWF0RXJyb3IiLAogICAgICAgICAgRk9STUFUX1VOU1VQUE9SVEVEOiAiRm9ybWF0VW5zdXBwb3J0ZWQiLAogICAgICAgICAgQ09ERUNfVU5TVVBQT1JURUQ6ICJDb2RlY1Vuc3VwcG9ydGVkIgogICAgICB9CiAgfQogICwgZnVuY3Rpb24oZSwgdCwgaSkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuLCByID0gIm9iamVjdCIgPT0gdHlwZW9mIFJlZmxlY3QgPyBSZWZsZWN0IDogbnVsbCwgcyA9IHIgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2Ygci5hcHBseSA/IHIuYXBwbHkgOiBmdW5jdGlvbihlLCB0LCBpKSB7CiAgICAgICAgICByZXR1cm4gRnVuY3Rpb24ucHJvdG90eXBlLmFwcGx5LmNhbGwoZSwgdCwgaSkKICAgICAgfQogICAgICA7CiAgICAgIG4gPSByICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIHIub3duS2V5cyA/IHIub3duS2V5cyA6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPyBmdW5jdGlvbihlKSB7CiAgICAgICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoZSkuY29uY2F0KE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSkpCiAgICAgIH0KICAgICAgOiBmdW5jdGlvbihlKSB7CiAgICAgICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoZSkKICAgICAgfQogICAgICA7CiAgICAgIHZhciBhID0gTnVtYmVyLmlzTmFOIHx8IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgIHJldHVybiBlICE9IGUKICAgICAgfQogICAgICA7CiAgICAgIGZ1bmN0aW9uIG8oKSB7CiAgICAgICAgICBvLmluaXQuY2FsbCh0aGlzKQogICAgICB9CiAgICAgIGUuZXhwb3J0cyA9IG8sCiAgICAgIGUuZXhwb3J0cy5vbmNlID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbihpLCBuKSB7CiAgICAgICAgICAgICAgZnVuY3Rpb24gcihpKSB7CiAgICAgICAgICAgICAgICAgIGUucmVtb3ZlTGlzdGVuZXIodCwgcyksCiAgICAgICAgICAgICAgICAgIG4oaSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZnVuY3Rpb24gcygpIHsKICAgICAgICAgICAgICAgICAgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZS5yZW1vdmVMaXN0ZW5lciAmJiBlLnJlbW92ZUxpc3RlbmVyKCJlcnJvciIsIHIpLAogICAgICAgICAgICAgICAgICBpKFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZyhlLCB0LCBzLCB7CiAgICAgICAgICAgICAgICAgIG9uY2U6ICEwCiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgImVycm9yIiAhPT0gdCAmJiBmdW5jdGlvbihlLCB0LCBpKSB7CiAgICAgICAgICAgICAgICAgICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUub24gJiYgZyhlLCAiZXJyb3IiLCB0LCBpKQogICAgICAgICAgICAgIH0oZSwgciwgewogICAgICAgICAgICAgICAgICBvbmNlOiAhMAogICAgICAgICAgICAgIH0pCiAgICAgICAgICB9CiAgICAgICAgICApKQogICAgICB9CiAgICAgICwKICAgICAgby5FdmVudEVtaXR0ZXIgPSBvLAogICAgICBvLnByb3RvdHlwZS5fZXZlbnRzID0gdm9pZCAwLAogICAgICBvLnByb3RvdHlwZS5fZXZlbnRzQ291bnQgPSAwLAogICAgICBvLnByb3RvdHlwZS5fbWF4TGlzdGVuZXJzID0gdm9pZCAwOwogICAgICB2YXIgaCA9IDEwOwogICAgICBmdW5jdGlvbiBkKGUpIHsKICAgICAgICAgIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiBlKQogICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RoZSAibGlzdGVuZXIiIGFyZ3VtZW50IG11c3QgYmUgb2YgdHlwZSBGdW5jdGlvbi4gUmVjZWl2ZWQgdHlwZSAnICsgdHlwZW9mIGUpCiAgICAgIH0KICAgICAgZnVuY3Rpb24gdShlKSB7CiAgICAgICAgICByZXR1cm4gdm9pZCAwID09PSBlLl9tYXhMaXN0ZW5lcnMgPyBvLmRlZmF1bHRNYXhMaXN0ZW5lcnMgOiBlLl9tYXhMaXN0ZW5lcnMKICAgICAgfQogICAgICBmdW5jdGlvbiBfKGUsIHQsIGksIG4pIHsKICAgICAgICAgIHZhciByLCBzLCBhLCBvOwogICAgICAgICAgaWYgKGQoaSksCiAgICAgICAgICB2b2lkIDAgPT09IChzID0gZS5fZXZlbnRzKSA/IChzID0gZS5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKSwKICAgICAgICAgIGUuX2V2ZW50c0NvdW50ID0gMCkgOiAodm9pZCAwICE9PSBzLm5ld0xpc3RlbmVyICYmIChlLmVtaXQoIm5ld0xpc3RlbmVyIiwgdCwgaS5saXN0ZW5lciA/IGkubGlzdGVuZXIgOiBpKSwKICAgICAgICAgIHMgPSBlLl9ldmVudHMpLAogICAgICAgICAgYSA9IHNbdF0pLAogICAgICAgICAgdm9pZCAwID09PSBhKQogICAgICAgICAgICAgIGEgPSBzW3RdID0gaSwKICAgICAgICAgICAgICArK2UuX2V2ZW50c0NvdW50OwogICAgICAgICAgZWxzZSBpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgYSA/IGEgPSBzW3RdID0gbiA/IFtpLCBhXSA6IFthLCBpXSA6IG4gPyBhLnVuc2hpZnQoaSkgOiBhLnB1c2goaSksCiAgICAgICAgICAociA9IHUoZSkpID4gMCAmJiBhLmxlbmd0aCA+IHIgJiYgIWEud2FybmVkKSB7CiAgICAgICAgICAgICAgYS53YXJuZWQgPSAhMDsKICAgICAgICAgICAgICB2YXIgaCA9IG5ldyBFcnJvcigiUG9zc2libGUgRXZlbnRFbWl0dGVyIG1lbW9yeSBsZWFrIGRldGVjdGVkLiAiICsgYS5sZW5ndGggKyAiICIgKyBTdHJpbmcodCkgKyAiIGxpc3RlbmVycyBhZGRlZC4gVXNlIGVtaXR0ZXIuc2V0TWF4TGlzdGVuZXJzKCkgdG8gaW5jcmVhc2UgbGltaXQiKTsKICAgICAgICAgICAgICBoLm5hbWUgPSAiTWF4TGlzdGVuZXJzRXhjZWVkZWRXYXJuaW5nIiwKICAgICAgICAgICAgICBoLmVtaXR0ZXIgPSBlLAogICAgICAgICAgICAgIGgudHlwZSA9IHQsCiAgICAgICAgICAgICAgaC5jb3VudCA9IGEubGVuZ3RoLAogICAgICAgICAgICAgIG8gPSBoLAogICAgICAgICAgICAgIGNvbnNvbGUgJiYgY29uc29sZS53YXJuICYmIGNvbnNvbGUud2FybihvKQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUKICAgICAgfQogICAgICBmdW5jdGlvbiBjKCkgewogICAgICAgICAgaWYgKCF0aGlzLmZpcmVkKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLnRhcmdldC5yZW1vdmVMaXN0ZW5lcih0aGlzLnR5cGUsIHRoaXMud3JhcEZuKSwKICAgICAgICAgICAgICB0aGlzLmZpcmVkID0gITAsCiAgICAgICAgICAgICAgMCA9PT0gYXJndW1lbnRzLmxlbmd0aCA/IHRoaXMubGlzdGVuZXIuY2FsbCh0aGlzLnRhcmdldCkgOiB0aGlzLmxpc3RlbmVyLmFwcGx5KHRoaXMudGFyZ2V0LCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgZnVuY3Rpb24gbChlLCB0LCBpKSB7CiAgICAgICAgICB2YXIgbiA9IHsKICAgICAgICAgICAgICBmaXJlZDogITEsCiAgICAgICAgICAgICAgd3JhcEZuOiB2b2lkIDAsCiAgICAgICAgICAgICAgdGFyZ2V0OiBlLAogICAgICAgICAgICAgIHR5cGU6IHQsCiAgICAgICAgICAgICAgbGlzdGVuZXI6IGkKICAgICAgICAgIH0KICAgICAgICAgICAgLCByID0gYy5iaW5kKG4pOwogICAgICAgICAgcmV0dXJuIHIubGlzdGVuZXIgPSBpLAogICAgICAgICAgbi53cmFwRm4gPSByLAogICAgICAgICAgcgogICAgICB9CiAgICAgIGZ1bmN0aW9uIGYoZSwgdCwgaSkgewogICAgICAgICAgdmFyIG4gPSBlLl9ldmVudHM7CiAgICAgICAgICBpZiAodm9pZCAwID09PSBuKQogICAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICAgIHZhciByID0gblt0XTsKICAgICAgICAgIHJldHVybiB2b2lkIDAgPT09IHIgPyBbXSA6ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHIgPyBpID8gW3IubGlzdGVuZXIgfHwgcl0gOiBbcl0gOiBpID8gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGZvciAodmFyIHQgPSBuZXcgQXJyYXkoZS5sZW5ndGgpLCBpID0gMDsgaSA8IHQubGVuZ3RoOyArK2kpCiAgICAgICAgICAgICAgICAgIHRbaV0gPSBlW2ldLmxpc3RlbmVyIHx8IGVbaV07CiAgICAgICAgICAgICAgcmV0dXJuIHQKICAgICAgICAgIH0ocikgOiBtKHIsIHIubGVuZ3RoKQogICAgICB9CiAgICAgIGZ1bmN0aW9uIHAoZSkgewogICAgICAgICAgdmFyIHQgPSB0aGlzLl9ldmVudHM7CiAgICAgICAgICBpZiAodm9pZCAwICE9PSB0KSB7CiAgICAgICAgICAgICAgdmFyIGkgPSB0W2VdOwogICAgICAgICAgICAgIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBpKQogICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICBpZiAodm9pZCAwICE9PSBpKQogICAgICAgICAgICAgICAgICByZXR1cm4gaS5sZW5ndGgKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAwCiAgICAgIH0KICAgICAgZnVuY3Rpb24gbShlLCB0KSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gbmV3IEFycmF5KHQpLCBuID0gMDsgbiA8IHQ7ICsrbikKICAgICAgICAgICAgICBpW25dID0gZVtuXTsKICAgICAgICAgIHJldHVybiBpCiAgICAgIH0KICAgICAgZnVuY3Rpb24gZyhlLCB0LCBpLCBuKSB7CiAgICAgICAgICBpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgZS5vbikKICAgICAgICAgICAgICBuLm9uY2UgPyBlLm9uY2UodCwgaSkgOiBlLm9uKHQsIGkpOwogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIGUuYWRkRXZlbnRMaXN0ZW5lcikKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlICJlbWl0dGVyIiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgRXZlbnRFbWl0dGVyLiBSZWNlaXZlZCB0eXBlICcgKyB0eXBlb2YgZSk7CiAgICAgICAgICAgICAgZS5hZGRFdmVudExpc3RlbmVyKHQsIChmdW5jdGlvbiByKHMpIHsKICAgICAgICAgICAgICAgICAgbi5vbmNlICYmIGUucmVtb3ZlRXZlbnRMaXN0ZW5lcih0LCByKSwKICAgICAgICAgICAgICAgICAgaShzKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKQogICAgICAgICAgfQogICAgICB9CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCAiZGVmYXVsdE1heExpc3RlbmVycyIsIHsKICAgICAgICAgIGVudW1lcmFibGU6ICEwLAogICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gaAogICAgICAgICAgfSwKICAgICAgICAgIHNldDogZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGlmICgibnVtYmVyIiAhPSB0eXBlb2YgZSB8fCBlIDwgMCB8fCBhKGUpKQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignVGhlIHZhbHVlIG9mICJkZWZhdWx0TWF4TGlzdGVuZXJzIiBpcyBvdXQgb2YgcmFuZ2UuIEl0IG11c3QgYmUgYSBub24tbmVnYXRpdmUgbnVtYmVyLiBSZWNlaXZlZCAnICsgZSArICIuIik7CiAgICAgICAgICAgICAgaCA9IGUKICAgICAgICAgIH0KICAgICAgfSksCiAgICAgIG8uaW5pdCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdm9pZCAwICE9PSB0aGlzLl9ldmVudHMgJiYgdGhpcy5fZXZlbnRzICE9PSBPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcykuX2V2ZW50cyB8fCAodGhpcy5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKSwKICAgICAgICAgIHRoaXMuX2V2ZW50c0NvdW50ID0gMCksCiAgICAgICAgICB0aGlzLl9tYXhMaXN0ZW5lcnMgPSB0aGlzLl9tYXhMaXN0ZW5lcnMgfHwgdm9pZCAwCiAgICAgIH0KICAgICAgLAogICAgICBvLnByb3RvdHlwZS5zZXRNYXhMaXN0ZW5lcnMgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICBpZiAoIm51bWJlciIgIT0gdHlwZW9mIGUgfHwgZSA8IDAgfHwgYShlKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignVGhlIHZhbHVlIG9mICJuIiBpcyBvdXQgb2YgcmFuZ2UuIEl0IG11c3QgYmUgYSBub24tbmVnYXRpdmUgbnVtYmVyLiBSZWNlaXZlZCAnICsgZSArICIuIik7CiAgICAgICAgICByZXR1cm4gdGhpcy5fbWF4TGlzdGVuZXJzID0gZSwKICAgICAgICAgIHRoaXMKICAgICAgfQogICAgICAsCiAgICAgIG8ucHJvdG90eXBlLmdldE1heExpc3RlbmVycyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHUodGhpcykKICAgICAgfQogICAgICAsCiAgICAgIG8ucHJvdG90eXBlLmVtaXQgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICBmb3IgKHZhciB0ID0gW10sIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgIHQucHVzaChhcmd1bWVudHNbaV0pOwogICAgICAgICAgdmFyIG4gPSAiZXJyb3IiID09PSBlCiAgICAgICAgICAgICwgciA9IHRoaXMuX2V2ZW50czsKICAgICAgICAgIGlmICh2b2lkIDAgIT09IHIpCiAgICAgICAgICAgICAgbiA9IG4gJiYgdm9pZCAwID09PSByLmVycm9yOwogICAgICAgICAgZWxzZSBpZiAoIW4pCiAgICAgICAgICAgICAgcmV0dXJuICExOwogICAgICAgICAgaWYgKG4pIHsKICAgICAgICAgICAgICB2YXIgYTsKICAgICAgICAgICAgICBpZiAodC5sZW5ndGggPiAwICYmIChhID0gdFswXSksCiAgICAgICAgICAgICAgYSBpbnN0YW5jZW9mIEVycm9yKQogICAgICAgICAgICAgICAgICB0aHJvdyBhOwogICAgICAgICAgICAgIHZhciBvID0gbmV3IEVycm9yKCJVbmhhbmRsZWQgZXJyb3IuIiArIChhID8gIiAoIiArIGEubWVzc2FnZSArICIpIiA6ICIiKSk7CiAgICAgICAgICAgICAgdGhyb3cgby5jb250ZXh0ID0gYSwKICAgICAgICAgICAgICBvCiAgICAgICAgICB9CiAgICAgICAgICB2YXIgaCA9IHJbZV07CiAgICAgICAgICBpZiAodm9pZCAwID09PSBoKQogICAgICAgICAgICAgIHJldHVybiAhMTsKICAgICAgICAgIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBoKQogICAgICAgICAgICAgIHMoaCwgdGhpcywgdCk7CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICB2YXIgZCA9IGgubGVuZ3RoCiAgICAgICAgICAgICAgICAsIHUgPSBtKGgsIGQpOwogICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBkOyArK2kpCiAgICAgICAgICAgICAgICAgIHModVtpXSwgdGhpcywgdCkKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAhMAogICAgICB9CiAgICAgICwKICAgICAgby5wcm90b3R5cGUuYWRkTGlzdGVuZXIgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICByZXR1cm4gXyh0aGlzLCBlLCB0LCAhMSkKICAgICAgfQogICAgICAsCiAgICAgIG8ucHJvdG90eXBlLm9uID0gby5wcm90b3R5cGUuYWRkTGlzdGVuZXIsCiAgICAgIG8ucHJvdG90eXBlLnByZXBlbmRMaXN0ZW5lciA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgIHJldHVybiBfKHRoaXMsIGUsIHQsICEwKQogICAgICB9CiAgICAgICwKICAgICAgby5wcm90b3R5cGUub25jZSA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgIHJldHVybiBkKHQpLAogICAgICAgICAgdGhpcy5vbihlLCBsKHRoaXMsIGUsIHQpKSwKICAgICAgICAgIHRoaXMKICAgICAgfQogICAgICAsCiAgICAgIG8ucHJvdG90eXBlLnByZXBlbmRPbmNlTGlzdGVuZXIgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICByZXR1cm4gZCh0KSwKICAgICAgICAgIHRoaXMucHJlcGVuZExpc3RlbmVyKGUsIGwodGhpcywgZSwgdCkpLAogICAgICAgICAgdGhpcwogICAgICB9CiAgICAgICwKICAgICAgby5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICB2YXIgaSwgbiwgciwgcywgYTsKICAgICAgICAgIGlmIChkKHQpLAogICAgICAgICAgdm9pZCAwID09PSAobiA9IHRoaXMuX2V2ZW50cykpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICBpZiAodm9pZCAwID09PSAoaSA9IG5bZV0pKQogICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgaWYgKGkgPT09IHQgfHwgaS5saXN0ZW5lciA9PT0gdCkKICAgICAgICAgICAgICAwID09IC0tdGhpcy5fZXZlbnRzQ291bnQgPyB0aGlzLl9ldmVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpIDogKGRlbGV0ZSBuW2VdLAogICAgICAgICAgICAgIG4ucmVtb3ZlTGlzdGVuZXIgJiYgdGhpcy5lbWl0KCJyZW1vdmVMaXN0ZW5lciIsIGUsIGkubGlzdGVuZXIgfHwgdCkpOwogICAgICAgICAgZWxzZSBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgaSkgewogICAgICAgICAgICAgIGZvciAociA9IC0xLAogICAgICAgICAgICAgIHMgPSBpLmxlbmd0aCAtIDE7IHMgPj0gMDsgcy0tKQogICAgICAgICAgICAgICAgICBpZiAoaVtzXSA9PT0gdCB8fCBpW3NdLmxpc3RlbmVyID09PSB0KSB7CiAgICAgICAgICAgICAgICAgICAgICBhID0gaVtzXS5saXN0ZW5lciwKICAgICAgICAgICAgICAgICAgICAgIHIgPSBzOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChyIDwgMCkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgMCA9PT0gciA/IGkuc2hpZnQoKSA6IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICAgICAgZm9yICg7IHQgKyAxIDwgZS5sZW5ndGg7IHQrKykKICAgICAgICAgICAgICAgICAgICAgIGVbdF0gPSBlW3QgKyAxXTsKICAgICAgICAgICAgICAgICAgZS5wb3AoKQogICAgICAgICAgICAgIH0oaSwgciksCiAgICAgICAgICAgICAgMSA9PT0gaS5sZW5ndGggJiYgKG5bZV0gPSBpWzBdKSwKICAgICAgICAgICAgICB2b2lkIDAgIT09IG4ucmVtb3ZlTGlzdGVuZXIgJiYgdGhpcy5lbWl0KCJyZW1vdmVMaXN0ZW5lciIsIGUsIGEgfHwgdCkKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgLAogICAgICBvLnByb3RvdHlwZS5vZmYgPSBvLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lciwKICAgICAgby5wcm90b3R5cGUucmVtb3ZlQWxsTGlzdGVuZXJzID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgdmFyIHQsIGksIG47CiAgICAgICAgICBpZiAodm9pZCAwID09PSAoaSA9IHRoaXMuX2V2ZW50cykpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICBpZiAodm9pZCAwID09PSBpLnJlbW92ZUxpc3RlbmVyKQogICAgICAgICAgICAgIHJldHVybiAwID09PSBhcmd1bWVudHMubGVuZ3RoID8gKHRoaXMuX2V2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCksCiAgICAgICAgICAgICAgdGhpcy5fZXZlbnRzQ291bnQgPSAwKSA6IHZvaWQgMCAhPT0gaVtlXSAmJiAoMCA9PSAtLXRoaXMuX2V2ZW50c0NvdW50ID8gdGhpcy5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKSA6IGRlbGV0ZSBpW2VdKSwKICAgICAgICAgICAgICB0aGlzOwogICAgICAgICAgaWYgKDAgPT09IGFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgICAgICAgICB2YXIgciwgcyA9IE9iamVjdC5rZXlzKGkpOwogICAgICAgICAgICAgIGZvciAobiA9IDA7IG4gPCBzLmxlbmd0aDsgKytuKQogICAgICAgICAgICAgICAgICAicmVtb3ZlTGlzdGVuZXIiICE9PSAociA9IHNbbl0pICYmIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKHIpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbW92ZUFsbExpc3RlbmVycygicmVtb3ZlTGlzdGVuZXIiKSwKICAgICAgICAgICAgICB0aGlzLl9ldmVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpLAogICAgICAgICAgICAgIHRoaXMuX2V2ZW50c0NvdW50ID0gMCwKICAgICAgICAgICAgICB0aGlzCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKHQgPSBpW2VdKSkKICAgICAgICAgICAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKGUsIHQpOwogICAgICAgICAgZWxzZSBpZiAodm9pZCAwICE9PSB0KQogICAgICAgICAgICAgIGZvciAobiA9IHQubGVuZ3RoIC0gMTsgbiA+PSAwOyBuLS0pCiAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIoZSwgdFtuXSk7CiAgICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgICwKICAgICAgby5wcm90b3R5cGUubGlzdGVuZXJzID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgcmV0dXJuIGYodGhpcywgZSwgITApCiAgICAgIH0KICAgICAgLAogICAgICBvLnByb3RvdHlwZS5yYXdMaXN0ZW5lcnMgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICByZXR1cm4gZih0aGlzLCBlLCAhMSkKICAgICAgfQogICAgICAsCiAgICAgIG8ubGlzdGVuZXJDb3VudCA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgIHJldHVybiAiZnVuY3Rpb24iID09IHR5cGVvZiBlLmxpc3RlbmVyQ291bnQgPyBlLmxpc3RlbmVyQ291bnQodCkgOiBwLmNhbGwoZSwgdCkKICAgICAgfQogICAgICAsCiAgICAgIG8ucHJvdG90eXBlLmxpc3RlbmVyQ291bnQgPSBwLAogICAgICBvLnByb3RvdHlwZS5ldmVudE5hbWVzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRzQ291bnQgPiAwID8gbih0aGlzLl9ldmVudHMpIDogW10KICAgICAgfQogIH0KICAsIGZ1bmN0aW9uKGUsIHQsIGkpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBpLmQodCwgImQiLCAoZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gbgogICAgICB9CiAgICAgICkpLAogICAgICBpLmQodCwgImIiLCAoZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gcgogICAgICB9CiAgICAgICkpLAogICAgICBpLmQodCwgImEiLCAoZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gcwogICAgICB9CiAgICAgICkpLAogICAgICBpLmQodCwgImMiLCAoZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgICkpOwogICAgICB2YXIgbiA9IGZ1bmN0aW9uKGUsIHQsIGksIG4sIHIpIHsKICAgICAgICAgIHRoaXMuZHRzID0gZSwKICAgICAgICAgIHRoaXMucHRzID0gdCwKICAgICAgICAgIHRoaXMuZHVyYXRpb24gPSBpLAogICAgICAgICAgdGhpcy5vcmlnaW5hbER0cyA9IG4sCiAgICAgICAgICB0aGlzLmlzU3luY1BvaW50ID0gciwKICAgICAgICAgIHRoaXMuZmlsZXBvc2l0aW9uID0gbnVsbAogICAgICB9CiAgICAgICAgLCByID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBmdW5jdGlvbiBlKCkgewogICAgICAgICAgICAgIHRoaXMuYmVnaW5EdHMgPSAwLAogICAgICAgICAgICAgIHRoaXMuZW5kRHRzID0gMCwKICAgICAgICAgICAgICB0aGlzLmJlZ2luUHRzID0gMCwKICAgICAgICAgICAgICB0aGlzLmVuZFB0cyA9IDAsCiAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbEJlZ2luRHRzID0gMCwKICAgICAgICAgICAgICB0aGlzLm9yaWdpbmFsRW5kRHRzID0gMCwKICAgICAgICAgICAgICB0aGlzLnN5bmNQb2ludHMgPSBbXSwKICAgICAgICAgICAgICB0aGlzLmZpcnN0U2FtcGxlID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLmxhc3RTYW1wbGUgPSBudWxsCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZS5wcm90b3R5cGUuYXBwZW5kU3luY1BvaW50ID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGUuaXNTeW5jUG9pbnQgPSAhMCwKICAgICAgICAgICAgICB0aGlzLnN5bmNQb2ludHMucHVzaChlKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZQogICAgICB9KCkKICAgICAgICAsIHMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGZ1bmN0aW9uIGUoKSB7CiAgICAgICAgICAgICAgdGhpcy5fbGlzdCA9IFtdCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZS5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0aGlzLl9saXN0ID0gW10KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLmFwcGVuZEFycmF5ID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHZhciB0ID0gdGhpcy5fbGlzdDsKICAgICAgICAgICAgICAwICE9PSBlLmxlbmd0aCAmJiAodC5sZW5ndGggPiAwICYmIGVbMF0ub3JpZ2luYWxEdHMgPCB0W3QubGVuZ3RoIC0gMV0ub3JpZ2luYWxEdHMgJiYgdGhpcy5jbGVhcigpLAogICAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHQsIGUpKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuZ2V0TGFzdFN5bmNQb2ludEJlZm9yZUR0cyA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBpZiAoMCA9PSB0aGlzLl9saXN0Lmxlbmd0aCkKICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLl9saXN0CiAgICAgICAgICAgICAgICAsIGkgPSAwCiAgICAgICAgICAgICAgICAsIG4gPSB0Lmxlbmd0aCAtIDEKICAgICAgICAgICAgICAgICwgciA9IDAKICAgICAgICAgICAgICAgICwgcyA9IDAKICAgICAgICAgICAgICAgICwgYSA9IG47CiAgICAgICAgICAgICAgZm9yIChlIDwgdFswXS5kdHMgJiYgKGkgPSAwLAogICAgICAgICAgICAgIHMgPSBhICsgMSk7IHMgPD0gYTsgKSB7CiAgICAgICAgICAgICAgICAgIGlmICgociA9IHMgKyBNYXRoLmZsb29yKChhIC0gcykgLyAyKSkgPT09IG4gfHwgZSA+PSB0W3JdLmR0cyAmJiBlIDwgdFtyICsgMV0uZHRzKSB7CiAgICAgICAgICAgICAgICAgICAgICBpID0gcjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdFtyXS5kdHMgPCBlID8gcyA9IHIgKyAxIDogYSA9IHIgLSAxCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiB0aGlzLl9saXN0W2ldCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlCiAgICAgIH0oKQogICAgICAgICwgYSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgZnVuY3Rpb24gZShlKSB7CiAgICAgICAgICAgICAgdGhpcy5fdHlwZSA9IGUsCiAgICAgICAgICAgICAgdGhpcy5fbGlzdCA9IFtdLAogICAgICAgICAgICAgIHRoaXMuX2xhc3RBcHBlbmRMb2NhdGlvbiA9IC0xCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAidHlwZSIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdHlwZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJsZW5ndGgiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xpc3QubGVuZ3RoCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIGUucHJvdG90eXBlLmlzRW1wdHkgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gMCA9PT0gdGhpcy5fbGlzdC5sZW5ndGgKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5fbGlzdCA9IFtdLAogICAgICAgICAgICAgIHRoaXMuX2xhc3RBcHBlbmRMb2NhdGlvbiA9IC0xCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fc2VhcmNoTmVhcmVzdFNlZ21lbnRCZWZvcmUgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLl9saXN0OwogICAgICAgICAgICAgIGlmICgwID09PSB0Lmxlbmd0aCkKICAgICAgICAgICAgICAgICAgcmV0dXJuIC0yOwogICAgICAgICAgICAgIHZhciBpID0gdC5sZW5ndGggLSAxCiAgICAgICAgICAgICAgICAsIG4gPSAwCiAgICAgICAgICAgICAgICAsIHIgPSAwCiAgICAgICAgICAgICAgICAsIHMgPSBpCiAgICAgICAgICAgICAgICAsIGEgPSAwOwogICAgICAgICAgICAgIGlmIChlIDwgdFswXS5vcmlnaW5hbEJlZ2luRHRzKQogICAgICAgICAgICAgICAgICByZXR1cm4gYSA9IC0xOwogICAgICAgICAgICAgIGZvciAoOyByIDw9IHM7ICkgewogICAgICAgICAgICAgICAgICBpZiAoKG4gPSByICsgTWF0aC5mbG9vcigocyAtIHIpIC8gMikpID09PSBpIHx8IGUgPiB0W25dLmxhc3RTYW1wbGUub3JpZ2luYWxEdHMgJiYgZSA8IHRbbiArIDFdLm9yaWdpbmFsQmVnaW5EdHMpIHsKICAgICAgICAgICAgICAgICAgICAgIGEgPSBuOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0W25dLm9yaWdpbmFsQmVnaW5EdHMgPCBlID8gciA9IG4gKyAxIDogcyA9IG4gLSAxCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fc2VhcmNoTmVhcmVzdFNlZ21lbnRBZnRlciA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2VhcmNoTmVhcmVzdFNlZ21lbnRCZWZvcmUoZSkgKyAxCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5hcHBlbmQgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLl9saXN0CiAgICAgICAgICAgICAgICAsIGkgPSBlCiAgICAgICAgICAgICAgICAsIG4gPSB0aGlzLl9sYXN0QXBwZW5kTG9jYXRpb24KICAgICAgICAgICAgICAgICwgciA9IDA7CiAgICAgICAgICAgICAgLTEgIT09IG4gJiYgbiA8IHQubGVuZ3RoICYmIGkub3JpZ2luYWxCZWdpbkR0cyA+PSB0W25dLmxhc3RTYW1wbGUub3JpZ2luYWxEdHMgJiYgKG4gPT09IHQubGVuZ3RoIC0gMSB8fCBuIDwgdC5sZW5ndGggLSAxICYmIGkub3JpZ2luYWxCZWdpbkR0cyA8IHRbbiArIDFdLm9yaWdpbmFsQmVnaW5EdHMpID8gciA9IG4gKyAxIDogdC5sZW5ndGggPiAwICYmIChyID0gdGhpcy5fc2VhcmNoTmVhcmVzdFNlZ21lbnRCZWZvcmUoaS5vcmlnaW5hbEJlZ2luRHRzKSArIDEpLAogICAgICAgICAgICAgIHRoaXMuX2xhc3RBcHBlbmRMb2NhdGlvbiA9IHIsCiAgICAgICAgICAgICAgdGhpcy5fbGlzdC5zcGxpY2UociwgMCwgaSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLmdldExhc3RTZWdtZW50QmVmb3JlID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHZhciB0ID0gdGhpcy5fc2VhcmNoTmVhcmVzdFNlZ21lbnRCZWZvcmUoZSk7CiAgICAgICAgICAgICAgcmV0dXJuIHQgPj0gMCA/IHRoaXMuX2xpc3RbdF0gOiBudWxsCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5nZXRMYXN0U2FtcGxlQmVmb3JlID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHZhciB0ID0gdGhpcy5nZXRMYXN0U2VnbWVudEJlZm9yZShlKTsKICAgICAgICAgICAgICByZXR1cm4gbnVsbCAhPSB0ID8gdC5sYXN0U2FtcGxlIDogbnVsbAogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuZ2V0TGFzdFN5bmNQb2ludEJlZm9yZSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBmb3IgKHZhciB0ID0gdGhpcy5fc2VhcmNoTmVhcmVzdFNlZ21lbnRCZWZvcmUoZSksIGkgPSB0aGlzLl9saXN0W3RdLnN5bmNQb2ludHM7IDAgPT09IGkubGVuZ3RoICYmIHQgPiAwOyApCiAgICAgICAgICAgICAgICAgIHQtLSwKICAgICAgICAgICAgICAgICAgaSA9IHRoaXMuX2xpc3RbdF0uc3luY1BvaW50czsKICAgICAgICAgICAgICByZXR1cm4gaS5sZW5ndGggPiAwID8gaVtpLmxlbmd0aCAtIDFdIDogbnVsbAogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZQogICAgICB9KCkKICB9CiAgLCBmdW5jdGlvbihlLCB0LCBpKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG4gPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGZ1bmN0aW9uIGUoKSB7CiAgICAgICAgICAgICAgdGhpcy5taW1lVHlwZSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5kdXJhdGlvbiA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5oYXNBdWRpbyA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5oYXNWaWRlbyA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5hdWRpb0NvZGVjID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLnZpZGVvQ29kZWMgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuYXVkaW9EYXRhUmF0ZSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy52aWRlb0RhdGFSYXRlID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLmF1ZGlvU2FtcGxlUmF0ZSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5hdWRpb0NoYW5uZWxDb3VudCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy53aWR0aCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuZnBzID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLnByb2ZpbGUgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMubGV2ZWwgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMucmVmRnJhbWVzID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLmNocm9tYUZvcm1hdCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5zYXJOdW0gPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuc2FyRGVuID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLm1ldGFkYXRhID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLnNlZ21lbnRzID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLnNlZ21lbnRDb3VudCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5oYXNLZXlmcmFtZXNJbmRleCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5rZXlmcmFtZXNJbmRleCA9IG51bGwKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBlLnByb3RvdHlwZS5pc0NvbXBsZXRlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdmFyIGUgPSAhMSA9PT0gdGhpcy5oYXNBdWRpbyB8fCAhMCA9PT0gdGhpcy5oYXNBdWRpbyAmJiBudWxsICE9IHRoaXMuYXVkaW9Db2RlYyAmJiBudWxsICE9IHRoaXMuYXVkaW9TYW1wbGVSYXRlICYmIG51bGwgIT0gdGhpcy5hdWRpb0NoYW5uZWxDb3VudAogICAgICAgICAgICAgICAgLCB0ID0gITEgPT09IHRoaXMuaGFzVmlkZW8gfHwgITAgPT09IHRoaXMuaGFzVmlkZW8gJiYgbnVsbCAhPSB0aGlzLnZpZGVvQ29kZWMgJiYgbnVsbCAhPSB0aGlzLndpZHRoICYmIG51bGwgIT0gdGhpcy5oZWlnaHQgJiYgbnVsbCAhPSB0aGlzLmZwcyAmJiBudWxsICE9IHRoaXMucHJvZmlsZSAmJiBudWxsICE9IHRoaXMubGV2ZWwgJiYgbnVsbCAhPSB0aGlzLnJlZkZyYW1lcyAmJiBudWxsICE9IHRoaXMuY2hyb21hRm9ybWF0ICYmIG51bGwgIT0gdGhpcy5zYXJOdW0gJiYgbnVsbCAhPSB0aGlzLnNhckRlbjsKICAgICAgICAgICAgICByZXR1cm4gbnVsbCAhPSB0aGlzLm1pbWVUeXBlICYmIGUgJiYgdAogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuaXNTZWVrYWJsZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiAhMCA9PT0gdGhpcy5oYXNLZXlmcmFtZXNJbmRleAogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuZ2V0TmVhcmVzdEtleWZyYW1lID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGlmIChudWxsID09IHRoaXMua2V5ZnJhbWVzSW5kZXgpCiAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgIHZhciB0ID0gdGhpcy5rZXlmcmFtZXNJbmRleAogICAgICAgICAgICAgICAgLCBpID0gdGhpcy5fc2VhcmNoKHQudGltZXMsIGUpOwogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgIGluZGV4OiBpLAogICAgICAgICAgICAgICAgICBtaWxsaXNlY29uZHM6IHQudGltZXNbaV0sCiAgICAgICAgICAgICAgICAgIGZpbGVwb3NpdGlvbjogdC5maWxlcG9zaXRpb25zW2ldCiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX3NlYXJjaCA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICB2YXIgaSA9IDAKICAgICAgICAgICAgICAgICwgbiA9IGUubGVuZ3RoIC0gMQogICAgICAgICAgICAgICAgLCByID0gMAogICAgICAgICAgICAgICAgLCBzID0gMAogICAgICAgICAgICAgICAgLCBhID0gbjsKICAgICAgICAgICAgICBmb3IgKHQgPCBlWzBdICYmIChpID0gMCwKICAgICAgICAgICAgICBzID0gYSArIDEpOyBzIDw9IGE7ICkgewogICAgICAgICAgICAgICAgICBpZiAoKHIgPSBzICsgTWF0aC5mbG9vcigoYSAtIHMpIC8gMikpID09PSBuIHx8IHQgPj0gZVtyXSAmJiB0IDwgZVtyICsgMV0pIHsKICAgICAgICAgICAgICAgICAgICAgIGkgPSByOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBlW3JdIDwgdCA/IHMgPSByICsgMSA6IGEgPSByIC0gMQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gaQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZQogICAgICB9KCk7CiAgICAgIHQuYSA9IG4KICB9CiAgLCBmdW5jdGlvbihlLCB0LCBpKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG4gPSBpKDYpCiAgICAgICAgLCByID0gaS5uKG4pCiAgICAgICAgLCBzID0gaSgwKQogICAgICAgICwgYSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgZnVuY3Rpb24gZSgpIHt9CiAgICAgICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsICJmb3JjZUdsb2JhbFRhZyIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gcy5hLkZPUkNFX0dMT0JBTF9UQUcKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNldDogZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgICBzLmEuRk9SQ0VfR0xPQkFMX1RBRyA9IHQsCiAgICAgICAgICAgICAgICAgIGUuX25vdGlmeUNoYW5nZSgpCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCAiZ2xvYmFsVGFnIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBzLmEuR0xPQkFMX1RBRwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICAgIHMuYS5HTE9CQUxfVEFHID0gdCwKICAgICAgICAgICAgICAgICAgZS5fbm90aWZ5Q2hhbmdlKCkKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsICJlbmFibGVBbGwiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHMuYS5FTkFCTEVfVkVSQk9TRSAmJiBzLmEuRU5BQkxFX0RFQlVHICYmIHMuYS5FTkFCTEVfSU5GTyAmJiBzLmEuRU5BQkxFX1dBUk4gJiYgcy5hLkVOQUJMRV9FUlJPUgogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICAgIHMuYS5FTkFCTEVfVkVSQk9TRSA9IHQsCiAgICAgICAgICAgICAgICAgIHMuYS5FTkFCTEVfREVCVUcgPSB0LAogICAgICAgICAgICAgICAgICBzLmEuRU5BQkxFX0lORk8gPSB0LAogICAgICAgICAgICAgICAgICBzLmEuRU5BQkxFX1dBUk4gPSB0LAogICAgICAgICAgICAgICAgICBzLmEuRU5BQkxFX0VSUk9SID0gdCwKICAgICAgICAgICAgICAgICAgZS5fbm90aWZ5Q2hhbmdlKCkKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsICJlbmFibGVEZWJ1ZyIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gcy5hLkVOQUJMRV9ERUJVRwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICAgIHMuYS5FTkFCTEVfREVCVUcgPSB0LAogICAgICAgICAgICAgICAgICBlLl9ub3RpZnlDaGFuZ2UoKQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgImVuYWJsZVZlcmJvc2UiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHMuYS5FTkFCTEVfVkVSQk9TRQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICAgIHMuYS5FTkFCTEVfVkVSQk9TRSA9IHQsCiAgICAgICAgICAgICAgICAgIGUuX25vdGlmeUNoYW5nZSgpCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCAiZW5hYmxlSW5mbyIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gcy5hLkVOQUJMRV9JTkZPCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgcy5hLkVOQUJMRV9JTkZPID0gdCwKICAgICAgICAgICAgICAgICAgZS5fbm90aWZ5Q2hhbmdlKCkKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsICJlbmFibGVXYXJuIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBzLmEuRU5BQkxFX1dBUk4KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNldDogZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgICBzLmEuRU5BQkxFX1dBUk4gPSB0LAogICAgICAgICAgICAgICAgICBlLl9ub3RpZnlDaGFuZ2UoKQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgImVuYWJsZUVycm9yIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBzLmEuRU5BQkxFX0VSUk9SCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgcy5hLkVOQUJMRV9FUlJPUiA9IHQsCiAgICAgICAgICAgICAgICAgIGUuX25vdGlmeUNoYW5nZSgpCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIGUuZ2V0Q29uZmlnID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgZ2xvYmFsVGFnOiBzLmEuR0xPQkFMX1RBRywKICAgICAgICAgICAgICAgICAgZm9yY2VHbG9iYWxUYWc6IHMuYS5GT1JDRV9HTE9CQUxfVEFHLAogICAgICAgICAgICAgICAgICBlbmFibGVWZXJib3NlOiBzLmEuRU5BQkxFX1ZFUkJPU0UsCiAgICAgICAgICAgICAgICAgIGVuYWJsZURlYnVnOiBzLmEuRU5BQkxFX0RFQlVHLAogICAgICAgICAgICAgICAgICBlbmFibGVJbmZvOiBzLmEuRU5BQkxFX0lORk8sCiAgICAgICAgICAgICAgICAgIGVuYWJsZVdhcm46IHMuYS5FTkFCTEVfV0FSTiwKICAgICAgICAgICAgICAgICAgZW5hYmxlRXJyb3I6IHMuYS5FTkFCTEVfRVJST1IsCiAgICAgICAgICAgICAgICAgIGVuYWJsZUNhbGxiYWNrOiBzLmEuRU5BQkxFX0NBTExCQUNLCiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5hcHBseUNvbmZpZyA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBzLmEuR0xPQkFMX1RBRyA9IGUuZ2xvYmFsVGFnLAogICAgICAgICAgICAgIHMuYS5GT1JDRV9HTE9CQUxfVEFHID0gZS5mb3JjZUdsb2JhbFRhZywKICAgICAgICAgICAgICBzLmEuRU5BQkxFX1ZFUkJPU0UgPSBlLmVuYWJsZVZlcmJvc2UsCiAgICAgICAgICAgICAgcy5hLkVOQUJMRV9ERUJVRyA9IGUuZW5hYmxlRGVidWcsCiAgICAgICAgICAgICAgcy5hLkVOQUJMRV9JTkZPID0gZS5lbmFibGVJbmZvLAogICAgICAgICAgICAgIHMuYS5FTkFCTEVfV0FSTiA9IGUuZW5hYmxlV2FybiwKICAgICAgICAgICAgICBzLmEuRU5BQkxFX0VSUk9SID0gZS5lbmFibGVFcnJvciwKICAgICAgICAgICAgICBzLmEuRU5BQkxFX0NBTExCQUNLID0gZS5lbmFibGVDYWxsYmFjawogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5fbm90aWZ5Q2hhbmdlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSBlLmVtaXR0ZXI7CiAgICAgICAgICAgICAgaWYgKHQubGlzdGVuZXJDb3VudCgiY2hhbmdlIikgPiAwKSB7CiAgICAgICAgICAgICAgICAgIHZhciBpID0gZS5nZXRDb25maWcoKTsKICAgICAgICAgICAgICAgICAgdC5lbWl0KCJjaGFuZ2UiLCBpKQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucmVnaXN0ZXJMaXN0ZW5lciA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICBlLmVtaXR0ZXIuYWRkTGlzdGVuZXIoImNoYW5nZSIsIHQpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnJlbW92ZUxpc3RlbmVyID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgIGUuZW1pdHRlci5yZW1vdmVMaXN0ZW5lcigiY2hhbmdlIiwgdCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUuYWRkTG9nTGlzdGVuZXIgPSBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgcy5hLmVtaXR0ZXIuYWRkTGlzdGVuZXIoImxvZyIsIHQpLAogICAgICAgICAgICAgIHMuYS5lbWl0dGVyLmxpc3RlbmVyQ291bnQoImxvZyIpID4gMCAmJiAocy5hLkVOQUJMRV9DQUxMQkFDSyA9ICEwLAogICAgICAgICAgICAgIGUuX25vdGlmeUNoYW5nZSgpKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5yZW1vdmVMb2dMaXN0ZW5lciA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICBzLmEuZW1pdHRlci5yZW1vdmVMaXN0ZW5lcigibG9nIiwgdCksCiAgICAgICAgICAgICAgMCA9PT0gcy5hLmVtaXR0ZXIubGlzdGVuZXJDb3VudCgibG9nIikgJiYgKHMuYS5FTkFCTEVfQ0FMTEJBQ0sgPSAhMSwKICAgICAgICAgICAgICBlLl9ub3RpZnlDaGFuZ2UoKSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUKICAgICAgfSgpOwogICAgICBhLmVtaXR0ZXIgPSBuZXcgci5hLAogICAgICB0LmEgPSBhCiAgfQogICwgZnVuY3Rpb24oZSwgdCwgaSkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gaSg2KQogICAgICAgICwgciA9IGkubihuKQogICAgICAgICwgcyA9IGkoMCkKICAgICAgICAsIGEgPSBpKDQpCiAgICAgICAgLCBvID0gaSg4KTsKICAgICAgZnVuY3Rpb24gaChlLCB0LCBpKSB7CiAgICAgICAgICB2YXIgbiA9IGU7CiAgICAgICAgICBpZiAodCArIGkgPCBuLmxlbmd0aCkgewogICAgICAgICAgICAgIGZvciAoOyBpLS07ICkKICAgICAgICAgICAgICAgICAgaWYgKDEyOCAhPSAoMTkyICYgblsrK3RdKSkKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMTsKICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAhMQogICAgICB9CiAgICAgIHZhciBkLCB1ID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgZm9yICh2YXIgdCA9IFtdLCBpID0gZSwgbiA9IDAsIHIgPSBlLmxlbmd0aDsgbiA8IHI7ICkKICAgICAgICAgICAgICBpZiAoaVtuXSA8IDEyOCkKICAgICAgICAgICAgICAgICAgdC5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoaVtuXSkpLAogICAgICAgICAgICAgICAgICArK247CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgIGlmIChpW25dIDwgMTkyKQogICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICBlbHNlIGlmIChpW25dIDwgMjI0KSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaChpLCBuLCAxKSkKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHMgPSAoMzEgJiBpW25dKSA8PCA2IHwgNjMgJiBpW24gKyAxXSkgPj0gMTI4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKDY1NTM1ICYgcykpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuICs9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlbbl0gPCAyNDApIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChoKGksIG4sIDIpKQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgocyA9ICgxNSAmIGlbbl0pIDw8IDEyIHwgKDYzICYgaVtuICsgMV0pIDw8IDYgfCA2MyAmIGlbbiArIDJdKSA+PSAyMDQ4ICYmIDU1Mjk2ICE9ICg2MzQ4OCAmIHMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKDY1NTM1ICYgcykpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuICs9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlbbl0gPCAyNDgpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBzOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGgoaSwgbiwgMykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChzID0gKDcgJiBpW25dKSA8PCAxOCB8ICg2MyAmIGlbbiArIDFdKSA8PCAxMiB8ICg2MyAmIGlbbiArIDJdKSA8PCA2IHwgNjMgJiBpW24gKyAzXSkgPiA2NTUzNiAmJiBzIDwgMTExNDExMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzIC09IDY1NTM2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShzID4+PiAxMCB8IDU1Mjk2KSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKDEwMjMgJiBzIHwgNTYzMjApKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiArPSA0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0LnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSg2NTUzMykpLAogICAgICAgICAgICAgICAgICArK24KICAgICAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdC5qb2luKCIiKQogICAgICB9LCBfID0gaSgzKSwgYyA9IChkID0gbmV3IEFycmF5QnVmZmVyKDIpLAogICAgICBuZXcgRGF0YVZpZXcoZCkuc2V0SW50MTYoMCwgMjU2LCAhMCksCiAgICAgIDI1NiA9PT0gbmV3IEludDE2QXJyYXkoZClbMF0pLCBsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBmdW5jdGlvbiBlKCkge30KICAgICAgICAgIHJldHVybiBlLnBhcnNlU2NyaXB0RGF0YSA9IGZ1bmN0aW9uKHQsIGksIG4pIHsKICAgICAgICAgICAgICB2YXIgciA9IHt9OwogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIHZhciBhID0gZS5wYXJzZVZhbHVlKHQsIGksIG4pCiAgICAgICAgICAgICAgICAgICAgLCBvID0gZS5wYXJzZVZhbHVlKHQsIGkgKyBhLnNpemUsIG4gLSBhLnNpemUpOwogICAgICAgICAgICAgICAgICByW2EuZGF0YV0gPSBvLmRhdGEKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgIHMuYS5lKCJBTUYiLCBlLnRvU3RyaW5nKCkpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiByCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnBhcnNlT2JqZWN0ID0gZnVuY3Rpb24odCwgaSwgbikgewogICAgICAgICAgICAgIGlmIChuIDwgMykKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IF8uYSgiRGF0YSBub3QgZW5vdWdoIHdoZW4gcGFyc2UgU2NyaXB0RGF0YU9iamVjdCIpOwogICAgICAgICAgICAgIHZhciByID0gZS5wYXJzZVN0cmluZyh0LCBpLCBuKQogICAgICAgICAgICAgICAgLCBzID0gZS5wYXJzZVZhbHVlKHQsIGkgKyByLnNpemUsIG4gLSByLnNpemUpCiAgICAgICAgICAgICAgICAsIGEgPSBzLm9iamVjdEVuZDsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgICBuYW1lOiByLmRhdGEsCiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcy5kYXRhCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHNpemU6IHIuc2l6ZSArIHMuc2l6ZSwKICAgICAgICAgICAgICAgICAgb2JqZWN0RW5kOiBhCiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wYXJzZVZhcmlhYmxlID0gZnVuY3Rpb24odCwgaSwgbikgewogICAgICAgICAgICAgIHJldHVybiBlLnBhcnNlT2JqZWN0KHQsIGksIG4pCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnBhcnNlU3RyaW5nID0gZnVuY3Rpb24oZSwgdCwgaSkgewogICAgICAgICAgICAgIGlmIChpIDwgMikKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IF8uYSgiRGF0YSBub3QgZW5vdWdoIHdoZW4gcGFyc2UgU3RyaW5nIik7CiAgICAgICAgICAgICAgdmFyIG4gPSBuZXcgRGF0YVZpZXcoZSx0LGkpLmdldFVpbnQxNigwLCAhYyk7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgZGF0YTogbiA+IDAgPyB1KG5ldyBVaW50OEFycmF5KGUsdCArIDIsbikpIDogIiIsCiAgICAgICAgICAgICAgICAgIHNpemU6IDIgKyBuCiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wYXJzZUxvbmdTdHJpbmcgPSBmdW5jdGlvbihlLCB0LCBpKSB7CiAgICAgICAgICAgICAgaWYgKGkgPCA0KQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgXy5hKCJEYXRhIG5vdCBlbm91Z2ggd2hlbiBwYXJzZSBMb25nU3RyaW5nIik7CiAgICAgICAgICAgICAgdmFyIG4gPSBuZXcgRGF0YVZpZXcoZSx0LGkpLmdldFVpbnQzMigwLCAhYyk7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgZGF0YTogbiA+IDAgPyB1KG5ldyBVaW50OEFycmF5KGUsdCArIDQsbikpIDogIiIsCiAgICAgICAgICAgICAgICAgIHNpemU6IDQgKyBuCiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wYXJzZURhdGUgPSBmdW5jdGlvbihlLCB0LCBpKSB7CiAgICAgICAgICAgICAgaWYgKGkgPCAxMCkKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IF8uYSgiRGF0YSBzaXplIGludmFsaWQgd2hlbiBwYXJzZSBEYXRlIik7CiAgICAgICAgICAgICAgdmFyIG4gPSBuZXcgRGF0YVZpZXcoZSx0LGkpCiAgICAgICAgICAgICAgICAsIHIgPSBuLmdldEZsb2F0NjQoMCwgIWMpCiAgICAgICAgICAgICAgICAsIHMgPSBuLmdldEludDE2KDgsICFjKTsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBkYXRhOiBuZXcgRGF0ZShyICs9IDYwICogcyAqIDFlMyksCiAgICAgICAgICAgICAgICAgIHNpemU6IDEwCiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wYXJzZVZhbHVlID0gZnVuY3Rpb24odCwgaSwgbikgewogICAgICAgICAgICAgIGlmIChuIDwgMSkKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IF8uYSgiRGF0YSBub3QgZW5vdWdoIHdoZW4gcGFyc2UgVmFsdWUiKTsKICAgICAgICAgICAgICB2YXIgciwgYSA9IG5ldyBEYXRhVmlldyh0LGksbiksIG8gPSAxLCBoID0gYS5nZXRVaW50OCgwKSwgZCA9ICExOwogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoaCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICByID0gYS5nZXRGbG9hdDY0KDEsICFjKSwKICAgICAgICAgICAgICAgICAgICAgIG8gKz0gODsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgICByID0gISFhLmdldFVpbnQ4KDEpLAogICAgICAgICAgICAgICAgICAgICAgbyArPSAxOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgIHZhciB1ID0gZS5wYXJzZVN0cmluZyh0LCBpICsgMSwgbiAtIDEpOwogICAgICAgICAgICAgICAgICAgICAgciA9IHUuZGF0YSwKICAgICAgICAgICAgICAgICAgICAgIG8gKz0gdS5zaXplOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgIHIgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgIHZhciBsID0gMDsKICAgICAgICAgICAgICAgICAgICAgIGZvciAoOSA9PSAoMTY3NzcyMTUgJiBhLmdldFVpbnQzMihuIC0gNCwgIWMpKSAmJiAobCA9IDMpOyBvIDwgbiAtIDQ7ICkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gZS5wYXJzZU9iamVjdCh0LCBpICsgbywgbiAtIG8gLSBsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZi5vYmplY3RFbmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgIHJbZi5kYXRhLm5hbWVdID0gZi5kYXRhLnZhbHVlLAogICAgICAgICAgICAgICAgICAgICAgICAgIG8gKz0gZi5zaXplCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBpZiAobyA8PSBuIC0gMykKICAgICAgICAgICAgICAgICAgICAgICAgICA5ID09PSAoMTY3NzcyMTUgJiBhLmdldFVpbnQzMihvIC0gMSwgIWMpKSAmJiAobyArPSAzKTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgICAgICByID0ge30sCiAgICAgICAgICAgICAgICAgICAgICBvICs9IDQ7CiAgICAgICAgICAgICAgICAgICAgICBsID0gMDsKICAgICAgICAgICAgICAgICAgICAgIGZvciAoOSA9PSAoMTY3NzcyMTUgJiBhLmdldFVpbnQzMihuIC0gNCwgIWMpKSAmJiAobCA9IDMpOyBvIDwgbiAtIDg7ICkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwID0gZS5wYXJzZVZhcmlhYmxlKHQsIGkgKyBvLCBuIC0gbyAtIGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwLm9iamVjdEVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcltwLmRhdGEubmFtZV0gPSBwLmRhdGEudmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgbyArPSBwLnNpemUKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGlmIChvIDw9IG4gLSAzKQogICAgICAgICAgICAgICAgICAgICAgICAgIDkgPT09ICgxNjc3NzIxNSAmIGEuZ2V0VWludDMyKG8gLSAxLCAhYykpICYmIChvICs9IDMpOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICAgICAgIHIgPSB2b2lkIDAsCiAgICAgICAgICAgICAgICAgICAgICBvID0gMSwKICAgICAgICAgICAgICAgICAgICAgIGQgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgICAgciA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgdmFyIG0gPSBhLmdldFVpbnQzMigxLCAhYyk7CiAgICAgICAgICAgICAgICAgICAgICBvICs9IDQ7CiAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBnID0gMDsgZyA8IG07IGcrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2ID0gZS5wYXJzZVZhbHVlKHQsIGkgKyBvLCBuIC0gbyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgci5wdXNoKHYuZGF0YSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgbyArPSB2LnNpemUKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSBlLnBhcnNlRGF0ZSh0LCBpICsgMSwgbiAtIDEpOwogICAgICAgICAgICAgICAgICAgICAgciA9IHkuZGF0YSwKICAgICAgICAgICAgICAgICAgICAgIG8gKz0geS5zaXplOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGUucGFyc2VTdHJpbmcodCwgaSArIDEsIG4gLSAxKTsKICAgICAgICAgICAgICAgICAgICAgIHIgPSBiLmRhdGEsCiAgICAgICAgICAgICAgICAgICAgICBvICs9IGIuc2l6ZTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgbyA9IG4sCiAgICAgICAgICAgICAgICAgICAgICBzLmEudygiQU1GIiwgIlVuc3VwcG9ydGVkIEFNRiB2YWx1ZSB0eXBlICIgKyBoKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICBzLmEuZSgiQU1GIiwgZS50b1N0cmluZygpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBkYXRhOiByLAogICAgICAgICAgICAgICAgICBzaXplOiBvLAogICAgICAgICAgICAgICAgICBvYmplY3RFbmQ6IGQKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlCiAgICAgIH0oKSwgZiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgZnVuY3Rpb24gZShlKSB7CiAgICAgICAgICAgICAgdGhpcy5UQUcgPSAiRXhwR29sb21iIiwKICAgICAgICAgICAgICB0aGlzLl9idWZmZXIgPSBlLAogICAgICAgICAgICAgIHRoaXMuX2J1ZmZlcl9pbmRleCA9IDAsCiAgICAgICAgICAgICAgdGhpcy5fdG90YWxfYnl0ZXMgPSBlLmJ5dGVMZW5ndGgsCiAgICAgICAgICAgICAgdGhpcy5fdG90YWxfYml0cyA9IDggKiBlLmJ5dGVMZW5ndGgsCiAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF93b3JkID0gMCwKICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X3dvcmRfYml0c19sZWZ0ID0gMAogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0aGlzLl9idWZmZXIgPSBudWxsCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fZmlsbEN1cnJlbnRXb3JkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLl90b3RhbF9ieXRlcyAtIHRoaXMuX2J1ZmZlcl9pbmRleDsKICAgICAgICAgICAgICBpZiAoZSA8PSAwKQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgXy5hKCJFeHBHb2xvbWI6IF9maWxsQ3VycmVudFdvcmQoKSBidXQgbm8gYnl0ZXMgYXZhaWxhYmxlIik7CiAgICAgICAgICAgICAgdmFyIHQgPSBNYXRoLm1pbig0LCBlKQogICAgICAgICAgICAgICAgLCBpID0gbmV3IFVpbnQ4QXJyYXkoNCk7CiAgICAgICAgICAgICAgaS5zZXQodGhpcy5fYnVmZmVyLnN1YmFycmF5KHRoaXMuX2J1ZmZlcl9pbmRleCwgdGhpcy5fYnVmZmVyX2luZGV4ICsgdCkpLAogICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfd29yZCA9IG5ldyBEYXRhVmlldyhpLmJ1ZmZlcikuZ2V0VWludDMyKDAsICExKSwKICAgICAgICAgICAgICB0aGlzLl9idWZmZXJfaW5kZXggKz0gdCwKICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X3dvcmRfYml0c19sZWZ0ID0gOCAqIHQKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLnJlYWRCaXRzID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGlmIChlID4gMzIpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBfLmIoIkV4cEdvbG9tYjogcmVhZEJpdHMoKSBiaXRzIGV4Y2VlZGVkIG1heCAzMmJpdHMhIik7CiAgICAgICAgICAgICAgaWYgKGUgPD0gdGhpcy5fY3VycmVudF93b3JkX2JpdHNfbGVmdCkgewogICAgICAgICAgICAgICAgICB2YXIgdCA9IHRoaXMuX2N1cnJlbnRfd29yZCA+Pj4gMzIgLSBlOwogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudF93b3JkIDw8PSBlLAogICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X3dvcmRfYml0c19sZWZ0IC09IGUsCiAgICAgICAgICAgICAgICAgIHQKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzLl9jdXJyZW50X3dvcmRfYml0c19sZWZ0ID8gdGhpcy5fY3VycmVudF93b3JkIDogMDsKICAgICAgICAgICAgICBpID4+Pj0gMzIgLSB0aGlzLl9jdXJyZW50X3dvcmRfYml0c19sZWZ0OwogICAgICAgICAgICAgIHZhciBuID0gZSAtIHRoaXMuX2N1cnJlbnRfd29yZF9iaXRzX2xlZnQ7CiAgICAgICAgICAgICAgdGhpcy5fZmlsbEN1cnJlbnRXb3JkKCk7CiAgICAgICAgICAgICAgdmFyIHIgPSBNYXRoLm1pbihuLCB0aGlzLl9jdXJyZW50X3dvcmRfYml0c19sZWZ0KQogICAgICAgICAgICAgICAgLCBzID0gdGhpcy5fY3VycmVudF93b3JkID4+PiAzMiAtIHI7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRfd29yZCA8PD0gciwKICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X3dvcmRfYml0c19sZWZ0IC09IHIsCiAgICAgICAgICAgICAgaSA9IGkgPDwgciB8IHMKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLnJlYWRCb29sID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIDEgPT09IHRoaXMucmVhZEJpdHMoMSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLnJlYWRCeXRlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVhZEJpdHMoOCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9za2lwTGVhZGluZ1plcm8gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB2YXIgZTsKICAgICAgICAgICAgICBmb3IgKGUgPSAwOyBlIDwgdGhpcy5fY3VycmVudF93b3JkX2JpdHNfbGVmdDsgZSsrKQogICAgICAgICAgICAgICAgICBpZiAoMCAhPSAodGhpcy5fY3VycmVudF93b3JkICYgMjE0NzQ4MzY0OCA+Pj4gZSkpCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudF93b3JkIDw8PSBlLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF93b3JkX2JpdHNfbGVmdCAtPSBlLAogICAgICAgICAgICAgICAgICAgICAgZTsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZmlsbEN1cnJlbnRXb3JkKCksCiAgICAgICAgICAgICAgZSArIHRoaXMuX3NraXBMZWFkaW5nWmVybygpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5yZWFkVUVHID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLl9za2lwTGVhZGluZ1plcm8oKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZWFkQml0cyhlICsgMSkgLSAxCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5yZWFkU0VHID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLnJlYWRVRUcoKTsKICAgICAgICAgICAgICByZXR1cm4gMSAmIGUgPyBlICsgMSA+Pj4gMSA6IC0xICogKGUgPj4+IDEpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlCiAgICAgIH0oKSwgcCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgZnVuY3Rpb24gZSgpIHt9CiAgICAgICAgICByZXR1cm4gZS5fZWJzcDJyYnNwID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGZvciAodmFyIHQgPSBlLCBpID0gdC5ieXRlTGVuZ3RoLCBuID0gbmV3IFVpbnQ4QXJyYXkoaSksIHIgPSAwLCBzID0gMDsgcyA8IGk7IHMrKykKICAgICAgICAgICAgICAgICAgcyA+PSAyICYmIDMgPT09IHRbc10gJiYgMCA9PT0gdFtzIC0gMV0gJiYgMCA9PT0gdFtzIC0gMl0gfHwgKG5bcl0gPSB0W3NdLAogICAgICAgICAgICAgICAgICByKyspOwogICAgICAgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShuLmJ1ZmZlciwwLHIpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnBhcnNlU1BTID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgIGZvciAodmFyIGkgPSB0LnN1YmFycmF5KDEsIDQpLCBuID0gImF2YzEuIiwgciA9IDA7IHIgPCAzOyByKyspIHsKICAgICAgICAgICAgICAgICAgdmFyIHMgPSBpW3JdLnRvU3RyaW5nKDE2KTsKICAgICAgICAgICAgICAgICAgcy5sZW5ndGggPCAyICYmIChzID0gIjAiICsgcyksCiAgICAgICAgICAgICAgICAgIG4gKz0gcwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB2YXIgYSA9IGUuX2Vic3AycmJzcCh0KQogICAgICAgICAgICAgICAgLCBvID0gbmV3IGYoYSk7CiAgICAgICAgICAgICAgby5yZWFkQnl0ZSgpOwogICAgICAgICAgICAgIHZhciBoID0gby5yZWFkQnl0ZSgpOwogICAgICAgICAgICAgIG8ucmVhZEJ5dGUoKTsKICAgICAgICAgICAgICB2YXIgZCA9IG8ucmVhZEJ5dGUoKTsKICAgICAgICAgICAgICBvLnJlYWRVRUcoKTsKICAgICAgICAgICAgICB2YXIgdSA9IGUuZ2V0UHJvZmlsZVN0cmluZyhoKQogICAgICAgICAgICAgICAgLCBfID0gZS5nZXRMZXZlbFN0cmluZyhkKQogICAgICAgICAgICAgICAgLCBjID0gMQogICAgICAgICAgICAgICAgLCBsID0gNDIwCiAgICAgICAgICAgICAgICAsIHAgPSA4CiAgICAgICAgICAgICAgICAsIG0gPSA4OwogICAgICAgICAgICAgIGlmICgoMTAwID09PSBoIHx8IDExMCA9PT0gaCB8fCAxMjIgPT09IGggfHwgMjQ0ID09PSBoIHx8IDQ0ID09PSBoIHx8IDgzID09PSBoIHx8IDg2ID09PSBoIHx8IDExOCA9PT0gaCB8fCAxMjggPT09IGggfHwgMTM4ID09PSBoIHx8IDE0NCA9PT0gaCkgJiYgKDMgPT09IChjID0gby5yZWFkVUVHKCkpICYmIG8ucmVhZEJpdHMoMSksCiAgICAgICAgICAgICAgYyA8PSAzICYmIChsID0gWzAsIDQyMCwgNDIyLCA0NDRdW2NdKSwKICAgICAgICAgICAgICBwID0gby5yZWFkVUVHKCkgKyA4LAogICAgICAgICAgICAgIG0gPSBvLnJlYWRVRUcoKSArIDgsCiAgICAgICAgICAgICAgby5yZWFkQml0cygxKSwKICAgICAgICAgICAgICBvLnJlYWRCb29sKCkpKQogICAgICAgICAgICAgICAgICBmb3IgKHZhciBnID0gMyAhPT0gYyA/IDggOiAxMiwgdiA9IDA7IHYgPCBnOyB2KyspCiAgICAgICAgICAgICAgICAgICAgICBvLnJlYWRCb29sKCkgJiYgKHYgPCA2ID8gZS5fc2tpcFNjYWxpbmdMaXN0KG8sIDE2KSA6IGUuX3NraXBTY2FsaW5nTGlzdChvLCA2NCkpOwogICAgICAgICAgICAgIG8ucmVhZFVFRygpOwogICAgICAgICAgICAgIHZhciB5ID0gby5yZWFkVUVHKCk7CiAgICAgICAgICAgICAgaWYgKDAgPT09IHkpCiAgICAgICAgICAgICAgICAgIG8ucmVhZFVFRygpOwogICAgICAgICAgICAgIGVsc2UgaWYgKDEgPT09IHkpIHsKICAgICAgICAgICAgICAgICAgby5yZWFkQml0cygxKSwKICAgICAgICAgICAgICAgICAgby5yZWFkU0VHKCksCiAgICAgICAgICAgICAgICAgIG8ucmVhZFNFRygpOwogICAgICAgICAgICAgICAgICB2YXIgYiA9IG8ucmVhZFVFRygpOwogICAgICAgICAgICAgICAgICBmb3IgKHYgPSAwOyB2IDwgYjsgdisrKQogICAgICAgICAgICAgICAgICAgICAgby5yZWFkU0VHKCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdmFyIEUgPSBvLnJlYWRVRUcoKTsKICAgICAgICAgICAgICBvLnJlYWRCaXRzKDEpOwogICAgICAgICAgICAgIHZhciBTID0gby5yZWFkVUVHKCkKICAgICAgICAgICAgICAgICwgQSA9IG8ucmVhZFVFRygpCiAgICAgICAgICAgICAgICAsIFIgPSBvLnJlYWRCaXRzKDEpOwogICAgICAgICAgICAgIDAgPT09IFIgJiYgby5yZWFkQml0cygxKSwKICAgICAgICAgICAgICBvLnJlYWRCaXRzKDEpOwogICAgICAgICAgICAgIHZhciBMID0gMAogICAgICAgICAgICAgICAgLCBUID0gMAogICAgICAgICAgICAgICAgLCB3ID0gMAogICAgICAgICAgICAgICAgLCBEID0gMDsKICAgICAgICAgICAgICBvLnJlYWRCb29sKCkgJiYgKEwgPSBvLnJlYWRVRUcoKSwKICAgICAgICAgICAgICBUID0gby5yZWFkVUVHKCksCiAgICAgICAgICAgICAgdyA9IG8ucmVhZFVFRygpLAogICAgICAgICAgICAgIEQgPSBvLnJlYWRVRUcoKSk7CiAgICAgICAgICAgICAgdmFyIGsgPSAxCiAgICAgICAgICAgICAgICAsIEMgPSAxCiAgICAgICAgICAgICAgICAsIEkgPSAwCiAgICAgICAgICAgICAgICAsIE8gPSAhMAogICAgICAgICAgICAgICAgLCBQID0gMAogICAgICAgICAgICAgICAgLCBNID0gMDsKICAgICAgICAgICAgICBpZiAoby5yZWFkQm9vbCgpKSB7CiAgICAgICAgICAgICAgICAgIGlmIChvLnJlYWRCb29sKCkpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciB4ID0gby5yZWFkQnl0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgeCA+IDAgJiYgeCA8IDE2ID8gKGsgPSBbMSwgMTIsIDEwLCAxNiwgNDAsIDI0LCAyMCwgMzIsIDgwLCAxOCwgMTUsIDY0LCAxNjAsIDQsIDMsIDJdW3ggLSAxXSwKICAgICAgICAgICAgICAgICAgICAgIEMgPSBbMSwgMTEsIDExLCAxMSwgMzMsIDExLCAxMSwgMTEsIDMzLCAxMSwgMTEsIDMzLCA5OSwgMywgMiwgMV1beCAtIDFdKSA6IDI1NSA9PT0geCAmJiAoayA9IG8ucmVhZEJ5dGUoKSA8PCA4IHwgby5yZWFkQnl0ZSgpLAogICAgICAgICAgICAgICAgICAgICAgQyA9IG8ucmVhZEJ5dGUoKSA8PCA4IHwgby5yZWFkQnl0ZSgpKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChvLnJlYWRCb29sKCkgJiYgby5yZWFkQm9vbCgpLAogICAgICAgICAgICAgICAgICBvLnJlYWRCb29sKCkgJiYgKG8ucmVhZEJpdHMoNCksCiAgICAgICAgICAgICAgICAgIG8ucmVhZEJvb2woKSAmJiBvLnJlYWRCaXRzKDI0KSksCiAgICAgICAgICAgICAgICAgIG8ucmVhZEJvb2woKSAmJiAoby5yZWFkVUVHKCksCiAgICAgICAgICAgICAgICAgIG8ucmVhZFVFRygpKSwKICAgICAgICAgICAgICAgICAgby5yZWFkQm9vbCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgQiA9IG8ucmVhZEJpdHMoMzIpCiAgICAgICAgICAgICAgICAgICAgICAgICwgVSA9IG8ucmVhZEJpdHMoMzIpOwogICAgICAgICAgICAgICAgICAgICAgTyA9IG8ucmVhZEJvb2woKSwKICAgICAgICAgICAgICAgICAgICAgIEkgPSAoUCA9IFUpIC8gKE0gPSAyICogQikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB2YXIgTiA9IDE7CiAgICAgICAgICAgICAgMSA9PT0gayAmJiAxID09PSBDIHx8IChOID0gayAvIEMpOwogICAgICAgICAgICAgIHZhciBGID0gMAogICAgICAgICAgICAgICAgLCBHID0gMDsKICAgICAgICAgICAgICAwID09PSBjID8gKEYgPSAxLAogICAgICAgICAgICAgIEcgPSAyIC0gUikgOiAoRiA9IDMgPT09IGMgPyAxIDogMiwKICAgICAgICAgICAgICBHID0gKDEgPT09IGMgPyAyIDogMSkgKiAoMiAtIFIpKTsKICAgICAgICAgICAgICB2YXIgViA9IDE2ICogKFMgKyAxKQogICAgICAgICAgICAgICAgLCBqID0gMTYgKiAoQSArIDEpICogKDIgLSBSKTsKICAgICAgICAgICAgICBWIC09IChMICsgVCkgKiBGLAogICAgICAgICAgICAgIGogLT0gKHcgKyBEKSAqIEc7CiAgICAgICAgICAgICAgdmFyIHogPSBNYXRoLmNlaWwoViAqIE4pOwogICAgICAgICAgICAgIHJldHVybiBvLmRlc3Ryb3koKSwKICAgICAgICAgICAgICBvID0gbnVsbCwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGNvZGVjX21pbWV0eXBlOiBuLAogICAgICAgICAgICAgICAgICBwcm9maWxlX2lkYzogaCwKICAgICAgICAgICAgICAgICAgbGV2ZWxfaWRjOiBkLAogICAgICAgICAgICAgICAgICBwcm9maWxlX3N0cmluZzogdSwKICAgICAgICAgICAgICAgICAgbGV2ZWxfc3RyaW5nOiBfLAogICAgICAgICAgICAgICAgICBjaHJvbWFfZm9ybWF0X2lkYzogYywKICAgICAgICAgICAgICAgICAgYml0X2RlcHRoOiBwLAogICAgICAgICAgICAgICAgICBiaXRfZGVwdGhfbHVtYTogcCwKICAgICAgICAgICAgICAgICAgYml0X2RlcHRoX2Nocm9tYTogbSwKICAgICAgICAgICAgICAgICAgcmVmX2ZyYW1lczogRSwKICAgICAgICAgICAgICAgICAgY2hyb21hX2Zvcm1hdDogbCwKICAgICAgICAgICAgICAgICAgY2hyb21hX2Zvcm1hdF9zdHJpbmc6IGUuZ2V0Q2hyb21hRm9ybWF0U3RyaW5nKGwpLAogICAgICAgICAgICAgICAgICBmcmFtZV9yYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgICBmaXhlZDogTywKICAgICAgICAgICAgICAgICAgICAgIGZwczogSSwKICAgICAgICAgICAgICAgICAgICAgIGZwc19kZW46IE0sCiAgICAgICAgICAgICAgICAgICAgICBmcHNfbnVtOiBQCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHNhcl9yYXRpbzogewogICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGssCiAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IEMKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgY29kZWNfc2l6ZTogewogICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IFYsCiAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGoKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgcHJlc2VudF9zaXplOiB7CiAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogeiwKICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogagogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5fc2tpcFNjYWxpbmdMaXN0ID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgIGZvciAodmFyIGkgPSA4LCBuID0gOCwgciA9IDA7IHIgPCB0OyByKyspCiAgICAgICAgICAgICAgICAgIDAgIT09IG4gJiYgKG4gPSAoaSArIGUucmVhZFNFRygpICsgMjU2KSAlIDI1NiksCiAgICAgICAgICAgICAgICAgIGkgPSAwID09PSBuID8gaSA6IG4KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUuZ2V0UHJvZmlsZVN0cmluZyA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKGUpIHsKICAgICAgICAgICAgICBjYXNlIDY2OgogICAgICAgICAgICAgICAgICByZXR1cm4gIkJhc2VsaW5lIjsKICAgICAgICAgICAgICBjYXNlIDc3OgogICAgICAgICAgICAgICAgICByZXR1cm4gIk1haW4iOwogICAgICAgICAgICAgIGNhc2UgODg6CiAgICAgICAgICAgICAgICAgIHJldHVybiAiRXh0ZW5kZWQiOwogICAgICAgICAgICAgIGNhc2UgMTAwOgogICAgICAgICAgICAgICAgICByZXR1cm4gIkhpZ2giOwogICAgICAgICAgICAgIGNhc2UgMTEwOgogICAgICAgICAgICAgICAgICByZXR1cm4gIkhpZ2gxMCI7CiAgICAgICAgICAgICAgY2FzZSAxMjI6CiAgICAgICAgICAgICAgICAgIHJldHVybiAiSGlnaDQyMiI7CiAgICAgICAgICAgICAgY2FzZSAyNDQ6CiAgICAgICAgICAgICAgICAgIHJldHVybiAiSGlnaDQ0NCI7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgcmV0dXJuICJVbmtub3duIgogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUuZ2V0TGV2ZWxTdHJpbmcgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIChlIC8gMTApLnRvRml4ZWQoMSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUuZ2V0Q2hyb21hRm9ybWF0U3RyaW5nID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHN3aXRjaCAoZSkgewogICAgICAgICAgICAgIGNhc2UgNDIwOgogICAgICAgICAgICAgICAgICByZXR1cm4gIjQ6MjowIjsKICAgICAgICAgICAgICBjYXNlIDQyMjoKICAgICAgICAgICAgICAgICAgcmV0dXJuICI0OjI6MiI7CiAgICAgICAgICAgICAgY2FzZSA0NDQ6CiAgICAgICAgICAgICAgICAgIHJldHVybiAiNDo0OjQiOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIHJldHVybiAiVW5rbm93biIKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlCiAgICAgIH0oKSwgbSA9IGkoNSk7CiAgICAgIHZhciBnLCB2ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBmdW5jdGlvbiBlKGUsIHQpIHsKICAgICAgICAgICAgICB0aGlzLlRBRyA9ICJGTFZEZW11eGVyIiwKICAgICAgICAgICAgICB0aGlzLl9jb25maWcgPSB0LAogICAgICAgICAgICAgIHRoaXMuX29uRXJyb3IgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uTWVkaWFJbmZvID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9vbk1ldGFEYXRhQXJyaXZlZCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fb25TY3JpcHREYXRhQXJyaXZlZCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fb25UcmFja01ldGFkYXRhID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9vbkRhdGFBdmFpbGFibGUgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX2RhdGFPZmZzZXQgPSBlLmRhdGFPZmZzZXQsCiAgICAgICAgICAgICAgdGhpcy5fZmlyc3RQYXJzZSA9ICEwLAogICAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoID0gITEsCiAgICAgICAgICAgICAgdGhpcy5faGFzQXVkaW8gPSBlLmhhc0F1ZGlvVHJhY2ssCiAgICAgICAgICAgICAgdGhpcy5faGFzVmlkZW8gPSBlLmhhc1ZpZGVvVHJhY2ssCiAgICAgICAgICAgICAgdGhpcy5faGFzQXVkaW9GbGFnT3ZlcnJpZGVkID0gITEsCiAgICAgICAgICAgICAgdGhpcy5faGFzVmlkZW9GbGFnT3ZlcnJpZGVkID0gITEsCiAgICAgICAgICAgICAgdGhpcy5fYXVkaW9Jbml0aWFsTWV0YWRhdGFEaXNwYXRjaGVkID0gITEsCiAgICAgICAgICAgICAgdGhpcy5fdmlkZW9Jbml0aWFsTWV0YWRhdGFEaXNwYXRjaGVkID0gITEsCiAgICAgICAgICAgICAgdGhpcy5fbWVkaWFJbmZvID0gbmV3IG8uYSwKICAgICAgICAgICAgICB0aGlzLl9tZWRpYUluZm8uaGFzQXVkaW8gPSB0aGlzLl9oYXNBdWRpbywKICAgICAgICAgICAgICB0aGlzLl9tZWRpYUluZm8uaGFzVmlkZW8gPSB0aGlzLl9oYXNWaWRlbywKICAgICAgICAgICAgICB0aGlzLl9tZXRhZGF0YSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fYXVkaW9NZXRhZGF0YSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fdmlkZW9NZXRhZGF0YSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fbmFsdUxlbmd0aFNpemUgPSA0LAogICAgICAgICAgICAgIHRoaXMuX3RpbWVzdGFtcEJhc2UgPSAwLAogICAgICAgICAgICAgIHRoaXMuX3RpbWVzY2FsZSA9IDFlMywKICAgICAgICAgICAgICB0aGlzLl9kdXJhdGlvbiA9IDAsCiAgICAgICAgICAgICAgdGhpcy5fZHVyYXRpb25PdmVycmlkZWQgPSAhMSwKICAgICAgICAgICAgICB0aGlzLl9yZWZlcmVuY2VGcmFtZVJhdGUgPSB7CiAgICAgICAgICAgICAgICAgIGZpeGVkOiAhMCwKICAgICAgICAgICAgICAgICAgZnBzOiAyMy45NzYsCiAgICAgICAgICAgICAgICAgIGZwc19udW06IDIzOTc2LAogICAgICAgICAgICAgICAgICBmcHNfZGVuOiAxZTMKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHRoaXMuX2ZsdlNvdW5kUmF0ZVRhYmxlID0gWzU1MDAsIDExMDI1LCAyMjA1MCwgNDQxMDAsIDQ4ZTNdLAogICAgICAgICAgICAgIHRoaXMuX21wZWdTYW1wbGluZ1JhdGVzID0gWzk2ZTMsIDg4MjAwLCA2NGUzLCA0OGUzLCA0NDEwMCwgMzJlMywgMjRlMywgMjIwNTAsIDE2ZTMsIDEyZTMsIDExMDI1LCA4ZTMsIDczNTBdLAogICAgICAgICAgICAgIHRoaXMuX21wZWdBdWRpb1YxMFNhbXBsZVJhdGVUYWJsZSA9IFs0NDEwMCwgNDhlMywgMzJlMywgMF0sCiAgICAgICAgICAgICAgdGhpcy5fbXBlZ0F1ZGlvVjIwU2FtcGxlUmF0ZVRhYmxlID0gWzIyMDUwLCAyNGUzLCAxNmUzLCAwXSwKICAgICAgICAgICAgICB0aGlzLl9tcGVnQXVkaW9WMjVTYW1wbGVSYXRlVGFibGUgPSBbMTEwMjUsIDEyZTMsIDhlMywgMF0sCiAgICAgICAgICAgICAgdGhpcy5fbXBlZ0F1ZGlvTDFCaXRSYXRlVGFibGUgPSBbMCwgMzIsIDY0LCA5NiwgMTI4LCAxNjAsIDE5MiwgMjI0LCAyNTYsIDI4OCwgMzIwLCAzNTIsIDM4NCwgNDE2LCA0NDgsIC0xXSwKICAgICAgICAgICAgICB0aGlzLl9tcGVnQXVkaW9MMkJpdFJhdGVUYWJsZSA9IFswLCAzMiwgNDgsIDU2LCA2NCwgODAsIDk2LCAxMTIsIDEyOCwgMTYwLCAxOTIsIDIyNCwgMjU2LCAzMjAsIDM4NCwgLTFdLAogICAgICAgICAgICAgIHRoaXMuX21wZWdBdWRpb0wzQml0UmF0ZVRhYmxlID0gWzAsIDMyLCA0MCwgNDgsIDU2LCA2NCwgODAsIDk2LCAxMTIsIDEyOCwgMTYwLCAxOTIsIDIyNCwgMjU2LCAzMjAsIC0xXSwKICAgICAgICAgICAgICB0aGlzLl92aWRlb1RyYWNrID0gewogICAgICAgICAgICAgICAgICB0eXBlOiAidmlkZW8iLAogICAgICAgICAgICAgICAgICBpZDogMSwKICAgICAgICAgICAgICAgICAgc2VxdWVuY2VOdW1iZXI6IDAsCiAgICAgICAgICAgICAgICAgIHNhbXBsZXM6IFtdLAogICAgICAgICAgICAgICAgICBsZW5ndGg6IDAKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHRoaXMuX2F1ZGlvVHJhY2sgPSB7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJhdWRpbyIsCiAgICAgICAgICAgICAgICAgIGlkOiAyLAogICAgICAgICAgICAgICAgICBzZXF1ZW5jZU51bWJlcjogMCwKICAgICAgICAgICAgICAgICAgc2FtcGxlczogW10sCiAgICAgICAgICAgICAgICAgIGxlbmd0aDogMAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgdGhpcy5fbGl0dGxlRW5kaWFuID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHZhciBlID0gbmV3IEFycmF5QnVmZmVyKDIpOwogICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGFWaWV3KGUpLnNldEludDE2KDAsIDI1NiwgITApLAogICAgICAgICAgICAgICAgICAyNTYgPT09IG5ldyBJbnQxNkFycmF5KGUpWzBdCiAgICAgICAgICAgICAgfSgpCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX21lZGlhSW5mbyA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fbWV0YWRhdGEgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX2F1ZGlvTWV0YWRhdGEgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX3ZpZGVvTWV0YWRhdGEgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX3ZpZGVvVHJhY2sgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX2F1ZGlvVHJhY2sgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uRXJyb3IgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uTWVkaWFJbmZvID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9vbk1ldGFEYXRhQXJyaXZlZCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fb25TY3JpcHREYXRhQXJyaXZlZCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fb25UcmFja01ldGFkYXRhID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9vbkRhdGFBdmFpbGFibGUgPSBudWxsCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb2JlID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHZhciB0ID0gbmV3IFVpbnQ4QXJyYXkoZSkKICAgICAgICAgICAgICAgICwgaSA9IHsKICAgICAgICAgICAgICAgICAgbWF0Y2g6ICExCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBpZiAoNzAgIT09IHRbMF0gfHwgNzYgIT09IHRbMV0gfHwgODYgIT09IHRbMl0gfHwgMSAhPT0gdFszXSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7CiAgICAgICAgICAgICAgdmFyIG4sIHIsIHMgPSAoNCAmIHRbNF0pID4+PiAyICE9IDAsIGEgPSAwICE9ICgxICYgdFs0XSksIG8gPSAobiA9IHQpW3IgPSA1XSA8PCAyNCB8IG5bciArIDFdIDw8IDE2IHwgbltyICsgMl0gPDwgOCB8IG5bciArIDNdOwogICAgICAgICAgICAgIHJldHVybiBvIDwgOSA/IGkgOiB7CiAgICAgICAgICAgICAgICAgIG1hdGNoOiAhMCwKICAgICAgICAgICAgICAgICAgY29uc3VtZWQ6IG8sCiAgICAgICAgICAgICAgICAgIGRhdGFPZmZzZXQ6IG8sCiAgICAgICAgICAgICAgICAgIGhhc0F1ZGlvVHJhY2s6IHMsCiAgICAgICAgICAgICAgICAgIGhhc1ZpZGVvVHJhY2s6IGEKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5iaW5kRGF0YVNvdXJjZSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICByZXR1cm4gZS5vbkRhdGFBcnJpdmFsID0gdGhpcy5wYXJzZUNodW5rcy5iaW5kKHRoaXMpLAogICAgICAgICAgICAgIHRoaXMKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgIm9uVHJhY2tNZXRhZGF0YSIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb25UcmFja01ldGFkYXRhCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fb25UcmFja01ldGFkYXRhID0gZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJvbk1lZGlhSW5mbyIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb25NZWRpYUluZm8KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICB0aGlzLl9vbk1lZGlhSW5mbyA9IGUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAib25NZXRhRGF0YUFycml2ZWQiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29uTWV0YURhdGFBcnJpdmVkCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fb25NZXRhRGF0YUFycml2ZWQgPSBlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgIm9uU2NyaXB0RGF0YUFycml2ZWQiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29uU2NyaXB0RGF0YUFycml2ZWQKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICB0aGlzLl9vblNjcmlwdERhdGFBcnJpdmVkID0gZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJvbkVycm9yIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vbkVycm9yCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fb25FcnJvciA9IGUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAib25EYXRhQXZhaWxhYmxlIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vbkRhdGFBdmFpbGFibGUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICB0aGlzLl9vbkRhdGFBdmFpbGFibGUgPSBlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgInRpbWVzdGFtcEJhc2UiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVzdGFtcEJhc2UKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICB0aGlzLl90aW1lc3RhbXBCYXNlID0gZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJvdmVycmlkZWREdXJhdGlvbiIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZHVyYXRpb24KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICB0aGlzLl9kdXJhdGlvbk92ZXJyaWRlZCA9ICEwLAogICAgICAgICAgICAgICAgICB0aGlzLl9kdXJhdGlvbiA9IGUsCiAgICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhSW5mby5kdXJhdGlvbiA9IGUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAib3ZlcnJpZGVkSGFzQXVkaW8iLCB7CiAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX2hhc0F1ZGlvRmxhZ092ZXJyaWRlZCA9ICEwLAogICAgICAgICAgICAgICAgICB0aGlzLl9oYXNBdWRpbyA9IGUsCiAgICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhSW5mby5oYXNBdWRpbyA9IGUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAib3ZlcnJpZGVkSGFzVmlkZW8iLCB7CiAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX2hhc1ZpZGVvRmxhZ092ZXJyaWRlZCA9ICEwLAogICAgICAgICAgICAgICAgICB0aGlzLl9oYXNWaWRlbyA9IGUsCiAgICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhSW5mby5oYXNWaWRlbyA9IGUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgZS5wcm90b3R5cGUucmVzZXRNZWRpYUluZm8gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0aGlzLl9tZWRpYUluZm8gPSBuZXcgby5hCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5faXNJbml0aWFsTWV0YWRhdGFEaXNwYXRjaGVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hhc0F1ZGlvICYmIHRoaXMuX2hhc1ZpZGVvID8gdGhpcy5fYXVkaW9Jbml0aWFsTWV0YWRhdGFEaXNwYXRjaGVkICYmIHRoaXMuX3ZpZGVvSW5pdGlhbE1ldGFkYXRhRGlzcGF0Y2hlZCA6IHRoaXMuX2hhc0F1ZGlvICYmICF0aGlzLl9oYXNWaWRlbyA/IHRoaXMuX2F1ZGlvSW5pdGlhbE1ldGFkYXRhRGlzcGF0Y2hlZCA6ICEodGhpcy5faGFzQXVkaW8gfHwgIXRoaXMuX2hhc1ZpZGVvKSAmJiB0aGlzLl92aWRlb0luaXRpYWxNZXRhZGF0YURpc3BhdGNoZWQKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLnBhcnNlQ2h1bmtzID0gZnVuY3Rpb24odCwgaSkgewogICAgICAgICAgICAgIGlmICghKHRoaXMuX29uRXJyb3IgJiYgdGhpcy5fb25NZWRpYUluZm8gJiYgdGhpcy5fb25UcmFja01ldGFkYXRhICYmIHRoaXMuX29uRGF0YUF2YWlsYWJsZSkpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBfLmEoIkZsdjogb25FcnJvciAmIG9uTWVkaWFJbmZvICYgb25UcmFja01ldGFkYXRhICYgb25EYXRhQXZhaWxhYmxlIGNhbGxiYWNrIG11c3QgYmUgc3BlY2lmaWVkIik7CiAgICAgICAgICAgICAgdmFyIG4gPSAwCiAgICAgICAgICAgICAgICAsIHIgPSB0aGlzLl9saXR0bGVFbmRpYW47CiAgICAgICAgICAgICAgaWYgKDAgPT09IGkpIHsKICAgICAgICAgICAgICAgICAgaWYgKCEodC5ieXRlTGVuZ3RoID4gMTMpKQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICAgIG4gPSBlLnByb2JlKHQpLmRhdGFPZmZzZXQKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5fZmlyc3RQYXJzZSAmJiAodGhpcy5fZmlyc3RQYXJzZSA9ICExLAogICAgICAgICAgICAgIGkgKyBuICE9PSB0aGlzLl9kYXRhT2Zmc2V0ICYmIHMuYS53KHRoaXMuVEFHLCAiRmlyc3QgdGltZSBwYXJzaW5nIGJ1dCBjaHVuayBieXRlU3RhcnQgaW52YWxpZCEiKSwKICAgICAgICAgICAgICAwICE9PSAoYSA9IG5ldyBEYXRhVmlldyh0LG4pKS5nZXRVaW50MzIoMCwgIXIpICYmIHMuYS53KHRoaXMuVEFHLCAiUHJldlRhZ1NpemUwICE9PSAwICEhISIpLAogICAgICAgICAgICAgIG4gKz0gNCk7CiAgICAgICAgICAgICAgZm9yICg7IG4gPCB0LmJ5dGVMZW5ndGg7ICkgewogICAgICAgICAgICAgICAgICB0aGlzLl9kaXNwYXRjaCA9ICEwOwogICAgICAgICAgICAgICAgICB2YXIgYSA9IG5ldyBEYXRhVmlldyh0LG4pOwogICAgICAgICAgICAgICAgICBpZiAobiArIDExICsgNCA+IHQuYnl0ZUxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB2YXIgbyA9IGEuZ2V0VWludDgoMCkKICAgICAgICAgICAgICAgICAgICAsIGggPSAxNjc3NzIxNSAmIGEuZ2V0VWludDMyKDAsICFyKTsKICAgICAgICAgICAgICAgICAgaWYgKG4gKyAxMSArIGggKyA0ID4gdC5ieXRlTGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGlmICg4ID09PSBvIHx8IDkgPT09IG8gfHwgMTggPT09IG8pIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gYS5nZXRVaW50OCg0KQogICAgICAgICAgICAgICAgICAgICAgICAsIHUgPSBhLmdldFVpbnQ4KDUpCiAgICAgICAgICAgICAgICAgICAgICAgICwgYyA9IGEuZ2V0VWludDgoNikgfCB1IDw8IDggfCBkIDw8IDE2IHwgYS5nZXRVaW50OCg3KSA8PCAyNDsKICAgICAgICAgICAgICAgICAgICAgIDAgIT09ICgxNjc3NzIxNSAmIGEuZ2V0VWludDMyKDcsICFyKSkgJiYgcy5hLncodGhpcy5UQUcsICJNZWV0IHRhZyB3aGljaCBoYXMgU3RyZWFtSUQgIT0gMCEiKTsKICAgICAgICAgICAgICAgICAgICAgIHZhciBsID0gbiArIDExOwogICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChvKSB7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFyc2VBdWRpb0RhdGEodCwgbCwgaCwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFyc2VWaWRlb0RhdGEodCwgbCwgaCwgYywgaSArIG4pOwogICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYXJzZVNjcmlwdERhdGEodCwgbCwgaCkKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gYS5nZXRVaW50MzIoMTEgKyBoLCAhcik7CiAgICAgICAgICAgICAgICAgICAgICBmICE9PSAxMSArIGggJiYgcy5hLncodGhpcy5UQUcsICJJbnZhbGlkIFByZXZUYWdTaXplICIgKyBmKSwKICAgICAgICAgICAgICAgICAgICAgIG4gKz0gMTEgKyBoICsgNAogICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgIHMuYS53KHRoaXMuVEFHLCAiVW5zdXBwb3J0ZWQgdGFnIHR5cGUgIiArIG8gKyAiLCBza2lwcGVkIiksCiAgICAgICAgICAgICAgICAgICAgICBuICs9IDExICsgaCArIDQKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzSW5pdGlhbE1ldGFkYXRhRGlzcGF0Y2hlZCgpICYmIHRoaXMuX2Rpc3BhdGNoICYmICh0aGlzLl9hdWRpb1RyYWNrLmxlbmd0aCB8fCB0aGlzLl92aWRlb1RyYWNrLmxlbmd0aCkgJiYgdGhpcy5fb25EYXRhQXZhaWxhYmxlKHRoaXMuX2F1ZGlvVHJhY2ssIHRoaXMuX3ZpZGVvVHJhY2spLAogICAgICAgICAgICAgIG4KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9wYXJzZVNjcmlwdERhdGEgPSBmdW5jdGlvbihlLCB0LCBpKSB7CiAgICAgICAgICAgICAgdmFyIG4gPSBsLnBhcnNlU2NyaXB0RGF0YShlLCB0LCBpKTsKICAgICAgICAgICAgICBpZiAobi5oYXNPd25Qcm9wZXJ0eSgib25NZXRhRGF0YSIpKSB7CiAgICAgICAgICAgICAgICAgIGlmIChudWxsID09IG4ub25NZXRhRGF0YSB8fCAib2JqZWN0IiAhPSB0eXBlb2Ygbi5vbk1ldGFEYXRhKQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgcy5hLncodGhpcy5UQUcsICJJbnZhbGlkIG9uTWV0YURhdGEgc3RydWN0dXJlISIpOwogICAgICAgICAgICAgICAgICB0aGlzLl9tZXRhZGF0YSAmJiBzLmEudyh0aGlzLlRBRywgIkZvdW5kIGFub3RoZXIgb25NZXRhRGF0YSB0YWchIiksCiAgICAgICAgICAgICAgICAgIHRoaXMuX21ldGFkYXRhID0gbjsKICAgICAgICAgICAgICAgICAgdmFyIHIgPSB0aGlzLl9tZXRhZGF0YS5vbk1ldGFEYXRhOwogICAgICAgICAgICAgICAgICBpZiAodGhpcy5fb25NZXRhRGF0YUFycml2ZWQgJiYgdGhpcy5fb25NZXRhRGF0YUFycml2ZWQoT2JqZWN0LmFzc2lnbih7fSwgcikpLAogICAgICAgICAgICAgICAgICAiYm9vbGVhbiIgPT0gdHlwZW9mIHIuaGFzQXVkaW8gJiYgITEgPT09IHRoaXMuX2hhc0F1ZGlvRmxhZ092ZXJyaWRlZCAmJiAodGhpcy5faGFzQXVkaW8gPSByLmhhc0F1ZGlvLAogICAgICAgICAgICAgICAgICB0aGlzLl9tZWRpYUluZm8uaGFzQXVkaW8gPSB0aGlzLl9oYXNBdWRpbyksCiAgICAgICAgICAgICAgICAgICJib29sZWFuIiA9PSB0eXBlb2Ygci5oYXNWaWRlbyAmJiAhMSA9PT0gdGhpcy5faGFzVmlkZW9GbGFnT3ZlcnJpZGVkICYmICh0aGlzLl9oYXNWaWRlbyA9IHIuaGFzVmlkZW8sCiAgICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhSW5mby5oYXNWaWRlbyA9IHRoaXMuX2hhc1ZpZGVvKSwKICAgICAgICAgICAgICAgICAgIm51bWJlciIgPT0gdHlwZW9mIHIuYXVkaW9kYXRhcmF0ZSAmJiAodGhpcy5fbWVkaWFJbmZvLmF1ZGlvRGF0YVJhdGUgPSByLmF1ZGlvZGF0YXJhdGUpLAogICAgICAgICAgICAgICAgICAibnVtYmVyIiA9PSB0eXBlb2Ygci52aWRlb2RhdGFyYXRlICYmICh0aGlzLl9tZWRpYUluZm8udmlkZW9EYXRhUmF0ZSA9IHIudmlkZW9kYXRhcmF0ZSksCiAgICAgICAgICAgICAgICAgICJudW1iZXIiID09IHR5cGVvZiByLndpZHRoICYmICh0aGlzLl9tZWRpYUluZm8ud2lkdGggPSByLndpZHRoKSwKICAgICAgICAgICAgICAgICAgIm51bWJlciIgPT0gdHlwZW9mIHIuaGVpZ2h0ICYmICh0aGlzLl9tZWRpYUluZm8uaGVpZ2h0ID0gci5oZWlnaHQpLAogICAgICAgICAgICAgICAgICAibnVtYmVyIiA9PSB0eXBlb2Ygci5kdXJhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9kdXJhdGlvbk92ZXJyaWRlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhID0gTWF0aC5mbG9vcihyLmR1cmF0aW9uICogdGhpcy5fdGltZXNjYWxlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9kdXJhdGlvbiA9IGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWVkaWFJbmZvLmR1cmF0aW9uID0gYQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhSW5mby5kdXJhdGlvbiA9IDA7CiAgICAgICAgICAgICAgICAgIGlmICgibnVtYmVyIiA9PSB0eXBlb2Ygci5mcmFtZXJhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBvID0gTWF0aC5mbG9vcigxZTMgKiByLmZyYW1lcmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICBpZiAobyA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaCA9IG8gLyAxZTM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmZXJlbmNlRnJhbWVSYXRlLmZpeGVkID0gITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmZXJlbmNlRnJhbWVSYXRlLmZwcyA9IGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmZXJlbmNlRnJhbWVSYXRlLmZwc19udW0gPSBvLAogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlZmVyZW5jZUZyYW1lUmF0ZS5mcHNfZGVuID0gMWUzLAogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhSW5mby5mcHMgPSBoCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKCJvYmplY3QiID09IHR5cGVvZiByLmtleWZyYW1lcykgewogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWVkaWFJbmZvLmhhc0tleWZyYW1lc0luZGV4ID0gITA7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHIua2V5ZnJhbWVzOwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWVkaWFJbmZvLmtleWZyYW1lc0luZGV4ID0gdGhpcy5fcGFyc2VLZXlmcmFtZXNJbmRleChkKSwKICAgICAgICAgICAgICAgICAgICAgIHIua2V5ZnJhbWVzID0gbnVsbAogICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhSW5mby5oYXNLZXlmcmFtZXNJbmRleCA9ICExOwogICAgICAgICAgICAgICAgICB0aGlzLl9kaXNwYXRjaCA9ICExLAogICAgICAgICAgICAgICAgICB0aGlzLl9tZWRpYUluZm8ubWV0YWRhdGEgPSByLAogICAgICAgICAgICAgICAgICBzLmEudih0aGlzLlRBRywgIlBhcnNlZCBvbk1ldGFEYXRhIiksCiAgICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhSW5mby5pc0NvbXBsZXRlKCkgJiYgdGhpcy5fb25NZWRpYUluZm8odGhpcy5fbWVkaWFJbmZvKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBPYmplY3Qua2V5cyhuKS5sZW5ndGggPiAwICYmIHRoaXMuX29uU2NyaXB0RGF0YUFycml2ZWQgJiYgdGhpcy5fb25TY3JpcHREYXRhQXJyaXZlZChPYmplY3QuYXNzaWduKHt9LCBuKSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9wYXJzZUtleWZyYW1lc0luZGV4ID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGZvciAodmFyIHQgPSBbXSwgaSA9IFtdLCBuID0gMTsgbiA8IGUudGltZXMubGVuZ3RoOyBuKyspIHsKICAgICAgICAgICAgICAgICAgdmFyIHIgPSB0aGlzLl90aW1lc3RhbXBCYXNlICsgTWF0aC5mbG9vcigxZTMgKiBlLnRpbWVzW25dKTsKICAgICAgICAgICAgICAgICAgdC5wdXNoKHIpLAogICAgICAgICAgICAgICAgICBpLnB1c2goZS5maWxlcG9zaXRpb25zW25dKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICB0aW1lczogdCwKICAgICAgICAgICAgICAgICAgZmlsZXBvc2l0aW9uczogaQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9wYXJzZUF1ZGlvRGF0YSA9IGZ1bmN0aW9uKGUsIHQsIGksIG4pIHsKICAgICAgICAgICAgICBpZiAoaSA8PSAxKQogICAgICAgICAgICAgICAgICBzLmEudyh0aGlzLlRBRywgIkZsdjogSW52YWxpZCBhdWRpbyBwYWNrZXQsIG1pc3NpbmcgU291bmREYXRhIHBheWxvYWQhIik7CiAgICAgICAgICAgICAgZWxzZSBpZiAoITAgIT09IHRoaXMuX2hhc0F1ZGlvRmxhZ092ZXJyaWRlZCB8fCAhMSAhPT0gdGhpcy5faGFzQXVkaW8pIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fbGl0dGxlRW5kaWFuOwogICAgICAgICAgICAgICAgICB2YXIgciA9IG5ldyBEYXRhVmlldyhlLHQsaSkuZ2V0VWludDgoMCkKICAgICAgICAgICAgICAgICAgICAsIGEgPSByID4+PiA0OwogICAgICAgICAgICAgICAgICBpZiAoMiA9PT0gYSB8fCAxMCA9PT0gYSkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIG8gPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICwgaCA9ICgxMiAmIHIpID4+PiAyOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGggPj0gMCAmJiBoIDw9IDQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBvID0gdGhpcy5fZmx2U291bmRSYXRlVGFibGVbaF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSAxICYgcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLCB1ID0gdGhpcy5fYXVkaW9NZXRhZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBfID0gdGhpcy5fYXVkaW9UcmFjazsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodSB8fCAoITEgPT09IHRoaXMuX2hhc0F1ZGlvICYmICExID09PSB0aGlzLl9oYXNBdWRpb0ZsYWdPdmVycmlkZWQgJiYgKHRoaXMuX2hhc0F1ZGlvID0gITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWVkaWFJbmZvLmhhc0F1ZGlvID0gITApLAogICAgICAgICAgICAgICAgICAgICAgICAgICh1ID0gdGhpcy5fYXVkaW9NZXRhZGF0YSA9IHt9KS50eXBlID0gImF1ZGlvIiwKICAgICAgICAgICAgICAgICAgICAgICAgICB1LmlkID0gXy5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICB1LnRpbWVzY2FsZSA9IHRoaXMuX3RpbWVzY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICB1LmR1cmF0aW9uID0gdGhpcy5fZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgdS5hdWRpb1NhbXBsZVJhdGUgPSBvLAogICAgICAgICAgICAgICAgICAgICAgICAgIHUuY2hhbm5lbENvdW50ID0gMCA9PT0gZCA/IDEgOiAyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAxMCA9PT0gYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMuX3BhcnNlQUFDQXVkaW9EYXRhKGUsIHQgKyAxLCBpIC0gMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsID09IGMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgwID09PSBjLnBhY2tldFR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuY29uZmlnICYmIHMuYS53KHRoaXMuVEFHLCAiRm91bmQgYW5vdGhlciBBdWRpb1NwZWNpZmljQ29uZmlnISIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSBjLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmF1ZGlvU2FtcGxlUmF0ZSA9IGwuc2FtcGxpbmdSYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5jaGFubmVsQ291bnQgPSBsLmNoYW5uZWxDb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuY29kZWMgPSBsLmNvZGVjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5vcmlnaW5hbENvZGVjID0gbC5vcmlnaW5hbENvZGVjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5jb25maWcgPSBsLmNvbmZpZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUucmVmU2FtcGxlRHVyYXRpb24gPSAxMDI0IC8gdS5hdWRpb1NhbXBsZVJhdGUgKiB1LnRpbWVzY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMuYS52KHRoaXMuVEFHLCAiUGFyc2VkIEF1ZGlvU3BlY2lmaWNDb25maWciKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzSW5pdGlhbE1ldGFkYXRhRGlzcGF0Y2hlZCgpID8gdGhpcy5fZGlzcGF0Y2ggJiYgKHRoaXMuX2F1ZGlvVHJhY2subGVuZ3RoIHx8IHRoaXMuX3ZpZGVvVHJhY2subGVuZ3RoKSAmJiB0aGlzLl9vbkRhdGFBdmFpbGFibGUodGhpcy5fYXVkaW9UcmFjaywgdGhpcy5fdmlkZW9UcmFjaykgOiB0aGlzLl9hdWRpb0luaXRpYWxNZXRhZGF0YURpc3BhdGNoZWQgPSAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vblRyYWNrTWV0YWRhdGEoImF1ZGlvIiwgdSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZyA9IHRoaXMuX21lZGlhSW5mbykuYXVkaW9Db2RlYyA9IHUub3JpZ2luYWxDb2RlYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuYXVkaW9TYW1wbGVSYXRlID0gdS5hdWRpb1NhbXBsZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLmF1ZGlvQ2hhbm5lbENvdW50ID0gdS5jaGFubmVsQ291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLmhhc1ZpZGVvID8gbnVsbCAhPSBnLnZpZGVvQ29kZWMgJiYgKGcubWltZVR5cGUgPSAndmlkZW8veC1mbHY7IGNvZGVjcz0iJyArIGcudmlkZW9Db2RlYyArICIsIiArIGcuYXVkaW9Db2RlYyArICciJykgOiBnLm1pbWVUeXBlID0gJ3ZpZGVvL3gtZmx2OyBjb2RlY3M9IicgKyBnLmF1ZGlvQ29kZWMgKyAnIicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLmlzQ29tcGxldGUoKSAmJiB0aGlzLl9vbk1lZGlhSW5mbyhnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKDEgPT09IGMucGFja2V0VHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSB0aGlzLl90aW1lc3RhbXBCYXNlICsgbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIHAgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pdDogYy5kYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aDogYy5kYXRhLmJ5dGVMZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHRzOiBmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB0czogZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uc2FtcGxlcy5wdXNoKHApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5sZW5ndGggKz0gYy5kYXRhLmxlbmd0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMuYS5lKHRoaXMuVEFHLCAiRmx2OiBVbnN1cHBvcnRlZCBBQUMgZGF0YSB0eXBlICIgKyBjLnBhY2tldFR5cGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgyID09PSBhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdS5jb2RlYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSAobCA9IHRoaXMuX3BhcnNlTVAzQXVkaW9EYXRhKGUsIHQgKyAxLCBpIC0gMSwgITApKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmF1ZGlvU2FtcGxlUmF0ZSA9IGwuc2FtcGxpbmdSYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5jaGFubmVsQ291bnQgPSBsLmNoYW5uZWxDb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuY29kZWMgPSBsLmNvZGVjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5vcmlnaW5hbENvZGVjID0gbC5vcmlnaW5hbENvZGVjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5yZWZTYW1wbGVEdXJhdGlvbiA9IDExNTIgLyB1LmF1ZGlvU2FtcGxlUmF0ZSAqIHUudGltZXNjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcy5hLnYodGhpcy5UQUcsICJQYXJzZWQgTVBFRyBBdWRpbyBGcmFtZSBIZWFkZXIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2F1ZGlvSW5pdGlhbE1ldGFkYXRhRGlzcGF0Y2hlZCA9ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fb25UcmFja01ldGFkYXRhKCJhdWRpbyIsIHUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGcgPSB0aGlzLl9tZWRpYUluZm8pLmF1ZGlvQ29kZWMgPSB1LmNvZGVjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5hdWRpb1NhbXBsZVJhdGUgPSB1LmF1ZGlvU2FtcGxlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuYXVkaW9DaGFubmVsQ291bnQgPSB1LmNoYW5uZWxDb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuYXVkaW9EYXRhUmF0ZSA9IGwuYml0UmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuaGFzVmlkZW8gPyBudWxsICE9IGcudmlkZW9Db2RlYyAmJiAoZy5taW1lVHlwZSA9ICd2aWRlby94LWZsdjsgY29kZWNzPSInICsgZy52aWRlb0NvZGVjICsgIiwiICsgZy5hdWRpb0NvZGVjICsgJyInKSA6IGcubWltZVR5cGUgPSAndmlkZW8veC1mbHY7IGNvZGVjcz0iJyArIGcuYXVkaW9Db2RlYyArICciJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuaXNDb21wbGV0ZSgpICYmIHRoaXMuX29uTWVkaWFJbmZvKGcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSB0aGlzLl9wYXJzZU1QM0F1ZGlvRGF0YShlLCB0ICsgMSwgaSAtIDEsICExKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gdikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IHRoaXMuX3RpbWVzdGFtcEJhc2UgKyBuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgeSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXQ6IHYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGg6IHYuYnl0ZUxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR0czogZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB0czogZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLnNhbXBsZXMucHVzaCh5KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5sZW5ndGggKz0gdi5sZW5ndGgKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbkVycm9yKG0uYS5GT1JNQVRfRVJST1IsICJGbHY6IEludmFsaWQgYXVkaW8gc2FtcGxlIHJhdGUgaWR4OiAiICsgaCkKICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbkVycm9yKG0uYS5DT0RFQ19VTlNVUFBPUlRFRCwgIkZsdjogVW5zdXBwb3J0ZWQgYXVkaW8gY29kZWMgaWR4OiAiICsgYSkKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fcGFyc2VBQUNBdWRpb0RhdGEgPSBmdW5jdGlvbihlLCB0LCBpKSB7CiAgICAgICAgICAgICAgaWYgKCEoaSA8PSAxKSkgewogICAgICAgICAgICAgICAgICB2YXIgbiA9IHt9CiAgICAgICAgICAgICAgICAgICAgLCByID0gbmV3IFVpbnQ4QXJyYXkoZSx0LGkpOwogICAgICAgICAgICAgICAgICByZXR1cm4gbi5wYWNrZXRUeXBlID0gclswXSwKICAgICAgICAgICAgICAgICAgMCA9PT0gclswXSA/IG4uZGF0YSA9IHRoaXMuX3BhcnNlQUFDQXVkaW9TcGVjaWZpY0NvbmZpZyhlLCB0ICsgMSwgaSAtIDEpIDogbi5kYXRhID0gci5zdWJhcnJheSgxKSwKICAgICAgICAgICAgICAgICAgbgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzLmEudyh0aGlzLlRBRywgIkZsdjogSW52YWxpZCBBQUMgcGFja2V0LCBtaXNzaW5nIEFBQ1BhY2tldFR5cGUgb3IvYW5kIERhdGEhIikKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9wYXJzZUFBQ0F1ZGlvU3BlY2lmaWNDb25maWcgPSBmdW5jdGlvbihlLCB0LCBpKSB7CiAgICAgICAgICAgICAgdmFyIG4sIHIsIHMgPSBuZXcgVWludDhBcnJheShlLHQsaSksIGEgPSBudWxsLCBvID0gMCwgaCA9IG51bGw7CiAgICAgICAgICAgICAgaWYgKG8gPSBuID0gc1swXSA+Pj4gMywKICAgICAgICAgICAgICAociA9ICg3ICYgc1swXSkgPDwgMSB8IHNbMV0gPj4+IDcpIDwgMCB8fCByID49IHRoaXMuX21wZWdTYW1wbGluZ1JhdGVzLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgdGhpcy5fb25FcnJvcihtLmEuRk9STUFUX0VSUk9SLCAiRmx2OiBBQUMgaW52YWxpZCBzYW1wbGluZyBmcmVxdWVuY3kgaW5kZXghIik7CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcy5fbXBlZ1NhbXBsaW5nUmF0ZXNbcl0KICAgICAgICAgICAgICAgICAgICAsIHUgPSAoMTIwICYgc1sxXSkgPj4+IDM7CiAgICAgICAgICAgICAgICAgIGlmICghKHUgPCAwIHx8IHUgPj0gOCkpIHsKICAgICAgICAgICAgICAgICAgICAgIDUgPT09IG8gJiYgKGggPSAoNyAmIHNbMV0pIDw8IDEgfCBzWzJdID4+PiA3LAogICAgICAgICAgICAgICAgICAgICAgKDEyNCAmIHNbMl0pID4+PiAyKTsKICAgICAgICAgICAgICAgICAgICAgIHZhciBfID0gc2VsZi5uYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTEgIT09IF8uaW5kZXhPZigiZmlyZWZveCIpID8gciA+PSA2ID8gKG8gPSA1LAogICAgICAgICAgICAgICAgICAgICAgYSA9IG5ldyBBcnJheSg0KSwKICAgICAgICAgICAgICAgICAgICAgIGggPSByIC0gMykgOiAobyA9IDIsCiAgICAgICAgICAgICAgICAgICAgICBhID0gbmV3IEFycmF5KDIpLAogICAgICAgICAgICAgICAgICAgICAgaCA9IHIpIDogLTEgIT09IF8uaW5kZXhPZigiYW5kcm9pZCIpID8gKG8gPSAyLAogICAgICAgICAgICAgICAgICAgICAgYSA9IG5ldyBBcnJheSgyKSwKICAgICAgICAgICAgICAgICAgICAgIGggPSByKSA6IChvID0gNSwKICAgICAgICAgICAgICAgICAgICAgIGggPSByLAogICAgICAgICAgICAgICAgICAgICAgYSA9IG5ldyBBcnJheSg0KSwKICAgICAgICAgICAgICAgICAgICAgIHIgPj0gNiA/IGggPSByIC0gMyA6IDEgPT09IHUgJiYgKG8gPSAyLAogICAgICAgICAgICAgICAgICAgICAgYSA9IG5ldyBBcnJheSgyKSwKICAgICAgICAgICAgICAgICAgICAgIGggPSByKSksCiAgICAgICAgICAgICAgICAgICAgICBhWzBdID0gbyA8PCAzLAogICAgICAgICAgICAgICAgICAgICAgYVswXSB8PSAoMTUgJiByKSA+Pj4gMSwKICAgICAgICAgICAgICAgICAgICAgIGFbMV0gPSAoMTUgJiByKSA8PCA3LAogICAgICAgICAgICAgICAgICAgICAgYVsxXSB8PSAoMTUgJiB1KSA8PCAzLAogICAgICAgICAgICAgICAgICAgICAgNSA9PT0gbyAmJiAoYVsxXSB8PSAoMTUgJiBoKSA+Pj4gMSwKICAgICAgICAgICAgICAgICAgICAgIGFbMl0gPSAoMSAmIGgpIDw8IDcsCiAgICAgICAgICAgICAgICAgICAgICBhWzJdIHw9IDgsCiAgICAgICAgICAgICAgICAgICAgICBhWzNdID0gMCksCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnOiBhLAogICAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBsaW5nUmF0ZTogZCwKICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsQ291bnQ6IHUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZWM6ICJtcDRhLjQwLiIgKyBvLAogICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsQ29kZWM6ICJtcDRhLjQwLiIgKyBuCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhpcy5fb25FcnJvcihtLmEuRk9STUFUX0VSUk9SLCAiRmx2OiBBQUMgaW52YWxpZCBjaGFubmVsIGNvbmZpZ3VyYXRpb24iKQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9wYXJzZU1QM0F1ZGlvRGF0YSA9IGZ1bmN0aW9uKGUsIHQsIGksIG4pIHsKICAgICAgICAgICAgICBpZiAoIShpIDwgNCkpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fbGl0dGxlRW5kaWFuOwogICAgICAgICAgICAgICAgICB2YXIgciA9IG5ldyBVaW50OEFycmF5KGUsdCxpKQogICAgICAgICAgICAgICAgICAgICwgYSA9IG51bGw7CiAgICAgICAgICAgICAgICAgIGlmIChuKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoMjU1ICE9PSByWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgIHZhciBvID0gclsxXSA+Pj4gMyAmIDMKICAgICAgICAgICAgICAgICAgICAgICAgLCBoID0gKDYgJiByWzFdKSA+PiAxCiAgICAgICAgICAgICAgICAgICAgICAgICwgZCA9ICgyNDAgJiByWzJdKSA+Pj4gNAogICAgICAgICAgICAgICAgICAgICAgICAsIHUgPSAoMTIgJiByWzJdKSA+Pj4gMgogICAgICAgICAgICAgICAgICAgICAgICAsIF8gPSAzICE9PSAoclszXSA+Pj4gNiAmIDMpID8gMiA6IDEKICAgICAgICAgICAgICAgICAgICAgICAgLCBjID0gMAogICAgICAgICAgICAgICAgICAgICAgICAsIGwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChvKSB7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMuX21wZWdBdWRpb1YyNVNhbXBsZVJhdGVUYWJsZVt1XTsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gdGhpcy5fbXBlZ0F1ZGlvVjIwU2FtcGxlUmF0ZVRhYmxlW3VdOwogICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSB0aGlzLl9tcGVnQXVkaW9WMTBTYW1wbGVSYXRlVGFibGVbdV0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoaCkgewogICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgIDM0LAogICAgICAgICAgICAgICAgICAgICAgICAgIGQgPCB0aGlzLl9tcGVnQXVkaW9MM0JpdFJhdGVUYWJsZS5sZW5ndGggJiYgKGwgPSB0aGlzLl9tcGVnQXVkaW9MM0JpdFJhdGVUYWJsZVtkXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgMzMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZCA8IHRoaXMuX21wZWdBdWRpb0wyQml0UmF0ZVRhYmxlLmxlbmd0aCAmJiAobCA9IHRoaXMuX21wZWdBdWRpb0wyQml0UmF0ZVRhYmxlW2RdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgICAgICAzMiwKICAgICAgICAgICAgICAgICAgICAgICAgICBkIDwgdGhpcy5fbXBlZ0F1ZGlvTDFCaXRSYXRlVGFibGUubGVuZ3RoICYmIChsID0gdGhpcy5fbXBlZ0F1ZGlvTDFCaXRSYXRlVGFibGVbZF0pCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBhID0gewogICAgICAgICAgICAgICAgICAgICAgICAgIGJpdFJhdGU6IGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtcGxpbmdSYXRlOiBjLAogICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5uZWxDb3VudDogXywKICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlYzogIm1wMyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxDb2RlYzogIm1wMyIKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICBhID0gcjsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcy5hLncodGhpcy5UQUcsICJGbHY6IEludmFsaWQgTVAzIHBhY2tldCwgaGVhZGVyIG1pc3NpbmchIikKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9wYXJzZVZpZGVvRGF0YSA9IGZ1bmN0aW9uKGUsIHQsIGksIG4sIHIpIHsKICAgICAgICAgICAgICBpZiAoaSA8PSAxKQogICAgICAgICAgICAgICAgICBzLmEudyh0aGlzLlRBRywgIkZsdjogSW52YWxpZCB2aWRlbyBwYWNrZXQsIG1pc3NpbmcgVmlkZW9EYXRhIHBheWxvYWQhIik7CiAgICAgICAgICAgICAgZWxzZSBpZiAoITAgIT09IHRoaXMuX2hhc1ZpZGVvRmxhZ092ZXJyaWRlZCB8fCAhMSAhPT0gdGhpcy5faGFzVmlkZW8pIHsKICAgICAgICAgICAgICAgICAgdmFyIGEgPSBuZXcgVWludDhBcnJheShlLHQsaSlbMF0KICAgICAgICAgICAgICAgICAgICAsIG8gPSAoMjQwICYgYSkgPj4+IDQKICAgICAgICAgICAgICAgICAgICAsIGggPSAxNSAmIGE7CiAgICAgICAgICAgICAgICAgIDcgPT09IGggPyB0aGlzLl9wYXJzZUFWQ1ZpZGVvUGFja2V0KGUsIHQgKyAxLCBpIC0gMSwgbiwgciwgbykgOiB0aGlzLl9vbkVycm9yKG0uYS5DT0RFQ19VTlNVUFBPUlRFRCwgIkZsdjogVW5zdXBwb3J0ZWQgY29kZWMgaW4gdmlkZW8gZnJhbWU6ICIgKyBoKQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9wYXJzZUFWQ1ZpZGVvUGFja2V0ID0gZnVuY3Rpb24oZSwgdCwgaSwgbiwgciwgYSkgewogICAgICAgICAgICAgIGlmIChpIDwgNCkKICAgICAgICAgICAgICAgICAgcy5hLncodGhpcy5UQUcsICJGbHY6IEludmFsaWQgQVZDIHBhY2tldCwgbWlzc2luZyBBVkNQYWNrZXRUeXBlIG9yL2FuZCBDb21wb3NpdGlvblRpbWUiKTsKICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgdmFyIG8gPSB0aGlzLl9saXR0bGVFbmRpYW4KICAgICAgICAgICAgICAgICAgICAsIGggPSBuZXcgRGF0YVZpZXcoZSx0LGkpCiAgICAgICAgICAgICAgICAgICAgLCBkID0gaC5nZXRVaW50OCgwKQogICAgICAgICAgICAgICAgICAgICwgdSA9ICgxNjc3NzIxNSAmIGguZ2V0VWludDMyKDAsICFvKSkgPDwgOCA+PiA4OwogICAgICAgICAgICAgICAgICBpZiAoMCA9PT0gZCkKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BhcnNlQVZDRGVjb2RlckNvbmZpZ3VyYXRpb25SZWNvcmQoZSwgdCArIDQsIGkgLSA0KTsKICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoMSA9PT0gZCkKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BhcnNlQVZDVmlkZW9EYXRhKGUsIHQgKyA0LCBpIC0gNCwgbiwgciwgYSwgdSk7CiAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKDIgIT09IGQpCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCB0aGlzLl9vbkVycm9yKG0uYS5GT1JNQVRfRVJST1IsICJGbHY6IEludmFsaWQgdmlkZW8gcGFja2V0IHR5cGUgIiArIGQpCiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX3BhcnNlQVZDRGVjb2RlckNvbmZpZ3VyYXRpb25SZWNvcmQgPSBmdW5jdGlvbihlLCB0LCBpKSB7CiAgICAgICAgICAgICAgaWYgKGkgPCA3KQogICAgICAgICAgICAgICAgICBzLmEudyh0aGlzLlRBRywgIkZsdjogSW52YWxpZCBBVkNEZWNvZGVyQ29uZmlndXJhdGlvblJlY29yZCwgbGFjayBvZiBkYXRhISIpOwogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICB2YXIgbiA9IHRoaXMuX3ZpZGVvTWV0YWRhdGEKICAgICAgICAgICAgICAgICAgICAsIHIgPSB0aGlzLl92aWRlb1RyYWNrCiAgICAgICAgICAgICAgICAgICAgLCBhID0gdGhpcy5fbGl0dGxlRW5kaWFuCiAgICAgICAgICAgICAgICAgICAgLCBvID0gbmV3IERhdGFWaWV3KGUsdCxpKTsKICAgICAgICAgICAgICAgICAgbiA/IHZvaWQgMCAhPT0gbi5hdmNjICYmIHMuYS53KHRoaXMuVEFHLCAiRm91bmQgYW5vdGhlciBBVkNEZWNvZGVyQ29uZmlndXJhdGlvblJlY29yZCEiKSA6ICghMSA9PT0gdGhpcy5faGFzVmlkZW8gJiYgITEgPT09IHRoaXMuX2hhc1ZpZGVvRmxhZ092ZXJyaWRlZCAmJiAodGhpcy5faGFzVmlkZW8gPSAhMCwKICAgICAgICAgICAgICAgICAgdGhpcy5fbWVkaWFJbmZvLmhhc1ZpZGVvID0gITApLAogICAgICAgICAgICAgICAgICAobiA9IHRoaXMuX3ZpZGVvTWV0YWRhdGEgPSB7fSkudHlwZSA9ICJ2aWRlbyIsCiAgICAgICAgICAgICAgICAgIG4uaWQgPSByLmlkLAogICAgICAgICAgICAgICAgICBuLnRpbWVzY2FsZSA9IHRoaXMuX3RpbWVzY2FsZSwKICAgICAgICAgICAgICAgICAgbi5kdXJhdGlvbiA9IHRoaXMuX2R1cmF0aW9uKTsKICAgICAgICAgICAgICAgICAgdmFyIGggPSBvLmdldFVpbnQ4KDApCiAgICAgICAgICAgICAgICAgICAgLCBkID0gby5nZXRVaW50OCgxKTsKICAgICAgICAgICAgICAgICAgby5nZXRVaW50OCgyKSwKICAgICAgICAgICAgICAgICAgby5nZXRVaW50OCgzKTsKICAgICAgICAgICAgICAgICAgaWYgKDEgPT09IGggJiYgMCAhPT0gZCkKICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9uYWx1TGVuZ3RoU2l6ZSA9IDEgKyAoMyAmIG8uZ2V0VWludDgoNCkpLAogICAgICAgICAgICAgICAgICAgICAgMyA9PT0gdGhpcy5fbmFsdUxlbmd0aFNpemUgfHwgNCA9PT0gdGhpcy5fbmFsdUxlbmd0aFNpemUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdSA9IDMxICYgby5nZXRVaW50OCg1KTsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMCAhPT0gdSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID4gMSAmJiBzLmEudyh0aGlzLlRBRywgIkZsdjogU3RyYW5nZSBBVkNEZWNvZGVyQ29uZmlndXJhdGlvblJlY29yZDogU1BTIENvdW50ID0gIiArIHUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBfID0gNiwgYyA9IDA7IGMgPCB1OyBjKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsID0gby5nZXRVaW50MTYoXywgIWEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF8gKz0gMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgIT09IGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IG5ldyBVaW50OEFycmF5KGUsdCArIF8sbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyArPSBsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gcC5wYXJzZVNQUyhmKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMCA9PT0gYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLmNvZGVjV2lkdGggPSBnLmNvZGVjX3NpemUud2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uY29kZWNIZWlnaHQgPSBnLmNvZGVjX3NpemUuaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnByZXNlbnRXaWR0aCA9IGcucHJlc2VudF9zaXplLndpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnByZXNlbnRIZWlnaHQgPSBnLnByZXNlbnRfc2l6ZS5oZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4ucHJvZmlsZSA9IGcucHJvZmlsZV9zdHJpbmcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4ubGV2ZWwgPSBnLmxldmVsX3N0cmluZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5iaXREZXB0aCA9IGcuYml0X2RlcHRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLmNocm9tYUZvcm1hdCA9IGcuY2hyb21hX2Zvcm1hdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5zYXJSYXRpbyA9IGcuc2FyX3JhdGlvLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLmZyYW1lUmF0ZSA9IGcuZnJhbWVfcmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgITEgIT09IGcuZnJhbWVfcmF0ZS5maXhlZCAmJiAwICE9PSBnLmZyYW1lX3JhdGUuZnBzX251bSAmJiAwICE9PSBnLmZyYW1lX3JhdGUuZnBzX2RlbiB8fCAobi5mcmFtZVJhdGUgPSB0aGlzLl9yZWZlcmVuY2VGcmFtZVJhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdiA9IG4uZnJhbWVSYXRlLmZwc19kZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIHkgPSBuLmZyYW1lUmF0ZS5mcHNfbnVtOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnJlZlNhbXBsZUR1cmF0aW9uID0gbi50aW1lc2NhbGUgKiAodiAvIHkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBiID0gZi5zdWJhcnJheSgxLCA0KSwgRSA9ICJhdmMxLiIsIFMgPSAwOyBTIDwgMzsgUysrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgQSA9IGJbU10udG9TdHJpbmcoMTYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQS5sZW5ndGggPCAyICYmIChBID0gIjAiICsgQSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFICs9IEEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLmNvZGVjID0gRTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIFIgPSB0aGlzLl9tZWRpYUluZm87CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFIud2lkdGggPSBuLmNvZGVjV2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFIuaGVpZ2h0ID0gbi5jb2RlY0hlaWdodCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUi5mcHMgPSBuLmZyYW1lUmF0ZS5mcHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFIucHJvZmlsZSA9IG4ucHJvZmlsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUi5sZXZlbCA9IG4ubGV2ZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFIucmVmRnJhbWVzID0gZy5yZWZfZnJhbWVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSLmNocm9tYUZvcm1hdCA9IGcuY2hyb21hX2Zvcm1hdF9zdHJpbmcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFIuc2FyTnVtID0gbi5zYXJSYXRpby53aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUi5zYXJEZW4gPSBuLnNhclJhdGlvLmhlaWdodCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUi52aWRlb0NvZGVjID0gRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUi5oYXNBdWRpbyA/IG51bGwgIT0gUi5hdWRpb0NvZGVjICYmIChSLm1pbWVUeXBlID0gJ3ZpZGVvL3gtZmx2OyBjb2RlY3M9IicgKyBSLnZpZGVvQ29kZWMgKyAiLCIgKyBSLmF1ZGlvQ29kZWMgKyAnIicpIDogUi5taW1lVHlwZSA9ICd2aWRlby94LWZsdjsgY29kZWNzPSInICsgUi52aWRlb0NvZGVjICsgJyInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSLmlzQ29tcGxldGUoKSAmJiB0aGlzLl9vbk1lZGlhSW5mbyhSKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgTCA9IG8uZ2V0VWludDgoXyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgwICE9PSBMKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMID4gMSAmJiBzLmEudyh0aGlzLlRBRywgIkZsdjogU3RyYW5nZSBBVkNEZWNvZGVyQ29uZmlndXJhdGlvblJlY29yZDogUFBTIENvdW50ID0gIiArIEwpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXysrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IEw7IGMrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBvLmdldFVpbnQxNihfLCAhYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXyArPSAyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgIT09IGwgJiYgKF8gKz0gbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uYXZjYyA9IG5ldyBVaW50OEFycmF5KGkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5hdmNjLnNldChuZXcgVWludDhBcnJheShlLHQsaSksIDApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcy5hLnYodGhpcy5UQUcsICJQYXJzZWQgQVZDRGVjb2RlckNvbmZpZ3VyYXRpb25SZWNvcmQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzSW5pdGlhbE1ldGFkYXRhRGlzcGF0Y2hlZCgpID8gdGhpcy5fZGlzcGF0Y2ggJiYgKHRoaXMuX2F1ZGlvVHJhY2subGVuZ3RoIHx8IHRoaXMuX3ZpZGVvVHJhY2subGVuZ3RoKSAmJiB0aGlzLl9vbkRhdGFBdmFpbGFibGUodGhpcy5fYXVkaW9UcmFjaywgdGhpcy5fdmlkZW9UcmFjaykgOiB0aGlzLl92aWRlb0luaXRpYWxNZXRhZGF0YURpc3BhdGNoZWQgPSAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vblRyYWNrTWV0YWRhdGEoInZpZGVvIiwgbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbkVycm9yKG0uYS5GT1JNQVRfRVJST1IsICJGbHY6IEludmFsaWQgQVZDRGVjb2RlckNvbmZpZ3VyYXRpb25SZWNvcmQ6IE5vIFBQUyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29uRXJyb3IobS5hLkZPUk1BVF9FUlJPUiwgIkZsdjogSW52YWxpZCBBVkNEZWNvZGVyQ29uZmlndXJhdGlvblJlY29yZDogTm8gU1BTIikKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29uRXJyb3IobS5hLkZPUk1BVF9FUlJPUiwgIkZsdjogU3RyYW5nZSBOYWx1TGVuZ3RoU2l6ZU1pbnVzT25lOiAiICsgKHRoaXMuX25hbHVMZW5ndGhTaXplIC0gMSkpOwogICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbkVycm9yKG0uYS5GT1JNQVRfRVJST1IsICJGbHY6IEludmFsaWQgQVZDRGVjb2RlckNvbmZpZ3VyYXRpb25SZWNvcmQiKQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9wYXJzZUFWQ1ZpZGVvRGF0YSA9IGZ1bmN0aW9uKGUsIHQsIGksIG4sIHIsIGEsIG8pIHsKICAgICAgICAgICAgICBmb3IgKHZhciBoID0gdGhpcy5fbGl0dGxlRW5kaWFuLCBkID0gbmV3IERhdGFWaWV3KGUsdCxpKSwgdSA9IFtdLCBfID0gMCwgYyA9IDAsIGwgPSB0aGlzLl9uYWx1TGVuZ3RoU2l6ZSwgZiA9IHRoaXMuX3RpbWVzdGFtcEJhc2UgKyBuLCBwID0gMSA9PT0gYTsgYyA8IGk7ICkgewogICAgICAgICAgICAgICAgICBpZiAoYyArIDQgPj0gaSkgewogICAgICAgICAgICAgICAgICAgICAgcy5hLncodGhpcy5UQUcsICJNYWxmb3JtZWQgTmFsdSBuZWFyIHRpbWVzdGFtcCAiICsgZiArICIsIG9mZnNldCA9ICIgKyBjICsgIiwgZGF0YVNpemUgPSAiICsgaSk7CiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHZhciBtID0gZC5nZXRVaW50MzIoYywgIWgpOwogICAgICAgICAgICAgICAgICBpZiAoMyA9PT0gbCAmJiAobSA+Pj49IDgpLAogICAgICAgICAgICAgICAgICBtID4gaSAtIGwpCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCBzLmEudyh0aGlzLlRBRywgIk1hbGZvcm1lZCBOYWx1cyBuZWFyIHRpbWVzdGFtcCAiICsgZiArICIsIE5hbHVTaXplID4gRGF0YVNpemUhIik7CiAgICAgICAgICAgICAgICAgIHZhciBnID0gMzEgJiBkLmdldFVpbnQ4KGMgKyBsKTsKICAgICAgICAgICAgICAgICAgNSA9PT0gZyAmJiAocCA9ICEwKTsKICAgICAgICAgICAgICAgICAgdmFyIHYgPSBuZXcgVWludDhBcnJheShlLHQgKyBjLGwgKyBtKQogICAgICAgICAgICAgICAgICAgICwgeSA9IHsKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGcsCiAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB2CiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIHUucHVzaCh5KSwKICAgICAgICAgICAgICAgICAgXyArPSB2LmJ5dGVMZW5ndGgsCiAgICAgICAgICAgICAgICAgIGMgKz0gbCArIG0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5fdmlkZW9UcmFjawogICAgICAgICAgICAgICAgICAgICwgRSA9IHsKICAgICAgICAgICAgICAgICAgICAgIHVuaXRzOiB1LAogICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoOiBfLAogICAgICAgICAgICAgICAgICAgICAgaXNLZXlmcmFtZTogcCwKICAgICAgICAgICAgICAgICAgICAgIGR0czogZiwKICAgICAgICAgICAgICAgICAgICAgIGN0czogbywKICAgICAgICAgICAgICAgICAgICAgIHB0czogZiArIG8KICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgcCAmJiAoRS5maWxlcG9zaXRpb24gPSByKSwKICAgICAgICAgICAgICAgICAgYi5zYW1wbGVzLnB1c2goRSksCiAgICAgICAgICAgICAgICAgIGIubGVuZ3RoICs9IF8KICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlCiAgICAgIH0oKSwgeSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgZnVuY3Rpb24gZSgpIHt9CiAgICAgICAgICByZXR1cm4gZS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMub25FcnJvciA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5vbk1lZGlhSW5mbyA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5vbk1ldGFEYXRhQXJyaXZlZCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5vblRyYWNrTWV0YWRhdGEgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMub25EYXRhQXZhaWxhYmxlID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLm9uVGltZWRJRDNNZXRhZGF0YSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5vblBFU1ByaXZhdGVEYXRhID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLm9uUEVTUHJpdmF0ZURhdGFEZXNjcmlwdG9yID0gbnVsbAogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZQogICAgICB9KCksIGIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHRoaXMucHJvZ3JhbV9wbXRfcGlkID0ge30KICAgICAgfTsKICAgICAgIWZ1bmN0aW9uKGUpIHsKICAgICAgICAgIGVbZS5rTVBFRzFBdWRpbyA9IDNdID0gImtNUEVHMUF1ZGlvIiwKICAgICAgICAgIGVbZS5rTVBFRzJBdWRpbyA9IDRdID0gImtNUEVHMkF1ZGlvIiwKICAgICAgICAgIGVbZS5rUEVTUHJpdmF0ZURhdGEgPSA2XSA9ICJrUEVTUHJpdmF0ZURhdGEiLAogICAgICAgICAgZVtlLmtBRFRTQUFDID0gMTVdID0gImtBRFRTQUFDIiwKICAgICAgICAgIGVbZS5rSUQzID0gMjFdID0gImtJRDMiLAogICAgICAgICAgZVtlLmtIMjY0ID0gMjddID0gImtIMjY0IiwKICAgICAgICAgIGVbZS5rSDI2NSA9IDM2XSA9ICJrSDI2NSIKICAgICAgfShnIHx8IChnID0ge30pKTsKICAgICAgdmFyIEUsIFMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHRoaXMucGlkX3N0cmVhbV90eXBlID0ge30sCiAgICAgICAgICB0aGlzLmNvbW1vbl9waWRzID0gewogICAgICAgICAgICAgIGgyNjQ6IHZvaWQgMCwKICAgICAgICAgICAgICBhZHRzX2FhYzogdm9pZCAwCiAgICAgICAgICB9LAogICAgICAgICAgdGhpcy5wZXNfcHJpdmF0ZV9kYXRhX3BpZHMgPSB7fSwKICAgICAgICAgIHRoaXMudGltZWRfaWQzX3BpZHMgPSB7fQogICAgICB9LCBBID0gZnVuY3Rpb24oKSB7fSwgUiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdGhpcy5zbGljZXMgPSBbXSwKICAgICAgICAgIHRoaXMudG90YWxfbGVuZ3RoID0gMCwKICAgICAgICAgIHRoaXMuZmlsZV9wb3NpdGlvbiA9IDAKICAgICAgfTsKICAgICAgIWZ1bmN0aW9uKGUpIHsKICAgICAgICAgIGVbZS5rVW5zcGVjaWZpZWQgPSAwXSA9ICJrVW5zcGVjaWZpZWQiLAogICAgICAgICAgZVtlLmtTbGljZU5vbklEUiA9IDFdID0gImtTbGljZU5vbklEUiIsCiAgICAgICAgICBlW2Uua1NsaWNlRFBBID0gMl0gPSAia1NsaWNlRFBBIiwKICAgICAgICAgIGVbZS5rU2xpY2VEUEIgPSAzXSA9ICJrU2xpY2VEUEIiLAogICAgICAgICAgZVtlLmtTbGljZURQQyA9IDRdID0gImtTbGljZURQQyIsCiAgICAgICAgICBlW2Uua1NsaWNlSURSID0gNV0gPSAia1NsaWNlSURSIiwKICAgICAgICAgIGVbZS5rU2xpY2VTRUkgPSA2XSA9ICJrU2xpY2VTRUkiLAogICAgICAgICAgZVtlLmtTbGljZVNQUyA9IDddID0gImtTbGljZVNQUyIsCiAgICAgICAgICBlW2Uua1NsaWNlUFBTID0gOF0gPSAia1NsaWNlUFBTIiwKICAgICAgICAgIGVbZS5rU2xpY2VBVUQgPSA5XSA9ICJrU2xpY2VBVUQiLAogICAgICAgICAgZVtlLmtFbmRPZlNlcXVlbmNlID0gMTBdID0gImtFbmRPZlNlcXVlbmNlIiwKICAgICAgICAgIGVbZS5rRW5kT2ZTdHJlYW0gPSAxMV0gPSAia0VuZE9mU3RyZWFtIiwKICAgICAgICAgIGVbZS5rRmlsbGVyID0gMTJdID0gImtGaWxsZXIiLAogICAgICAgICAgZVtlLmtTUFNFeHQgPSAxM10gPSAia1NQU0V4dCIsCiAgICAgICAgICBlW2Uua1Jlc2VydmVkMCA9IDE0XSA9ICJrUmVzZXJ2ZWQwIgogICAgICB9KEUgfHwgKEUgPSB7fSkpOwogICAgICB2YXIgTCwgVCwgdyA9IGZ1bmN0aW9uKCkge30sIEQgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICB2YXIgdCA9IGUuZGF0YS5ieXRlTGVuZ3RoOwogICAgICAgICAgdGhpcy50eXBlID0gZS50eXBlLAogICAgICAgICAgdGhpcy5kYXRhID0gbmV3IFVpbnQ4QXJyYXkoNCArIHQpLAogICAgICAgICAgbmV3IERhdGFWaWV3KHRoaXMuZGF0YS5idWZmZXIpLnNldFVpbnQzMigwLCB0KSwKICAgICAgICAgIHRoaXMuZGF0YS5zZXQoZS5kYXRhLCA0KQogICAgICB9LCBrID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBmdW5jdGlvbiBlKGUpIHsKICAgICAgICAgICAgICB0aGlzLlRBRyA9ICJIMjY0QW5uZXhCUGFyc2VyIiwKICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRfc3RhcnRjb2RlX29mZnNldF8gPSAwLAogICAgICAgICAgICAgIHRoaXMuZW9mX2ZsYWdfID0gITEsCiAgICAgICAgICAgICAgdGhpcy5kYXRhXyA9IGUsCiAgICAgICAgICAgICAgdGhpcy5jdXJyZW50X3N0YXJ0Y29kZV9vZmZzZXRfID0gdGhpcy5maW5kTmV4dFN0YXJ0Q29kZU9mZnNldCgwKSwKICAgICAgICAgICAgICB0aGlzLmVvZl9mbGFnXyAmJiBzLmEuZSh0aGlzLlRBRywgIkNvdWxkIG5vdCBmb3VuZCBIMjY0IHN0YXJ0Y29kZSB1bnRpbCBwYXlsb2FkIGVuZCEiKQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUucHJvdG90eXBlLmZpbmROZXh0U3RhcnRDb2RlT2Zmc2V0ID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGZvciAodmFyIHQgPSBlLCBpID0gdGhpcy5kYXRhXzsgOyApIHsKICAgICAgICAgICAgICAgICAgaWYgKHQgKyAzID49IGkuYnl0ZUxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVvZl9mbGFnXyA9ICEwLAogICAgICAgICAgICAgICAgICAgICAgaS5ieXRlTGVuZ3RoOwogICAgICAgICAgICAgICAgICB2YXIgbiA9IGlbdCArIDBdIDw8IDI0IHwgaVt0ICsgMV0gPDwgMTYgfCBpW3QgKyAyXSA8PCA4IHwgaVt0ICsgM10KICAgICAgICAgICAgICAgICAgICAsIHIgPSBpW3QgKyAwXSA8PCAxNiB8IGlbdCArIDFdIDw8IDggfCBpW3QgKyAyXTsKICAgICAgICAgICAgICAgICAgaWYgKDEgPT09IG4gfHwgMSA9PT0gcikKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0OwogICAgICAgICAgICAgICAgICB0KysKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5yZWFkTmV4dE5hbHVQYXlsb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgZSA9IHRoaXMuZGF0YV8sIHQgPSBudWxsOyBudWxsID09IHQgJiYgIXRoaXMuZW9mX2ZsYWdfOyApIHsKICAgICAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzLmN1cnJlbnRfc3RhcnRjb2RlX29mZnNldF8KICAgICAgICAgICAgICAgICAgICAsIG4gPSAzMSAmIGVbaSArPSAxID09PSAoZVtpXSA8PCAyNCB8IGVbaSArIDFdIDw8IDE2IHwgZVtpICsgMl0gPDwgOCB8IGVbaSArIDNdKSA/IDQgOiAzXQogICAgICAgICAgICAgICAgICAgICwgciA9ICgxMjggJiBlW2ldKSA+Pj4gNwogICAgICAgICAgICAgICAgICAgICwgcyA9IHRoaXMuZmluZE5leHRTdGFydENvZGVPZmZzZXQoaSk7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRfc3RhcnRjb2RlX29mZnNldF8gPSBzLAogICAgICAgICAgICAgICAgICAhKG4gPj0gRS5rUmVzZXJ2ZWQwKSAmJiAwID09PSByKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IGUuc3ViYXJyYXkoaSwgcyk7CiAgICAgICAgICAgICAgICAgICAgICAodCA9IG5ldyB3KS50eXBlID0gbiwKICAgICAgICAgICAgICAgICAgICAgIHQuZGF0YSA9IGEKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gdAogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZQogICAgICB9KCksIEMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGZ1bmN0aW9uIGUoZSwgdCwgaSkgewogICAgICAgICAgICAgIHZhciBuID0gOCArIGUuYnl0ZUxlbmd0aCArIDEgKyAyICsgdC5ieXRlTGVuZ3RoCiAgICAgICAgICAgICAgICAsIHIgPSAhMTsKICAgICAgICAgICAgICA2NiAhPT0gZVszXSAmJiA3NyAhPT0gZVszXSAmJiA4OCAhPT0gZVszXSAmJiAociA9ICEwLAogICAgICAgICAgICAgIG4gKz0gNCk7CiAgICAgICAgICAgICAgdmFyIHMgPSB0aGlzLmRhdGEgPSBuZXcgVWludDhBcnJheShuKTsKICAgICAgICAgICAgICBzWzBdID0gMSwKICAgICAgICAgICAgICBzWzFdID0gZVsxXSwKICAgICAgICAgICAgICBzWzJdID0gZVsyXSwKICAgICAgICAgICAgICBzWzNdID0gZVszXSwKICAgICAgICAgICAgICBzWzRdID0gMjU1LAogICAgICAgICAgICAgIHNbNV0gPSAyMjU7CiAgICAgICAgICAgICAgdmFyIGEgPSBlLmJ5dGVMZW5ndGg7CiAgICAgICAgICAgICAgc1s2XSA9IGEgPj4+IDgsCiAgICAgICAgICAgICAgc1s3XSA9IDI1NSAmIGE7CiAgICAgICAgICAgICAgdmFyIG8gPSA4OwogICAgICAgICAgICAgIHMuc2V0KGUsIDgpLAogICAgICAgICAgICAgIHNbbyArPSBhXSA9IDE7CiAgICAgICAgICAgICAgdmFyIGggPSB0LmJ5dGVMZW5ndGg7CiAgICAgICAgICAgICAgc1tvICsgMV0gPSBoID4+PiA4LAogICAgICAgICAgICAgIHNbbyArIDJdID0gMjU1ICYgaCwKICAgICAgICAgICAgICBzLnNldCh0LCBvICsgMyksCiAgICAgICAgICAgICAgbyArPSAzICsgaCwKICAgICAgICAgICAgICByICYmIChzW29dID0gMjUyIHwgaS5jaHJvbWFfZm9ybWF0X2lkYywKICAgICAgICAgICAgICBzW28gKyAxXSA9IDI0OCB8IGkuYml0X2RlcHRoX2x1bWEgLSA4LAogICAgICAgICAgICAgIHNbbyArIDJdID0gMjQ4IHwgaS5iaXRfZGVwdGhfY2hyb21hIC0gOCwKICAgICAgICAgICAgICBzW28gKyAzXSA9IDAsCiAgICAgICAgICAgICAgbyArPSA0KQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUucHJvdG90eXBlLmdldERhdGEgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlCiAgICAgIH0oKTsKICAgICAgIWZ1bmN0aW9uKGUpIHsKICAgICAgICAgIGVbZS5rTnVsbCA9IDBdID0gImtOdWxsIiwKICAgICAgICAgIGVbZS5rQUFDTWFpbiA9IDFdID0gImtBQUNNYWluIiwKICAgICAgICAgIGVbZS5rQUFDX0xDID0gMl0gPSAia0FBQ19MQyIsCiAgICAgICAgICBlW2Uua0FBQ19TU1IgPSAzXSA9ICJrQUFDX1NTUiIsCiAgICAgICAgICBlW2Uua0FBQ19MVFAgPSA0XSA9ICJrQUFDX0xUUCIsCiAgICAgICAgICBlW2Uua0FBQ19TQlIgPSA1XSA9ICJrQUFDX1NCUiIsCiAgICAgICAgICBlW2Uua0FBQ19TY2FsYWJsZSA9IDZdID0gImtBQUNfU2NhbGFibGUiLAogICAgICAgICAgZVtlLmtMYXllcjEgPSAzMl0gPSAia0xheWVyMSIsCiAgICAgICAgICBlW2Uua0xheWVyMiA9IDMzXSA9ICJrTGF5ZXIyIiwKICAgICAgICAgIGVbZS5rTGF5ZXIzID0gMzRdID0gImtMYXllcjMiCiAgICAgIH0oTCB8fCAoTCA9IHt9KSksCiAgICAgIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgIGVbZS5rOTYwMDBIeiA9IDBdID0gIms5NjAwMEh6IiwKICAgICAgICAgIGVbZS5rODgyMDBIeiA9IDFdID0gIms4ODIwMEh6IiwKICAgICAgICAgIGVbZS5rNjQwMDBIeiA9IDJdID0gIms2NDAwMEh6IiwKICAgICAgICAgIGVbZS5rNDgwMDBIeiA9IDNdID0gIms0ODAwMEh6IiwKICAgICAgICAgIGVbZS5rNDQxMDBIeiA9IDRdID0gIms0NDEwMEh6IiwKICAgICAgICAgIGVbZS5rMzIwMDBIeiA9IDVdID0gImszMjAwMEh6IiwKICAgICAgICAgIGVbZS5rMjQwMDBIeiA9IDZdID0gImsyNDAwMEh6IiwKICAgICAgICAgIGVbZS5rMjIwNTBIeiA9IDddID0gImsyMjA1MEh6IiwKICAgICAgICAgIGVbZS5rMTYwMDBIeiA9IDhdID0gImsxNjAwMEh6IiwKICAgICAgICAgIGVbZS5rMTIwMDBIeiA9IDldID0gImsxMjAwMEh6IiwKICAgICAgICAgIGVbZS5rMTEwMjVIeiA9IDEwXSA9ICJrMTEwMjVIeiIsCiAgICAgICAgICBlW2UuazgwMDBIeiA9IDExXSA9ICJrODAwMEh6IiwKICAgICAgICAgIGVbZS5rNzM1MEh6ID0gMTJdID0gIms3MzUwSHoiCiAgICAgIH0oVCB8fCAoVCA9IHt9KSk7CiAgICAgIHZhciBJLCBPID0gWzk2ZTMsIDg4MjAwLCA2NGUzLCA0OGUzLCA0NDEwMCwgMzJlMywgMjRlMywgMjIwNTAsIDE2ZTMsIDEyZTMsIDExMDI1LCA4ZTMsIDczNTBdLCBQID0gZnVuY3Rpb24oKSB7fSwgTSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgZnVuY3Rpb24gZShlKSB7CiAgICAgICAgICAgICAgdGhpcy5UQUcgPSAiQUFDQURUU1BhcnNlciIsCiAgICAgICAgICAgICAgdGhpcy5kYXRhXyA9IGUsCiAgICAgICAgICAgICAgdGhpcy5jdXJyZW50X3N5bmN3b3JkX29mZnNldF8gPSB0aGlzLmZpbmROZXh0U3luY3dvcmRPZmZzZXQoMCksCiAgICAgICAgICAgICAgdGhpcy5lb2ZfZmxhZ18gJiYgcy5hLmUodGhpcy5UQUcsICJDb3VsZCBub3QgZm91bmQgQURUUyBzeW5jd29yZCB1bnRpbCBwYXlsb2FkIGVuZCIpCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZS5wcm90b3R5cGUuZmluZE5leHRTeW5jd29yZE9mZnNldCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBmb3IgKHZhciB0ID0gZSwgaSA9IHRoaXMuZGF0YV87IDsgKSB7CiAgICAgICAgICAgICAgICAgIGlmICh0ICsgNyA+PSBpLmJ5dGVMZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lb2ZfZmxhZ18gPSAhMCwKICAgICAgICAgICAgICAgICAgICAgIGkuYnl0ZUxlbmd0aDsKICAgICAgICAgICAgICAgICAgaWYgKDQwOTUgPT09IChpW3QgKyAwXSA8PCA4IHwgaVt0ICsgMV0pID4+PiA0KQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgICAgICAgICAgIHQrKwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLnJlYWROZXh0QUFDRnJhbWUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBlID0gdGhpcy5kYXRhXywgdCA9IG51bGw7IG51bGwgPT0gdCAmJiAhdGhpcy5lb2ZfZmxhZ187ICkgewogICAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMuY3VycmVudF9zeW5jd29yZF9vZmZzZXRfCiAgICAgICAgICAgICAgICAgICAgLCBuID0gKDggJiBlW2kgKyAxXSkgPj4+IDMKICAgICAgICAgICAgICAgICAgICAsIHIgPSAoNiAmIGVbaSArIDFdKSA+Pj4gMQogICAgICAgICAgICAgICAgICAgICwgcyA9IDEgJiBlW2kgKyAxXQogICAgICAgICAgICAgICAgICAgICwgYSA9ICgxOTIgJiBlW2kgKyAyXSkgPj4+IDYKICAgICAgICAgICAgICAgICAgICAsIG8gPSAoNjAgJiBlW2kgKyAyXSkgPj4+IDIKICAgICAgICAgICAgICAgICAgICAsIGggPSAoMSAmIGVbaSArIDJdKSA8PCAyIHwgKDE5MiAmIGVbaSArIDNdKSA+Pj4gNgogICAgICAgICAgICAgICAgICAgICwgZCA9ICgzICYgZVtpICsgM10pIDw8IDExIHwgZVtpICsgNF0gPDwgMyB8ICgyMjQgJiBlW2kgKyA1XSkgPj4+IDU7CiAgICAgICAgICAgICAgICAgIGVbaSArIDZdOwogICAgICAgICAgICAgICAgICBpZiAoaSArIGQgPiB0aGlzLmRhdGFfLmJ5dGVMZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW9mX2ZsYWdfID0gITAsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhc19sYXN0X2luY29tcGxldGVfZGF0YSA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB2YXIgdSA9IDEgPT09IHMgPyA3IDogOQogICAgICAgICAgICAgICAgICAgICwgXyA9IGQgLSB1OwogICAgICAgICAgICAgICAgICBpICs9IHU7CiAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5maW5kTmV4dFN5bmN3b3JkT2Zmc2V0KGkgKyBfKTsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudF9zeW5jd29yZF9vZmZzZXRfID0gYywKICAgICAgICAgICAgICAgICAgKDAgPT09IG4gfHwgMSA9PT0gbikgJiYgMCA9PT0gcikgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSBlLnN1YmFycmF5KGksIGkgKyBfKTsKICAgICAgICAgICAgICAgICAgICAgICh0ID0gbmV3IFApLmF1ZGlvX29iamVjdF90eXBlID0gYSArIDEsCiAgICAgICAgICAgICAgICAgICAgICB0LnNhbXBsaW5nX2ZyZXFfaW5kZXggPSBvLAogICAgICAgICAgICAgICAgICAgICAgdC5zYW1wbGluZ19mcmVxdWVuY3kgPSBPW29dLAogICAgICAgICAgICAgICAgICAgICAgdC5jaGFubmVsX2NvbmZpZyA9IGgsCiAgICAgICAgICAgICAgICAgICAgICB0LmRhdGEgPSBsCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHQKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLmhhc0luY29tcGxldGVEYXRhID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGFzX2xhc3RfaW5jb21wbGV0ZV9kYXRhCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5nZXRJbmNvbXBsZXRlRGF0YSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLmhhc19sYXN0X2luY29tcGxldGVfZGF0YSA/IHRoaXMuZGF0YV8uc3ViYXJyYXkodGhpcy5jdXJyZW50X3N5bmN3b3JkX29mZnNldF8pIDogbnVsbAogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZQogICAgICB9KCksIHggPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICB2YXIgdCA9IG51bGwKICAgICAgICAgICAgLCBpID0gZS5hdWRpb19vYmplY3RfdHlwZQogICAgICAgICAgICAsIG4gPSBlLmF1ZGlvX29iamVjdF90eXBlCiAgICAgICAgICAgICwgciA9IGUuc2FtcGxpbmdfZnJlcV9pbmRleAogICAgICAgICAgICAsIHMgPSBlLmNoYW5uZWxfY29uZmlnCiAgICAgICAgICAgICwgYSA9IDAKICAgICAgICAgICAgLCBvID0gbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgLTEgIT09IG8uaW5kZXhPZigiZmlyZWZveCIpID8gciA+PSA2ID8gKG4gPSA1LAogICAgICAgICAgdCA9IG5ldyBBcnJheSg0KSwKICAgICAgICAgIGEgPSByIC0gMykgOiAobiA9IDIsCiAgICAgICAgICB0ID0gbmV3IEFycmF5KDIpLAogICAgICAgICAgYSA9IHIpIDogLTEgIT09IG8uaW5kZXhPZigiYW5kcm9pZCIpID8gKG4gPSAyLAogICAgICAgICAgdCA9IG5ldyBBcnJheSgyKSwKICAgICAgICAgIGEgPSByKSA6IChuID0gNSwKICAgICAgICAgIGEgPSByLAogICAgICAgICAgdCA9IG5ldyBBcnJheSg0KSwKICAgICAgICAgIHIgPj0gNiA/IGEgPSByIC0gMyA6IDEgPT09IHMgJiYgKG4gPSAyLAogICAgICAgICAgdCA9IG5ldyBBcnJheSgyKSwKICAgICAgICAgIGEgPSByKSksCiAgICAgICAgICB0WzBdID0gbiA8PCAzLAogICAgICAgICAgdFswXSB8PSAoMTUgJiByKSA+Pj4gMSwKICAgICAgICAgIHRbMV0gPSAoMTUgJiByKSA8PCA3LAogICAgICAgICAgdFsxXSB8PSAoMTUgJiBzKSA8PCAzLAogICAgICAgICAgNSA9PT0gbiAmJiAodFsxXSB8PSAoMTUgJiBhKSA+Pj4gMSwKICAgICAgICAgIHRbMl0gPSAoMSAmIGEpIDw8IDcsCiAgICAgICAgICB0WzJdIHw9IDgsCiAgICAgICAgICB0WzNdID0gMCksCiAgICAgICAgICB0aGlzLmNvbmZpZyA9IHQsCiAgICAgICAgICB0aGlzLnNhbXBsaW5nX3JhdGUgPSBPW3JdLAogICAgICAgICAgdGhpcy5jaGFubmVsX2NvdW50ID0gcywKICAgICAgICAgIHRoaXMuY29kZWNfbWltZXR5cGUgPSAibXA0YS40MC4iICsgbiwKICAgICAgICAgIHRoaXMub3JpZ2luYWxfY29kZWNfbWltZXR5cGUgPSAibXA0YS40MC4iICsgaQogICAgICB9LCBCID0gZnVuY3Rpb24oKSB7fSwgVSA9IGZ1bmN0aW9uKCkge30sIE4gPSAoSSA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgIHJldHVybiAoSSA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCB7CiAgICAgICAgICAgICAgX19wcm90b19fOiBbXQogICAgICAgICAgfWluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgIGUuX19wcm90b19fID0gdAogICAgICAgICAgfQogICAgICAgICAgfHwgZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdCkKICAgICAgICAgICAgICAgICAgdC5oYXNPd25Qcm9wZXJ0eShpKSAmJiAoZVtpXSA9IHRbaV0pCiAgICAgICAgICB9CiAgICAgICAgICApKGUsIHQpCiAgICAgIH0KICAgICAgLAogICAgICBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICBmdW5jdGlvbiBpKCkgewogICAgICAgICAgICAgIHRoaXMuY29uc3RydWN0b3IgPSBlCiAgICAgICAgICB9CiAgICAgICAgICBJKGUsIHQpLAogICAgICAgICAgZS5wcm90b3R5cGUgPSBudWxsID09PSB0ID8gT2JqZWN0LmNyZWF0ZSh0KSA6IChpLnByb3RvdHlwZSA9IHQucHJvdG90eXBlLAogICAgICAgICAgbmV3IGkpCiAgICAgIH0KICAgICAgKSwgRiA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgIGZ1bmN0aW9uIHQodCwgaSkgewogICAgICAgICAgICAgIHZhciBuID0gZS5jYWxsKHRoaXMpIHx8IHRoaXM7CiAgICAgICAgICAgICAgcmV0dXJuIG4uVEFHID0gIlRTRGVtdXhlciIsCiAgICAgICAgICAgICAgbi5maXJzdF9wYXJzZV8gPSAhMCwKICAgICAgICAgICAgICBuLm1lZGlhX2luZm9fID0gbmV3IG8uYSwKICAgICAgICAgICAgICBuLnRpbWVzY2FsZV8gPSA5MCwKICAgICAgICAgICAgICBuLmR1cmF0aW9uXyA9IDAsCiAgICAgICAgICAgICAgbi5jdXJyZW50X3BtdF9waWRfID0gLTEsCiAgICAgICAgICAgICAgbi5wcm9ncmFtX3BtdF9tYXBfID0ge30sCiAgICAgICAgICAgICAgbi5wZXNfc2xpY2VfcXVldWVzXyA9IHt9LAogICAgICAgICAgICAgIG4udmlkZW9fbWV0YWRhdGFfID0gewogICAgICAgICAgICAgICAgICBzcHM6IHZvaWQgMCwKICAgICAgICAgICAgICAgICAgcHBzOiB2b2lkIDAsCiAgICAgICAgICAgICAgICAgIHNwc19kZXRhaWxzOiB2b2lkIDAKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIG4uYXVkaW9fbWV0YWRhdGFfID0gewogICAgICAgICAgICAgICAgICBhdWRpb19vYmplY3RfdHlwZTogdm9pZCAwLAogICAgICAgICAgICAgICAgICBzYW1wbGluZ19mcmVxX2luZGV4OiB2b2lkIDAsCiAgICAgICAgICAgICAgICAgIHNhbXBsaW5nX2ZyZXF1ZW5jeTogdm9pZCAwLAogICAgICAgICAgICAgICAgICBjaGFubmVsX2NvbmZpZzogdm9pZCAwCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBuLmFhY19sYXN0X3NhbXBsZV9wdHNfID0gdm9pZCAwLAogICAgICAgICAgICAgIG4uYWFjX2xhc3RfaW5jb21wbGV0ZV9kYXRhXyA9IG51bGwsCiAgICAgICAgICAgICAgbi5oYXNfdmlkZW9fID0gITEsCiAgICAgICAgICAgICAgbi5oYXNfYXVkaW9fID0gITEsCiAgICAgICAgICAgICAgbi52aWRlb19pbml0X3NlZ21lbnRfZGlzcGF0Y2hlZF8gPSAhMSwKICAgICAgICAgICAgICBuLmF1ZGlvX2luaXRfc2VnbWVudF9kaXNwYXRjaGVkXyA9ICExLAogICAgICAgICAgICAgIG4udmlkZW9fbWV0YWRhdGFfY2hhbmdlZF8gPSAhMSwKICAgICAgICAgICAgICBuLmF1ZGlvX21ldGFkYXRhX2NoYW5nZWRfID0gITEsCiAgICAgICAgICAgICAgbi52aWRlb190cmFja18gPSB7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ2aWRlbyIsCiAgICAgICAgICAgICAgICAgIGlkOiAxLAogICAgICAgICAgICAgICAgICBzZXF1ZW5jZU51bWJlcjogMCwKICAgICAgICAgICAgICAgICAgc2FtcGxlczogW10sCiAgICAgICAgICAgICAgICAgIGxlbmd0aDogMAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgbi5hdWRpb190cmFja18gPSB7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJhdWRpbyIsCiAgICAgICAgICAgICAgICAgIGlkOiAyLAogICAgICAgICAgICAgICAgICBzZXF1ZW5jZU51bWJlcjogMCwKICAgICAgICAgICAgICAgICAgc2FtcGxlczogW10sCiAgICAgICAgICAgICAgICAgIGxlbmd0aDogMAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgbi50c19wYWNrZXRfc2l6ZV8gPSB0LnRzX3BhY2tldF9zaXplLAogICAgICAgICAgICAgIG4uc3luY19vZmZzZXRfID0gdC5zeW5jX29mZnNldCwKICAgICAgICAgICAgICBuLmNvbmZpZ18gPSBpLAogICAgICAgICAgICAgIG4KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBOKHQsIGUpLAogICAgICAgICAgdC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMubWVkaWFfaW5mb18gPSBudWxsLAogICAgICAgICAgICAgIHRoaXMucGVzX3NsaWNlX3F1ZXVlc18gPSBudWxsLAogICAgICAgICAgICAgIHRoaXMudmlkZW9fbWV0YWRhdGFfID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLmF1ZGlvX21ldGFkYXRhXyA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5hYWNfbGFzdF9pbmNvbXBsZXRlX2RhdGFfID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLnZpZGVvX3RyYWNrXyA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5hdWRpb190cmFja18gPSBudWxsLAogICAgICAgICAgICAgIGUucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgdC5wcm9iZSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB2YXIgdCA9IG5ldyBVaW50OEFycmF5KGUpCiAgICAgICAgICAgICAgICAsIGkgPSAtMQogICAgICAgICAgICAgICAgLCBuID0gMTg4OwogICAgICAgICAgICAgIGlmICh0LmJ5dGVMZW5ndGggPD0gMyAqIG4pCiAgICAgICAgICAgICAgICAgIHJldHVybiBzLmEuZSgiVFNEZW11eGVyIiwgIlByb2JlIGRhdGEgIiArIHQuYnl0ZUxlbmd0aCArICIgYnl0ZXMgaXMgdG9vIGZldyBmb3IganVkZ2luZyBNUEVHLVRTIHN0cmVhbSBmb3JtYXQhIiksCiAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgIG1hdGNoOiAhMQogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGZvciAoOyAtMSA9PT0gaTsgKSB7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIHIgPSBNYXRoLm1pbigxZTMsIHQuYnl0ZUxlbmd0aCAtIDMgKiBuKSwgYSA9IDA7IGEgPCByOyApIHsKICAgICAgICAgICAgICAgICAgICAgIGlmICg3MSA9PT0gdFthXSAmJiA3MSA9PT0gdFthICsgbl0gJiYgNzEgPT09IHRbYSArIDIgKiBuXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBhOwogICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBhKysKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoLTEgPT09IGkpCiAgICAgICAgICAgICAgICAgICAgICBpZiAoMTg4ID09PSBuKQogICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSAxOTI7CiAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMTkyICE9PSBuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gMjA0CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiAtMSA9PT0gaSA/IHsKICAgICAgICAgICAgICAgICAgbWF0Y2g6ICExCiAgICAgICAgICAgICAgfSA6ICgxOTIgPT09IG4gJiYgaSA+PSA0ID8gKHMuYS52KCJUU0RlbXV4ZXIiLCAidHNfcGFja2V0X3NpemUgPSAxOTIsIG0ydHMgbW9kZSIpLAogICAgICAgICAgICAgIGkgLT0gNCkgOiAyMDQgPT09IG4gJiYgcy5hLnYoIlRTRGVtdXhlciIsICJ0c19wYWNrZXRfc2l6ZSA9IDIwNCwgUlMgZW5jb2RlZCBNUEVHMi1UUyBzdHJlYW0iKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIG1hdGNoOiAhMCwKICAgICAgICAgICAgICAgICAgY29uc3VtZWQ6IDAsCiAgICAgICAgICAgICAgICAgIHRzX3BhY2tldF9zaXplOiBuLAogICAgICAgICAgICAgICAgICBzeW5jX29mZnNldDogaQogICAgICAgICAgICAgIH0pCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5iaW5kRGF0YVNvdXJjZSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICByZXR1cm4gZS5vbkRhdGFBcnJpdmFsID0gdGhpcy5wYXJzZUNodW5rcy5iaW5kKHRoaXMpLAogICAgICAgICAgICAgIHRoaXMKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLnJlc2V0TWVkaWFJbmZvID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5tZWRpYV9pbmZvXyA9IG5ldyBvLmEKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLnBhcnNlQ2h1bmtzID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgIGlmICghKHRoaXMub25FcnJvciAmJiB0aGlzLm9uTWVkaWFJbmZvICYmIHRoaXMub25UcmFja01ldGFkYXRhICYmIHRoaXMub25EYXRhQXZhaWxhYmxlKSkKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IF8uYSgib25FcnJvciAmIG9uTWVkaWFJbmZvICYgb25UcmFja01ldGFkYXRhICYgb25EYXRhQXZhaWxhYmxlIGNhbGxiYWNrIG11c3QgYmUgc3BlY2lmaWVkIik7CiAgICAgICAgICAgICAgdmFyIGkgPSAwOwogICAgICAgICAgICAgIGZvciAodGhpcy5maXJzdF9wYXJzZV8gJiYgKHRoaXMuZmlyc3RfcGFyc2VfID0gITEsCiAgICAgICAgICAgICAgaSA9IHRoaXMuc3luY19vZmZzZXRfKTsgaSArIHRoaXMudHNfcGFja2V0X3NpemVfIDw9IGUuYnl0ZUxlbmd0aDsgKSB7CiAgICAgICAgICAgICAgICAgIHZhciBuID0gdCArIGk7CiAgICAgICAgICAgICAgICAgIDE5MiA9PT0gdGhpcy50c19wYWNrZXRfc2l6ZV8gJiYgKGkgKz0gNCk7CiAgICAgICAgICAgICAgICAgIHZhciByID0gbmV3IFVpbnQ4QXJyYXkoZSxpLDE4OCkKICAgICAgICAgICAgICAgICAgICAsIGEgPSByWzBdOwogICAgICAgICAgICAgICAgICBpZiAoNzEgIT09IGEpIHsKICAgICAgICAgICAgICAgICAgICAgIHMuYS5lKHRoaXMuVEFHLCAic3luY19ieXRlID0gIiArIGEgKyAiLCBub3QgMHg0NyIpOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB2YXIgbyA9ICg2NCAmIHJbMV0pID4+PiA2CiAgICAgICAgICAgICAgICAgICAgLCBoID0gKHJbMV0sCiAgICAgICAgICAgICAgICAgICgzMSAmIHJbMV0pIDw8IDggfCByWzJdKQogICAgICAgICAgICAgICAgICAgICwgZCA9ICg0OCAmIHJbM10pID4+PiA0CiAgICAgICAgICAgICAgICAgICAgLCB1ID0gMTUgJiByWzNdCiAgICAgICAgICAgICAgICAgICAgLCBjID0ge30KICAgICAgICAgICAgICAgICAgICAsIGwgPSA0OwogICAgICAgICAgICAgICAgICBpZiAoMiA9PSBkIHx8IDMgPT0gZCkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSByWzRdOwogICAgICAgICAgICAgICAgICAgICAgaWYgKDUgKyBmID09PSAxODgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpICs9IDE4OCwKICAgICAgICAgICAgICAgICAgICAgICAgICAyMDQgPT09IHRoaXMudHNfcGFja2V0X3NpemVfICYmIChpICs9IDE2KTsKICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgZiA+IDAgJiYgKGMgPSB0aGlzLnBhcnNlQWRhcHRhdGlvbkZpZWxkKGUsIGkgKyA0LCAxICsgZikpLAogICAgICAgICAgICAgICAgICAgICAgbCA9IDUgKyBmCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKDEgPT0gZCB8fCAzID09IGQpCiAgICAgICAgICAgICAgICAgICAgICBpZiAoMCA9PT0gaCB8fCBoID09PSB0aGlzLmN1cnJlbnRfcG10X3BpZF8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCArPSAxICsgcltsXTsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IDE4OCAtIGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgMCA9PT0gaCA/IHRoaXMucGFyc2VQQVQoZSwgaSArIGwsIHAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZF91bml0X3N0YXJ0X2luZGljYXRvcjogbywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWl0eV9jb251bnRlcjogdQogICAgICAgICAgICAgICAgICAgICAgICAgIH0pIDogdGhpcy5wYXJzZVBNVChlLCBpICsgbCwgcCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkX3VuaXRfc3RhcnRfaW5kaWNhdG9yOiBvLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51aXR5X2NvbnVudGVyOiB1CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobnVsbCAhPSB0aGlzLnBtdF8gJiYgbnVsbCAhPSB0aGlzLnBtdF8ucGlkX3N0cmVhbV90eXBlW2hdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IDE4OCAtIGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG0gPSB0aGlzLnBtdF8ucGlkX3N0cmVhbV90eXBlW2hdOwogICAgICAgICAgICAgICAgICAgICAgICAgIGggIT09IHRoaXMucG10Xy5jb21tb25fcGlkcy5oMjY0ICYmIGggIT09IHRoaXMucG10Xy5jb21tb25fcGlkcy5hZHRzX2FhYyAmJiAhMCAhPT0gdGhpcy5wbXRfLnBlc19wcml2YXRlX2RhdGFfcGlkc1toXSAmJiAhMCAhPT0gdGhpcy5wbXRfLnRpbWVkX2lkM19waWRzW2hdIHx8IHRoaXMuaGFuZGxlUEVTU2xpY2UoZSwgaSArIGwsIHAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlkOiBoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW1fdHlwZTogbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9wb3NpdGlvbjogbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZF91bml0X3N0YXJ0X2luZGljYXRvcjogbywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWl0eV9jb251bnRlcjogdSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9tX2FjY2Vzc19pbmRpY2F0b3I6IGMucmFuZG9tX2FjY2Vzc19pbmRpY2F0b3IKICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpICs9IDE4OCwKICAgICAgICAgICAgICAgICAgMjA0ID09PSB0aGlzLnRzX3BhY2tldF9zaXplXyAmJiAoaSArPSAxNikKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlzcGF0Y2hBdWRpb1ZpZGVvTWVkaWFTZWdtZW50KCksCiAgICAgICAgICAgICAgaQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgdC5wcm90b3R5cGUucGFyc2VBZGFwdGF0aW9uRmllbGQgPSBmdW5jdGlvbihlLCB0LCBpKSB7CiAgICAgICAgICAgICAgdmFyIG4gPSBuZXcgVWludDhBcnJheShlLHQsaSkKICAgICAgICAgICAgICAgICwgciA9IG5bMF07CiAgICAgICAgICAgICAgcmV0dXJuIHIgPiAwID8gciA+IDE4MyA/IChzLmEudyh0aGlzLlRBRywgIklsbGVnYWwgYWRhcHRhdGlvbl9maWVsZF9sZW5ndGg6ICIgKyByKSwKICAgICAgICAgICAgICB7fSkgOiB7CiAgICAgICAgICAgICAgICAgIGRpc2NvbnRpbnVpdHlfaW5kaWNhdG9yOiAoMTI4ICYgblsxXSkgPj4+IDcsCiAgICAgICAgICAgICAgICAgIHJhbmRvbV9hY2Nlc3NfaW5kaWNhdG9yOiAoNjQgJiBuWzFdKSA+Pj4gNiwKICAgICAgICAgICAgICAgICAgZWxlbWVudGFyeV9zdHJlYW1fcHJpb3JpdHlfaW5kaWNhdG9yOiAoMzIgJiBuWzFdKSA+Pj4gNQogICAgICAgICAgICAgIH0gOiB7fQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgdC5wcm90b3R5cGUucGFyc2VQQVQgPSBmdW5jdGlvbihlLCB0LCBpLCBuKSB7CiAgICAgICAgICAgICAgdmFyIHIgPSBuZXcgVWludDhBcnJheShlLHQsaSkKICAgICAgICAgICAgICAgICwgYSA9IHJbMF07CiAgICAgICAgICAgICAgaWYgKDAgPT09IGEpIHsKICAgICAgICAgICAgICAgICAgdmFyIG8gPSAoMTUgJiByWzFdKSA8PCA4IHwgclsyXQogICAgICAgICAgICAgICAgICAgICwgaCA9IChyWzNdLAogICAgICAgICAgICAgICAgICByWzRdLAogICAgICAgICAgICAgICAgICAoNjIgJiByWzVdKSA+Pj4gMSkKICAgICAgICAgICAgICAgICAgICAsIGQgPSAxICYgcls1XQogICAgICAgICAgICAgICAgICAgICwgdSA9IHJbNl0KICAgICAgICAgICAgICAgICAgICAsIF8gPSAocls3XSwKICAgICAgICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgICAgICAgICAgIGlmICgxID09PSBkICYmIDAgPT09IHUpCiAgICAgICAgICAgICAgICAgICAgICAoXyA9IG5ldyBiKS52ZXJzaW9uX251bWJlciA9IGg7CiAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG51bGwgPT0gKF8gPSB0aGlzLnBhdF8pKQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICBmb3IgKHZhciBjID0gbyAtIDUgLSA0LCBsID0gLTEsIGYgPSAtMSwgcCA9IDg7IHAgPCA4ICsgYzsgcCArPSA0KSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgbSA9IHJbcF0gPDwgOCB8IHJbcCArIDFdCiAgICAgICAgICAgICAgICAgICAgICAgICwgZyA9ICgzMSAmIHJbcCArIDJdKSA8PCA4IHwgcltwICsgM107CiAgICAgICAgICAgICAgICAgICAgICAwID09PSBtID8gXy5uZXR3b3JrX3BpZCA9IGcgOiAoXy5wcm9ncmFtX3BtdF9waWRbbV0gPSBnLAogICAgICAgICAgICAgICAgICAgICAgLTEgPT09IGwgJiYgKGwgPSBtKSwKICAgICAgICAgICAgICAgICAgICAgIC0xID09PSBmICYmIChmID0gZykpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgMSA9PT0gZCAmJiAwID09PSB1ICYmIChudWxsID09IHRoaXMucGF0XyAmJiBzLmEudih0aGlzLlRBRywgIlBhcnNlZCBmaXJzdCBQQVQ6ICIgKyBKU09OLnN0cmluZ2lmeShfKSksCiAgICAgICAgICAgICAgICAgIHRoaXMucGF0XyA9IF8sCiAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudF9wcm9ncmFtXyA9IGwsCiAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudF9wbXRfcGlkXyA9IGYpCiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgIHMuYS5lKHRoaXMuVEFHLCAicGFyc2VQQVQ6IHRhYmxlX2lkICIgKyBhICsgIiBpcyBub3QgY29ycmVzcG9uZGVkIHRvIFBBVCEiKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgdC5wcm90b3R5cGUucGFyc2VQTVQgPSBmdW5jdGlvbihlLCB0LCBpLCBuKSB7CiAgICAgICAgICAgICAgdmFyIHIgPSBuZXcgVWludDhBcnJheShlLHQsaSkKICAgICAgICAgICAgICAgICwgYSA9IHJbMF07CiAgICAgICAgICAgICAgaWYgKDIgPT09IGEpIHsKICAgICAgICAgICAgICAgICAgdmFyIG8gPSAoMTUgJiByWzFdKSA8PCA4IHwgclsyXQogICAgICAgICAgICAgICAgICAgICwgaCA9IHJbM10gPDwgOCB8IHJbNF0KICAgICAgICAgICAgICAgICAgICAsIGQgPSAoNjIgJiByWzVdKSA+Pj4gMQogICAgICAgICAgICAgICAgICAgICwgdSA9IDEgJiByWzVdCiAgICAgICAgICAgICAgICAgICAgLCBfID0gcls2XQogICAgICAgICAgICAgICAgICAgICwgYyA9IChyWzddLAogICAgICAgICAgICAgICAgICBudWxsKTsKICAgICAgICAgICAgICAgICAgaWYgKDEgPT09IHUgJiYgMCA9PT0gXykKICAgICAgICAgICAgICAgICAgICAgIChjID0gbmV3IFMpLnByb2dyYW1fbnVtYmVyID0gaCwKICAgICAgICAgICAgICAgICAgICAgIGMudmVyc2lvbl9udW1iZXIgPSBkLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9ncmFtX3BtdF9tYXBfW2hdID0gYzsKICAgICAgICAgICAgICAgICAgZWxzZSBpZiAobnVsbCA9PSAoYyA9IHRoaXMucHJvZ3JhbV9wbXRfbWFwX1toXSkpCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgIHJbOF0sCiAgICAgICAgICAgICAgICAgIHJbOV07CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGwgPSAoMTUgJiByWzEwXSkgPDwgOCB8IHJbMTFdLCBmID0gMTIgKyBsLCBwID0gbyAtIDkgLSBsIC0gNCwgbSA9IGY7IG0gPCBmICsgcDsgKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgdiA9IHJbbV0KICAgICAgICAgICAgICAgICAgICAgICAgLCB5ID0gKDMxICYgclttICsgMV0pIDw8IDggfCByW20gKyAyXQogICAgICAgICAgICAgICAgICAgICAgICAsIGIgPSAoMTUgJiByW20gKyAzXSkgPDwgOCB8IHJbbSArIDRdOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGMucGlkX3N0cmVhbV90eXBlW3ldID0gdiwKICAgICAgICAgICAgICAgICAgICAgIHYgIT09IGcua0gyNjQgfHwgYy5jb21tb25fcGlkcy5oMjY0KQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2ICE9PSBnLmtBRFRTQUFDIHx8IGMuY29tbW9uX3BpZHMuYWR0c19hYWMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2ID09PSBnLmtQRVNQcml2YXRlRGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMucGVzX3ByaXZhdGVfZGF0YV9waWRzW3ldID0gITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBFID0gci5zdWJhcnJheShtICsgNSwgbSArIDUgKyBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoUEVTUHJpdmF0ZURhdGFEZXNjcmlwdG9yKHksIHYsIEUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdiA9PT0gZy5rSUQzICYmIChjLnRpbWVkX2lkM19waWRzW3ldID0gITApOwogICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5jb21tb25fcGlkcy5hZHRzX2FhYyA9IHk7CiAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgYy5jb21tb25fcGlkcy5oMjY0ID0geTsKICAgICAgICAgICAgICAgICAgICAgIG0gKz0gNSArIGIKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBoID09PSB0aGlzLmN1cnJlbnRfcHJvZ3JhbV8gJiYgKG51bGwgPT0gdGhpcy5wbXRfICYmIHMuYS52KHRoaXMuVEFHLCAiUGFyc2VkIGZpcnN0IFBNVDogIiArIEpTT04uc3RyaW5naWZ5KGMpKSwKICAgICAgICAgICAgICAgICAgdGhpcy5wbXRfID0gYywKICAgICAgICAgICAgICAgICAgYy5jb21tb25fcGlkcy5oMjY0ICYmICh0aGlzLmhhc192aWRlb18gPSAhMCksCiAgICAgICAgICAgICAgICAgIGMuY29tbW9uX3BpZHMuYWR0c19hYWMgJiYgKHRoaXMuaGFzX2F1ZGlvXyA9ICEwKSkKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgcy5hLmUodGhpcy5UQUcsICJwYXJzZVBNVDogdGFibGVfaWQgIiArIGEgKyAiIGlzIG5vdCBjb3JyZXNwb25kZWQgdG8gUE1UISIpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5oYW5kbGVQRVNTbGljZSA9IGZ1bmN0aW9uKGUsIHQsIGksIG4pIHsKICAgICAgICAgICAgICB2YXIgciA9IG5ldyBVaW50OEFycmF5KGUsdCxpKQogICAgICAgICAgICAgICAgLCBhID0gclswXSA8PCAxNiB8IHJbMV0gPDwgOCB8IHJbMl07CiAgICAgICAgICAgICAgclszXSwKICAgICAgICAgICAgICByWzRdLAogICAgICAgICAgICAgIHJbNV07CiAgICAgICAgICAgICAgaWYgKG4ucGF5bG9hZF91bml0X3N0YXJ0X2luZGljYXRvcikgewogICAgICAgICAgICAgICAgICBpZiAoMSAhPT0gYSkKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHMuYS5lKHRoaXMuVEFHLCAiaGFuZGxlUEVTU2xpY2U6IHBhY2tldF9zdGFydF9jb2RlX3ByZWZpeCBzaG91bGQgYmUgMSBidXQgd2l0aCB2YWx1ZSAiICsgYSk7CiAgICAgICAgICAgICAgICAgIHZhciBvID0gdGhpcy5wZXNfc2xpY2VfcXVldWVzX1tuLnBpZF07CiAgICAgICAgICAgICAgICAgIGlmIChvKSB7CiAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBoID0gbmV3IFVpbnQ4QXJyYXkoby50b3RhbF9sZW5ndGgpLCBkID0gMCwgdSA9IDA7IGQgPCBvLnNsaWNlcy5sZW5ndGg7IGQrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfID0gby5zbGljZXNbZF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgaC5zZXQoXywgdSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgdSArPSBfLmJ5dGVMZW5ndGgKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIG8uc2xpY2VzID0gW10sCiAgICAgICAgICAgICAgICAgICAgICBvLnRvdGFsX2xlbmd0aCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IG5ldyBBOwogICAgICAgICAgICAgICAgICAgICAgYy5waWQgPSBuLnBpZCwKICAgICAgICAgICAgICAgICAgICAgIGMuZGF0YSA9IGgsCiAgICAgICAgICAgICAgICAgICAgICBjLnN0cmVhbV90eXBlID0gbi5zdHJlYW1fdHlwZSwKICAgICAgICAgICAgICAgICAgICAgIGMuZmlsZV9wb3NpdGlvbiA9IG8uZmlsZV9wb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgIGMucmFuZG9tX2FjY2Vzc19pbmRpY2F0b3IgPSBvLnJhbmRvbV9hY2Nlc3NfaW5kaWNhdG9yLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJzZVBFUyhjKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHRoaXMucGVzX3NsaWNlX3F1ZXVlc19bbi5waWRdID0gbmV3IFIsCiAgICAgICAgICAgICAgICAgIHRoaXMucGVzX3NsaWNlX3F1ZXVlc19bbi5waWRdLmZpbGVfcG9zaXRpb24gPSBuLmZpbGVfcG9zaXRpb24sCiAgICAgICAgICAgICAgICAgIHRoaXMucGVzX3NsaWNlX3F1ZXVlc19bbi5waWRdLnJhbmRvbV9hY2Nlc3NfaW5kaWNhdG9yID0gbi5yYW5kb21fYWNjZXNzX2luZGljYXRvcgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAobnVsbCAhPSB0aGlzLnBlc19zbGljZV9xdWV1ZXNfW24ucGlkXSkgewogICAgICAgICAgICAgICAgICB2YXIgbCA9IHRoaXMucGVzX3NsaWNlX3F1ZXVlc19bbi5waWRdOwogICAgICAgICAgICAgICAgICBsLnNsaWNlcy5wdXNoKHIpLAogICAgICAgICAgICAgICAgICBsLnRvdGFsX2xlbmd0aCArPSByLmJ5dGVMZW5ndGgKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5wYXJzZVBFUyA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB2YXIgdCA9IGUuZGF0YQogICAgICAgICAgICAgICAgLCBpID0gdFswXSA8PCAxNiB8IHRbMV0gPDwgOCB8IHRbMl0KICAgICAgICAgICAgICAgICwgbiA9IHRbM10KICAgICAgICAgICAgICAgICwgciA9IHRbNF0gPDwgOCB8IHRbNV07CiAgICAgICAgICAgICAgaWYgKDEgPT09IGkpIHsKICAgICAgICAgICAgICAgICAgaWYgKDE4OCAhPT0gbiAmJiAxOTAgIT09IG4gJiYgMTkxICE9PSBuICYmIDI0MCAhPT0gbiAmJiAyNDEgIT09IG4gJiYgMjU1ICE9PSBuICYmIDI0MiAhPT0gbiAmJiAyNDggIT09IG4pIHsKICAgICAgICAgICAgICAgICAgICAgIHRbNl07CiAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9ICgxOTIgJiB0WzddKSA+Pj4gNgogICAgICAgICAgICAgICAgICAgICAgICAsIG8gPSB0WzhdCiAgICAgICAgICAgICAgICAgICAgICAgICwgaCA9IHZvaWQgMAogICAgICAgICAgICAgICAgICAgICAgICAsIGQgPSB2b2lkIDA7CiAgICAgICAgICAgICAgICAgICAgICAyICE9PSBhICYmIDMgIT09IGEgfHwgKGggPSA1MzY4NzA5MTIgKiAoMTQgJiB0WzldKSArIDQxOTQzMDQgKiAoMjU1ICYgdFsxMF0pICsgMTYzODQgKiAoMjU0ICYgdFsxMV0pICsgMTI4ICogKDI1NSAmIHRbMTJdKSArICgyNTQgJiB0WzEzXSkgLyAyLAogICAgICAgICAgICAgICAgICAgICAgZCA9IDMgPT09IGEgPyA1MzY4NzA5MTIgKiAoMTQgJiB0WzE0XSkgKyA0MTk0MzA0ICogKDI1NSAmIHRbMTVdKSArIDE2Mzg0ICogKDI1NCAmIHRbMTZdKSArIDEyOCAqICgyNTUgJiB0WzE3XSkgKyAoMjU0ICYgdFsxOF0pIC8gMiA6IGgpOwogICAgICAgICAgICAgICAgICAgICAgdmFyIHUgPSA5ICsgbwogICAgICAgICAgICAgICAgICAgICAgICAsIF8gPSB2b2lkIDA7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoMCAhPT0gcikgewogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyIDwgMyArIG8pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHMuYS52KHRoaXMuVEFHLCAiTWFsZm9ybWVkIFBFUzogUEVTX3BhY2tldF9sZW5ndGggPCAzICsgUEVTX2hlYWRlcl9kYXRhX2xlbmd0aCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgIF8gPSByIC0gMyAtIG8KICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgIF8gPSB0LmJ5dGVMZW5ndGggLSB1OwogICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0LnN1YmFycmF5KHUsIHUgKyBfKTsKICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZS5zdHJlYW1fdHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgY2FzZSBnLmtNUEVHMUF1ZGlvOgogICAgICAgICAgICAgICAgICAgICAgY2FzZSBnLmtNUEVHMkF1ZGlvOgogICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgY2FzZSBnLmtQRVNQcml2YXRlRGF0YToKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnNlUEVTUHJpdmF0ZURhdGFQYXlsb2FkKGMsIGgsIGQsIGUucGlkLCBuKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgZy5rQURUU0FBQzoKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnNlQUFDUGF5bG9hZChjLCBoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgZy5rSUQzOgogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyc2VUaW1lZElEM01ldGFkYXRhUGF5bG9hZChjLCBoLCBkLCBlLnBpZCwgbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIGcua0gyNjQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJzZUgyNjRQYXlsb2FkKGMsIGgsIGQsIGUuZmlsZV9wb3NpdGlvbiwgZS5yYW5kb21fYWNjZXNzX2luZGljYXRvcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIGcua0gyNjU6CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKDE4OCA9PT0gbiB8fCAxOTEgPT09IG4gfHwgMjQwID09PSBuIHx8IDI0MSA9PT0gbiB8fCAyNTUgPT09IG4gfHwgMjQyID09PSBuIHx8IDI0OCA9PT0gbikgJiYgZS5zdHJlYW1fdHlwZSA9PT0gZy5rUEVTUHJpdmF0ZURhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgIHUgPSA2LAogICAgICAgICAgICAgICAgICAgICAgXyA9IHZvaWQgMDsKICAgICAgICAgICAgICAgICAgICAgIF8gPSAwICE9PSByID8gciA6IHQuYnl0ZUxlbmd0aCAtIHU7CiAgICAgICAgICAgICAgICAgICAgICBjID0gdC5zdWJhcnJheSh1LCB1ICsgXyk7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnNlUEVTUHJpdmF0ZURhdGFQYXlsb2FkKGMsIHZvaWQgMCwgdm9pZCAwLCBlLnBpZCwgbikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICBzLmEuZSh0aGlzLlRBRywgInBhcnNlUEVTOiBwYWNrZXRfc3RhcnRfY29kZV9wcmVmaXggc2hvdWxkIGJlIDEgYnV0IHdpdGggdmFsdWUgIiArIGkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5wYXJzZUgyNjRQYXlsb2FkID0gZnVuY3Rpb24oZSwgdCwgaSwgbiwgcikgewogICAgICAgICAgICAgIGZvciAodmFyIGEgPSBuZXcgayhlKSwgbyA9IG51bGwsIGggPSBbXSwgZCA9IDAsIHUgPSAhMTsgbnVsbCAhPSAobyA9IGEucmVhZE5leHROYWx1UGF5bG9hZCgpKTsgKSB7CiAgICAgICAgICAgICAgICAgIHZhciBfID0gbmV3IEQobyk7CiAgICAgICAgICAgICAgICAgIGlmIChfLnR5cGUgPT09IEUua1NsaWNlU1BTKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHAucGFyc2VTUFMoby5kYXRhKTsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlkZW9faW5pdF9zZWdtZW50X2Rpc3BhdGNoZWRfID8gITAgPT09IHRoaXMuZGV0ZWN0VmlkZW9NZXRhZGF0YUNoYW5nZShfLCBjKSAmJiAocy5hLnYodGhpcy5UQUcsICJIMjY0OiBDcml0aWNhbCBoMjY0IG1ldGFkYXRhIGhhcyBiZWVuIGNoYW5nZWQsIGF0dGVtcHQgdG8gcmUtZ2VuZXJhdGUgSW5pdFNlZ21lbnQiKSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlkZW9fbWV0YWRhdGFfY2hhbmdlZF8gPSAhMCwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlkZW9fbWV0YWRhdGFfID0gewogICAgICAgICAgICAgICAgICAgICAgICAgIHNwczogXywKICAgICAgICAgICAgICAgICAgICAgICAgICBwcHM6IHZvaWQgMCwKICAgICAgICAgICAgICAgICAgICAgICAgICBzcHNfZGV0YWlsczogYwogICAgICAgICAgICAgICAgICAgICAgfSkgOiAodGhpcy52aWRlb19tZXRhZGF0YV8uc3BzID0gXywKICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlkZW9fbWV0YWRhdGFfLnNwc19kZXRhaWxzID0gYykKICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICBfLnR5cGUgPT09IEUua1NsaWNlUFBTID8gdGhpcy52aWRlb19pbml0X3NlZ21lbnRfZGlzcGF0Y2hlZF8gJiYgIXRoaXMudmlkZW9fbWV0YWRhdGFfY2hhbmdlZF8gfHwgKHRoaXMudmlkZW9fbWV0YWRhdGFfLnBwcyA9IF8sCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZpZGVvX21ldGFkYXRhXy5zcHMgJiYgdGhpcy52aWRlb19tZXRhZGF0YV8ucHBzICYmICh0aGlzLnZpZGVvX21ldGFkYXRhX2NoYW5nZWRfICYmIHRoaXMuZGlzcGF0Y2hWaWRlb01lZGlhU2VnbWVudCgpLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaFZpZGVvSW5pdFNlZ21lbnQoKSkpIDogKF8udHlwZSA9PT0gRS5rU2xpY2VJRFIgfHwgXy50eXBlID09PSBFLmtTbGljZU5vbklEUiAmJiAxID09PSByKSAmJiAodSA9ICEwKTsKICAgICAgICAgICAgICAgICAgdGhpcy52aWRlb19pbml0X3NlZ21lbnRfZGlzcGF0Y2hlZF8gJiYgKGgucHVzaChfKSwKICAgICAgICAgICAgICAgICAgZCArPSBfLmRhdGEuYnl0ZUxlbmd0aCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdmFyIGwgPSBNYXRoLmZsb29yKHQgLyB0aGlzLnRpbWVzY2FsZV8pCiAgICAgICAgICAgICAgICAsIGYgPSBNYXRoLmZsb29yKGkgLyB0aGlzLnRpbWVzY2FsZV8pOwogICAgICAgICAgICAgIGlmIChoLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICB2YXIgbSA9IHRoaXMudmlkZW9fdHJhY2tfCiAgICAgICAgICAgICAgICAgICAgLCBnID0gewogICAgICAgICAgICAgICAgICAgICAgdW5pdHM6IGgsCiAgICAgICAgICAgICAgICAgICAgICBsZW5ndGg6IGQsCiAgICAgICAgICAgICAgICAgICAgICBpc0tleWZyYW1lOiB1LAogICAgICAgICAgICAgICAgICAgICAgZHRzOiBmLAogICAgICAgICAgICAgICAgICAgICAgcHRzOiBsLAogICAgICAgICAgICAgICAgICAgICAgY3RzOiBsIC0gZiwKICAgICAgICAgICAgICAgICAgICAgIGZpbGVfcG9zaXRpb246IG4KICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgbS5zYW1wbGVzLnB1c2goZyksCiAgICAgICAgICAgICAgICAgIG0ubGVuZ3RoICs9IGQKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5kZXRlY3RWaWRlb01ldGFkYXRhQ2hhbmdlID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgIGlmIChlLmRhdGEuYnl0ZUxlbmd0aCAhPT0gdGhpcy52aWRlb19tZXRhZGF0YV8uc3BzLmRhdGEuYnl0ZUxlbmd0aCkKICAgICAgICAgICAgICAgICAgcmV0dXJuICEwOwogICAgICAgICAgICAgIGlmICh0LmNvZGVjX21pbWV0eXBlICE9PSB0aGlzLnZpZGVvX21ldGFkYXRhXy5zcHNfZGV0YWlscy5jb2RlY19taW1ldHlwZSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHMuYS52KHRoaXMuVEFHLCAiSDI2NDogQ29kZWMgbWltZVR5cGUgY2hhbmdlZCBmcm9tICIgKyB0aGlzLnZpZGVvX21ldGFkYXRhXy5zcHNfZGV0YWlscy5jb2RlY19taW1ldHlwZSArICIgdG8gIiArIHQuY29kZWNfbWltZXR5cGUpLAogICAgICAgICAgICAgICAgICAhMDsKICAgICAgICAgICAgICBpZiAodC5jb2RlY19zaXplLndpZHRoICE9PSB0aGlzLnZpZGVvX21ldGFkYXRhXy5zcHNfZGV0YWlscy5jb2RlY19zaXplLndpZHRoIHx8IHQuY29kZWNfc2l6ZS5oZWlnaHQgIT09IHRoaXMudmlkZW9fbWV0YWRhdGFfLnNwc19kZXRhaWxzLmNvZGVjX3NpemUuaGVpZ2h0KSB7CiAgICAgICAgICAgICAgICAgIHZhciBpID0gdGhpcy52aWRlb19tZXRhZGF0YV8uc3BzX2RldGFpbHMuY29kZWNfc2l6ZQogICAgICAgICAgICAgICAgICAgICwgbiA9IHQuY29kZWNfc2l6ZTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHMuYS52KHRoaXMuVEFHLCAiSDI2NDogQ29kZWQgUmVzb2x1dGlvbiBjaGFuZ2VkIGZyb20gIiArIGkud2lkdGggKyAieCIgKyBpLmhlaWdodCArICIgdG8gIiArIG4ud2lkdGggKyAieCIgKyBuLmhlaWdodCksCiAgICAgICAgICAgICAgICAgICEwCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiB0LnByZXNlbnRfc2l6ZS53aWR0aCAhPT0gdGhpcy52aWRlb19tZXRhZGF0YV8uc3BzX2RldGFpbHMucHJlc2VudF9zaXplLndpZHRoICYmIChzLmEudih0aGlzLlRBRywgIkgyNjQ6IFByZXNlbnQgcmVzb2x1dGlvbiB3aWR0aCBjaGFuZ2VkIGZyb20gIiArIHRoaXMudmlkZW9fbWV0YWRhdGFfLnNwc19kZXRhaWxzLnByZXNlbnRfc2l6ZS53aWR0aCArICIgdG8gIiArIHQucHJlc2VudF9zaXplLndpZHRoKSwKICAgICAgICAgICAgICAhMCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLmlzSW5pdFNlZ21lbnREaXNwYXRjaGVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGFzX3ZpZGVvXyAmJiB0aGlzLmhhc19hdWRpb18gPyB0aGlzLnZpZGVvX2luaXRfc2VnbWVudF9kaXNwYXRjaGVkXyAmJiB0aGlzLmF1ZGlvX2luaXRfc2VnbWVudF9kaXNwYXRjaGVkXyA6IHRoaXMuaGFzX3ZpZGVvXyAmJiAhdGhpcy5oYXNfYXVkaW9fID8gdGhpcy52aWRlb19pbml0X3NlZ21lbnRfZGlzcGF0Y2hlZF8gOiAhKHRoaXMuaGFzX3ZpZGVvXyB8fCAhdGhpcy5oYXNfYXVkaW9fKSAmJiB0aGlzLmF1ZGlvX2luaXRfc2VnbWVudF9kaXNwYXRjaGVkXwogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgdC5wcm90b3R5cGUuZGlzcGF0Y2hWaWRlb0luaXRTZWdtZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLnZpZGVvX21ldGFkYXRhXy5zcHNfZGV0YWlscwogICAgICAgICAgICAgICAgLCB0ID0gewogICAgICAgICAgICAgICAgICB0eXBlOiAidmlkZW8iCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB0LmlkID0gdGhpcy52aWRlb190cmFja18uaWQsCiAgICAgICAgICAgICAgdC50aW1lc2NhbGUgPSAxZTMsCiAgICAgICAgICAgICAgdC5kdXJhdGlvbiA9IHRoaXMuZHVyYXRpb25fLAogICAgICAgICAgICAgIHQuY29kZWNXaWR0aCA9IGUuY29kZWNfc2l6ZS53aWR0aCwKICAgICAgICAgICAgICB0LmNvZGVjSGVpZ2h0ID0gZS5jb2RlY19zaXplLmhlaWdodCwKICAgICAgICAgICAgICB0LnByZXNlbnRXaWR0aCA9IGUucHJlc2VudF9zaXplLndpZHRoLAogICAgICAgICAgICAgIHQucHJlc2VudEhlaWdodCA9IGUucHJlc2VudF9zaXplLmhlaWdodCwKICAgICAgICAgICAgICB0LnByb2ZpbGUgPSBlLnByb2ZpbGVfc3RyaW5nLAogICAgICAgICAgICAgIHQubGV2ZWwgPSBlLmxldmVsX3N0cmluZywKICAgICAgICAgICAgICB0LmJpdERlcHRoID0gZS5iaXRfZGVwdGgsCiAgICAgICAgICAgICAgdC5jaHJvbWFGb3JtYXQgPSBlLmNocm9tYV9mb3JtYXQsCiAgICAgICAgICAgICAgdC5zYXJSYXRpbyA9IGUuc2FyX3JhdGlvLAogICAgICAgICAgICAgIHQuZnJhbWVSYXRlID0gZS5mcmFtZV9yYXRlOwogICAgICAgICAgICAgIHZhciBpID0gdC5mcmFtZVJhdGUuZnBzX2RlbgogICAgICAgICAgICAgICAgLCBuID0gdC5mcmFtZVJhdGUuZnBzX251bTsKICAgICAgICAgICAgICB0LnJlZlNhbXBsZUR1cmF0aW9uID0gaSAvIG4gKiAxZTMsCiAgICAgICAgICAgICAgdC5jb2RlYyA9IGUuY29kZWNfbWltZXR5cGU7CiAgICAgICAgICAgICAgdmFyIHIgPSB0aGlzLnZpZGVvX21ldGFkYXRhXy5zcHMuZGF0YS5zdWJhcnJheSg0KQogICAgICAgICAgICAgICAgLCBhID0gdGhpcy52aWRlb19tZXRhZGF0YV8ucHBzLmRhdGEuc3ViYXJyYXkoNCkKICAgICAgICAgICAgICAgICwgbyA9IG5ldyBDKHIsYSxlKTsKICAgICAgICAgICAgICB0LmF2Y2MgPSBvLmdldERhdGEoKSwKICAgICAgICAgICAgICAwID09IHRoaXMudmlkZW9faW5pdF9zZWdtZW50X2Rpc3BhdGNoZWRfICYmIHMuYS52KHRoaXMuVEFHLCAiR2VuZXJhdGVkIGZpcnN0IEFWQ0RlY29kZXJDb25maWd1cmF0aW9uUmVjb3JkIGZvciBtaW1lVHlwZTogIiArIHQuY29kZWMpLAogICAgICAgICAgICAgIHRoaXMub25UcmFja01ldGFkYXRhKCJ2aWRlbyIsIHQpLAogICAgICAgICAgICAgIHRoaXMudmlkZW9faW5pdF9zZWdtZW50X2Rpc3BhdGNoZWRfID0gITAsCiAgICAgICAgICAgICAgdGhpcy52aWRlb19tZXRhZGF0YV9jaGFuZ2VkXyA9ICExOwogICAgICAgICAgICAgIHZhciBoID0gdGhpcy5tZWRpYV9pbmZvXzsKICAgICAgICAgICAgICBoLmhhc1ZpZGVvID0gITAsCiAgICAgICAgICAgICAgaC53aWR0aCA9IHQuY29kZWNXaWR0aCwKICAgICAgICAgICAgICBoLmhlaWdodCA9IHQuY29kZWNIZWlnaHQsCiAgICAgICAgICAgICAgaC5mcHMgPSB0LmZyYW1lUmF0ZS5mcHMsCiAgICAgICAgICAgICAgaC5wcm9maWxlID0gdC5wcm9maWxlLAogICAgICAgICAgICAgIGgubGV2ZWwgPSB0LmxldmVsLAogICAgICAgICAgICAgIGgucmVmRnJhbWVzID0gZS5yZWZfZnJhbWVzLAogICAgICAgICAgICAgIGguY2hyb21hRm9ybWF0ID0gZS5jaHJvbWFfZm9ybWF0X3N0cmluZywKICAgICAgICAgICAgICBoLnNhck51bSA9IHQuc2FyUmF0aW8ud2lkdGgsCiAgICAgICAgICAgICAgaC5zYXJEZW4gPSB0LnNhclJhdGlvLmhlaWdodCwKICAgICAgICAgICAgICBoLnZpZGVvQ29kZWMgPSB0LmNvZGVjLAogICAgICAgICAgICAgIGguaGFzQXVkaW8gJiYgaC5hdWRpb0NvZGVjID8gaC5taW1lVHlwZSA9ICd2aWRlby9tcDJ0OyBjb2RlY3M9IicgKyBoLnZpZGVvQ29kZWMgKyAiLCIgKyBoLmF1ZGlvQ29kZWMgKyAnIicgOiBoLm1pbWVUeXBlID0gJ3ZpZGVvL21wMnQ7IGNvZGVjcz0iJyArIGgudmlkZW9Db2RlYyArICciJywKICAgICAgICAgICAgICBoLmlzQ29tcGxldGUoKSAmJiB0aGlzLm9uTWVkaWFJbmZvKGgpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5kaXNwYXRjaFZpZGVvTWVkaWFTZWdtZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5pc0luaXRTZWdtZW50RGlzcGF0Y2hlZCgpICYmIHRoaXMudmlkZW9fdHJhY2tfLmxlbmd0aCAmJiB0aGlzLm9uRGF0YUF2YWlsYWJsZShudWxsLCB0aGlzLnZpZGVvX3RyYWNrXykKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLmRpc3BhdGNoQXVkaW9NZWRpYVNlZ21lbnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0aGlzLmlzSW5pdFNlZ21lbnREaXNwYXRjaGVkKCkgJiYgdGhpcy5hdWRpb190cmFja18ubGVuZ3RoICYmIHRoaXMub25EYXRhQXZhaWxhYmxlKHRoaXMuYXVkaW9fdHJhY2tfLCBudWxsKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgdC5wcm90b3R5cGUuZGlzcGF0Y2hBdWRpb1ZpZGVvTWVkaWFTZWdtZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5pc0luaXRTZWdtZW50RGlzcGF0Y2hlZCgpICYmICh0aGlzLmF1ZGlvX3RyYWNrXy5sZW5ndGggfHwgdGhpcy52aWRlb190cmFja18ubGVuZ3RoKSAmJiB0aGlzLm9uRGF0YUF2YWlsYWJsZSh0aGlzLmF1ZGlvX3RyYWNrXywgdGhpcy52aWRlb190cmFja18pCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5wYXJzZUFBQ1BheWxvYWQgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgaWYgKCF0aGlzLmhhc192aWRlb18gfHwgdGhpcy52aWRlb19pbml0X3NlZ21lbnRfZGlzcGF0Y2hlZF8pIHsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYWFjX2xhc3RfaW5jb21wbGV0ZV9kYXRhXykgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBuZXcgVWludDhBcnJheShlLmJ5dGVMZW5ndGggKyB0aGlzLmFhY19sYXN0X2luY29tcGxldGVfZGF0YV8uYnl0ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICBpLnNldCh0aGlzLmFhY19sYXN0X2luY29tcGxldGVfZGF0YV8sIDApLAogICAgICAgICAgICAgICAgICAgICAgaS5zZXQoZSwgdGhpcy5hYWNfbGFzdF9pbmNvbXBsZXRlX2RhdGFfLmJ5dGVMZW5ndGgpLAogICAgICAgICAgICAgICAgICAgICAgZSA9IGkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB2YXIgbiwgcjsKICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gdCkKICAgICAgICAgICAgICAgICAgICAgIHIgPSB0IC8gdGhpcy50aW1lc2NhbGVfOwogICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsID09IHRoaXMuYWFjX2xhc3Rfc2FtcGxlX3B0c18pCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgcy5hLncodGhpcy5UQUcsICJBQUM6IFVua25vd24gcHRzIik7CiAgICAgICAgICAgICAgICAgICAgICBuID0gMTAyNCAvIHRoaXMuYXVkaW9fbWV0YWRhdGFfLnNhbXBsaW5nX2ZyZXF1ZW5jeSAqIDFlMywKICAgICAgICAgICAgICAgICAgICAgIHIgPSB0aGlzLmFhY19sYXN0X3NhbXBsZV9wdHNfICsgbgogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmFhY19sYXN0X2luY29tcGxldGVfZGF0YV8gJiYgdGhpcy5hYWNfbGFzdF9zYW1wbGVfcHRzXykgewogICAgICAgICAgICAgICAgICAgICAgbiA9IDEwMjQgLyB0aGlzLmF1ZGlvX21ldGFkYXRhXy5zYW1wbGluZ19mcmVxdWVuY3kgKiAxZTM7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMuYWFjX2xhc3Rfc2FtcGxlX3B0c18gKyBuOwogICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoYSAtIHIpID4gMSAmJiAocy5hLncodGhpcy5UQUcsICJBQUM6IERldGVjdGVkIHB0cyBvdmVybGFwcGVkLCBleHBlY3RlZDogIiArIGEgKyAibXMsIFBFUyBwdHM6ICIgKyByICsgIm1zIiksCiAgICAgICAgICAgICAgICAgICAgICByID0gYSkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBmb3IgKHZhciBvLCBoID0gbmV3IE0oZSksIGQgPSBudWxsLCB1ID0gcjsgbnVsbCAhPSAoZCA9IGgucmVhZE5leHRBQUNGcmFtZSgpKTsgKSB7CiAgICAgICAgICAgICAgICAgICAgICBuID0gMTAyNCAvIGQuc2FtcGxpbmdfZnJlcXVlbmN5ICogMWUzLAogICAgICAgICAgICAgICAgICAgICAgMCA9PSB0aGlzLmF1ZGlvX2luaXRfc2VnbWVudF9kaXNwYXRjaGVkXyA/ICh0aGlzLmF1ZGlvX21ldGFkYXRhXy5hdWRpb19vYmplY3RfdHlwZSA9IGQuYXVkaW9fb2JqZWN0X3R5cGUsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvX21ldGFkYXRhXy5zYW1wbGluZ19mcmVxX2luZGV4ID0gZC5zYW1wbGluZ19mcmVxX2luZGV4LAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5hdWRpb19tZXRhZGF0YV8uc2FtcGxpbmdfZnJlcXVlbmN5ID0gZC5zYW1wbGluZ19mcmVxdWVuY3ksCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvX21ldGFkYXRhXy5jaGFubmVsX2NvbmZpZyA9IGQuY2hhbm5lbF9jb25maWcsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoQXVkaW9Jbml0U2VnbWVudChkKSkgOiB0aGlzLmRldGVjdEF1ZGlvTWV0YWRhdGFDaGFuZ2UoZCkgJiYgKHRoaXMuZGlzcGF0Y2hBdWRpb01lZGlhU2VnbWVudCgpLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEF1ZGlvSW5pdFNlZ21lbnQoZCkpLAogICAgICAgICAgICAgICAgICAgICAgbyA9IHU7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgXyA9IE1hdGguZmxvb3IodSkKICAgICAgICAgICAgICAgICAgICAgICAgLCBjID0gewogICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXQ6IGQuZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGg6IGQuZGF0YS5ieXRlTGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgIHB0czogXywKICAgICAgICAgICAgICAgICAgICAgICAgICBkdHM6IF8KICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvX3RyYWNrXy5zYW1wbGVzLnB1c2goYyksCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvX3RyYWNrXy5sZW5ndGggKz0gZC5kYXRhLmJ5dGVMZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICB1ICs9IG4KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBoLmhhc0luY29tcGxldGVEYXRhKCkgJiYgKHRoaXMuYWFjX2xhc3RfaW5jb21wbGV0ZV9kYXRhXyA9IGguZ2V0SW5jb21wbGV0ZURhdGEoKSksCiAgICAgICAgICAgICAgICAgIG8gJiYgKHRoaXMuYWFjX2xhc3Rfc2FtcGxlX3B0c18gPSBvKQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLmRldGVjdEF1ZGlvTWV0YWRhdGFDaGFuZ2UgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuYXVkaW9fb2JqZWN0X3R5cGUgIT09IHRoaXMuYXVkaW9fbWV0YWRhdGFfLmF1ZGlvX29iamVjdF90eXBlID8gKHMuYS52KHRoaXMuVEFHLCAiQUFDOiBBdWRpb09iamVjdFR5cGUgY2hhbmdlZCBmcm9tICIgKyB0aGlzLmF1ZGlvX21ldGFkYXRhXy5hdWRpb19vYmplY3RfdHlwZSArICIgdG8gIiArIGUuYXVkaW9fb2JqZWN0X3R5cGUpLAogICAgICAgICAgICAgICEwKSA6IGUuc2FtcGxpbmdfZnJlcV9pbmRleCAhPT0gdGhpcy5hdWRpb19tZXRhZGF0YV8uc2FtcGxpbmdfZnJlcV9pbmRleCA/IChzLmEudih0aGlzLlRBRywgIkFBQzogU2FtcGxpbmdGcmVxdWVuY3lJbmRleCBjaGFuZ2VkIGZyb20gIiArIHRoaXMuYXVkaW9fbWV0YWRhdGFfLnNhbXBsaW5nX2ZyZXFfaW5kZXggKyAiIHRvICIgKyBlLnNhbXBsaW5nX2ZyZXFfaW5kZXgpLAogICAgICAgICAgICAgICEwKSA6IGUuY2hhbm5lbF9jb25maWcgIT09IHRoaXMuYXVkaW9fbWV0YWRhdGFfLmNoYW5uZWxfY29uZmlnICYmIChzLmEudih0aGlzLlRBRywgIkFBQzogQ2hhbm5lbCBjb25maWd1cmF0aW9uIGNoYW5nZWQgZnJvbSAiICsgdGhpcy5hdWRpb19tZXRhZGF0YV8uY2hhbm5lbF9jb25maWcgKyAiIHRvICIgKyBlLmNoYW5uZWxfY29uZmlnKSwKICAgICAgICAgICAgICAhMCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLmRpc3BhdGNoQXVkaW9Jbml0U2VnbWVudCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB2YXIgdCA9IG5ldyB4KGUpCiAgICAgICAgICAgICAgICAsIGkgPSB7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJhdWRpbyIKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGkuaWQgPSB0aGlzLmF1ZGlvX3RyYWNrXy5pZCwKICAgICAgICAgICAgICBpLnRpbWVzY2FsZSA9IDFlMywKICAgICAgICAgICAgICBpLmR1cmF0aW9uID0gdGhpcy5kdXJhdGlvbl8sCiAgICAgICAgICAgICAgaS5hdWRpb1NhbXBsZVJhdGUgPSB0LnNhbXBsaW5nX3JhdGUsCiAgICAgICAgICAgICAgaS5jaGFubmVsQ291bnQgPSB0LmNoYW5uZWxfY291bnQsCiAgICAgICAgICAgICAgaS5jb2RlYyA9IHQuY29kZWNfbWltZXR5cGUsCiAgICAgICAgICAgICAgaS5vcmlnaW5hbENvZGVjID0gdC5vcmlnaW5hbF9jb2RlY19taW1ldHlwZSwKICAgICAgICAgICAgICBpLmNvbmZpZyA9IHQuY29uZmlnLAogICAgICAgICAgICAgIGkucmVmU2FtcGxlRHVyYXRpb24gPSAxMDI0IC8gaS5hdWRpb1NhbXBsZVJhdGUgKiBpLnRpbWVzY2FsZSwKICAgICAgICAgICAgICAwID09IHRoaXMuYXVkaW9faW5pdF9zZWdtZW50X2Rpc3BhdGNoZWRfICYmIHMuYS52KHRoaXMuVEFHLCAiR2VuZXJhdGVkIGZpcnN0IEF1ZGlvU3BlY2lmaWNDb25maWcgZm9yIG1pbWVUeXBlOiAiICsgaS5jb2RlYyksCiAgICAgICAgICAgICAgdGhpcy5vblRyYWNrTWV0YWRhdGEoImF1ZGlvIiwgaSksCiAgICAgICAgICAgICAgdGhpcy5hdWRpb19pbml0X3NlZ21lbnRfZGlzcGF0Y2hlZF8gPSAhMCwKICAgICAgICAgICAgICB0aGlzLnZpZGVvX21ldGFkYXRhX2NoYW5nZWRfID0gITE7CiAgICAgICAgICAgICAgdmFyIG4gPSB0aGlzLm1lZGlhX2luZm9fOwogICAgICAgICAgICAgIG4uaGFzQXVkaW8gPSAhMCwKICAgICAgICAgICAgICBuLmF1ZGlvQ29kZWMgPSBpLm9yaWdpbmFsQ29kZWMsCiAgICAgICAgICAgICAgbi5hdWRpb1NhbXBsZVJhdGUgPSBpLmF1ZGlvU2FtcGxlUmF0ZSwKICAgICAgICAgICAgICBuLmF1ZGlvQ2hhbm5lbENvdW50ID0gaS5jaGFubmVsQ291bnQsCiAgICAgICAgICAgICAgbi5oYXNWaWRlbyAmJiBuLnZpZGVvQ29kZWMgPyBuLm1pbWVUeXBlID0gJ3ZpZGVvL21wMnQ7IGNvZGVjcz0iJyArIG4udmlkZW9Db2RlYyArICIsIiArIG4uYXVkaW9Db2RlYyArICciJyA6IG4ubWltZVR5cGUgPSAndmlkZW8vbXAydDsgY29kZWNzPSInICsgbi5hdWRpb0NvZGVjICsgJyInLAogICAgICAgICAgICAgIG4uaXNDb21wbGV0ZSgpICYmIHRoaXMub25NZWRpYUluZm8obikKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLmRpc3BhdGNoUEVTUHJpdmF0ZURhdGFEZXNjcmlwdG9yID0gZnVuY3Rpb24oZSwgdCwgaSkgewogICAgICAgICAgICAgIHZhciBuID0gbmV3IFU7CiAgICAgICAgICAgICAgbi5waWQgPSBlLAogICAgICAgICAgICAgIG4uc3RyZWFtX3R5cGUgPSB0LAogICAgICAgICAgICAgIG4uZGVzY3JpcHRvciA9IGksCiAgICAgICAgICAgICAgdGhpcy5vblBFU1ByaXZhdGVEYXRhRGVzY3JpcHRvciAmJiB0aGlzLm9uUEVTUHJpdmF0ZURhdGFEZXNjcmlwdG9yKG4pCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5wYXJzZVBFU1ByaXZhdGVEYXRhUGF5bG9hZCA9IGZ1bmN0aW9uKGUsIHQsIGksIG4sIHIpIHsKICAgICAgICAgICAgICB2YXIgcyA9IG5ldyBCOwogICAgICAgICAgICAgIGlmIChzLnBpZCA9IG4sCiAgICAgICAgICAgICAgcy5zdHJlYW1faWQgPSByLAogICAgICAgICAgICAgIHMubGVuID0gZS5ieXRlTGVuZ3RoLAogICAgICAgICAgICAgIHMuZGF0YSA9IGUsCiAgICAgICAgICAgICAgbnVsbCAhPSB0KSB7CiAgICAgICAgICAgICAgICAgIHZhciBhID0gTWF0aC5mbG9vcih0IC8gdGhpcy50aW1lc2NhbGVfKTsKICAgICAgICAgICAgICAgICAgcy5wdHMgPSBhCiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgIHMubmVhcmVzdF9wdHMgPSB0aGlzLmFhY19sYXN0X3NhbXBsZV9wdHNfOwogICAgICAgICAgICAgIGlmIChudWxsICE9IGkpIHsKICAgICAgICAgICAgICAgICAgdmFyIG8gPSBNYXRoLmZsb29yKGkgLyB0aGlzLnRpbWVzY2FsZV8pOwogICAgICAgICAgICAgICAgICBzLmR0cyA9IG8KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5vblBFU1ByaXZhdGVEYXRhICYmIHRoaXMub25QRVNQcml2YXRlRGF0YShzKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgdC5wcm90b3R5cGUucGFyc2VUaW1lZElEM01ldGFkYXRhUGF5bG9hZCA9IGZ1bmN0aW9uKGUsIHQsIGksIG4sIHIpIHsKICAgICAgICAgICAgICB2YXIgcyA9IG5ldyBCOwogICAgICAgICAgICAgIGlmIChzLnBpZCA9IG4sCiAgICAgICAgICAgICAgcy5zdHJlYW1faWQgPSByLAogICAgICAgICAgICAgIHMubGVuID0gZS5ieXRlTGVuZ3RoLAogICAgICAgICAgICAgIHMuZGF0YSA9IGUsCiAgICAgICAgICAgICAgbnVsbCAhPSB0KSB7CiAgICAgICAgICAgICAgICAgIHZhciBhID0gTWF0aC5mbG9vcih0IC8gdGhpcy50aW1lc2NhbGVfKTsKICAgICAgICAgICAgICAgICAgcy5wdHMgPSBhCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChudWxsICE9IGkpIHsKICAgICAgICAgICAgICAgICAgdmFyIG8gPSBNYXRoLmZsb29yKGkgLyB0aGlzLnRpbWVzY2FsZV8pOwogICAgICAgICAgICAgICAgICBzLmR0cyA9IG8KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5vblRpbWVkSUQzTWV0YWRhdGEgJiYgdGhpcy5vblRpbWVkSUQzTWV0YWRhdGEocykKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQKICAgICAgfSh5KSwgRyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgZnVuY3Rpb24gZSgpIHt9CiAgICAgICAgICByZXR1cm4gZS5pbml0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgdCBpbiBlLnR5cGVzID0gewogICAgICAgICAgICAgICAgICBhdmMxOiBbXSwKICAgICAgICAgICAgICAgICAgYXZjQzogW10sCiAgICAgICAgICAgICAgICAgIGJ0cnQ6IFtdLAogICAgICAgICAgICAgICAgICBkaW5mOiBbXSwKICAgICAgICAgICAgICAgICAgZHJlZjogW10sCiAgICAgICAgICAgICAgICAgIGVzZHM6IFtdLAogICAgICAgICAgICAgICAgICBmdHlwOiBbXSwKICAgICAgICAgICAgICAgICAgaGRscjogW10sCiAgICAgICAgICAgICAgICAgIG1kYXQ6IFtdLAogICAgICAgICAgICAgICAgICBtZGhkOiBbXSwKICAgICAgICAgICAgICAgICAgbWRpYTogW10sCiAgICAgICAgICAgICAgICAgIG1maGQ6IFtdLAogICAgICAgICAgICAgICAgICBtaW5mOiBbXSwKICAgICAgICAgICAgICAgICAgbW9vZjogW10sCiAgICAgICAgICAgICAgICAgIG1vb3Y6IFtdLAogICAgICAgICAgICAgICAgICBtcDRhOiBbXSwKICAgICAgICAgICAgICAgICAgbXZleDogW10sCiAgICAgICAgICAgICAgICAgIG12aGQ6IFtdLAogICAgICAgICAgICAgICAgICBzZHRwOiBbXSwKICAgICAgICAgICAgICAgICAgc3RibDogW10sCiAgICAgICAgICAgICAgICAgIHN0Y286IFtdLAogICAgICAgICAgICAgICAgICBzdHNjOiBbXSwKICAgICAgICAgICAgICAgICAgc3RzZDogW10sCiAgICAgICAgICAgICAgICAgIHN0c3o6IFtdLAogICAgICAgICAgICAgICAgICBzdHRzOiBbXSwKICAgICAgICAgICAgICAgICAgdGZkdDogW10sCiAgICAgICAgICAgICAgICAgIHRmaGQ6IFtdLAogICAgICAgICAgICAgICAgICB0cmFmOiBbXSwKICAgICAgICAgICAgICAgICAgdHJhazogW10sCiAgICAgICAgICAgICAgICAgIHRydW46IFtdLAogICAgICAgICAgICAgICAgICB0cmV4OiBbXSwKICAgICAgICAgICAgICAgICAgdGtoZDogW10sCiAgICAgICAgICAgICAgICAgIHZtaGQ6IFtdLAogICAgICAgICAgICAgICAgICBzbWhkOiBbXSwKICAgICAgICAgICAgICAgICAgIi5tcDMiOiBbXQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZS50eXBlcykKICAgICAgICAgICAgICAgICAgZS50eXBlcy5oYXNPd25Qcm9wZXJ0eSh0KSAmJiAoZS50eXBlc1t0XSA9IFt0LmNoYXJDb2RlQXQoMCksIHQuY2hhckNvZGVBdCgxKSwgdC5jaGFyQ29kZUF0KDIpLCB0LmNoYXJDb2RlQXQoMyldKTsKICAgICAgICAgICAgICB2YXIgaSA9IGUuY29uc3RhbnRzID0ge307CiAgICAgICAgICAgICAgaS5GVFlQID0gbmV3IFVpbnQ4QXJyYXkoWzEwNSwgMTE1LCAxMTEsIDEwOSwgMCwgMCwgMCwgMSwgMTA1LCAxMTUsIDExMSwgMTA5LCA5NywgMTE4LCA5OSwgNDldKSwKICAgICAgICAgICAgICBpLlNUU0RfUFJFRklYID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDFdKSwKICAgICAgICAgICAgICBpLlNUVFMgPSBuZXcgVWludDhBcnJheShbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0pLAogICAgICAgICAgICAgIGkuU1RTQyA9IGkuU1RDTyA9IGkuU1RUUywKICAgICAgICAgICAgICBpLlNUU1ogPSBuZXcgVWludDhBcnJheShbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0pLAogICAgICAgICAgICAgIGkuSERMUl9WSURFTyA9IG5ldyBVaW50OEFycmF5KFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAxMTgsIDEwNSwgMTAwLCAxMDEsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDg2LCAxMDUsIDEwMCwgMTAxLCAxMTEsIDcyLCA5NywgMTEwLCAxMDAsIDEwOCwgMTAxLCAxMTQsIDBdKSwKICAgICAgICAgICAgICBpLkhETFJfQVVESU8gPSBuZXcgVWludDhBcnJheShbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMTE1LCAxMTEsIDExNywgMTEwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA4MywgMTExLCAxMTcsIDExMCwgMTAwLCA3MiwgOTcsIDExMCwgMTAwLCAxMDgsIDEwMSwgMTE0LCAwXSksCiAgICAgICAgICAgICAgaS5EUkVGID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDEsIDAsIDAsIDAsIDEyLCAxMTcsIDExNCwgMTA4LCAzMiwgMCwgMCwgMCwgMV0pLAogICAgICAgICAgICAgIGkuU01IRCA9IG5ldyBVaW50OEFycmF5KFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwXSksCiAgICAgICAgICAgICAgaS5WTUhEID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDAsIDAsIDEsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5ib3ggPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgdCA9IDgsIGkgPSBudWxsLCBuID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSwgciA9IG4ubGVuZ3RoLCBzID0gMDsgcyA8IHI7IHMrKykKICAgICAgICAgICAgICAgICAgdCArPSBuW3NdLmJ5dGVMZW5ndGg7CiAgICAgICAgICAgICAgKGkgPSBuZXcgVWludDhBcnJheSh0KSlbMF0gPSB0ID4+PiAyNCAmIDI1NSwKICAgICAgICAgICAgICBpWzFdID0gdCA+Pj4gMTYgJiAyNTUsCiAgICAgICAgICAgICAgaVsyXSA9IHQgPj4+IDggJiAyNTUsCiAgICAgICAgICAgICAgaVszXSA9IDI1NSAmIHQsCiAgICAgICAgICAgICAgaS5zZXQoZSwgNCk7CiAgICAgICAgICAgICAgdmFyIGEgPSA4OwogICAgICAgICAgICAgIGZvciAocyA9IDA7IHMgPCByOyBzKyspCiAgICAgICAgICAgICAgICAgIGkuc2V0KG5bc10sIGEpLAogICAgICAgICAgICAgICAgICBhICs9IG5bc10uYnl0ZUxlbmd0aDsKICAgICAgICAgICAgICByZXR1cm4gaQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5nZW5lcmF0ZUluaXRTZWdtZW50ID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgIHZhciBpID0gZS5ib3goZS50eXBlcy5mdHlwLCBlLmNvbnN0YW50cy5GVFlQKQogICAgICAgICAgICAgICAgLCBuID0gZS5tb292KHQpCiAgICAgICAgICAgICAgICAsIHIgPSBuZXcgVWludDhBcnJheShpLmJ5dGVMZW5ndGggKyBuLmJ5dGVMZW5ndGgpOwogICAgICAgICAgICAgIHJldHVybiByLnNldChpLCAwKSwKICAgICAgICAgICAgICByLnNldChuLCBpLmJ5dGVMZW5ndGgpLAogICAgICAgICAgICAgIHIKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUubW9vdiA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICB2YXIgaSA9IGUubXZoZCh0LnRpbWVzY2FsZSwgdC5kdXJhdGlvbikKICAgICAgICAgICAgICAgICwgbiA9IGUudHJhayh0KQogICAgICAgICAgICAgICAgLCByID0gZS5tdmV4KHQpOwogICAgICAgICAgICAgIHJldHVybiBlLmJveChlLnR5cGVzLm1vb3YsIGksIG4sIHIpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLm12aGQgPSBmdW5jdGlvbih0LCBpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuYm94KGUudHlwZXMubXZoZCwgbmV3IFVpbnQ4QXJyYXkoWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIHQgPj4+IDI0ICYgMjU1LCB0ID4+PiAxNiAmIDI1NSwgdCA+Pj4gOCAmIDI1NSwgMjU1ICYgdCwgaSA+Pj4gMjQgJiAyNTUsIGkgPj4+IDE2ICYgMjU1LCBpID4+PiA4ICYgMjU1LCAyNTUgJiBpLCAwLCAxLCAwLCAwLCAxLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAxLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAxLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA2NCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMjU1LCAyNTUsIDI1NSwgMjU1XSkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnRyYWsgPSBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuYm94KGUudHlwZXMudHJhaywgZS50a2hkKHQpLCBlLm1kaWEodCkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnRraGQgPSBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgdmFyIGkgPSB0LmlkCiAgICAgICAgICAgICAgICAsIG4gPSB0LmR1cmF0aW9uCiAgICAgICAgICAgICAgICAsIHIgPSB0LnByZXNlbnRXaWR0aAogICAgICAgICAgICAgICAgLCBzID0gdC5wcmVzZW50SGVpZ2h0OwogICAgICAgICAgICAgIHJldHVybiBlLmJveChlLnR5cGVzLnRraGQsIG5ldyBVaW50OEFycmF5KFswLCAwLCAwLCA3LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCBpID4+PiAyNCAmIDI1NSwgaSA+Pj4gMTYgJiAyNTUsIGkgPj4+IDggJiAyNTUsIDI1NSAmIGksIDAsIDAsIDAsIDAsIG4gPj4+IDI0ICYgMjU1LCBuID4+PiAxNiAmIDI1NSwgbiA+Pj4gOCAmIDI1NSwgMjU1ICYgbiwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgNjQsIDAsIDAsIDAsIHIgPj4+IDggJiAyNTUsIDI1NSAmIHIsIDAsIDAsIHMgPj4+IDggJiAyNTUsIDI1NSAmIHMsIDAsIDBdKSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUubWRpYSA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gZS5ib3goZS50eXBlcy5tZGlhLCBlLm1kaGQodCksIGUuaGRscih0KSwgZS5taW5mKHQpKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5tZGhkID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgIHZhciBpID0gdC50aW1lc2NhbGUKICAgICAgICAgICAgICAgICwgbiA9IHQuZHVyYXRpb247CiAgICAgICAgICAgICAgcmV0dXJuIGUuYm94KGUudHlwZXMubWRoZCwgbmV3IFVpbnQ4QXJyYXkoWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIGkgPj4+IDI0ICYgMjU1LCBpID4+PiAxNiAmIDI1NSwgaSA+Pj4gOCAmIDI1NSwgMjU1ICYgaSwgbiA+Pj4gMjQgJiAyNTUsIG4gPj4+IDE2ICYgMjU1LCBuID4+PiA4ICYgMjU1LCAyNTUgJiBuLCA4NSwgMTk2LCAwLCAwXSkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLmhkbHIgPSBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgdmFyIGkgPSBudWxsOwogICAgICAgICAgICAgIHJldHVybiBpID0gImF1ZGlvIiA9PT0gdC50eXBlID8gZS5jb25zdGFudHMuSERMUl9BVURJTyA6IGUuY29uc3RhbnRzLkhETFJfVklERU8sCiAgICAgICAgICAgICAgZS5ib3goZS50eXBlcy5oZGxyLCBpKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5taW5mID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgIHZhciBpID0gbnVsbDsKICAgICAgICAgICAgICByZXR1cm4gaSA9ICJhdWRpbyIgPT09IHQudHlwZSA/IGUuYm94KGUudHlwZXMuc21oZCwgZS5jb25zdGFudHMuU01IRCkgOiBlLmJveChlLnR5cGVzLnZtaGQsIGUuY29uc3RhbnRzLlZNSEQpLAogICAgICAgICAgICAgIGUuYm94KGUudHlwZXMubWluZiwgaSwgZS5kaW5mKCksIGUuc3RibCh0KSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUuZGluZiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiBlLmJveChlLnR5cGVzLmRpbmYsIGUuYm94KGUudHlwZXMuZHJlZiwgZS5jb25zdGFudHMuRFJFRikpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnN0YmwgPSBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuYm94KGUudHlwZXMuc3RibCwgZS5zdHNkKHQpLCBlLmJveChlLnR5cGVzLnN0dHMsIGUuY29uc3RhbnRzLlNUVFMpLCBlLmJveChlLnR5cGVzLnN0c2MsIGUuY29uc3RhbnRzLlNUU0MpLCBlLmJveChlLnR5cGVzLnN0c3osIGUuY29uc3RhbnRzLlNUU1opLCBlLmJveChlLnR5cGVzLnN0Y28sIGUuY29uc3RhbnRzLlNUQ08pKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5zdHNkID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgIHJldHVybiAiYXVkaW8iID09PSB0LnR5cGUgPyAibXAzIiA9PT0gdC5jb2RlYyA/IGUuYm94KGUudHlwZXMuc3RzZCwgZS5jb25zdGFudHMuU1RTRF9QUkVGSVgsIGUubXAzKHQpKSA6IGUuYm94KGUudHlwZXMuc3RzZCwgZS5jb25zdGFudHMuU1RTRF9QUkVGSVgsIGUubXA0YSh0KSkgOiBlLmJveChlLnR5cGVzLnN0c2QsIGUuY29uc3RhbnRzLlNUU0RfUFJFRklYLCBlLmF2YzEodCkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLm1wMyA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICB2YXIgaSA9IHQuY2hhbm5lbENvdW50CiAgICAgICAgICAgICAgICAsIG4gPSB0LmF1ZGlvU2FtcGxlUmF0ZQogICAgICAgICAgICAgICAgLCByID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDEsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIGksIDAsIDE2LCAwLCAwLCAwLCAwLCBuID4+PiA4ICYgMjU1LCAyNTUgJiBuLCAwLCAwXSk7CiAgICAgICAgICAgICAgcmV0dXJuIGUuYm94KGUudHlwZXNbIi5tcDMiXSwgcikKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUubXA0YSA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICB2YXIgaSA9IHQuY2hhbm5lbENvdW50CiAgICAgICAgICAgICAgICAsIG4gPSB0LmF1ZGlvU2FtcGxlUmF0ZQogICAgICAgICAgICAgICAgLCByID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDEsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIGksIDAsIDE2LCAwLCAwLCAwLCAwLCBuID4+PiA4ICYgMjU1LCAyNTUgJiBuLCAwLCAwXSk7CiAgICAgICAgICAgICAgcmV0dXJuIGUuYm94KGUudHlwZXMubXA0YSwgciwgZS5lc2RzKHQpKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5lc2RzID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgIHZhciBpID0gdC5jb25maWcgfHwgW10KICAgICAgICAgICAgICAgICwgbiA9IGkubGVuZ3RoCiAgICAgICAgICAgICAgICAsIHIgPSBuZXcgVWludDhBcnJheShbMCwgMCwgMCwgMCwgMywgMjMgKyBuLCAwLCAxLCAwLCA0LCAxNSArIG4sIDY0LCAyMSwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgNV0uY29uY2F0KFtuXSkuY29uY2F0KGkpLmNvbmNhdChbNiwgMSwgMl0pKTsKICAgICAgICAgICAgICByZXR1cm4gZS5ib3goZS50eXBlcy5lc2RzLCByKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5hdmMxID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgIHZhciBpID0gdC5hdmNjCiAgICAgICAgICAgICAgICAsIG4gPSB0LmNvZGVjV2lkdGgKICAgICAgICAgICAgICAgICwgciA9IHQuY29kZWNIZWlnaHQKICAgICAgICAgICAgICAgICwgcyA9IG5ldyBVaW50OEFycmF5KFswLCAwLCAwLCAwLCAwLCAwLCAwLCAxLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCBuID4+PiA4ICYgMjU1LCAyNTUgJiBuLCByID4+PiA4ICYgMjU1LCAyNTUgJiByLCAwLCA3MiwgMCwgMCwgMCwgNzIsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDEsIDEwLCAxMjAsIDExMywgMTEzLCA0NywgMTAyLCAxMDgsIDExOCwgNDYsIDEwNiwgMTE1LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAyNCwgMjU1LCAyNTVdKTsKICAgICAgICAgICAgICByZXR1cm4gZS5ib3goZS50eXBlcy5hdmMxLCBzLCBlLmJveChlLnR5cGVzLmF2Y0MsIGkpKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5tdmV4ID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgIHJldHVybiBlLmJveChlLnR5cGVzLm12ZXgsIGUudHJleCh0KSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUudHJleCA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICB2YXIgaSA9IHQuaWQKICAgICAgICAgICAgICAgICwgbiA9IG5ldyBVaW50OEFycmF5KFswLCAwLCAwLCAwLCBpID4+PiAyNCAmIDI1NSwgaSA+Pj4gMTYgJiAyNTUsIGkgPj4+IDggJiAyNTUsIDI1NSAmIGksIDAsIDAsIDAsIDEsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDEsIDAsIDFdKTsKICAgICAgICAgICAgICByZXR1cm4gZS5ib3goZS50eXBlcy50cmV4LCBuKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5tb29mID0gZnVuY3Rpb24odCwgaSkgewogICAgICAgICAgICAgIHJldHVybiBlLmJveChlLnR5cGVzLm1vb2YsIGUubWZoZCh0LnNlcXVlbmNlTnVtYmVyKSwgZS50cmFmKHQsIGkpKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5tZmhkID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgIHZhciBpID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDAsIDAsIDAsIHQgPj4+IDI0ICYgMjU1LCB0ID4+PiAxNiAmIDI1NSwgdCA+Pj4gOCAmIDI1NSwgMjU1ICYgdF0pOwogICAgICAgICAgICAgIHJldHVybiBlLmJveChlLnR5cGVzLm1maGQsIGkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnRyYWYgPSBmdW5jdGlvbih0LCBpKSB7CiAgICAgICAgICAgICAgdmFyIG4gPSB0LmlkCiAgICAgICAgICAgICAgICAsIHIgPSBlLmJveChlLnR5cGVzLnRmaGQsIG5ldyBVaW50OEFycmF5KFswLCAwLCAwLCAwLCBuID4+PiAyNCAmIDI1NSwgbiA+Pj4gMTYgJiAyNTUsIG4gPj4+IDggJiAyNTUsIDI1NSAmIG5dKSkKICAgICAgICAgICAgICAgICwgcyA9IGUuYm94KGUudHlwZXMudGZkdCwgbmV3IFVpbnQ4QXJyYXkoWzAsIDAsIDAsIDAsIGkgPj4+IDI0ICYgMjU1LCBpID4+PiAxNiAmIDI1NSwgaSA+Pj4gOCAmIDI1NSwgMjU1ICYgaV0pKQogICAgICAgICAgICAgICAgLCBhID0gZS5zZHRwKHQpCiAgICAgICAgICAgICAgICAsIG8gPSBlLnRydW4odCwgYS5ieXRlTGVuZ3RoICsgMTYgKyAxNiArIDggKyAxNiArIDggKyA4KTsKICAgICAgICAgICAgICByZXR1cm4gZS5ib3goZS50eXBlcy50cmFmLCByLCBzLCBvLCBhKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5zZHRwID0gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgIGZvciAodmFyIGkgPSB0LnNhbXBsZXMgfHwgW10sIG4gPSBpLmxlbmd0aCwgciA9IG5ldyBVaW50OEFycmF5KDQgKyBuKSwgcyA9IDA7IHMgPCBuOyBzKyspIHsKICAgICAgICAgICAgICAgICAgdmFyIGEgPSBpW3NdLmZsYWdzOwogICAgICAgICAgICAgICAgICByW3MgKyA0XSA9IGEuaXNMZWFkaW5nIDw8IDYgfCBhLmRlcGVuZHNPbiA8PCA0IHwgYS5pc0RlcGVuZGVkT24gPDwgMiB8IGEuaGFzUmVkdW5kYW5jeQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gZS5ib3goZS50eXBlcy5zZHRwLCByKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS50cnVuID0gZnVuY3Rpb24odCwgaSkgewogICAgICAgICAgICAgIHZhciBuID0gdC5zYW1wbGVzIHx8IFtdCiAgICAgICAgICAgICAgICAsIHIgPSBuLmxlbmd0aAogICAgICAgICAgICAgICAgLCBzID0gMTIgKyAxNiAqIHIKICAgICAgICAgICAgICAgICwgYSA9IG5ldyBVaW50OEFycmF5KHMpOwogICAgICAgICAgICAgIGkgKz0gOCArIHMsCiAgICAgICAgICAgICAgYS5zZXQoWzAsIDAsIDE1LCAxLCByID4+PiAyNCAmIDI1NSwgciA+Pj4gMTYgJiAyNTUsIHIgPj4+IDggJiAyNTUsIDI1NSAmIHIsIGkgPj4+IDI0ICYgMjU1LCBpID4+PiAxNiAmIDI1NSwgaSA+Pj4gOCAmIDI1NSwgMjU1ICYgaV0sIDApOwogICAgICAgICAgICAgIGZvciAodmFyIG8gPSAwOyBvIDwgcjsgbysrKSB7CiAgICAgICAgICAgICAgICAgIHZhciBoID0gbltvXS5kdXJhdGlvbgogICAgICAgICAgICAgICAgICAgICwgZCA9IG5bb10uc2l6ZQogICAgICAgICAgICAgICAgICAgICwgdSA9IG5bb10uZmxhZ3MKICAgICAgICAgICAgICAgICAgICAsIF8gPSBuW29dLmN0czsKICAgICAgICAgICAgICAgICAgYS5zZXQoW2ggPj4+IDI0ICYgMjU1LCBoID4+PiAxNiAmIDI1NSwgaCA+Pj4gOCAmIDI1NSwgMjU1ICYgaCwgZCA+Pj4gMjQgJiAyNTUsIGQgPj4+IDE2ICYgMjU1LCBkID4+PiA4ICYgMjU1LCAyNTUgJiBkLCB1LmlzTGVhZGluZyA8PCAyIHwgdS5kZXBlbmRzT24sIHUuaXNEZXBlbmRlZE9uIDw8IDYgfCB1Lmhhc1JlZHVuZGFuY3kgPDwgNCB8IHUuaXNOb25TeW5jLCAwLCAwLCBfID4+PiAyNCAmIDI1NSwgXyA+Pj4gMTYgJiAyNTUsIF8gPj4+IDggJiAyNTUsIDI1NSAmIF9dLCAxMiArIDE2ICogbykKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGUuYm94KGUudHlwZXMudHJ1biwgYSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUubWRhdCA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gZS5ib3goZS50eXBlcy5tZGF0LCB0KQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZQogICAgICB9KCk7CiAgICAgIEcuaW5pdCgpOwogICAgICB2YXIgViA9IEcKICAgICAgICAsIGogPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGZ1bmN0aW9uIGUoKSB7fQogICAgICAgICAgcmV0dXJuIGUuZ2V0U2lsZW50RnJhbWUgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgaWYgKCJtcDRhLjQwLjIiID09PSBlKSB7CiAgICAgICAgICAgICAgICAgIGlmICgxID09PSB0KQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KFswLCAyMDAsIDAsIDEyOCwgMzUsIDEyOF0pOwogICAgICAgICAgICAgICAgICBpZiAoMiA9PT0gdCkKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShbMzMsIDAsIDczLCAxNDQsIDIsIDI1LCAwLCAzNSwgMTI4XSk7CiAgICAgICAgICAgICAgICAgIGlmICgzID09PSB0KQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KFswLCAyMDAsIDAsIDEyOCwgMzIsIDEzMiwgMSwgMzgsIDY0LCA4LCAxMDAsIDAsIDE0Ml0pOwogICAgICAgICAgICAgICAgICBpZiAoNCA9PT0gdCkKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShbMCwgMjAwLCAwLCAxMjgsIDMyLCAxMzIsIDEsIDM4LCA2NCwgOCwgMTAwLCAwLCAxMjgsIDQ0LCAxMjgsIDgsIDIsIDU2XSk7CiAgICAgICAgICAgICAgICAgIGlmICg1ID09PSB0KQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KFswLCAyMDAsIDAsIDEyOCwgMzIsIDEzMiwgMSwgMzgsIDY0LCA4LCAxMDAsIDAsIDEzMCwgNDgsIDQsIDE1MywgMCwgMzMsIDE0NCwgMiwgNTZdKTsKICAgICAgICAgICAgICAgICAgaWYgKDYgPT09IHQpCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoWzAsIDIwMCwgMCwgMTI4LCAzMiwgMTMyLCAxLCAzOCwgNjQsIDgsIDEwMCwgMCwgMTMwLCA0OCwgNCwgMTUzLCAwLCAzMywgMTQ0LCAyLCAwLCAxNzgsIDAsIDMyLCA4LCAyMjRdKQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGlmICgxID09PSB0KQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KFsxLCA2NCwgMzQsIDEyOCwgMTYzLCA3OCwgMjMwLCAxMjgsIDE4NiwgOCwgMCwgMCwgMCwgMjgsIDYsIDI0MSwgMTkzLCAxMCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDk0XSk7CiAgICAgICAgICAgICAgICAgIGlmICgyID09PSB0KQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KFsxLCA2NCwgMzQsIDEyOCwgMTYzLCA5NCwgMjMwLCAxMjgsIDE4NiwgOCwgMCwgMCwgMCwgMCwgMTQ5LCAwLCA2LCAyNDEsIDE2MSwgMTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTRdKTsKICAgICAgICAgICAgICAgICAgaWYgKDMgPT09IHQpCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoWzEsIDY0LCAzNCwgMTI4LCAxNjMsIDk0LCAyMzAsIDEyOCwgMTg2LCA4LCAwLCAwLCAwLCAwLCAxNDksIDAsIDYsIDI0MSwgMTYxLCAxMCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5MCwgOTAsIDkwLCA5NF0pCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlCiAgICAgIH0oKQogICAgICAgICwgeiA9IGkoNykKICAgICAgICAsIEggPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGZ1bmN0aW9uIGUoZSkgewogICAgICAgICAgICAgIHRoaXMuVEFHID0gIk1QNFJlbXV4ZXIiLAogICAgICAgICAgICAgIHRoaXMuX2NvbmZpZyA9IGUsCiAgICAgICAgICAgICAgdGhpcy5faXNMaXZlID0gITAgPT09IGUuaXNMaXZlLAogICAgICAgICAgICAgIHRoaXMuX2R0c0Jhc2UgPSAtMSwKICAgICAgICAgICAgICB0aGlzLl9kdHNCYXNlSW5pdGVkID0gITEsCiAgICAgICAgICAgICAgdGhpcy5fYXVkaW9EdHNCYXNlID0gMSAvIDAsCiAgICAgICAgICAgICAgdGhpcy5fdmlkZW9EdHNCYXNlID0gMSAvIDAsCiAgICAgICAgICAgICAgdGhpcy5fYXVkaW9OZXh0RHRzID0gdm9pZCAwLAogICAgICAgICAgICAgIHRoaXMuX3ZpZGVvTmV4dER0cyA9IHZvaWQgMCwKICAgICAgICAgICAgICB0aGlzLl9hdWRpb1N0YXNoZWRMYXN0U2FtcGxlID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl92aWRlb1N0YXNoZWRMYXN0U2FtcGxlID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9hdWRpb01ldGEgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX3ZpZGVvTWV0YSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fYXVkaW9TZWdtZW50SW5mb0xpc3QgPSBuZXcgei5jKCJhdWRpbyIpLAogICAgICAgICAgICAgIHRoaXMuX3ZpZGVvU2VnbWVudEluZm9MaXN0ID0gbmV3IHouYygidmlkZW8iKSwKICAgICAgICAgICAgICB0aGlzLl9vbkluaXRTZWdtZW50ID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9vbk1lZGlhU2VnbWVudCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fZm9yY2VGaXJzdElEUiA9ICEoIWEuYS5jaHJvbWUgfHwgIShhLmEudmVyc2lvbi5tYWpvciA8IDUwIHx8IDUwID09PSBhLmEudmVyc2lvbi5tYWpvciAmJiBhLmEudmVyc2lvbi5idWlsZCA8IDI2NjEpKSwKICAgICAgICAgICAgICB0aGlzLl9maWxsU2lsZW50QWZ0ZXJTZWVrID0gYS5hLm1zZWRnZSB8fCBhLmEubXNpZSwKICAgICAgICAgICAgICB0aGlzLl9tcDNVc2VNcGVnQXVkaW8gPSAhYS5hLmZpcmVmb3gsCiAgICAgICAgICAgICAgdGhpcy5fZmlsbEF1ZGlvVGltZXN0YW1wR2FwID0gdGhpcy5fY29uZmlnLmZpeEF1ZGlvVGltZXN0YW1wR2FwCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX2R0c0Jhc2UgPSAtMSwKICAgICAgICAgICAgICB0aGlzLl9kdHNCYXNlSW5pdGVkID0gITEsCiAgICAgICAgICAgICAgdGhpcy5fYXVkaW9NZXRhID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl92aWRlb01ldGEgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX2F1ZGlvU2VnbWVudEluZm9MaXN0LmNsZWFyKCksCiAgICAgICAgICAgICAgdGhpcy5fYXVkaW9TZWdtZW50SW5mb0xpc3QgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX3ZpZGVvU2VnbWVudEluZm9MaXN0LmNsZWFyKCksCiAgICAgICAgICAgICAgdGhpcy5fdmlkZW9TZWdtZW50SW5mb0xpc3QgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uSW5pdFNlZ21lbnQgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uTWVkaWFTZWdtZW50ID0gbnVsbAogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuYmluZERhdGFTb3VyY2UgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUub25EYXRhQXZhaWxhYmxlID0gdGhpcy5yZW11eC5iaW5kKHRoaXMpLAogICAgICAgICAgICAgIGUub25UcmFja01ldGFkYXRhID0gdGhpcy5fb25UcmFja01ldGFkYXRhUmVjZWl2ZWQuYmluZCh0aGlzKSwKICAgICAgICAgICAgICB0aGlzCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJvbkluaXRTZWdtZW50IiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vbkluaXRTZWdtZW50CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fb25Jbml0U2VnbWVudCA9IGUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAib25NZWRpYVNlZ21lbnQiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29uTWVkaWFTZWdtZW50CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fb25NZWRpYVNlZ21lbnQgPSBlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIGUucHJvdG90eXBlLmluc2VydERpc2NvbnRpbnVpdHkgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0aGlzLl9hdWRpb05leHREdHMgPSB0aGlzLl92aWRlb05leHREdHMgPSB2b2lkIDAKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLnNlZWsgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdGhpcy5fYXVkaW9TdGFzaGVkTGFzdFNhbXBsZSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fdmlkZW9TdGFzaGVkTGFzdFNhbXBsZSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fdmlkZW9TZWdtZW50SW5mb0xpc3QuY2xlYXIoKSwKICAgICAgICAgICAgICB0aGlzLl9hdWRpb1NlZ21lbnRJbmZvTGlzdC5jbGVhcigpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5yZW11eCA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICBpZiAoIXRoaXMuX29uTWVkaWFTZWdtZW50KQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgXy5hKCJNUDRSZW11eGVyOiBvbk1lZGlhU2VnbWVudCBjYWxsYmFjayBtdXN0IGJlIHNwZWNpZmljZWQhIik7CiAgICAgICAgICAgICAgdGhpcy5fZHRzQmFzZUluaXRlZCB8fCB0aGlzLl9jYWxjdWxhdGVEdHNCYXNlKGUsIHQpLAogICAgICAgICAgICAgIHQgJiYgdGhpcy5fcmVtdXhWaWRlbyh0KSwKICAgICAgICAgICAgICBlICYmIHRoaXMuX3JlbXV4QXVkaW8oZSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vblRyYWNrTWV0YWRhdGFSZWNlaXZlZCA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICB2YXIgaSA9IG51bGwKICAgICAgICAgICAgICAgICwgbiA9ICJtcDQiCiAgICAgICAgICAgICAgICAsIHIgPSB0LmNvZGVjOwogICAgICAgICAgICAgIGlmICgiYXVkaW8iID09PSBlKQogICAgICAgICAgICAgICAgICB0aGlzLl9hdWRpb01ldGEgPSB0LAogICAgICAgICAgICAgICAgICAibXAzIiA9PT0gdC5jb2RlYyAmJiB0aGlzLl9tcDNVc2VNcGVnQXVkaW8gPyAobiA9ICJtcGVnIiwKICAgICAgICAgICAgICAgICAgciA9ICIiLAogICAgICAgICAgICAgICAgICBpID0gbmV3IFVpbnQ4QXJyYXkpIDogaSA9IFYuZ2VuZXJhdGVJbml0U2VnbWVudCh0KTsKICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgaWYgKCJ2aWRlbyIgIT09IGUpCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgIHRoaXMuX3ZpZGVvTWV0YSA9IHQsCiAgICAgICAgICAgICAgICAgIGkgPSBWLmdlbmVyYXRlSW5pdFNlZ21lbnQodCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKCF0aGlzLl9vbkluaXRTZWdtZW50KQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgXy5hKCJNUDRSZW11eGVyOiBvbkluaXRTZWdtZW50IGNhbGxiYWNrIG11c3QgYmUgc3BlY2lmaWVkISIpOwogICAgICAgICAgICAgIHRoaXMuX29uSW5pdFNlZ21lbnQoZSwgewogICAgICAgICAgICAgICAgICB0eXBlOiBlLAogICAgICAgICAgICAgICAgICBkYXRhOiBpLmJ1ZmZlciwKICAgICAgICAgICAgICAgICAgY29kZWM6IHIsCiAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogZSArICIvIiArIG4sCiAgICAgICAgICAgICAgICAgIG1lZGlhRHVyYXRpb246IHQuZHVyYXRpb24KICAgICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX2NhbGN1bGF0ZUR0c0Jhc2UgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgdGhpcy5fZHRzQmFzZUluaXRlZCB8fCAoZSAmJiBlLnNhbXBsZXMgJiYgZS5zYW1wbGVzLmxlbmd0aCAmJiAodGhpcy5fYXVkaW9EdHNCYXNlID0gZS5zYW1wbGVzWzBdLmR0cyksCiAgICAgICAgICAgICAgdCAmJiB0LnNhbXBsZXMgJiYgdC5zYW1wbGVzLmxlbmd0aCAmJiAodGhpcy5fdmlkZW9EdHNCYXNlID0gdC5zYW1wbGVzWzBdLmR0cyksCiAgICAgICAgICAgICAgdGhpcy5fZHRzQmFzZSA9IE1hdGgubWluKHRoaXMuX2F1ZGlvRHRzQmFzZSwgdGhpcy5fdmlkZW9EdHNCYXNlKSwKICAgICAgICAgICAgICB0aGlzLl9kdHNCYXNlSW5pdGVkID0gITApCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5nZXRUaW1lc3RhbXBCYXNlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2R0c0Jhc2VJbml0ZWQgPyB0aGlzLl9kdHNCYXNlIDogMAogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuZmx1c2hTdGFzaGVkU2FtcGxlcyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHZhciBlID0gdGhpcy5fdmlkZW9TdGFzaGVkTGFzdFNhbXBsZQogICAgICAgICAgICAgICAgLCB0ID0gdGhpcy5fYXVkaW9TdGFzaGVkTGFzdFNhbXBsZQogICAgICAgICAgICAgICAgLCBpID0gewogICAgICAgICAgICAgICAgICB0eXBlOiAidmlkZW8iLAogICAgICAgICAgICAgICAgICBpZDogMSwKICAgICAgICAgICAgICAgICAgc2VxdWVuY2VOdW1iZXI6IDAsCiAgICAgICAgICAgICAgICAgIHNhbXBsZXM6IFtdLAogICAgICAgICAgICAgICAgICBsZW5ndGg6IDAKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIG51bGwgIT0gZSAmJiAoaS5zYW1wbGVzLnB1c2goZSksCiAgICAgICAgICAgICAgaS5sZW5ndGggPSBlLmxlbmd0aCk7CiAgICAgICAgICAgICAgdmFyIG4gPSB7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJhdWRpbyIsCiAgICAgICAgICAgICAgICAgIGlkOiAyLAogICAgICAgICAgICAgICAgICBzZXF1ZW5jZU51bWJlcjogMCwKICAgICAgICAgICAgICAgICAgc2FtcGxlczogW10sCiAgICAgICAgICAgICAgICAgIGxlbmd0aDogMAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgbnVsbCAhPSB0ICYmIChuLnNhbXBsZXMucHVzaCh0KSwKICAgICAgICAgICAgICBuLmxlbmd0aCA9IHQubGVuZ3RoKSwKICAgICAgICAgICAgICB0aGlzLl92aWRlb1N0YXNoZWRMYXN0U2FtcGxlID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9hdWRpb1N0YXNoZWRMYXN0U2FtcGxlID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9yZW11eFZpZGVvKGksICEwKSwKICAgICAgICAgICAgICB0aGlzLl9yZW11eEF1ZGlvKG4sICEwKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX3JlbXV4QXVkaW8gPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgaWYgKG51bGwgIT0gdGhpcy5fYXVkaW9NZXRhKSB7CiAgICAgICAgICAgICAgICAgIHZhciBpLCBuID0gZSwgciA9IG4uc2FtcGxlcywgbyA9IHZvaWQgMCwgaCA9IC0xLCBkID0gdGhpcy5fYXVkaW9NZXRhLnJlZlNhbXBsZUR1cmF0aW9uLCB1ID0gIm1wMyIgPT09IHRoaXMuX2F1ZGlvTWV0YS5jb2RlYyAmJiB0aGlzLl9tcDNVc2VNcGVnQXVkaW8sIF8gPSB0aGlzLl9kdHNCYXNlSW5pdGVkICYmIHZvaWQgMCA9PT0gdGhpcy5fYXVkaW9OZXh0RHRzLCBjID0gITE7CiAgICAgICAgICAgICAgICAgIGlmIChyICYmIDAgIT09IHIubGVuZ3RoICYmICgxICE9PSByLmxlbmd0aCB8fCB0KSkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICwgZiA9IG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgLCBwID0gMDsKICAgICAgICAgICAgICAgICAgICAgIHUgPyAobCA9IDAsCiAgICAgICAgICAgICAgICAgICAgICBwID0gbi5sZW5ndGgpIDogKGwgPSA4LAogICAgICAgICAgICAgICAgICAgICAgcCA9IDggKyBuLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgbSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoci5sZW5ndGggPiAxICYmIChwIC09IChtID0gci5wb3AoKSkubGVuZ3RoKSwKICAgICAgICAgICAgICAgICAgICAgIG51bGwgIT0gdGhpcy5fYXVkaW9TdGFzaGVkTGFzdFNhbXBsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gdGhpcy5fYXVkaW9TdGFzaGVkTGFzdFNhbXBsZTsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdWRpb1N0YXNoZWRMYXN0U2FtcGxlID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICByLnVuc2hpZnQoZyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgcCArPSBnLmxlbmd0aAogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSBtICYmICh0aGlzLl9hdWRpb1N0YXNoZWRMYXN0U2FtcGxlID0gbSk7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgdiA9IHJbMF0uZHRzIC0gdGhpcy5fZHRzQmFzZTsKICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hdWRpb05leHREdHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgbyA9IHYgLSB0aGlzLl9hdWRpb05leHREdHM7CiAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLl9hdWRpb1NlZ21lbnRJbmZvTGlzdC5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgbyA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmlsbFNpbGVudEFmdGVyU2VlayAmJiAhdGhpcy5fdmlkZW9TZWdtZW50SW5mb0xpc3QuaXNFbXB0eSgpICYmICJtcDMiICE9PSB0aGlzLl9hdWRpb01ldGEub3JpZ2luYWxDb2RlYyAmJiAoYyA9ICEwKTsKICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB5ID0gdGhpcy5fYXVkaW9TZWdtZW50SW5mb0xpc3QuZ2V0TGFzdFNhbXBsZUJlZm9yZSh2KTsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSB5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gdiAtICh5Lm9yaWdpbmFsRHRzICsgeS5kdXJhdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPD0gMyAmJiAoYiA9IDApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvID0gdiAtICh5LmR0cyArIHkuZHVyYXRpb24gKyBiKQogICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvID0gMAogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgaWYgKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgRSA9IHYgLSBvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIFMgPSB0aGlzLl92aWRlb1NlZ21lbnRJbmZvTGlzdC5nZXRMYXN0U2VnbWVudEJlZm9yZSh2KTsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSBTICYmIFMuYmVnaW5EdHMgPCBFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChQID0gai5nZXRTaWxlbnRGcmFtZSh0aGlzLl9hdWRpb01ldGEub3JpZ2luYWxDb2RlYywgdGhpcy5fYXVkaW9NZXRhLmNoYW5uZWxDb3VudCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBBID0gUy5iZWdpbkR0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIFIgPSBFIC0gUy5iZWdpbkR0czsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMuYS52KHRoaXMuVEFHLCAiSW5zZXJ0UHJlZml4U2lsZW50QXVkaW86IGR0czogIiArIEEgKyAiLCBkdXJhdGlvbjogIiArIFIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgci51bnNoaWZ0KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0OiBQLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR0czogQSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdHM6IEEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcCArPSBQLmJ5dGVMZW5ndGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gITEKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIEwgPSBbXSwgVCA9IDA7IFQgPCByLmxlbmd0aDsgVCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHcgPSAoZyA9IHJbVF0pLnVuaXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgRCA9IGcuZHRzIC0gdGhpcy5fZHRzQmFzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBrID0gKEEgPSBELAogICAgICAgICAgICAgICAgICAgICAgICAgICExKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBDID0gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBJID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShEIDwgLS4wMDEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgibXAzIiAhPT0gdGhpcy5fYXVkaW9NZXRhLmNvZGVjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgTyA9IEQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fYXVkaW9OZXh0RHRzICYmIChPID0gdGhpcy5fYXVkaW9OZXh0RHRzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChvID0gRCAtIE8pIDw9IC0zICogZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMuYS53KHRoaXMuVEFHLCAiRHJvcHBpbmcgMSBhdWRpbyBmcmFtZSAob3JpZ2luYWxEdHM6ICIgKyBEICsgIiBtcyAsY3VyUmVmRHRzOiAiICsgTyArICIgbXMpICBkdWUgdG8gZHRzQ29ycmVjdGlvbjogIiArIG8gKyAiIG1zIG92ZXJsYXAuIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvID49IDMgKiBkICYmIHRoaXMuX2ZpbGxBdWRpb1RpbWVzdGFtcEdhcCAmJiAhYS5hLnNhZmFyaSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgUCwgTSA9IE1hdGguZmxvb3IobyAvIGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMuYS53KHRoaXMuVEFHLCAiTGFyZ2UgYXVkaW8gdGltZXN0YW1wIGdhcCBkZXRlY3RlZCwgbWF5IGNhdXNlIEFWIHN5bmMgdG8gZHJpZnQuIFNpbGVudCBmcmFtZXMgd2lsbCBiZSBnZW5lcmF0ZWQgdG8gYXZvaWQgdW5zeW5jLlxub3JpZ2luYWxEdHM6ICIgKyBEICsgIiBtcywgY3VyUmVmRHRzOiAiICsgTyArICIgbXMsIGR0c0NvcnJlY3Rpb246ICIgKyBNYXRoLnJvdW5kKG8pICsgIiBtcywgZ2VuZXJhdGU6ICIgKyBNICsgIiBmcmFtZXMiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0gTWF0aC5mbG9vcihPKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJID0gTWF0aC5mbG9vcihPICsgZCkgLSBBLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgPT0gKFAgPSBqLmdldFNpbGVudEZyYW1lKHRoaXMuX2F1ZGlvTWV0YS5vcmlnaW5hbENvZGVjLCB0aGlzLl9hdWRpb01ldGEuY2hhbm5lbENvdW50KSkgJiYgKHMuYS53KHRoaXMuVEFHLCAiVW5hYmxlIHRvIGdlbmVyYXRlIHNpbGVudCBmcmFtZSBmb3IgIiArIHRoaXMuX2F1ZGlvTWV0YS5vcmlnaW5hbENvZGVjICsgIiB3aXRoICIgKyB0aGlzLl9hdWRpb01ldGEuY2hhbm5lbENvdW50ICsgIiBjaGFubmVscywgcmVwZWF0IGxhc3QgZnJhbWUiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQID0gdyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgTTsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE8gKz0gZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEIgPSBNYXRoLmZsb29yKE8pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBVID0gTWF0aC5mbG9vcihPICsgZCkgLSBCCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBOID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHRzOiBCLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHRzOiBCLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RzOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pdDogUCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IFAuYnl0ZUxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBVLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxEdHM6IEQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzTGVhZGluZzogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXBlbmRzT246IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNEZXBlbmRlZE9uOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc1JlZHVuZGFuY3k6IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQy5wdXNoKE4pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwICs9IE4uc2l6ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdWRpb05leHREdHMgPSBPICsgZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSA9IE1hdGguZmxvb3IoTyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSSA9IE1hdGguZmxvb3IoTyArIGQpIC0gQSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdWRpb05leHREdHMgPSBPICsgZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEEgPSBEIC0gbywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQgIT09IHIubGVuZ3RoIC0gMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJID0gcltUICsgMV0uZHRzIC0gdGhpcy5fZHRzQmFzZSAtIG8gLSBBOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAobnVsbCAhPSBtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEkgPSBtLmR0cyAtIHRoaXMuX2R0c0Jhc2UgLSBvIC0gQTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJID0gTC5sZW5ndGggPj0gMSA/IExbTC5sZW5ndGggLSAxXS5kdXJhdGlvbiA6IE1hdGguZmxvb3IoZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdWRpb05leHREdHMgPSBBICsgSQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0xID09PSBoICYmIChoID0gQSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEwucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdHM6IEEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdHM6IEEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHM6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0OiBnLnVuaXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBnLnVuaXQuYnl0ZUxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBJLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxEdHM6IEQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzTGVhZGluZzogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXBlbmRzT246IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNEZXBlbmRlZE9uOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc1JlZHVuZGFuY3k6IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgJiYgTC5wdXNoLmFwcGx5KEwsIEMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPT09IEwubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuLnNhbXBsZXMgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIChuLmxlbmd0aCA9IDApOwogICAgICAgICAgICAgICAgICAgICAgdSA/IGYgPSBuZXcgVWludDhBcnJheShwKSA6ICgoZiA9IG5ldyBVaW50OEFycmF5KHApKVswXSA9IHAgPj4+IDI0ICYgMjU1LAogICAgICAgICAgICAgICAgICAgICAgZlsxXSA9IHAgPj4+IDE2ICYgMjU1LAogICAgICAgICAgICAgICAgICAgICAgZlsyXSA9IHAgPj4+IDggJiAyNTUsCiAgICAgICAgICAgICAgICAgICAgICBmWzNdID0gMjU1ICYgcCwKICAgICAgICAgICAgICAgICAgICAgIGYuc2V0KFYudHlwZXMubWRhdCwgNCkpOwogICAgICAgICAgICAgICAgICAgICAgZm9yIChUID0gMDsgVCA8IEwubGVuZ3RoOyBUKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB3ID0gTFtUXS51bml0OwogICAgICAgICAgICAgICAgICAgICAgICAgIGYuc2V0KHcsIGwpLAogICAgICAgICAgICAgICAgICAgICAgICAgIGwgKz0gdy5ieXRlTGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB2YXIgRiA9IExbTC5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgICAgICAgIGkgPSBGLmR0cyArIEYuZHVyYXRpb247CiAgICAgICAgICAgICAgICAgICAgICB2YXIgRyA9IG5ldyB6LmI7CiAgICAgICAgICAgICAgICAgICAgICBHLmJlZ2luRHRzID0gaCwKICAgICAgICAgICAgICAgICAgICAgIEcuZW5kRHRzID0gaSwKICAgICAgICAgICAgICAgICAgICAgIEcuYmVnaW5QdHMgPSBoLAogICAgICAgICAgICAgICAgICAgICAgRy5lbmRQdHMgPSBpLAogICAgICAgICAgICAgICAgICAgICAgRy5vcmlnaW5hbEJlZ2luRHRzID0gTFswXS5vcmlnaW5hbER0cywKICAgICAgICAgICAgICAgICAgICAgIEcub3JpZ2luYWxFbmREdHMgPSBGLm9yaWdpbmFsRHRzICsgRi5kdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgIEcuZmlyc3RTYW1wbGUgPSBuZXcgei5kKExbMF0uZHRzLExbMF0ucHRzLExbMF0uZHVyYXRpb24sTFswXS5vcmlnaW5hbER0cywhMSksCiAgICAgICAgICAgICAgICAgICAgICBHLmxhc3RTYW1wbGUgPSBuZXcgei5kKEYuZHRzLEYucHRzLEYuZHVyYXRpb24sRi5vcmlnaW5hbER0cywhMSksCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0xpdmUgfHwgdGhpcy5fYXVkaW9TZWdtZW50SW5mb0xpc3QuYXBwZW5kKEcpLAogICAgICAgICAgICAgICAgICAgICAgbi5zYW1wbGVzID0gTCwKICAgICAgICAgICAgICAgICAgICAgIG4uc2VxdWVuY2VOdW1iZXIrKzsKICAgICAgICAgICAgICAgICAgICAgIHZhciBIID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgIEggPSB1ID8gbmV3IFVpbnQ4QXJyYXkgOiBWLm1vb2YobiwgaCksCiAgICAgICAgICAgICAgICAgICAgICBuLnNhbXBsZXMgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgIG4ubGVuZ3RoID0gMDsKICAgICAgICAgICAgICAgICAgICAgIHZhciBxID0gewogICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJhdWRpbyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5fbWVyZ2VCb3hlcyhILCBmKS5idWZmZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtcGxlQ291bnQ6IEwubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgIGluZm86IEcKICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICB1ICYmIF8gJiYgKHEudGltZXN0YW1wT2Zmc2V0ID0gaCksCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbk1lZGlhU2VnbWVudCgiYXVkaW8iLCBxKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX3JlbXV4VmlkZW8gPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgaWYgKG51bGwgIT0gdGhpcy5fdmlkZW9NZXRhKSB7CiAgICAgICAgICAgICAgICAgIHZhciBpLCBuLCByID0gZSwgcyA9IHIuc2FtcGxlcywgYSA9IHZvaWQgMCwgbyA9IC0xLCBoID0gLTE7CiAgICAgICAgICAgICAgICAgIGlmIChzICYmIDAgIT09IHMubGVuZ3RoICYmICgxICE9PSBzLmxlbmd0aCB8fCB0KSkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSA4CiAgICAgICAgICAgICAgICAgICAgICAgICwgdSA9IG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgLCBfID0gOCArIGUubGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgICAgICwgYyA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICBpZiAocy5sZW5ndGggPiAxICYmIChfIC09IChjID0gcy5wb3AoKSkubGVuZ3RoKSwKICAgICAgICAgICAgICAgICAgICAgIG51bGwgIT0gdGhpcy5fdmlkZW9TdGFzaGVkTGFzdFNhbXBsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsID0gdGhpcy5fdmlkZW9TdGFzaGVkTGFzdFNhbXBsZTsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl92aWRlb1N0YXNoZWRMYXN0U2FtcGxlID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICBzLnVuc2hpZnQobCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgXyArPSBsLmxlbmd0aAogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSBjICYmICh0aGlzLl92aWRlb1N0YXNoZWRMYXN0U2FtcGxlID0gYyk7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IHNbMF0uZHRzIC0gdGhpcy5fZHRzQmFzZTsKICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl92aWRlb05leHREdHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGYgLSB0aGlzLl92aWRlb05leHREdHM7CiAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLl92aWRlb1NlZ21lbnRJbmZvTGlzdC5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IHRoaXMuX3ZpZGVvU2VnbWVudEluZm9MaXN0LmdldExhc3RTYW1wbGVCZWZvcmUoZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gcCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbSA9IGYgLSAocC5vcmlnaW5hbER0cyArIHAuZHVyYXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtIDw9IDMgJiYgKG0gPSAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGYgLSAocC5kdHMgKyBwLmR1cmF0aW9uICsgbSkKICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IDAKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGcgPSBuZXcgei5iLCB2ID0gW10sIHkgPSAwOyB5IDwgcy5sZW5ndGg7IHkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gKGwgPSBzW3ldKS5kdHMgLSB0aGlzLl9kdHNCYXNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIEUgPSBsLmlzS2V5ZnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgUyA9IGIgLSBhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIEEgPSBsLmN0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBSID0gUyArIEE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgLTEgPT09IG8gJiYgKG8gPSBTLAogICAgICAgICAgICAgICAgICAgICAgICAgIGggPSBSKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgTCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHkgIT09IHMubGVuZ3RoIC0gMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTCA9IHNbeSArIDFdLmR0cyAtIHRoaXMuX2R0c0Jhc2UgLSBhIC0gUzsKICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChudWxsICE9IGMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEwgPSBjLmR0cyAtIHRoaXMuX2R0c0Jhc2UgLSBhIC0gUzsKICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEwgPSB2Lmxlbmd0aCA+PSAxID8gdlt2Lmxlbmd0aCAtIDFdLmR1cmF0aW9uIDogTWF0aC5mbG9vcih0aGlzLl92aWRlb01ldGEucmVmU2FtcGxlRHVyYXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBUID0gbmV3IHouZChTLFIsTCxsLmR0cywhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQuZmlsZXBvc2l0aW9uID0gbC5maWxlcG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuYXBwZW5kU3luY1BvaW50KFQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIHYucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR0czogUywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHRzOiBSLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHM6IEEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXRzOiBsLnVuaXRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBsLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNLZXlmcmFtZTogRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IEwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsRHRzOiBiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFnczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNMZWFkaW5nOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVwZW5kc09uOiBFID8gMiA6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0RlcGVuZGVkT246IEUgPyAxIDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc1JlZHVuZGFuY3k6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc05vblN5bmM6IEUgPyAwIDogMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICh1ID0gbmV3IFVpbnQ4QXJyYXkoXykpWzBdID0gXyA+Pj4gMjQgJiAyNTUsCiAgICAgICAgICAgICAgICAgICAgICB1WzFdID0gXyA+Pj4gMTYgJiAyNTUsCiAgICAgICAgICAgICAgICAgICAgICB1WzJdID0gXyA+Pj4gOCAmIDI1NSwKICAgICAgICAgICAgICAgICAgICAgIHVbM10gPSAyNTUgJiBfLAogICAgICAgICAgICAgICAgICAgICAgdS5zZXQoVi50eXBlcy5tZGF0LCA0KTsKICAgICAgICAgICAgICAgICAgICAgIGZvciAoeSA9IDA7IHkgPCB2Lmxlbmd0aDsgeSsrKQogICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHcgPSB2W3ldLnVuaXRzOyB3Lmxlbmd0aDsgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBEID0gdy5zaGlmdCgpLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuc2V0KEQsIGQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkICs9IEQuYnl0ZUxlbmd0aAogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHZhciBrID0gdlt2Lmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPSBrLmR0cyArIGsuZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICBuID0gay5wdHMgKyBrLmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdmlkZW9OZXh0RHRzID0gaSwKICAgICAgICAgICAgICAgICAgICAgIGcuYmVnaW5EdHMgPSBvLAogICAgICAgICAgICAgICAgICAgICAgZy5lbmREdHMgPSBpLAogICAgICAgICAgICAgICAgICAgICAgZy5iZWdpblB0cyA9IGgsCiAgICAgICAgICAgICAgICAgICAgICBnLmVuZFB0cyA9IG4sCiAgICAgICAgICAgICAgICAgICAgICBnLm9yaWdpbmFsQmVnaW5EdHMgPSB2WzBdLm9yaWdpbmFsRHRzLAogICAgICAgICAgICAgICAgICAgICAgZy5vcmlnaW5hbEVuZER0cyA9IGsub3JpZ2luYWxEdHMgKyBrLmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgZy5maXJzdFNhbXBsZSA9IG5ldyB6LmQodlswXS5kdHMsdlswXS5wdHMsdlswXS5kdXJhdGlvbix2WzBdLm9yaWdpbmFsRHRzLHZbMF0uaXNLZXlmcmFtZSksCiAgICAgICAgICAgICAgICAgICAgICBnLmxhc3RTYW1wbGUgPSBuZXcgei5kKGsuZHRzLGsucHRzLGsuZHVyYXRpb24say5vcmlnaW5hbER0cyxrLmlzS2V5ZnJhbWUpLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNMaXZlIHx8IHRoaXMuX3ZpZGVvU2VnbWVudEluZm9MaXN0LmFwcGVuZChnKSwKICAgICAgICAgICAgICAgICAgICAgIHIuc2FtcGxlcyA9IHYsCiAgICAgICAgICAgICAgICAgICAgICByLnNlcXVlbmNlTnVtYmVyKyssCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9mb3JjZUZpcnN0SURSKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEMgPSB2WzBdLmZsYWdzOwogICAgICAgICAgICAgICAgICAgICAgICAgIEMuZGVwZW5kc09uID0gMiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDLmlzTm9uU3luYyA9IDAKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHZhciBJID0gVi5tb29mKHIsIG8pOwogICAgICAgICAgICAgICAgICAgICAgci5zYW1wbGVzID0gW10sCiAgICAgICAgICAgICAgICAgICAgICByLmxlbmd0aCA9IDAsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbk1lZGlhU2VnbWVudCgidmlkZW8iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogInZpZGVvIiwKICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLl9tZXJnZUJveGVzKEksIHUpLmJ1ZmZlciwKICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1wbGVDb3VudDogdi5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mbzogZwogICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9tZXJnZUJveGVzID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgIHZhciBpID0gbmV3IFVpbnQ4QXJyYXkoZS5ieXRlTGVuZ3RoICsgdC5ieXRlTGVuZ3RoKTsKICAgICAgICAgICAgICByZXR1cm4gaS5zZXQoZSwgMCksCiAgICAgICAgICAgICAgaS5zZXQodCwgZS5ieXRlTGVuZ3RoKSwKICAgICAgICAgICAgICBpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlCiAgICAgIH0oKQogICAgICAgICwgcSA9IGkoMTEpCiAgICAgICAgLCBLID0gaSgxKQogICAgICAgICwgVyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgZnVuY3Rpb24gZShlLCB0KSB7CiAgICAgICAgICAgICAgdGhpcy5UQUcgPSAiVHJhbnNtdXhpbmdDb250cm9sbGVyIiwKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyID0gbmV3IHIuYSwKICAgICAgICAgICAgICB0aGlzLl9jb25maWcgPSB0LAogICAgICAgICAgICAgIGUuc2VnbWVudHMgfHwgKGUuc2VnbWVudHMgPSBbewogICAgICAgICAgICAgICAgICBkdXJhdGlvbjogZS5kdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgZmlsZXNpemU6IGUuZmlsZXNpemUsCiAgICAgICAgICAgICAgICAgIHVybDogZS51cmwKICAgICAgICAgICAgICB9XSksCiAgICAgICAgICAgICAgImJvb2xlYW4iICE9IHR5cGVvZiBlLmNvcnMgJiYgKGUuY29ycyA9ICEwKSwKICAgICAgICAgICAgICAiYm9vbGVhbiIgIT0gdHlwZW9mIGUud2l0aENyZWRlbnRpYWxzICYmIChlLndpdGhDcmVkZW50aWFscyA9ICExKSwKICAgICAgICAgICAgICB0aGlzLl9tZWRpYURhdGFTb3VyY2UgPSBlLAogICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRTZWdtZW50SW5kZXggPSAwOwogICAgICAgICAgICAgIHZhciBpID0gMDsKICAgICAgICAgICAgICB0aGlzLl9tZWRpYURhdGFTb3VyY2Uuc2VnbWVudHMuZm9yRWFjaCgoZnVuY3Rpb24obikgewogICAgICAgICAgICAgICAgICBuLnRpbWVzdGFtcEJhc2UgPSBpLAogICAgICAgICAgICAgICAgICBpICs9IG4uZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgIG4uY29ycyA9IGUuY29ycywKICAgICAgICAgICAgICAgICAgbi53aXRoQ3JlZGVudGlhbHMgPSBlLndpdGhDcmVkZW50aWFscywKICAgICAgICAgICAgICAgICAgdC5yZWZlcnJlclBvbGljeSAmJiAobi5yZWZlcnJlclBvbGljeSA9IHQucmVmZXJyZXJQb2xpY3kpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkpLAogICAgICAgICAgICAgIGlzTmFOKGkpIHx8IHRoaXMuX21lZGlhRGF0YVNvdXJjZS5kdXJhdGlvbiA9PT0gaSB8fCAodGhpcy5fbWVkaWFEYXRhU291cmNlLmR1cmF0aW9uID0gaSksCiAgICAgICAgICAgICAgdGhpcy5fbWVkaWFJbmZvID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9kZW11eGVyID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9yZW11eGVyID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9pb2N0bCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fcGVuZGluZ1NlZWtUaW1lID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9wZW5kaW5nUmVzb2x2ZVNlZWtQb2ludCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fc3RhdGlzdGljc1JlcG9ydGVyID0gbnVsbAogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0aGlzLl9tZWRpYUluZm8gPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX21lZGlhRGF0YVNvdXJjZSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fc3RhdGlzdGljc1JlcG9ydGVyICYmIHRoaXMuX2Rpc2FibGVTdGF0aXN0aWNzUmVwb3J0ZXIoKSwKICAgICAgICAgICAgICB0aGlzLl9pb2N0bCAmJiAodGhpcy5faW9jdGwuZGVzdHJveSgpLAogICAgICAgICAgICAgIHRoaXMuX2lvY3RsID0gbnVsbCksCiAgICAgICAgICAgICAgdGhpcy5fZGVtdXhlciAmJiAodGhpcy5fZGVtdXhlci5kZXN0cm95KCksCiAgICAgICAgICAgICAgdGhpcy5fZGVtdXhlciA9IG51bGwpLAogICAgICAgICAgICAgIHRoaXMuX3JlbXV4ZXIgJiYgKHRoaXMuX3JlbXV4ZXIuZGVzdHJveSgpLAogICAgICAgICAgICAgIHRoaXMuX3JlbXV4ZXIgPSBudWxsKSwKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyLnJlbW92ZUFsbExpc3RlbmVycygpLAogICAgICAgICAgICAgIHRoaXMuX2VtaXR0ZXIgPSBudWxsCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyLmFkZExpc3RlbmVyKGUsIHQpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5yZW1vdmVMaXN0ZW5lcihlLCB0KQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0aGlzLl9sb2FkU2VnbWVudCgwKSwKICAgICAgICAgICAgICB0aGlzLl9lbmFibGVTdGF0aXN0aWNzUmVwb3J0ZXIoKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX2xvYWRTZWdtZW50ID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRTZWdtZW50SW5kZXggPSBlOwogICAgICAgICAgICAgIHZhciBpID0gdGhpcy5fbWVkaWFEYXRhU291cmNlLnNlZ21lbnRzW2VdCiAgICAgICAgICAgICAgICAsIG4gPSB0aGlzLl9pb2N0bCA9IG5ldyBxLmEoaSx0aGlzLl9jb25maWcsZSk7CiAgICAgICAgICAgICAgbi5vbkVycm9yID0gdGhpcy5fb25JT0V4Y2VwdGlvbi5iaW5kKHRoaXMpLAogICAgICAgICAgICAgIG4ub25TZWVrZWQgPSB0aGlzLl9vbklPU2Vla2VkLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgbi5vbkNvbXBsZXRlID0gdGhpcy5fb25JT0NvbXBsZXRlLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgbi5vblJlZGlyZWN0ID0gdGhpcy5fb25JT1JlZGlyZWN0LmJpbmQodGhpcyksCiAgICAgICAgICAgICAgbi5vblJlY292ZXJlZEVhcmx5RW9mID0gdGhpcy5fb25JT1JlY292ZXJlZEVhcmx5RW9mLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgdCA/IHRoaXMuX2RlbXV4ZXIuYmluZERhdGFTb3VyY2UodGhpcy5faW9jdGwpIDogbi5vbkRhdGFBcnJpdmFsID0gdGhpcy5fb25Jbml0Q2h1bmtBcnJpdmFsLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgbi5vcGVuKHQpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5faW50ZXJuYWxBYm9ydCgpLAogICAgICAgICAgICAgIHRoaXMuX2Rpc2FibGVTdGF0aXN0aWNzUmVwb3J0ZXIoKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX2ludGVybmFsQWJvcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0aGlzLl9pb2N0bCAmJiAodGhpcy5faW9jdGwuZGVzdHJveSgpLAogICAgICAgICAgICAgIHRoaXMuX2lvY3RsID0gbnVsbCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5faW9jdGwgJiYgdGhpcy5faW9jdGwuaXNXb3JraW5nKCkgJiYgKHRoaXMuX2lvY3RsLnBhdXNlKCksCiAgICAgICAgICAgICAgdGhpcy5fZGlzYWJsZVN0YXRpc3RpY3NSZXBvcnRlcigpKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUucmVzdW1lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5faW9jdGwgJiYgdGhpcy5faW9jdGwuaXNQYXVzZWQoKSAmJiAodGhpcy5faW9jdGwucmVzdW1lKCksCiAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlU3RhdGlzdGljc1JlcG9ydGVyKCkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5zZWVrID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGlmIChudWxsICE9IHRoaXMuX21lZGlhSW5mbyAmJiB0aGlzLl9tZWRpYUluZm8uaXNTZWVrYWJsZSgpKSB7CiAgICAgICAgICAgICAgICAgIHZhciB0ID0gdGhpcy5fc2VhcmNoU2VnbWVudEluZGV4Q29udGFpbnMoZSk7CiAgICAgICAgICAgICAgICAgIGlmICh0ID09PSB0aGlzLl9jdXJyZW50U2VnbWVudEluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMuX21lZGlhSW5mby5zZWdtZW50c1t0XTsKICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsID09IGkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGVuZGluZ1NlZWtUaW1lID0gZTsKICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gaS5nZXROZWFyZXN0S2V5ZnJhbWUoZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVtdXhlci5zZWVrKG4ubWlsbGlzZWNvbmRzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pb2N0bC5zZWVrKG4uZmlsZXBvc2l0aW9uKSwKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wZW5kaW5nUmVzb2x2ZVNlZWtQb2ludCA9IG4ubWlsbGlzZWNvbmRzCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgciA9IHRoaXMuX21lZGlhSW5mby5zZWdtZW50c1t0XTsKICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsID09IHIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGVuZGluZ1NlZWtUaW1lID0gZSwKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbnRlcm5hbEFib3J0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVtdXhlci5zZWVrKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVtdXhlci5pbnNlcnREaXNjb250aW51aXR5KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbG9hZFNlZ21lbnQodCk7CiAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gci5nZXROZWFyZXN0S2V5ZnJhbWUoZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faW50ZXJuYWxBYm9ydCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbXV4ZXIuc2VlayhlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZW11eGVyLmluc2VydERpc2NvbnRpbnVpdHkoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZW11eGVyLnJlc2V0TWVkaWFJbmZvKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVtdXhlci50aW1lc3RhbXBCYXNlID0gdGhpcy5fbWVkaWFEYXRhU291cmNlLnNlZ21lbnRzW3RdLnRpbWVzdGFtcEJhc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbG9hZFNlZ21lbnQodCwgbi5maWxlcG9zaXRpb24pLAogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdSZXNvbHZlU2Vla1BvaW50ID0gbi5taWxsaXNlY29uZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVwb3J0U2VnbWVudE1lZGlhSW5mbyh0KQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZVN0YXRpc3RpY3NSZXBvcnRlcigpCiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX3NlYXJjaFNlZ21lbnRJbmRleENvbnRhaW5zID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGZvciAodmFyIHQgPSB0aGlzLl9tZWRpYURhdGFTb3VyY2Uuc2VnbWVudHMsIGkgPSB0Lmxlbmd0aCAtIDEsIG4gPSAwOyBuIDwgdC5sZW5ndGg7IG4rKykKICAgICAgICAgICAgICAgICAgaWYgKGUgPCB0W25dLnRpbWVzdGFtcEJhc2UpIHsKICAgICAgICAgICAgICAgICAgICAgIGkgPSBuIC0gMTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gaQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX29uSW5pdENodW5rQXJyaXZhbCA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMKICAgICAgICAgICAgICAgICwgbiA9IG51bGwKICAgICAgICAgICAgICAgICwgciA9IDA7CiAgICAgICAgICAgICAgaWYgKHQgPiAwKQogICAgICAgICAgICAgICAgICB0aGlzLl9kZW11eGVyLmJpbmREYXRhU291cmNlKHRoaXMuX2lvY3RsKSwKICAgICAgICAgICAgICAgICAgdGhpcy5fZGVtdXhlci50aW1lc3RhbXBCYXNlID0gdGhpcy5fbWVkaWFEYXRhU291cmNlLnNlZ21lbnRzW3RoaXMuX2N1cnJlbnRTZWdtZW50SW5kZXhdLnRpbWVzdGFtcEJhc2UsCiAgICAgICAgICAgICAgICAgIHIgPSB0aGlzLl9kZW11eGVyLnBhcnNlQ2h1bmtzKGUsIHQpOwogICAgICAgICAgICAgIGVsc2UgaWYgKChuID0gRi5wcm9iZShlKSkubWF0Y2gpIHsKICAgICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLl9kZW11eGVyID0gbmV3IEYobix0aGlzLl9jb25maWcpOwogICAgICAgICAgICAgICAgICB0aGlzLl9yZW11eGVyIHx8ICh0aGlzLl9yZW11eGVyID0gbmV3IEgodGhpcy5fY29uZmlnKSksCiAgICAgICAgICAgICAgICAgIGEub25FcnJvciA9IHRoaXMuX29uRGVtdXhFeGNlcHRpb24uYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgICAgYS5vbk1lZGlhSW5mbyA9IHRoaXMuX29uTWVkaWFJbmZvLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICAgIGEub25NZXRhRGF0YUFycml2ZWQgPSB0aGlzLl9vbk1ldGFEYXRhQXJyaXZlZC5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgICBhLm9uVGltZWRJRDNNZXRhZGF0YSA9IHRoaXMuX29uVGltZWRJRDNNZXRhZGF0YS5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgICBhLm9uUEVTUHJpdmF0ZURhdGFEZXNjcmlwdG9yID0gdGhpcy5fb25QRVNQcml2YXRlRGF0YURlc2NyaXB0b3IuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgICAgYS5vblBFU1ByaXZhdGVEYXRhID0gdGhpcy5fb25QRVNQcml2YXRlRGF0YS5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgICB0aGlzLl9yZW11eGVyLmJpbmREYXRhU291cmNlKHRoaXMuX2RlbXV4ZXIpLAogICAgICAgICAgICAgICAgICB0aGlzLl9kZW11eGVyLmJpbmREYXRhU291cmNlKHRoaXMuX2lvY3RsKSwKICAgICAgICAgICAgICAgICAgdGhpcy5fcmVtdXhlci5vbkluaXRTZWdtZW50ID0gdGhpcy5fb25SZW11eGVySW5pdFNlZ21lbnRBcnJpdmFsLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbXV4ZXIub25NZWRpYVNlZ21lbnQgPSB0aGlzLl9vblJlbXV4ZXJNZWRpYVNlZ21lbnRBcnJpdmFsLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICAgIHIgPSB0aGlzLl9kZW11eGVyLnBhcnNlQ2h1bmtzKGUsIHQpCiAgICAgICAgICAgICAgfSBlbHNlIGlmICgobiA9IHYucHJvYmUoZSkpLm1hdGNoKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX2RlbXV4ZXIgPSBuZXcgdihuLHRoaXMuX2NvbmZpZyksCiAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbXV4ZXIgfHwgKHRoaXMuX3JlbXV4ZXIgPSBuZXcgSCh0aGlzLl9jb25maWcpKTsKICAgICAgICAgICAgICAgICAgdmFyIG8gPSB0aGlzLl9tZWRpYURhdGFTb3VyY2U7CiAgICAgICAgICAgICAgICAgIG51bGwgPT0gby5kdXJhdGlvbiB8fCBpc05hTihvLmR1cmF0aW9uKSB8fCAodGhpcy5fZGVtdXhlci5vdmVycmlkZWREdXJhdGlvbiA9IG8uZHVyYXRpb24pLAogICAgICAgICAgICAgICAgICAiYm9vbGVhbiIgPT0gdHlwZW9mIG8uaGFzQXVkaW8gJiYgKHRoaXMuX2RlbXV4ZXIub3ZlcnJpZGVkSGFzQXVkaW8gPSBvLmhhc0F1ZGlvKSwKICAgICAgICAgICAgICAgICAgImJvb2xlYW4iID09IHR5cGVvZiBvLmhhc1ZpZGVvICYmICh0aGlzLl9kZW11eGVyLm92ZXJyaWRlZEhhc1ZpZGVvID0gby5oYXNWaWRlbyksCiAgICAgICAgICAgICAgICAgIHRoaXMuX2RlbXV4ZXIudGltZXN0YW1wQmFzZSA9IG8uc2VnbWVudHNbdGhpcy5fY3VycmVudFNlZ21lbnRJbmRleF0udGltZXN0YW1wQmFzZSwKICAgICAgICAgICAgICAgICAgdGhpcy5fZGVtdXhlci5vbkVycm9yID0gdGhpcy5fb25EZW11eEV4Y2VwdGlvbi5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgICB0aGlzLl9kZW11eGVyLm9uTWVkaWFJbmZvID0gdGhpcy5fb25NZWRpYUluZm8uYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgICAgdGhpcy5fZGVtdXhlci5vbk1ldGFEYXRhQXJyaXZlZCA9IHRoaXMuX29uTWV0YURhdGFBcnJpdmVkLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICAgIHRoaXMuX2RlbXV4ZXIub25TY3JpcHREYXRhQXJyaXZlZCA9IHRoaXMuX29uU2NyaXB0RGF0YUFycml2ZWQuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgICAgdGhpcy5fcmVtdXhlci5iaW5kRGF0YVNvdXJjZSh0aGlzLl9kZW11eGVyLmJpbmREYXRhU291cmNlKHRoaXMuX2lvY3RsKSksCiAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbXV4ZXIub25Jbml0U2VnbWVudCA9IHRoaXMuX29uUmVtdXhlckluaXRTZWdtZW50QXJyaXZhbC5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgICB0aGlzLl9yZW11eGVyLm9uTWVkaWFTZWdtZW50ID0gdGhpcy5fb25SZW11eGVyTWVkaWFTZWdtZW50QXJyaXZhbC5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgICByID0gdGhpcy5fZGVtdXhlci5wYXJzZUNodW5rcyhlLCB0KQogICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICBuID0gbnVsbCwKICAgICAgICAgICAgICAgICAgcy5hLmUodGhpcy5UQUcsICJOb24gTVBFRy1UUy9GTFYsIFVuc3VwcG9ydGVkIG1lZGlhIHR5cGUhIiksCiAgICAgICAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgaS5faW50ZXJuYWxBYm9ydCgpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgKSksCiAgICAgICAgICAgICAgICAgIHRoaXMuX2VtaXR0ZXIuZW1pdChLLmEuREVNVVhfRVJST1IsIG0uYS5GT1JNQVRfVU5TVVBQT1JURUQsICJOb24gTVBFRy1UUy9GTFYsIFVuc3VwcG9ydGVkIG1lZGlhIHR5cGUhIiksCiAgICAgICAgICAgICAgICAgIHIgPSAwOwogICAgICAgICAgICAgIHJldHVybiByCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fb25NZWRpYUluZm8gPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzOwogICAgICAgICAgICAgIG51bGwgPT0gdGhpcy5fbWVkaWFJbmZvICYmICh0aGlzLl9tZWRpYUluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBlKSwKICAgICAgICAgICAgICB0aGlzLl9tZWRpYUluZm8ua2V5ZnJhbWVzSW5kZXggPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX21lZGlhSW5mby5zZWdtZW50cyA9IFtdLAogICAgICAgICAgICAgIHRoaXMuX21lZGlhSW5mby5zZWdtZW50Q291bnQgPSB0aGlzLl9tZWRpYURhdGFTb3VyY2Uuc2VnbWVudHMubGVuZ3RoLAogICAgICAgICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLl9tZWRpYUluZm8sIG8uYS5wcm90b3R5cGUpKTsKICAgICAgICAgICAgICB2YXIgaSA9IE9iamVjdC5hc3NpZ24oe30sIGUpOwogICAgICAgICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihpLCBvLmEucHJvdG90eXBlKSwKICAgICAgICAgICAgICB0aGlzLl9tZWRpYUluZm8uc2VnbWVudHNbdGhpcy5fY3VycmVudFNlZ21lbnRJbmRleF0gPSBpLAogICAgICAgICAgICAgIHRoaXMuX3JlcG9ydFNlZ21lbnRNZWRpYUluZm8odGhpcy5fY3VycmVudFNlZ21lbnRJbmRleCksCiAgICAgICAgICAgICAgbnVsbCAhPSB0aGlzLl9wZW5kaW5nU2Vla1RpbWUgJiYgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHZhciBlID0gdC5fcGVuZGluZ1NlZWtUaW1lOwogICAgICAgICAgICAgICAgICB0Ll9wZW5kaW5nU2Vla1RpbWUgPSBudWxsLAogICAgICAgICAgICAgICAgICB0LnNlZWsoZSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vbk1ldGFEYXRhQXJyaXZlZCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyLmVtaXQoSy5hLk1FVEFEQVRBX0FSUklWRUQsIGUpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fb25TY3JpcHREYXRhQXJyaXZlZCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyLmVtaXQoSy5hLlNDUklQVERBVEFfQVJSSVZFRCwgZSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vblRpbWVkSUQzTWV0YWRhdGEgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLl9yZW11eGVyLmdldFRpbWVzdGFtcEJhc2UoKTsKICAgICAgICAgICAgICBudWxsICE9IGUucHRzICYmIChlLnB0cyAtPSB0KSwKICAgICAgICAgICAgICBudWxsICE9IGUuZHRzICYmIChlLmR0cyAtPSB0KSwKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyLmVtaXQoSy5hLlRJTUVEX0lEM19NRVRBREFUQV9BUlJJVkVELCBlKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX29uUEVTUHJpdmF0ZURhdGFEZXNjcmlwdG9yID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHRoaXMuX2VtaXR0ZXIuZW1pdChLLmEuUEVTX1BSSVZBVEVfREFUQV9ERVNDUklQVE9SLCBlKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX29uUEVTUHJpdmF0ZURhdGEgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLl9yZW11eGVyLmdldFRpbWVzdGFtcEJhc2UoKTsKICAgICAgICAgICAgICBudWxsICE9IGUucHRzICYmIChlLnB0cyAtPSB0KSwKICAgICAgICAgICAgICBudWxsICE9IGUubmVhcmVzdF9wdHMgJiYgKGUubmVhcmVzdF9wdHMgLT0gdCksCiAgICAgICAgICAgICAgbnVsbCAhPSBlLmR0cyAmJiAoZS5kdHMgLT0gdCksCiAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5lbWl0KEsuYS5QRVNfUFJJVkFURV9EQVRBX0FSUklWRUQsIGUpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fb25JT1NlZWtlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX3JlbXV4ZXIuaW5zZXJ0RGlzY29udGludWl0eSgpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fb25JT0NvbXBsZXRlID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHZhciB0ID0gZSArIDE7CiAgICAgICAgICAgICAgdCA8IHRoaXMuX21lZGlhRGF0YVNvdXJjZS5zZWdtZW50cy5sZW5ndGggPyAodGhpcy5faW50ZXJuYWxBYm9ydCgpLAogICAgICAgICAgICAgIHRoaXMuX3JlbXV4ZXIgJiYgdGhpcy5fcmVtdXhlci5mbHVzaFN0YXNoZWRTYW1wbGVzKCksCiAgICAgICAgICAgICAgdGhpcy5fbG9hZFNlZ21lbnQodCkpIDogKHRoaXMuX3JlbXV4ZXIgJiYgdGhpcy5fcmVtdXhlci5mbHVzaFN0YXNoZWRTYW1wbGVzKCksCiAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5lbWl0KEsuYS5MT0FESU5HX0NPTVBMRVRFKSwKICAgICAgICAgICAgICB0aGlzLl9kaXNhYmxlU3RhdGlzdGljc1JlcG9ydGVyKCkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fb25JT1JlZGlyZWN0ID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHZhciB0ID0gdGhpcy5faW9jdGwuZXh0cmFEYXRhOwogICAgICAgICAgICAgIHRoaXMuX21lZGlhRGF0YVNvdXJjZS5zZWdtZW50c1t0XS5yZWRpcmVjdGVkVVJMID0gZQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX29uSU9SZWNvdmVyZWRFYXJseUVvZiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX2VtaXR0ZXIuZW1pdChLLmEuUkVDT1ZFUkVEX0VBUkxZX0VPRikKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vbklPRXhjZXB0aW9uID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgIHMuYS5lKHRoaXMuVEFHLCAiSU9FeGNlcHRpb246IHR5cGUgPSAiICsgZSArICIsIGNvZGUgPSAiICsgdC5jb2RlICsgIiwgbXNnID0gIiArIHQubXNnKSwKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyLmVtaXQoSy5hLklPX0VSUk9SLCBlLCB0KSwKICAgICAgICAgICAgICB0aGlzLl9kaXNhYmxlU3RhdGlzdGljc1JlcG9ydGVyKCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vbkRlbXV4RXhjZXB0aW9uID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgIHMuYS5lKHRoaXMuVEFHLCAiRGVtdXhFeGNlcHRpb246IHR5cGUgPSAiICsgZSArICIsIGluZm8gPSAiICsgdCksCiAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5lbWl0KEsuYS5ERU1VWF9FUlJPUiwgZSwgdCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vblJlbXV4ZXJJbml0U2VnbWVudEFycml2YWwgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5lbWl0KEsuYS5JTklUX1NFR01FTlQsIGUsIHQpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fb25SZW11eGVyTWVkaWFTZWdtZW50QXJyaXZhbCA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICBpZiAobnVsbCA9PSB0aGlzLl9wZW5kaW5nU2Vla1RpbWUgJiYgKHRoaXMuX2VtaXR0ZXIuZW1pdChLLmEuTUVESUFfU0VHTUVOVCwgZSwgdCksCiAgICAgICAgICAgICAgbnVsbCAhPSB0aGlzLl9wZW5kaW5nUmVzb2x2ZVNlZWtQb2ludCAmJiAidmlkZW8iID09PSBlKSkgewogICAgICAgICAgICAgICAgICB2YXIgaSA9IHQuaW5mby5zeW5jUG9pbnRzCiAgICAgICAgICAgICAgICAgICAgLCBuID0gdGhpcy5fcGVuZGluZ1Jlc29sdmVTZWVrUG9pbnQ7CiAgICAgICAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdSZXNvbHZlU2Vla1BvaW50ID0gbnVsbCwKICAgICAgICAgICAgICAgICAgYS5hLnNhZmFyaSAmJiBpLmxlbmd0aCA+IDAgJiYgaVswXS5vcmlnaW5hbER0cyA9PT0gbiAmJiAobiA9IGlbMF0ucHRzKSwKICAgICAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5lbWl0KEsuYS5SRUNPTU1FTkRfU0VFS1BPSU5ULCBuKQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9lbmFibGVTdGF0aXN0aWNzUmVwb3J0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBudWxsID09IHRoaXMuX3N0YXRpc3RpY3NSZXBvcnRlciAmJiAodGhpcy5fc3RhdGlzdGljc1JlcG9ydGVyID0gc2VsZi5zZXRJbnRlcnZhbCh0aGlzLl9yZXBvcnRTdGF0aXN0aWNzSW5mby5iaW5kKHRoaXMpLCB0aGlzLl9jb25maWcuc3RhdGlzdGljc0luZm9SZXBvcnRJbnRlcnZhbCkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fZGlzYWJsZVN0YXRpc3RpY3NSZXBvcnRlciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX3N0YXRpc3RpY3NSZXBvcnRlciAmJiAoc2VsZi5jbGVhckludGVydmFsKHRoaXMuX3N0YXRpc3RpY3NSZXBvcnRlciksCiAgICAgICAgICAgICAgdGhpcy5fc3RhdGlzdGljc1JlcG9ydGVyID0gbnVsbCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9yZXBvcnRTZWdtZW50TWVkaWFJbmZvID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHZhciB0ID0gdGhpcy5fbWVkaWFJbmZvLnNlZ21lbnRzW2VdCiAgICAgICAgICAgICAgICAsIGkgPSBPYmplY3QuYXNzaWduKHt9LCB0KTsKICAgICAgICAgICAgICBpLmR1cmF0aW9uID0gdGhpcy5fbWVkaWFJbmZvLmR1cmF0aW9uLAogICAgICAgICAgICAgIGkuc2VnbWVudENvdW50ID0gdGhpcy5fbWVkaWFJbmZvLnNlZ21lbnRDb3VudCwKICAgICAgICAgICAgICBkZWxldGUgaS5zZWdtZW50cywKICAgICAgICAgICAgICBkZWxldGUgaS5rZXlmcmFtZXNJbmRleCwKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyLmVtaXQoSy5hLk1FRElBX0lORk8sIGkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fcmVwb3J0U3RhdGlzdGljc0luZm8gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB2YXIgZSA9IHt9OwogICAgICAgICAgICAgIGUudXJsID0gdGhpcy5faW9jdGwuY3VycmVudFVSTCwKICAgICAgICAgICAgICBlLmhhc1JlZGlyZWN0ID0gdGhpcy5faW9jdGwuaGFzUmVkaXJlY3QsCiAgICAgICAgICAgICAgZS5oYXNSZWRpcmVjdCAmJiAoZS5yZWRpcmVjdGVkVVJMID0gdGhpcy5faW9jdGwuY3VycmVudFJlZGlyZWN0ZWRVUkwpLAogICAgICAgICAgICAgIGUuc3BlZWQgPSB0aGlzLl9pb2N0bC5jdXJyZW50U3BlZWQsCiAgICAgICAgICAgICAgZS5sb2FkZXJUeXBlID0gdGhpcy5faW9jdGwubG9hZGVyVHlwZSwKICAgICAgICAgICAgICBlLmN1cnJlbnRTZWdtZW50SW5kZXggPSB0aGlzLl9jdXJyZW50U2VnbWVudEluZGV4LAogICAgICAgICAgICAgIGUudG90YWxTZWdtZW50Q291bnQgPSB0aGlzLl9tZWRpYURhdGFTb3VyY2Uuc2VnbWVudHMubGVuZ3RoLAogICAgICAgICAgICAgIHRoaXMuX2VtaXR0ZXIuZW1pdChLLmEuU1RBVElTVElDU19JTkZPLCBlKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZQogICAgICB9KCk7CiAgICAgIHQuYSA9IFcKICB9CiAgLCBmdW5jdGlvbihlLCB0LCBpKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG4sIHIgPSBpKDApLCBzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBmdW5jdGlvbiBlKCkgewogICAgICAgICAgICAgIHRoaXMuX2ZpcnN0Q2hlY2twb2ludCA9IDAsCiAgICAgICAgICAgICAgdGhpcy5fbGFzdENoZWNrcG9pbnQgPSAwLAogICAgICAgICAgICAgIHRoaXMuX2ludGVydmFsQnl0ZXMgPSAwLAogICAgICAgICAgICAgIHRoaXMuX3RvdGFsQnl0ZXMgPSAwLAogICAgICAgICAgICAgIHRoaXMuX2xhc3RTZWNvbmRCeXRlcyA9IDAsCiAgICAgICAgICAgICAgc2VsZi5wZXJmb3JtYW5jZSAmJiBzZWxmLnBlcmZvcm1hbmNlLm5vdyA/IHRoaXMuX25vdyA9IHNlbGYucGVyZm9ybWFuY2Uubm93LmJpbmQoc2VsZi5wZXJmb3JtYW5jZSkgOiB0aGlzLl9ub3cgPSBEYXRlLm5vdwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5fZmlyc3RDaGVja3BvaW50ID0gdGhpcy5fbGFzdENoZWNrcG9pbnQgPSAwLAogICAgICAgICAgICAgIHRoaXMuX3RvdGFsQnl0ZXMgPSB0aGlzLl9pbnRlcnZhbEJ5dGVzID0gMCwKICAgICAgICAgICAgICB0aGlzLl9sYXN0U2Vjb25kQnl0ZXMgPSAwCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5hZGRCeXRlcyA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAwID09PSB0aGlzLl9maXJzdENoZWNrcG9pbnQgPyAodGhpcy5fZmlyc3RDaGVja3BvaW50ID0gdGhpcy5fbm93KCksCiAgICAgICAgICAgICAgdGhpcy5fbGFzdENoZWNrcG9pbnQgPSB0aGlzLl9maXJzdENoZWNrcG9pbnQsCiAgICAgICAgICAgICAgdGhpcy5faW50ZXJ2YWxCeXRlcyArPSBlLAogICAgICAgICAgICAgIHRoaXMuX3RvdGFsQnl0ZXMgKz0gZSkgOiB0aGlzLl9ub3coKSAtIHRoaXMuX2xhc3RDaGVja3BvaW50IDwgMWUzID8gKHRoaXMuX2ludGVydmFsQnl0ZXMgKz0gZSwKICAgICAgICAgICAgICB0aGlzLl90b3RhbEJ5dGVzICs9IGUpIDogKHRoaXMuX2xhc3RTZWNvbmRCeXRlcyA9IHRoaXMuX2ludGVydmFsQnl0ZXMsCiAgICAgICAgICAgICAgdGhpcy5faW50ZXJ2YWxCeXRlcyA9IGUsCiAgICAgICAgICAgICAgdGhpcy5fdG90YWxCeXRlcyArPSBlLAogICAgICAgICAgICAgIHRoaXMuX2xhc3RDaGVja3BvaW50ID0gdGhpcy5fbm93KCkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJjdXJyZW50S0JwcyIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICB0aGlzLmFkZEJ5dGVzKDApOwogICAgICAgICAgICAgICAgICB2YXIgZSA9ICh0aGlzLl9ub3coKSAtIHRoaXMuX2xhc3RDaGVja3BvaW50KSAvIDFlMzsKICAgICAgICAgICAgICAgICAgcmV0dXJuIDAgPT0gZSAmJiAoZSA9IDEpLAogICAgICAgICAgICAgICAgICB0aGlzLl9pbnRlcnZhbEJ5dGVzIC8gZSAvIDEwMjQKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAibGFzdFNlY29uZEtCcHMiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkQnl0ZXMoMCksCiAgICAgICAgICAgICAgICAgIDAgIT09IHRoaXMuX2xhc3RTZWNvbmRCeXRlcyA/IHRoaXMuX2xhc3RTZWNvbmRCeXRlcyAvIDEwMjQgOiB0aGlzLl9ub3coKSAtIHRoaXMuX2xhc3RDaGVja3BvaW50ID49IDUwMCA/IHRoaXMuY3VycmVudEtCcHMgOiAwCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgImF2ZXJhZ2VLQnBzIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHZhciBlID0gKHRoaXMuX25vdygpIC0gdGhpcy5fZmlyc3RDaGVja3BvaW50KSAvIDFlMzsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RvdGFsQnl0ZXMgLyBlIC8gMTAyNAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBlCiAgICAgIH0oKSwgYSA9IGkoMiksIG8gPSBpKDQpLCBoID0gaSgzKSwgZCA9IChuID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgcmV0dXJuIChuID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IHsKICAgICAgICAgICAgICBfX3Byb3RvX186IFtdCiAgICAgICAgICB9aW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgZS5fX3Byb3RvX18gPSB0CiAgICAgICAgICB9CiAgICAgICAgICB8fCBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiB0KQogICAgICAgICAgICAgICAgICB0Lmhhc093blByb3BlcnR5KGkpICYmIChlW2ldID0gdFtpXSkKICAgICAgICAgIH0KICAgICAgICAgICkoZSwgdCkKICAgICAgfQogICAgICAsCiAgICAgIGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgIGZ1bmN0aW9uIGkoKSB7CiAgICAgICAgICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IGUKICAgICAgICAgIH0KICAgICAgICAgIG4oZSwgdCksCiAgICAgICAgICBlLnByb3RvdHlwZSA9IG51bGwgPT09IHQgPyBPYmplY3QuY3JlYXRlKHQpIDogKGkucHJvdG90eXBlID0gdC5wcm90b3R5cGUsCiAgICAgICAgICBuZXcgaSkKICAgICAgfQogICAgICApLCB1ID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgZnVuY3Rpb24gdCh0LCBpKSB7CiAgICAgICAgICAgICAgdmFyIG4gPSBlLmNhbGwodGhpcywgImZldGNoLXN0cmVhbS1sb2FkZXIiKSB8fCB0aGlzOwogICAgICAgICAgICAgIHJldHVybiBuLlRBRyA9ICJGZXRjaFN0cmVhbUxvYWRlciIsCiAgICAgICAgICAgICAgbi5fc2Vla0hhbmRsZXIgPSB0LAogICAgICAgICAgICAgIG4uX2NvbmZpZyA9IGksCiAgICAgICAgICAgICAgbi5fbmVlZFN0YXNoID0gITAsCiAgICAgICAgICAgICAgbi5fcmVxdWVzdEFib3J0ID0gITEsCiAgICAgICAgICAgICAgbi5fYWJvcnRDb250cm9sbGVyID0gbnVsbCwKICAgICAgICAgICAgICBuLl9jb250ZW50TGVuZ3RoID0gbnVsbCwKICAgICAgICAgICAgICBuLl9yZWNlaXZlZExlbmd0aCA9IDAsCiAgICAgICAgICAgICAgbgogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGQodCwgZSksCiAgICAgICAgICB0LmlzU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgdmFyIGUgPSBvLmEubXNlZGdlICYmIG8uYS52ZXJzaW9uLm1pbm9yID49IDE1MDQ4CiAgICAgICAgICAgICAgICAgICAgLCB0ID0gIW8uYS5tc2VkZ2UgfHwgZTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZmV0Y2ggJiYgc2VsZi5SZWFkYWJsZVN0cmVhbSAmJiB0CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5pc1dvcmtpbmcoKSAmJiB0aGlzLmFib3J0KCksCiAgICAgICAgICAgICAgZS5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgIHZhciBpID0gdGhpczsKICAgICAgICAgICAgICB0aGlzLl9kYXRhU291cmNlID0gZSwKICAgICAgICAgICAgICB0aGlzLl9yYW5nZSA9IHQ7CiAgICAgICAgICAgICAgdmFyIG4gPSBlLnVybDsKICAgICAgICAgICAgICB0aGlzLl9jb25maWcucmV1c2VSZWRpcmVjdGVkVVJMICYmIG51bGwgIT0gZS5yZWRpcmVjdGVkVVJMICYmIChuID0gZS5yZWRpcmVjdGVkVVJMKTsKICAgICAgICAgICAgICB2YXIgciA9IHRoaXMuX3NlZWtIYW5kbGVyLmdldENvbmZpZyhuLCB0KQogICAgICAgICAgICAgICAgLCBzID0gbmV3IHNlbGYuSGVhZGVyczsKICAgICAgICAgICAgICBpZiAoIm9iamVjdCIgPT0gdHlwZW9mIHIuaGVhZGVycykgewogICAgICAgICAgICAgICAgICB2YXIgbyA9IHIuaGVhZGVyczsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZCBpbiBvKQogICAgICAgICAgICAgICAgICAgICAgby5oYXNPd25Qcm9wZXJ0eShkKSAmJiBzLmFwcGVuZChkLCBvW2RdKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB2YXIgdSA9IHsKICAgICAgICAgICAgICAgICAgbWV0aG9kOiAiR0VUIiwKICAgICAgICAgICAgICAgICAgaGVhZGVyczogcywKICAgICAgICAgICAgICAgICAgbW9kZTogImNvcnMiLAogICAgICAgICAgICAgICAgICBjYWNoZTogImRlZmF1bHQiLAogICAgICAgICAgICAgICAgICByZWZlcnJlclBvbGljeTogIm5vLXJlZmVycmVyLXdoZW4tZG93bmdyYWRlIgogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgaWYgKCJvYmplY3QiID09IHR5cGVvZiB0aGlzLl9jb25maWcuaGVhZGVycykKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZCBpbiB0aGlzLl9jb25maWcuaGVhZGVycykKICAgICAgICAgICAgICAgICAgICAgIHMuYXBwZW5kKGQsIHRoaXMuX2NvbmZpZy5oZWFkZXJzW2RdKTsKICAgICAgICAgICAgICAhMSA9PT0gZS5jb3JzICYmICh1Lm1vZGUgPSAic2FtZS1vcmlnaW4iKSwKICAgICAgICAgICAgICBlLndpdGhDcmVkZW50aWFscyAmJiAodS5jcmVkZW50aWFscyA9ICJpbmNsdWRlIiksCiAgICAgICAgICAgICAgZS5yZWZlcnJlclBvbGljeSAmJiAodS5yZWZlcnJlclBvbGljeSA9IGUucmVmZXJyZXJQb2xpY3kpLAogICAgICAgICAgICAgIHNlbGYuQWJvcnRDb250cm9sbGVyICYmICh0aGlzLl9hYm9ydENvbnRyb2xsZXIgPSBuZXcgc2VsZi5BYm9ydENvbnRyb2xsZXIsCiAgICAgICAgICAgICAgdS5zaWduYWwgPSB0aGlzLl9hYm9ydENvbnRyb2xsZXIuc2lnbmFsKSwKICAgICAgICAgICAgICB0aGlzLl9zdGF0dXMgPSBhLmMua0Nvbm5lY3RpbmcsCiAgICAgICAgICAgICAgc2VsZi5mZXRjaChyLnVybCwgdSkudGhlbigoZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICBpZiAoaS5fcmVxdWVzdEFib3J0KQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkuX3N0YXR1cyA9IGEuYy5rSWRsZSwKICAgICAgICAgICAgICAgICAgICAgIHZvaWQgZS5ib2R5LmNhbmNlbCgpOwogICAgICAgICAgICAgICAgICBpZiAoZS5vayAmJiBlLnN0YXR1cyA+PSAyMDAgJiYgZS5zdGF0dXMgPD0gMjk5KSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoZS51cmwgIT09IHIudXJsICYmIGkuX29uVVJMUmVkaXJlY3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IGkuX3NlZWtIYW5kbGVyLnJlbW92ZVVSTFBhcmFtZXRlcnMoZS51cmwpOwogICAgICAgICAgICAgICAgICAgICAgICAgIGkuX29uVVJMUmVkaXJlY3QodCkKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gZS5oZWFkZXJzLmdldCgiQ29udGVudC1MZW5ndGgiKTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsICE9IG4gJiYgKGkuX2NvbnRlbnRMZW5ndGggPSBwYXJzZUludChuKSwKICAgICAgICAgICAgICAgICAgICAgIDAgIT09IGkuX2NvbnRlbnRMZW5ndGggJiYgaS5fb25Db250ZW50TGVuZ3RoS25vd24gJiYgaS5fb25Db250ZW50TGVuZ3RoS25vd24oaS5fY29udGVudExlbmd0aCkpLAogICAgICAgICAgICAgICAgICAgICAgaS5fcHVtcC5jYWxsKGksIGUuYm9keS5nZXRSZWFkZXIoKSkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoaS5fc3RhdHVzID0gYS5jLmtFcnJvciwKICAgICAgICAgICAgICAgICAgIWkuX29uRXJyb3IpCiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgaC5kKCJGZXRjaFN0cmVhbUxvYWRlcjogSHR0cCBjb2RlIGludmFsaWQsICIgKyBlLnN0YXR1cyArICIgIiArIGUuc3RhdHVzVGV4dCk7CiAgICAgICAgICAgICAgICAgIGkuX29uRXJyb3IoYS5iLkhUVFBfU1RBVFVTX0NPREVfSU5WQUxJRCwgewogICAgICAgICAgICAgICAgICAgICAgY29kZTogZS5zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgICBtc2c6IGUuc3RhdHVzVGV4dAogICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKS5jYXRjaCgoZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICBpZiAoIWkuX2Fib3J0Q29udHJvbGxlciB8fCAhaS5fYWJvcnRDb250cm9sbGVyLnNpZ25hbC5hYm9ydGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaS5fc3RhdHVzID0gYS5jLmtFcnJvciwKICAgICAgICAgICAgICAgICAgICAgICFpLl9vbkVycm9yKQogICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgICAgICAgICAgICBpLl9vbkVycm9yKGEuYi5FWENFUFRJT04sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgICBtc2c6IGUubWVzc2FnZQogICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgdC5wcm90b3R5cGUuYWJvcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5fcmVxdWVzdEFib3J0ID0gITAsCiAgICAgICAgICAgICAgKHRoaXMuX3N0YXR1cyAhPT0gYS5jLmtCdWZmZXJpbmcgfHwgIW8uYS5jaHJvbWUpICYmIHRoaXMuX2Fib3J0Q29udHJvbGxlcikKICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Fib3J0Q29udHJvbGxlci5hYm9ydCgpCiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5fcHVtcCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB2YXIgdCA9IHRoaXM7CiAgICAgICAgICAgICAgcmV0dXJuIGUucmVhZCgpLnRoZW4oKGZ1bmN0aW9uKGkpIHsKICAgICAgICAgICAgICAgICAgaWYgKGkuZG9uZSkKICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSB0Ll9jb250ZW50TGVuZ3RoICYmIHQuX3JlY2VpdmVkTGVuZ3RoIDwgdC5fY29udGVudExlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHQuX3N0YXR1cyA9IGEuYy5rRXJyb3I7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBhLmIuRUFSTFlfRU9GCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIHIgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IC0xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2c6ICJGZXRjaCBzdHJlYW0gbWVldCBFYXJseS1FT0YiCiAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXQuX29uRXJyb3IpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBoLmQoci5tc2cpOwogICAgICAgICAgICAgICAgICAgICAgICAgIHQuX29uRXJyb3IobiwgcikKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgIHQuX3N0YXR1cyA9IGEuYy5rQ29tcGxldGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdC5fb25Db21wbGV0ZSAmJiB0Ll9vbkNvbXBsZXRlKHQuX3JhbmdlLmZyb20sIHQuX3JhbmdlLmZyb20gKyB0Ll9yZWNlaXZlZExlbmd0aCAtIDEpOwogICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGlmICh0Ll9hYm9ydENvbnRyb2xsZXIgJiYgdC5fYWJvcnRDb250cm9sbGVyLnNpZ25hbC5hYm9ydGVkKQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkICh0Ll9zdGF0dXMgPSBhLmMua0NvbXBsZXRlKTsKICAgICAgICAgICAgICAgICAgICAgIGlmICghMCA9PT0gdC5fcmVxdWVzdEFib3J0KQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0Ll9zdGF0dXMgPSBhLmMua0NvbXBsZXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgIGUuY2FuY2VsKCk7CiAgICAgICAgICAgICAgICAgICAgICB0Ll9zdGF0dXMgPSBhLmMua0J1ZmZlcmluZzsKICAgICAgICAgICAgICAgICAgICAgIHZhciBzID0gaS52YWx1ZS5idWZmZXIKICAgICAgICAgICAgICAgICAgICAgICAgLCBvID0gdC5fcmFuZ2UuZnJvbSArIHQuX3JlY2VpdmVkTGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgdC5fcmVjZWl2ZWRMZW5ndGggKz0gcy5ieXRlTGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgdC5fb25EYXRhQXJyaXZhbCAmJiB0Ll9vbkRhdGFBcnJpdmFsKHMsIG8sIHQuX3JlY2VpdmVkTGVuZ3RoKSwKICAgICAgICAgICAgICAgICAgICAgIHQuX3B1bXAoZSkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKS5jYXRjaCgoZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICBpZiAodC5fYWJvcnRDb250cm9sbGVyICYmIHQuX2Fib3J0Q29udHJvbGxlci5zaWduYWwuYWJvcnRlZCkKICAgICAgICAgICAgICAgICAgICAgIHQuX3N0YXR1cyA9IGEuYy5rQ29tcGxldGU7CiAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKDExICE9PSBlLmNvZGUgfHwgIW8uYS5tc2VkZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgIHQuX3N0YXR1cyA9IGEuYy5rRXJyb3I7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgLCBuID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgIGlmICgxOSAhPT0gZS5jb2RlICYmICJuZXR3b3JrIGVycm9yIiAhPT0gZS5tZXNzYWdlIHx8ICEobnVsbCA9PT0gdC5fY29udGVudExlbmd0aCB8fCBudWxsICE9PSB0Ll9jb250ZW50TGVuZ3RoICYmIHQuX3JlY2VpdmVkTGVuZ3RoIDwgdC5fY29udGVudExlbmd0aCkgPyAoaSA9IGEuYi5FWENFUFRJT04sCiAgICAgICAgICAgICAgICAgICAgICBuID0gewogICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGUuY29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICBtc2c6IGUubWVzc2FnZQogICAgICAgICAgICAgICAgICAgICAgfSkgOiAoaSA9IGEuYi5FQVJMWV9FT0YsCiAgICAgICAgICAgICAgICAgICAgICBuID0gewogICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGUuY29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICBtc2c6ICJGZXRjaCBzdHJlYW0gbWVldCBFYXJseS1FT0YiCiAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICF0Ll9vbkVycm9yKQogICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBoLmQobi5tc2cpOwogICAgICAgICAgICAgICAgICAgICAgdC5fb25FcnJvcihpLCBuKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0CiAgICAgIH0oYS5hKSwgXyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGUgPSBmdW5jdGlvbih0LCBpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIChlID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IHsKICAgICAgICAgICAgICAgICAgX19wcm90b19fOiBbXQogICAgICAgICAgICAgIH1pbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICAgICAgZS5fX3Byb3RvX18gPSB0CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHx8IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiB0KQogICAgICAgICAgICAgICAgICAgICAgdC5oYXNPd25Qcm9wZXJ0eShpKSAmJiAoZVtpXSA9IHRbaV0pCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkodCwgaSkKICAgICAgICAgIH07CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odCwgaSkgewogICAgICAgICAgICAgIGZ1bmN0aW9uIG4oKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuY29uc3RydWN0b3IgPSB0CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGUodCwgaSksCiAgICAgICAgICAgICAgdC5wcm90b3R5cGUgPSBudWxsID09PSBpID8gT2JqZWN0LmNyZWF0ZShpKSA6IChuLnByb3RvdHlwZSA9IGkucHJvdG90eXBlLAogICAgICAgICAgICAgIG5ldyBuKQogICAgICAgICAgfQogICAgICB9KCksIGMgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICBmdW5jdGlvbiB0KHQsIGkpIHsKICAgICAgICAgICAgICB2YXIgbiA9IGUuY2FsbCh0aGlzLCAieGhyLW1vei1jaHVua2VkLWxvYWRlciIpIHx8IHRoaXM7CiAgICAgICAgICAgICAgcmV0dXJuIG4uVEFHID0gIk1vekNodW5rZWRMb2FkZXIiLAogICAgICAgICAgICAgIG4uX3NlZWtIYW5kbGVyID0gdCwKICAgICAgICAgICAgICBuLl9jb25maWcgPSBpLAogICAgICAgICAgICAgIG4uX25lZWRTdGFzaCA9ICEwLAogICAgICAgICAgICAgIG4uX3hociA9IG51bGwsCiAgICAgICAgICAgICAgbi5fcmVxdWVzdEFib3J0ID0gITEsCiAgICAgICAgICAgICAgbi5fY29udGVudExlbmd0aCA9IG51bGwsCiAgICAgICAgICAgICAgbi5fcmVjZWl2ZWRMZW5ndGggPSAwLAogICAgICAgICAgICAgIG4KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBfKHQsIGUpLAogICAgICAgICAgdC5pc1N1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIHZhciBlID0gbmV3IFhNTEh0dHBSZXF1ZXN0OwogICAgICAgICAgICAgICAgICByZXR1cm4gZS5vcGVuKCJHRVQiLCAiaHR0cHM6Ly9leGFtcGxlLmNvbSIsICEwKSwKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZVR5cGUgPSAibW96LWNodW5rZWQtYXJyYXlidWZmZXIiLAogICAgICAgICAgICAgICAgICAibW96LWNodW5rZWQtYXJyYXlidWZmZXIiID09PSBlLnJlc3BvbnNlVHlwZQogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHIuYS53KCJNb3pDaHVua2VkTG9hZGVyIiwgZS5tZXNzYWdlKSwKICAgICAgICAgICAgICAgICAgITEKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5pc1dvcmtpbmcoKSAmJiB0aGlzLmFib3J0KCksCiAgICAgICAgICAgICAgdGhpcy5feGhyICYmICh0aGlzLl94aHIub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl94aHIub25wcm9ncmVzcyA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5feGhyLm9ubG9hZGVuZCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5feGhyLm9uZXJyb3IgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX3hociA9IG51bGwpLAogICAgICAgICAgICAgIGUucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgdC5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICB0aGlzLl9kYXRhU291cmNlID0gZSwKICAgICAgICAgICAgICB0aGlzLl9yYW5nZSA9IHQ7CiAgICAgICAgICAgICAgdmFyIGkgPSBlLnVybDsKICAgICAgICAgICAgICB0aGlzLl9jb25maWcucmV1c2VSZWRpcmVjdGVkVVJMICYmIG51bGwgIT0gZS5yZWRpcmVjdGVkVVJMICYmIChpID0gZS5yZWRpcmVjdGVkVVJMKTsKICAgICAgICAgICAgICB2YXIgbiA9IHRoaXMuX3NlZWtIYW5kbGVyLmdldENvbmZpZyhpLCB0KTsKICAgICAgICAgICAgICB0aGlzLl9yZXF1ZXN0VVJMID0gbi51cmw7CiAgICAgICAgICAgICAgdmFyIHIgPSB0aGlzLl94aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3Q7CiAgICAgICAgICAgICAgaWYgKHIub3BlbigiR0VUIiwgbi51cmwsICEwKSwKICAgICAgICAgICAgICByLnJlc3BvbnNlVHlwZSA9ICJtb3otY2h1bmtlZC1hcnJheWJ1ZmZlciIsCiAgICAgICAgICAgICAgci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSB0aGlzLl9vblJlYWR5U3RhdGVDaGFuZ2UuYmluZCh0aGlzKSwKICAgICAgICAgICAgICByLm9ucHJvZ3Jlc3MgPSB0aGlzLl9vblByb2dyZXNzLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgci5vbmxvYWRlbmQgPSB0aGlzLl9vbkxvYWRFbmQuYmluZCh0aGlzKSwKICAgICAgICAgICAgICByLm9uZXJyb3IgPSB0aGlzLl9vblhockVycm9yLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgZS53aXRoQ3JlZGVudGlhbHMgJiYgKHIud2l0aENyZWRlbnRpYWxzID0gITApLAogICAgICAgICAgICAgICJvYmplY3QiID09IHR5cGVvZiBuLmhlYWRlcnMpIHsKICAgICAgICAgICAgICAgICAgdmFyIHMgPSBuLmhlYWRlcnM7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIG8gaW4gcykKICAgICAgICAgICAgICAgICAgICAgIHMuaGFzT3duUHJvcGVydHkobykgJiYgci5zZXRSZXF1ZXN0SGVhZGVyKG8sIHNbb10pCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICgib2JqZWN0IiA9PSB0eXBlb2YgdGhpcy5fY29uZmlnLmhlYWRlcnMpIHsKICAgICAgICAgICAgICAgICAgcyA9IHRoaXMuX2NvbmZpZy5oZWFkZXJzOwogICAgICAgICAgICAgICAgICBmb3IgKHZhciBvIGluIHMpCiAgICAgICAgICAgICAgICAgICAgICBzLmhhc093blByb3BlcnR5KG8pICYmIHIuc2V0UmVxdWVzdEhlYWRlcihvLCBzW29dKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLl9zdGF0dXMgPSBhLmMua0Nvbm5lY3RpbmcsCiAgICAgICAgICAgICAgci5zZW5kKCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLmFib3J0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5fcmVxdWVzdEFib3J0ID0gITAsCiAgICAgICAgICAgICAgdGhpcy5feGhyICYmIHRoaXMuX3hoci5hYm9ydCgpLAogICAgICAgICAgICAgIHRoaXMuX3N0YXR1cyA9IGEuYy5rQ29tcGxldGUKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLl9vblJlYWR5U3RhdGVDaGFuZ2UgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSBlLnRhcmdldDsKICAgICAgICAgICAgICBpZiAoMiA9PT0gdC5yZWFkeVN0YXRlKSB7CiAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9IHQucmVzcG9uc2VVUkwgJiYgdC5yZXNwb25zZVVSTCAhPT0gdGhpcy5fcmVxdWVzdFVSTCAmJiB0aGlzLl9vblVSTFJlZGlyZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMuX3NlZWtIYW5kbGVyLnJlbW92ZVVSTFBhcmFtZXRlcnModC5yZXNwb25zZVVSTCk7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vblVSTFJlZGlyZWN0KGkpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKDAgIT09IHQuc3RhdHVzICYmICh0LnN0YXR1cyA8IDIwMCB8fCB0LnN0YXR1cyA+IDI5OSkpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zdGF0dXMgPSBhLmMua0Vycm9yLAogICAgICAgICAgICAgICAgICAgICAgIXRoaXMuX29uRXJyb3IpCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGguZCgiTW96Q2h1bmtlZExvYWRlcjogSHR0cCBjb2RlIGludmFsaWQsICIgKyB0LnN0YXR1cyArICIgIiArIHQuc3RhdHVzVGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbkVycm9yKGEuYi5IVFRQX1NUQVRVU19DT0RFX0lOVkFMSUQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiB0LnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgICBtc2c6IHQuc3RhdHVzVGV4dAogICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGF0dXMgPSBhLmMua0J1ZmZlcmluZwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLl9vblByb2dyZXNzID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGlmICh0aGlzLl9zdGF0dXMgIT09IGEuYy5rRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgbnVsbCA9PT0gdGhpcy5fY29udGVudExlbmd0aCAmJiBudWxsICE9PSBlLnRvdGFsICYmIDAgIT09IGUudG90YWwgJiYgKHRoaXMuX2NvbnRlbnRMZW5ndGggPSBlLnRvdGFsLAogICAgICAgICAgICAgICAgICB0aGlzLl9vbkNvbnRlbnRMZW5ndGhLbm93biAmJiB0aGlzLl9vbkNvbnRlbnRMZW5ndGhLbm93bih0aGlzLl9jb250ZW50TGVuZ3RoKSk7CiAgICAgICAgICAgICAgICAgIHZhciB0ID0gZS50YXJnZXQucmVzcG9uc2UKICAgICAgICAgICAgICAgICAgICAsIGkgPSB0aGlzLl9yYW5nZS5mcm9tICsgdGhpcy5fcmVjZWl2ZWRMZW5ndGg7CiAgICAgICAgICAgICAgICAgIHRoaXMuX3JlY2VpdmVkTGVuZ3RoICs9IHQuYnl0ZUxlbmd0aCwKICAgICAgICAgICAgICAgICAgdGhpcy5fb25EYXRhQXJyaXZhbCAmJiB0aGlzLl9vbkRhdGFBcnJpdmFsKHQsIGksIHRoaXMuX3JlY2VpdmVkTGVuZ3RoKQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLl9vbkxvYWRFbmQgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgITAgIT09IHRoaXMuX3JlcXVlc3RBYm9ydCA/IHRoaXMuX3N0YXR1cyAhPT0gYS5jLmtFcnJvciAmJiAodGhpcy5fc3RhdHVzID0gYS5jLmtDb21wbGV0ZSwKICAgICAgICAgICAgICB0aGlzLl9vbkNvbXBsZXRlICYmIHRoaXMuX29uQ29tcGxldGUodGhpcy5fcmFuZ2UuZnJvbSwgdGhpcy5fcmFuZ2UuZnJvbSArIHRoaXMuX3JlY2VpdmVkTGVuZ3RoIC0gMSkpIDogdGhpcy5fcmVxdWVzdEFib3J0ID0gITEKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLl9vblhockVycm9yID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHRoaXMuX3N0YXR1cyA9IGEuYy5rRXJyb3I7CiAgICAgICAgICAgICAgdmFyIHQgPSAwCiAgICAgICAgICAgICAgICAsIGkgPSBudWxsOwogICAgICAgICAgICAgIGlmICh0aGlzLl9jb250ZW50TGVuZ3RoICYmIGUubG9hZGVkIDwgdGhpcy5fY29udGVudExlbmd0aCA/ICh0ID0gYS5iLkVBUkxZX0VPRiwKICAgICAgICAgICAgICBpID0gewogICAgICAgICAgICAgICAgICBjb2RlOiAtMSwKICAgICAgICAgICAgICAgICAgbXNnOiAiTW96LUNodW5rZWQgc3RyZWFtIG1lZXQgRWFybHktRW9mIgogICAgICAgICAgICAgIH0pIDogKHQgPSBhLmIuRVhDRVBUSU9OLAogICAgICAgICAgICAgIGkgPSB7CiAgICAgICAgICAgICAgICAgIGNvZGU6IC0xLAogICAgICAgICAgICAgICAgICBtc2c6IGUuY29uc3RydWN0b3IubmFtZSArICIgIiArIGUudHlwZQogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICF0aGlzLl9vbkVycm9yKQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgaC5kKGkubXNnKTsKICAgICAgICAgICAgICB0aGlzLl9vbkVycm9yKHQsIGkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0CiAgICAgIH0oYS5hKSwgbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGUgPSBmdW5jdGlvbih0LCBpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIChlID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IHsKICAgICAgICAgICAgICAgICAgX19wcm90b19fOiBbXQogICAgICAgICAgICAgIH1pbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICAgICAgZS5fX3Byb3RvX18gPSB0CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHx8IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiB0KQogICAgICAgICAgICAgICAgICAgICAgdC5oYXNPd25Qcm9wZXJ0eShpKSAmJiAoZVtpXSA9IHRbaV0pCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkodCwgaSkKICAgICAgICAgIH07CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odCwgaSkgewogICAgICAgICAgICAgIGZ1bmN0aW9uIG4oKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuY29uc3RydWN0b3IgPSB0CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGUodCwgaSksCiAgICAgICAgICAgICAgdC5wcm90b3R5cGUgPSBudWxsID09PSBpID8gT2JqZWN0LmNyZWF0ZShpKSA6IChuLnByb3RvdHlwZSA9IGkucHJvdG90eXBlLAogICAgICAgICAgICAgIG5ldyBuKQogICAgICAgICAgfQogICAgICB9KCksIGYgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICBmdW5jdGlvbiB0KHQsIGkpIHsKICAgICAgICAgICAgICB2YXIgbiA9IGUuY2FsbCh0aGlzLCAieGhyLXJhbmdlLWxvYWRlciIpIHx8IHRoaXM7CiAgICAgICAgICAgICAgcmV0dXJuIG4uVEFHID0gIlJhbmdlTG9hZGVyIiwKICAgICAgICAgICAgICBuLl9zZWVrSGFuZGxlciA9IHQsCiAgICAgICAgICAgICAgbi5fY29uZmlnID0gaSwKICAgICAgICAgICAgICBuLl9uZWVkU3Rhc2ggPSAhMSwKICAgICAgICAgICAgICBuLl9jaHVua1NpemVLQkxpc3QgPSBbMTI4LCAyNTYsIDM4NCwgNTEyLCA3NjgsIDEwMjQsIDE1MzYsIDIwNDgsIDMwNzIsIDQwOTYsIDUxMjAsIDYxNDQsIDcxNjgsIDgxOTJdLAogICAgICAgICAgICAgIG4uX2N1cnJlbnRDaHVua1NpemVLQiA9IDM4NCwKICAgICAgICAgICAgICBuLl9jdXJyZW50U3BlZWROb3JtYWxpemVkID0gMCwKICAgICAgICAgICAgICBuLl96ZXJvU3BlZWRDaHVua0NvdW50ID0gMCwKICAgICAgICAgICAgICBuLl94aHIgPSBudWxsLAogICAgICAgICAgICAgIG4uX3NwZWVkU2FtcGxlciA9IG5ldyBzLAogICAgICAgICAgICAgIG4uX3JlcXVlc3RBYm9ydCA9ICExLAogICAgICAgICAgICAgIG4uX3dhaXRGb3JUb3RhbExlbmd0aCA9ICExLAogICAgICAgICAgICAgIG4uX3RvdGFsTGVuZ3RoUmVjZWl2ZWQgPSAhMSwKICAgICAgICAgICAgICBuLl9jdXJyZW50UmVxdWVzdFVSTCA9IG51bGwsCiAgICAgICAgICAgICAgbi5fY3VycmVudFJlZGlyZWN0ZWRVUkwgPSBudWxsLAogICAgICAgICAgICAgIG4uX2N1cnJlbnRSZXF1ZXN0UmFuZ2UgPSBudWxsLAogICAgICAgICAgICAgIG4uX3RvdGFsTGVuZ3RoID0gbnVsbCwKICAgICAgICAgICAgICBuLl9jb250ZW50TGVuZ3RoID0gbnVsbCwKICAgICAgICAgICAgICBuLl9yZWNlaXZlZExlbmd0aCA9IDAsCiAgICAgICAgICAgICAgbi5fbGFzdFRpbWVMb2FkZWQgPSAwLAogICAgICAgICAgICAgIG4KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBsKHQsIGUpLAogICAgICAgICAgdC5pc1N1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIHZhciBlID0gbmV3IFhNTEh0dHBSZXF1ZXN0OwogICAgICAgICAgICAgICAgICByZXR1cm4gZS5vcGVuKCJHRVQiLCAiaHR0cHM6Ly9leGFtcGxlLmNvbSIsICEwKSwKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZVR5cGUgPSAiYXJyYXlidWZmZXIiLAogICAgICAgICAgICAgICAgICAiYXJyYXlidWZmZXIiID09PSBlLnJlc3BvbnNlVHlwZQogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHIuYS53KCJSYW5nZUxvYWRlciIsIGUubWVzc2FnZSksCiAgICAgICAgICAgICAgICAgICExCiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgdC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuaXNXb3JraW5nKCkgJiYgdGhpcy5hYm9ydCgpLAogICAgICAgICAgICAgIHRoaXMuX3hociAmJiAodGhpcy5feGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5feGhyLm9ucHJvZ3Jlc3MgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX3hoci5vbmxvYWQgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX3hoci5vbmVycm9yID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl94aHIgPSBudWxsKSwKICAgICAgICAgICAgICBlLnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcykKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LnByb3RvdHlwZSwgImN1cnJlbnRTcGVlZCIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc3BlZWRTYW1wbGVyLmxhc3RTZWNvbmRLQnBzCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIHQucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgdGhpcy5fZGF0YVNvdXJjZSA9IGUsCiAgICAgICAgICAgICAgdGhpcy5fcmFuZ2UgPSB0LAogICAgICAgICAgICAgIHRoaXMuX3N0YXR1cyA9IGEuYy5rQ29ubmVjdGluZzsKICAgICAgICAgICAgICB2YXIgaSA9ICExOwogICAgICAgICAgICAgIG51bGwgIT0gdGhpcy5fZGF0YVNvdXJjZS5maWxlc2l6ZSAmJiAwICE9PSB0aGlzLl9kYXRhU291cmNlLmZpbGVzaXplICYmIChpID0gITAsCiAgICAgICAgICAgICAgdGhpcy5fdG90YWxMZW5ndGggPSB0aGlzLl9kYXRhU291cmNlLmZpbGVzaXplKSwKICAgICAgICAgICAgICB0aGlzLl90b3RhbExlbmd0aFJlY2VpdmVkIHx8IGkgPyB0aGlzLl9vcGVuU3ViUmFuZ2UoKSA6ICh0aGlzLl93YWl0Rm9yVG90YWxMZW5ndGggPSAhMCwKICAgICAgICAgICAgICB0aGlzLl9pbnRlcm5hbE9wZW4odGhpcy5fZGF0YVNvdXJjZSwgewogICAgICAgICAgICAgICAgICBmcm9tOiAwLAogICAgICAgICAgICAgICAgICB0bzogLTEKICAgICAgICAgICAgICB9KSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLl9vcGVuU3ViUmFuZ2UgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB2YXIgZSA9IDEwMjQgKiB0aGlzLl9jdXJyZW50Q2h1bmtTaXplS0IKICAgICAgICAgICAgICAgICwgdCA9IHRoaXMuX3JhbmdlLmZyb20gKyB0aGlzLl9yZWNlaXZlZExlbmd0aAogICAgICAgICAgICAgICAgLCBpID0gdCArIGU7CiAgICAgICAgICAgICAgbnVsbCAhPSB0aGlzLl9jb250ZW50TGVuZ3RoICYmIGkgLSB0aGlzLl9yYW5nZS5mcm9tID49IHRoaXMuX2NvbnRlbnRMZW5ndGggJiYgKGkgPSB0aGlzLl9yYW5nZS5mcm9tICsgdGhpcy5fY29udGVudExlbmd0aCAtIDEpLAogICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRSZXF1ZXN0UmFuZ2UgPSB7CiAgICAgICAgICAgICAgICAgIGZyb206IHQsCiAgICAgICAgICAgICAgICAgIHRvOiBpCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB0aGlzLl9pbnRlcm5hbE9wZW4odGhpcy5fZGF0YVNvdXJjZSwgdGhpcy5fY3VycmVudFJlcXVlc3RSYW5nZSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLl9pbnRlcm5hbE9wZW4gPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgdGhpcy5fbGFzdFRpbWVMb2FkZWQgPSAwOwogICAgICAgICAgICAgIHZhciBpID0gZS51cmw7CiAgICAgICAgICAgICAgdGhpcy5fY29uZmlnLnJldXNlUmVkaXJlY3RlZFVSTCAmJiAobnVsbCAhPSB0aGlzLl9jdXJyZW50UmVkaXJlY3RlZFVSTCA/IGkgPSB0aGlzLl9jdXJyZW50UmVkaXJlY3RlZFVSTCA6IG51bGwgIT0gZS5yZWRpcmVjdGVkVVJMICYmIChpID0gZS5yZWRpcmVjdGVkVVJMKSk7CiAgICAgICAgICAgICAgdmFyIG4gPSB0aGlzLl9zZWVrSGFuZGxlci5nZXRDb25maWcoaSwgdCk7CiAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFJlcXVlc3RVUkwgPSBuLnVybDsKICAgICAgICAgICAgICB2YXIgciA9IHRoaXMuX3hociA9IG5ldyBYTUxIdHRwUmVxdWVzdDsKICAgICAgICAgICAgICBpZiAoci5vcGVuKCJHRVQiLCBuLnVybCwgITApLAogICAgICAgICAgICAgIHIucmVzcG9uc2VUeXBlID0gImFycmF5YnVmZmVyIiwKICAgICAgICAgICAgICByLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IHRoaXMuX29uUmVhZHlTdGF0ZUNoYW5nZS5iaW5kKHRoaXMpLAogICAgICAgICAgICAgIHIub25wcm9ncmVzcyA9IHRoaXMuX29uUHJvZ3Jlc3MuYmluZCh0aGlzKSwKICAgICAgICAgICAgICByLm9ubG9hZCA9IHRoaXMuX29uTG9hZC5iaW5kKHRoaXMpLAogICAgICAgICAgICAgIHIub25lcnJvciA9IHRoaXMuX29uWGhyRXJyb3IuYmluZCh0aGlzKSwKICAgICAgICAgICAgICBlLndpdGhDcmVkZW50aWFscyAmJiAoci53aXRoQ3JlZGVudGlhbHMgPSAhMCksCiAgICAgICAgICAgICAgIm9iamVjdCIgPT0gdHlwZW9mIG4uaGVhZGVycykgewogICAgICAgICAgICAgICAgICB2YXIgcyA9IG4uaGVhZGVyczsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYSBpbiBzKQogICAgICAgICAgICAgICAgICAgICAgcy5oYXNPd25Qcm9wZXJ0eShhKSAmJiByLnNldFJlcXVlc3RIZWFkZXIoYSwgc1thXSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKCJvYmplY3QiID09IHR5cGVvZiB0aGlzLl9jb25maWcuaGVhZGVycykgewogICAgICAgICAgICAgICAgICBzID0gdGhpcy5fY29uZmlnLmhlYWRlcnM7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGEgaW4gcykKICAgICAgICAgICAgICAgICAgICAgIHMuaGFzT3duUHJvcGVydHkoYSkgJiYgci5zZXRSZXF1ZXN0SGVhZGVyKGEsIHNbYV0pCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHIuc2VuZCgpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5hYm9ydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RBYm9ydCA9ICEwLAogICAgICAgICAgICAgIHRoaXMuX2ludGVybmFsQWJvcnQoKSwKICAgICAgICAgICAgICB0aGlzLl9zdGF0dXMgPSBhLmMua0NvbXBsZXRlCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5faW50ZXJuYWxBYm9ydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX3hociAmJiAodGhpcy5feGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5feGhyLm9ucHJvZ3Jlc3MgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX3hoci5vbmxvYWQgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX3hoci5vbmVycm9yID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl94aHIuYWJvcnQoKSwKICAgICAgICAgICAgICB0aGlzLl94aHIgPSBudWxsKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgdC5wcm90b3R5cGUuX29uUmVhZHlTdGF0ZUNoYW5nZSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB2YXIgdCA9IGUudGFyZ2V0OwogICAgICAgICAgICAgIGlmICgyID09PSB0LnJlYWR5U3RhdGUpIHsKICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gdC5yZXNwb25zZVVSTCkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzLl9zZWVrSGFuZGxlci5yZW1vdmVVUkxQYXJhbWV0ZXJzKHQucmVzcG9uc2VVUkwpOwogICAgICAgICAgICAgICAgICAgICAgdC5yZXNwb25zZVVSTCAhPT0gdGhpcy5fY3VycmVudFJlcXVlc3RVUkwgJiYgaSAhPT0gdGhpcy5fY3VycmVudFJlZGlyZWN0ZWRVUkwgJiYgKHRoaXMuX2N1cnJlbnRSZWRpcmVjdGVkVVJMID0gaSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29uVVJMUmVkaXJlY3QgJiYgdGhpcy5fb25VUkxSZWRpcmVjdChpKSkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAodC5zdGF0dXMgPj0gMjAwICYmIHQuc3RhdHVzIDw9IDI5OSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3dhaXRGb3JUb3RhbExlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGF0dXMgPSBhLmMua0J1ZmZlcmluZwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXR1cyA9IGEuYy5rRXJyb3IsCiAgICAgICAgICAgICAgICAgICAgICAhdGhpcy5fb25FcnJvcikKICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgaC5kKCJSYW5nZUxvYWRlcjogSHR0cCBjb2RlIGludmFsaWQsICIgKyB0LnN0YXR1cyArICIgIiArIHQuc3RhdHVzVGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbkVycm9yKGEuYi5IVFRQX1NUQVRVU19DT0RFX0lOVkFMSUQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiB0LnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgICBtc2c6IHQuc3RhdHVzVGV4dAogICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLl9vblByb2dyZXNzID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGlmICh0aGlzLl9zdGF0dXMgIT09IGEuYy5rRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgaWYgKG51bGwgPT09IHRoaXMuX2NvbnRlbnRMZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciB0ID0gITE7CiAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fd2FpdEZvclRvdGFsTGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fd2FpdEZvclRvdGFsTGVuZ3RoID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdG90YWxMZW5ndGhSZWNlaXZlZCA9ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgIHQgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IGUudG90YWw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faW50ZXJuYWxBYm9ydCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgIT0gaSAmIDAgIT09IGkgJiYgKHRoaXMuX3RvdGFsTGVuZ3RoID0gaSkKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGlmICgtMSA9PT0gdGhpcy5fcmFuZ2UudG8gPyB0aGlzLl9jb250ZW50TGVuZ3RoID0gdGhpcy5fdG90YWxMZW5ndGggLSB0aGlzLl9yYW5nZS5mcm9tIDogdGhpcy5fY29udGVudExlbmd0aCA9IHRoaXMuX3JhbmdlLnRvIC0gdGhpcy5fcmFuZ2UuZnJvbSArIDEsCiAgICAgICAgICAgICAgICAgICAgICB0KQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHRoaXMuX29wZW5TdWJSYW5nZSgpOwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fb25Db250ZW50TGVuZ3RoS25vd24gJiYgdGhpcy5fb25Db250ZW50TGVuZ3RoS25vd24odGhpcy5fY29udGVudExlbmd0aCkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB2YXIgbiA9IGUubG9hZGVkIC0gdGhpcy5fbGFzdFRpbWVMb2FkZWQ7CiAgICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RUaW1lTG9hZGVkID0gZS5sb2FkZWQsCiAgICAgICAgICAgICAgICAgIHRoaXMuX3NwZWVkU2FtcGxlci5hZGRCeXRlcyhuKQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLl9ub3JtYWxpemVTcGVlZCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB2YXIgdCA9IHRoaXMuX2NodW5rU2l6ZUtCTGlzdAogICAgICAgICAgICAgICAgLCBpID0gdC5sZW5ndGggLSAxCiAgICAgICAgICAgICAgICAsIG4gPSAwCiAgICAgICAgICAgICAgICAsIHIgPSAwCiAgICAgICAgICAgICAgICAsIHMgPSBpOwogICAgICAgICAgICAgIGlmIChlIDwgdFswXSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRbMF07CiAgICAgICAgICAgICAgZm9yICg7IHIgPD0gczsgKSB7CiAgICAgICAgICAgICAgICAgIGlmICgobiA9IHIgKyBNYXRoLmZsb29yKChzIC0gcikgLyAyKSkgPT09IGkgfHwgZSA+PSB0W25dICYmIGUgPCB0W24gKyAxXSkKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0W25dOwogICAgICAgICAgICAgICAgICB0W25dIDwgZSA/IHIgPSBuICsgMSA6IHMgPSBuIC0gMQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLl9vbkxvYWQgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXR1cyAhPT0gYS5jLmtFcnJvcikKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3dhaXRGb3JUb3RhbExlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3dhaXRGb3JUb3RhbExlbmd0aCA9ICExOwogICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RUaW1lTG9hZGVkID0gMDsKICAgICAgICAgICAgICAgICAgICAgIHZhciB0ID0gdGhpcy5fc3BlZWRTYW1wbGVyLmxhc3RTZWNvbmRLQnBzOwogICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPT09IHQgJiYgKHRoaXMuX3plcm9TcGVlZENodW5rQ291bnQrKywKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3plcm9TcGVlZENodW5rQ291bnQgPj0gMyAmJiAodCA9IHRoaXMuX3NwZWVkU2FtcGxlci5jdXJyZW50S0JwcykpLAogICAgICAgICAgICAgICAgICAgICAgMCAhPT0gdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gdGhpcy5fbm9ybWFsaXplU3BlZWQodCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFNwZWVkTm9ybWFsaXplZCAhPT0gaSAmJiAodGhpcy5fY3VycmVudFNwZWVkTm9ybWFsaXplZCA9IGksCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudENodW5rU2l6ZUtCID0gaSkKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gZS50YXJnZXQucmVzcG9uc2UKICAgICAgICAgICAgICAgICAgICAgICAgLCByID0gdGhpcy5fcmFuZ2UuZnJvbSArIHRoaXMuX3JlY2VpdmVkTGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVjZWl2ZWRMZW5ndGggKz0gbi5ieXRlTGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgIG51bGwgIT0gdGhpcy5fY29udGVudExlbmd0aCAmJiB0aGlzLl9yZWNlaXZlZExlbmd0aCA8IHRoaXMuX2NvbnRlbnRMZW5ndGggPyB0aGlzLl9vcGVuU3ViUmFuZ2UoKSA6IHMgPSAhMCwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29uRGF0YUFycml2YWwgJiYgdGhpcy5fb25EYXRhQXJyaXZhbChuLCByLCB0aGlzLl9yZWNlaXZlZExlbmd0aCksCiAgICAgICAgICAgICAgICAgICAgICBzICYmICh0aGlzLl9zdGF0dXMgPSBhLmMua0NvbXBsZXRlLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fb25Db21wbGV0ZSAmJiB0aGlzLl9vbkNvbXBsZXRlKHRoaXMuX3JhbmdlLmZyb20sIHRoaXMuX3JhbmdlLmZyb20gKyB0aGlzLl9yZWNlaXZlZExlbmd0aCAtIDEpKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5fb25YaHJFcnJvciA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB0aGlzLl9zdGF0dXMgPSBhLmMua0Vycm9yOwogICAgICAgICAgICAgIHZhciB0ID0gMAogICAgICAgICAgICAgICAgLCBpID0gbnVsbDsKICAgICAgICAgICAgICBpZiAodGhpcy5fY29udGVudExlbmd0aCAmJiB0aGlzLl9yZWNlaXZlZExlbmd0aCA+IDAgJiYgdGhpcy5fcmVjZWl2ZWRMZW5ndGggPCB0aGlzLl9jb250ZW50TGVuZ3RoID8gKHQgPSBhLmIuRUFSTFlfRU9GLAogICAgICAgICAgICAgIGkgPSB7CiAgICAgICAgICAgICAgICAgIGNvZGU6IC0xLAogICAgICAgICAgICAgICAgICBtc2c6ICJSYW5nZUxvYWRlciBtZWV0IEVhcmx5LUVvZiIKICAgICAgICAgICAgICB9KSA6ICh0ID0gYS5iLkVYQ0VQVElPTiwKICAgICAgICAgICAgICBpID0gewogICAgICAgICAgICAgICAgICBjb2RlOiAtMSwKICAgICAgICAgICAgICAgICAgbXNnOiBlLmNvbnN0cnVjdG9yLm5hbWUgKyAiICIgKyBlLnR5cGUKICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAhdGhpcy5fb25FcnJvcikKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGguZChpLm1zZyk7CiAgICAgICAgICAgICAgdGhpcy5fb25FcnJvcih0LCBpKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgdAogICAgICB9KGEuYSksIHAgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBlID0gZnVuY3Rpb24odCwgaSkgewogICAgICAgICAgICAgIHJldHVybiAoZSA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCB7CiAgICAgICAgICAgICAgICAgIF9fcHJvdG9fXzogW10KICAgICAgICAgICAgICB9aW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgICAgIGUuX19wcm90b19fID0gdAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB8fCBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdCkKICAgICAgICAgICAgICAgICAgICAgIHQuaGFzT3duUHJvcGVydHkoaSkgJiYgKGVbaV0gPSB0W2ldKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKHQsIGkpCiAgICAgICAgICB9OwogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGkpIHsKICAgICAgICAgICAgICBmdW5jdGlvbiBuKCkgewogICAgICAgICAgICAgICAgICB0aGlzLmNvbnN0cnVjdG9yID0gdAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlKHQsIGkpLAogICAgICAgICAgICAgIHQucHJvdG90eXBlID0gbnVsbCA9PT0gaSA/IE9iamVjdC5jcmVhdGUoaSkgOiAobi5wcm90b3R5cGUgPSBpLnByb3RvdHlwZSwKICAgICAgICAgICAgICBuZXcgbikKICAgICAgICAgIH0KICAgICAgfSgpLCBtID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgZnVuY3Rpb24gdCgpIHsKICAgICAgICAgICAgICB2YXIgdCA9IGUuY2FsbCh0aGlzLCAid2Vic29ja2V0LWxvYWRlciIpIHx8IHRoaXM7CiAgICAgICAgICAgICAgcmV0dXJuIHQuVEFHID0gIldlYlNvY2tldExvYWRlciIsCiAgICAgICAgICAgICAgdC5fbmVlZFN0YXNoID0gITAsCiAgICAgICAgICAgICAgdC5fd3MgPSBudWxsLAogICAgICAgICAgICAgIHQuX3JlcXVlc3RBYm9ydCA9ICExLAogICAgICAgICAgICAgIHQuX3JlY2VpdmVkTGVuZ3RoID0gMCwKICAgICAgICAgICAgICB0CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcCh0LCBlKSwKICAgICAgICAgIHQuaXNTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBzZWxmLldlYlNvY2tldAogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgdC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX3dzICYmIHRoaXMuYWJvcnQoKSwKICAgICAgICAgICAgICBlLnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcykKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLl93cyA9IG5ldyBzZWxmLldlYlNvY2tldChlLnVybCk7CiAgICAgICAgICAgICAgICAgIHQuYmluYXJ5VHlwZSA9ICJhcnJheWJ1ZmZlciIsCiAgICAgICAgICAgICAgICAgIHQub25vcGVuID0gdGhpcy5fb25XZWJTb2NrZXRPcGVuLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICAgIHQub25jbG9zZSA9IHRoaXMuX29uV2ViU29ja2V0Q2xvc2UuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgICAgdC5vbm1lc3NhZ2UgPSB0aGlzLl9vbldlYlNvY2tldE1lc3NhZ2UuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgICAgdC5vbmVycm9yID0gdGhpcy5fb25XZWJTb2NrZXRFcnJvci5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgICB0aGlzLl9zdGF0dXMgPSBhLmMua0Nvbm5lY3RpbmcKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX3N0YXR1cyA9IGEuYy5rRXJyb3I7CiAgICAgICAgICAgICAgICAgIHZhciBpID0gewogICAgICAgICAgICAgICAgICAgICAgY29kZTogZS5jb2RlLAogICAgICAgICAgICAgICAgICAgICAgbXNnOiBlLm1lc3NhZ2UKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9vbkVycm9yKQogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGguZChpLm1zZyk7CiAgICAgICAgICAgICAgICAgIHRoaXMuX29uRXJyb3IoYS5iLkVYQ0VQVElPTiwgaSkKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5hYm9ydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHZhciBlID0gdGhpcy5fd3M7CiAgICAgICAgICAgICAgIWUgfHwgMCAhPT0gZS5yZWFkeVN0YXRlICYmIDEgIT09IGUucmVhZHlTdGF0ZSB8fCAodGhpcy5fcmVxdWVzdEFib3J0ID0gITAsCiAgICAgICAgICAgICAgZS5jbG9zZSgpKSwKICAgICAgICAgICAgICB0aGlzLl93cyA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fc3RhdHVzID0gYS5jLmtDb21wbGV0ZQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgdC5wcm90b3R5cGUuX29uV2ViU29ja2V0T3BlbiA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB0aGlzLl9zdGF0dXMgPSBhLmMua0J1ZmZlcmluZwogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgdC5wcm90b3R5cGUuX29uV2ViU29ja2V0Q2xvc2UgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgITAgIT09IHRoaXMuX3JlcXVlc3RBYm9ydCA/ICh0aGlzLl9zdGF0dXMgPSBhLmMua0NvbXBsZXRlLAogICAgICAgICAgICAgIHRoaXMuX29uQ29tcGxldGUgJiYgdGhpcy5fb25Db21wbGV0ZSgwLCB0aGlzLl9yZWNlaXZlZExlbmd0aCAtIDEpKSA6IHRoaXMuX3JlcXVlc3RBYm9ydCA9ICExCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICB0LnByb3RvdHlwZS5fb25XZWJTb2NrZXRNZXNzYWdlID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHZhciB0ID0gdGhpczsKICAgICAgICAgICAgICBpZiAoZS5kYXRhIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpCiAgICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoQXJyYXlCdWZmZXIoZS5kYXRhKTsKICAgICAgICAgICAgICBlbHNlIGlmIChlLmRhdGEgaW5zdGFuY2VvZiBCbG9iKSB7CiAgICAgICAgICAgICAgICAgIHZhciBpID0gbmV3IEZpbGVSZWFkZXI7CiAgICAgICAgICAgICAgICAgIGkub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICB0Ll9kaXNwYXRjaEFycmF5QnVmZmVyKGkucmVzdWx0KQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICwKICAgICAgICAgICAgICAgICAgaS5yZWFkQXNBcnJheUJ1ZmZlcihlLmRhdGEpCiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fc3RhdHVzID0gYS5jLmtFcnJvcjsKICAgICAgICAgICAgICAgICAgdmFyIG4gPSB7CiAgICAgICAgICAgICAgICAgICAgICBjb2RlOiAtMSwKICAgICAgICAgICAgICAgICAgICAgIG1zZzogIlVuc3VwcG9ydGVkIFdlYlNvY2tldCBtZXNzYWdlIHR5cGU6ICIgKyBlLmRhdGEuY29uc3RydWN0b3IubmFtZQogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX29uRXJyb3IpCiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgaC5kKG4ubXNnKTsKICAgICAgICAgICAgICAgICAgdGhpcy5fb25FcnJvcihhLmIuRVhDRVBUSU9OLCBuKQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLl9kaXNwYXRjaEFycmF5QnVmZmVyID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHZhciB0ID0gZQogICAgICAgICAgICAgICAgLCBpID0gdGhpcy5fcmVjZWl2ZWRMZW5ndGg7CiAgICAgICAgICAgICAgdGhpcy5fcmVjZWl2ZWRMZW5ndGggKz0gdC5ieXRlTGVuZ3RoLAogICAgICAgICAgICAgIHRoaXMuX29uRGF0YUFycml2YWwgJiYgdGhpcy5fb25EYXRhQXJyaXZhbCh0LCBpLCB0aGlzLl9yZWNlaXZlZExlbmd0aCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIHQucHJvdG90eXBlLl9vbldlYlNvY2tldEVycm9yID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHRoaXMuX3N0YXR1cyA9IGEuYy5rRXJyb3I7CiAgICAgICAgICAgICAgdmFyIHQgPSB7CiAgICAgICAgICAgICAgICAgIGNvZGU6IGUuY29kZSwKICAgICAgICAgICAgICAgICAgbXNnOiBlLm1lc3NhZ2UKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGlmICghdGhpcy5fb25FcnJvcikKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGguZCh0Lm1zZyk7CiAgICAgICAgICAgICAgdGhpcy5fb25FcnJvcihhLmIuRVhDRVBUSU9OLCB0KQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgdAogICAgICB9KGEuYSksIGcgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGZ1bmN0aW9uIGUoZSkgewogICAgICAgICAgICAgIHRoaXMuX3plcm9TdGFydCA9IGUgfHwgITEKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBlLnByb3RvdHlwZS5nZXRDb25maWcgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgdmFyIGkgPSB7fTsKICAgICAgICAgICAgICBpZiAoMCAhPT0gdC5mcm9tIHx8IC0xICE9PSB0LnRvKSB7CiAgICAgICAgICAgICAgICAgIHZhciBuID0gdm9pZCAwOwogICAgICAgICAgICAgICAgICBuID0gLTEgIT09IHQudG8gPyAiYnl0ZXM9IiArIHQuZnJvbS50b1N0cmluZygpICsgIi0iICsgdC50by50b1N0cmluZygpIDogImJ5dGVzPSIgKyB0LmZyb20udG9TdHJpbmcoKSArICItIiwKICAgICAgICAgICAgICAgICAgaS5SYW5nZSA9IG4KICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgdGhpcy5femVyb1N0YXJ0ICYmIChpLlJhbmdlID0gImJ5dGVzPTAtIik7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgdXJsOiBlLAogICAgICAgICAgICAgICAgICBoZWFkZXJzOiBpCiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUucmVtb3ZlVVJMUGFyYW1ldGVycyA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICByZXR1cm4gZQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZQogICAgICB9KCksIHYgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGZ1bmN0aW9uIGUoZSwgdCkgewogICAgICAgICAgICAgIHRoaXMuX3N0YXJ0TmFtZSA9IGUsCiAgICAgICAgICAgICAgdGhpcy5fZW5kTmFtZSA9IHQKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBlLnByb3RvdHlwZS5nZXRDb25maWcgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgdmFyIGkgPSBlOwogICAgICAgICAgICAgIGlmICgwICE9PSB0LmZyb20gfHwgLTEgIT09IHQudG8pIHsKICAgICAgICAgICAgICAgICAgdmFyIG4gPSAhMDsKICAgICAgICAgICAgICAgICAgLTEgPT09IGkuaW5kZXhPZigiPyIpICYmIChpICs9ICI/IiwKICAgICAgICAgICAgICAgICAgbiA9ICExKSwKICAgICAgICAgICAgICAgICAgbiAmJiAoaSArPSAiJiIpLAogICAgICAgICAgICAgICAgICBpICs9IHRoaXMuX3N0YXJ0TmFtZSArICI9IiArIHQuZnJvbS50b1N0cmluZygpLAogICAgICAgICAgICAgICAgICAtMSAhPT0gdC50byAmJiAoaSArPSAiJiIgKyB0aGlzLl9lbmROYW1lICsgIj0iICsgdC50by50b1N0cmluZygpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICB1cmw6IGksCiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHt9CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUucmVtb3ZlVVJMUGFyYW1ldGVycyA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB2YXIgdCA9IGUuc3BsaXQoIj8iKVswXQogICAgICAgICAgICAgICAgLCBpID0gdm9pZCAwCiAgICAgICAgICAgICAgICAsIG4gPSBlLmluZGV4T2YoIj8iKTsKICAgICAgICAgICAgICAtMSAhPT0gbiAmJiAoaSA9IGUuc3Vic3RyaW5nKG4gKyAxKSk7CiAgICAgICAgICAgICAgdmFyIHIgPSAiIjsKICAgICAgICAgICAgICBpZiAobnVsbCAhPSBpICYmIGkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgcyA9IGkuc3BsaXQoIiYiKSwgYSA9IDA7IGEgPCBzLmxlbmd0aDsgYSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IHNbYV0uc3BsaXQoIj0iKQogICAgICAgICAgICAgICAgICAgICAgICAsIGggPSBhID4gMDsKICAgICAgICAgICAgICAgICAgICAgIG9bMF0gIT09IHRoaXMuX3N0YXJ0TmFtZSAmJiBvWzBdICE9PSB0aGlzLl9lbmROYW1lICYmIChoICYmIChyICs9ICImIiksCiAgICAgICAgICAgICAgICAgICAgICByICs9IHNbYV0pCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gMCA9PT0gci5sZW5ndGggPyB0IDogdCArICI/IiArIHIKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUKICAgICAgfSgpLCB5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBmdW5jdGlvbiBlKGUsIHQsIGkpIHsKICAgICAgICAgICAgICB0aGlzLlRBRyA9ICJJT0NvbnRyb2xsZXIiLAogICAgICAgICAgICAgIHRoaXMuX2NvbmZpZyA9IHQsCiAgICAgICAgICAgICAgdGhpcy5fZXh0cmFEYXRhID0gaSwKICAgICAgICAgICAgICB0aGlzLl9zdGFzaEluaXRpYWxTaXplID0gNjU1MzYsCiAgICAgICAgICAgICAgbnVsbCAhPSB0LnN0YXNoSW5pdGlhbFNpemUgJiYgdC5zdGFzaEluaXRpYWxTaXplID4gMCAmJiAodGhpcy5fc3Rhc2hJbml0aWFsU2l6ZSA9IHQuc3Rhc2hJbml0aWFsU2l6ZSksCiAgICAgICAgICAgICAgdGhpcy5fc3Rhc2hVc2VkID0gMCwKICAgICAgICAgICAgICB0aGlzLl9zdGFzaFNpemUgPSB0aGlzLl9zdGFzaEluaXRpYWxTaXplLAogICAgICAgICAgICAgIHRoaXMuX2J1ZmZlclNpemUgPSAzMTQ1NzI4LAogICAgICAgICAgICAgIHRoaXMuX3N0YXNoQnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKHRoaXMuX2J1ZmZlclNpemUpLAogICAgICAgICAgICAgIHRoaXMuX3N0YXNoQnl0ZVN0YXJ0ID0gMCwKICAgICAgICAgICAgICB0aGlzLl9lbmFibGVTdGFzaCA9ICEwLAogICAgICAgICAgICAgICExID09PSB0LmVuYWJsZVN0YXNoQnVmZmVyICYmICh0aGlzLl9lbmFibGVTdGFzaCA9ICExKSwKICAgICAgICAgICAgICB0aGlzLl9sb2FkZXIgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX2xvYWRlckNsYXNzID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9zZWVrSGFuZGxlciA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fZGF0YVNvdXJjZSA9IGUsCiAgICAgICAgICAgICAgdGhpcy5faXNXZWJTb2NrZXRVUkwgPSAvd3NzPzpcL1wvKC4rPykvLnRlc3QoZS51cmwpLAogICAgICAgICAgICAgIHRoaXMuX3JlZlRvdGFsTGVuZ3RoID0gZS5maWxlc2l6ZSA/IGUuZmlsZXNpemUgOiBudWxsLAogICAgICAgICAgICAgIHRoaXMuX3RvdGFsTGVuZ3RoID0gdGhpcy5fcmVmVG90YWxMZW5ndGgsCiAgICAgICAgICAgICAgdGhpcy5fZnVsbFJlcXVlc3RGbGFnID0gITEsCiAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFJhbmdlID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9yZWRpcmVjdGVkVVJMID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9zcGVlZE5vcm1hbGl6ZWQgPSAwLAogICAgICAgICAgICAgIHRoaXMuX3NwZWVkU2FtcGxlciA9IG5ldyBzLAogICAgICAgICAgICAgIHRoaXMuX3NwZWVkTm9ybWFsaXplTGlzdCA9IFszMiwgNjQsIDk2LCAxMjgsIDE5MiwgMjU2LCAzODQsIDUxMiwgNzY4LCAxMDI0LCAxNTM2LCAyMDQ4LCAzMDcyLCA0MDk2XSwKICAgICAgICAgICAgICB0aGlzLl9pc0Vhcmx5RW9mUmVjb25uZWN0aW5nID0gITEsCiAgICAgICAgICAgICAgdGhpcy5fcGF1c2VkID0gITEsCiAgICAgICAgICAgICAgdGhpcy5fcmVzdW1lRnJvbSA9IDAsCiAgICAgICAgICAgICAgdGhpcy5fb25EYXRhQXJyaXZhbCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fb25TZWVrZWQgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uRXJyb3IgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uQ29tcGxldGUgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uUmVkaXJlY3QgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX29uUmVjb3ZlcmVkRWFybHlFb2YgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX3NlbGVjdFNlZWtIYW5kbGVyKCksCiAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0TG9hZGVyKCksCiAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlTG9hZGVyKCkKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBlLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5fbG9hZGVyLmlzV29ya2luZygpICYmIHRoaXMuX2xvYWRlci5hYm9ydCgpLAogICAgICAgICAgICAgIHRoaXMuX2xvYWRlci5kZXN0cm95KCksCiAgICAgICAgICAgICAgdGhpcy5fbG9hZGVyID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9sb2FkZXJDbGFzcyA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fZGF0YVNvdXJjZSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fc3Rhc2hCdWZmZXIgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX3N0YXNoVXNlZCA9IHRoaXMuX3N0YXNoU2l6ZSA9IHRoaXMuX2J1ZmZlclNpemUgPSB0aGlzLl9zdGFzaEJ5dGVTdGFydCA9IDAsCiAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFJhbmdlID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9zcGVlZFNhbXBsZXIgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX2lzRWFybHlFb2ZSZWNvbm5lY3RpbmcgPSAhMSwKICAgICAgICAgICAgICB0aGlzLl9vbkRhdGFBcnJpdmFsID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9vblNlZWtlZCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fb25FcnJvciA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fb25Db21wbGV0ZSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fb25SZWRpcmVjdCA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fb25SZWNvdmVyZWRFYXJseUVvZiA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fZXh0cmFEYXRhID0gbnVsbAogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuaXNXb3JraW5nID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xvYWRlciAmJiB0aGlzLl9sb2FkZXIuaXNXb3JraW5nKCkgJiYgIXRoaXMuX3BhdXNlZAogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuaXNQYXVzZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcGF1c2VkCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJzdGF0dXMiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xvYWRlci5zdGF0dXMKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAiZXh0cmFEYXRhIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9leHRyYURhdGEKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICB0aGlzLl9leHRyYURhdGEgPSBlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgIm9uRGF0YUFycml2YWwiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29uRGF0YUFycml2YWwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICB0aGlzLl9vbkRhdGFBcnJpdmFsID0gZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJvblNlZWtlZCIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb25TZWVrZWQKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICB0aGlzLl9vblNlZWtlZCA9IGUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAib25FcnJvciIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb25FcnJvcgogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX29uRXJyb3IgPSBlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgIm9uQ29tcGxldGUiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29uQ29tcGxldGUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICB0aGlzLl9vbkNvbXBsZXRlID0gZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJvblJlZGlyZWN0IiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vblJlZGlyZWN0CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fb25SZWRpcmVjdCA9IGUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAib25SZWNvdmVyZWRFYXJseUVvZiIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb25SZWNvdmVyZWRFYXJseUVvZgogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX29uUmVjb3ZlcmVkRWFybHlFb2YgPSBlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgImN1cnJlbnRVUkwiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGFTb3VyY2UudXJsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgImhhc1JlZGlyZWN0IiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsICE9IHRoaXMuX3JlZGlyZWN0ZWRVUkwgfHwgbnVsbCAhPSB0aGlzLl9kYXRhU291cmNlLnJlZGlyZWN0ZWRVUkwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAiY3VycmVudFJlZGlyZWN0ZWRVUkwiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlZGlyZWN0ZWRVUkwgfHwgdGhpcy5fZGF0YVNvdXJjZS5yZWRpcmVjdGVkVVJMCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgImN1cnJlbnRTcGVlZCIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbG9hZGVyQ2xhc3MgPT09IGYgPyB0aGlzLl9sb2FkZXIuY3VycmVudFNwZWVkIDogdGhpcy5fc3BlZWRTYW1wbGVyLmxhc3RTZWNvbmRLQnBzCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgImxvYWRlclR5cGUiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xvYWRlci50eXBlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIGUucHJvdG90eXBlLl9zZWxlY3RTZWVrSGFuZGxlciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHZhciBlID0gdGhpcy5fY29uZmlnOwogICAgICAgICAgICAgIGlmICgicmFuZ2UiID09PSBlLnNlZWtUeXBlKQogICAgICAgICAgICAgICAgICB0aGlzLl9zZWVrSGFuZGxlciA9IG5ldyBnKHRoaXMuX2NvbmZpZy5yYW5nZUxvYWRaZXJvU3RhcnQpOwogICAgICAgICAgICAgIGVsc2UgaWYgKCJwYXJhbSIgPT09IGUuc2Vla1R5cGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIHQgPSBlLnNlZWtQYXJhbVN0YXJ0IHx8ICJic3RhcnQiCiAgICAgICAgICAgICAgICAgICAgLCBpID0gZS5zZWVrUGFyYW1FbmQgfHwgImJlbmQiOwogICAgICAgICAgICAgICAgICB0aGlzLl9zZWVrSGFuZGxlciA9IG5ldyB2KHQsaSkKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBpZiAoImN1c3RvbSIgIT09IGUuc2Vla1R5cGUpCiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgaC5iKCJJbnZhbGlkIHNlZWtUeXBlIGluIGNvbmZpZzogIiArIGUuc2Vla1R5cGUpOwogICAgICAgICAgICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgZS5jdXN0b21TZWVrSGFuZGxlcikKICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBoLmIoIkN1c3RvbSBzZWVrVHlwZSBzcGVjaWZpZWQgaW4gY29uZmlnIGJ1dCBpbnZhbGlkIGN1c3RvbVNlZWtIYW5kbGVyISIpOwogICAgICAgICAgICAgICAgICB0aGlzLl9zZWVrSGFuZGxlciA9IG5ldyBlLmN1c3RvbVNlZWtIYW5kbGVyCiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX3NlbGVjdExvYWRlciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIGlmIChudWxsICE9IHRoaXMuX2NvbmZpZy5jdXN0b21Mb2FkZXIpCiAgICAgICAgICAgICAgICAgIHRoaXMuX2xvYWRlckNsYXNzID0gdGhpcy5fY29uZmlnLmN1c3RvbUxvYWRlcjsKICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLl9pc1dlYlNvY2tldFVSTCkKICAgICAgICAgICAgICAgICAgdGhpcy5fbG9hZGVyQ2xhc3MgPSBtOwogICAgICAgICAgICAgIGVsc2UgaWYgKHUuaXNTdXBwb3J0ZWQoKSkKICAgICAgICAgICAgICAgICAgdGhpcy5fbG9hZGVyQ2xhc3MgPSB1OwogICAgICAgICAgICAgIGVsc2UgaWYgKGMuaXNTdXBwb3J0ZWQoKSkKICAgICAgICAgICAgICAgICAgdGhpcy5fbG9hZGVyQ2xhc3MgPSBjOwogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICBpZiAoIWYuaXNTdXBwb3J0ZWQoKSkKICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBoLmQoIllvdXIgYnJvd3NlciBkb2Vzbid0IHN1cHBvcnQgeGhyIHdpdGggYXJyYXlidWZmZXIgcmVzcG9uc2VUeXBlISIpOwogICAgICAgICAgICAgICAgICB0aGlzLl9sb2FkZXJDbGFzcyA9IGYKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fY3JlYXRlTG9hZGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5fbG9hZGVyID0gbmV3IHRoaXMuX2xvYWRlckNsYXNzKHRoaXMuX3NlZWtIYW5kbGVyLHRoaXMuX2NvbmZpZyksCiAgICAgICAgICAgICAgITEgPT09IHRoaXMuX2xvYWRlci5uZWVkU3Rhc2hCdWZmZXIgJiYgKHRoaXMuX2VuYWJsZVN0YXNoID0gITEpLAogICAgICAgICAgICAgIHRoaXMuX2xvYWRlci5vbkNvbnRlbnRMZW5ndGhLbm93biA9IHRoaXMuX29uQ29udGVudExlbmd0aEtub3duLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgdGhpcy5fbG9hZGVyLm9uVVJMUmVkaXJlY3QgPSB0aGlzLl9vblVSTFJlZGlyZWN0LmJpbmQodGhpcyksCiAgICAgICAgICAgICAgdGhpcy5fbG9hZGVyLm9uRGF0YUFycml2YWwgPSB0aGlzLl9vbkxvYWRlckNodW5rQXJyaXZhbC5iaW5kKHRoaXMpLAogICAgICAgICAgICAgIHRoaXMuX2xvYWRlci5vbkNvbXBsZXRlID0gdGhpcy5fb25Mb2FkZXJDb21wbGV0ZS5iaW5kKHRoaXMpLAogICAgICAgICAgICAgIHRoaXMuX2xvYWRlci5vbkVycm9yID0gdGhpcy5fb25Mb2FkZXJFcnJvci5iaW5kKHRoaXMpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRSYW5nZSA9IHsKICAgICAgICAgICAgICAgICAgZnJvbTogMCwKICAgICAgICAgICAgICAgICAgdG86IC0xCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlICYmICh0aGlzLl9jdXJyZW50UmFuZ2UuZnJvbSA9IGUpLAogICAgICAgICAgICAgIHRoaXMuX3NwZWVkU2FtcGxlci5yZXNldCgpLAogICAgICAgICAgICAgIGUgfHwgKHRoaXMuX2Z1bGxSZXF1ZXN0RmxhZyA9ICEwKSwKICAgICAgICAgICAgICB0aGlzLl9sb2FkZXIub3Blbih0aGlzLl9kYXRhU291cmNlLCBPYmplY3QuYXNzaWduKHt9LCB0aGlzLl9jdXJyZW50UmFuZ2UpKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuYWJvcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0aGlzLl9sb2FkZXIuYWJvcnQoKSwKICAgICAgICAgICAgICB0aGlzLl9wYXVzZWQgJiYgKHRoaXMuX3BhdXNlZCA9ICExLAogICAgICAgICAgICAgIHRoaXMuX3Jlc3VtZUZyb20gPSAwKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0aGlzLmlzV29ya2luZygpICYmICh0aGlzLl9sb2FkZXIuYWJvcnQoKSwKICAgICAgICAgICAgICAwICE9PSB0aGlzLl9zdGFzaFVzZWQgPyAodGhpcy5fcmVzdW1lRnJvbSA9IHRoaXMuX3N0YXNoQnl0ZVN0YXJ0LAogICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRSYW5nZS50byA9IHRoaXMuX3N0YXNoQnl0ZVN0YXJ0IC0gMSkgOiB0aGlzLl9yZXN1bWVGcm9tID0gdGhpcy5fY3VycmVudFJhbmdlLnRvICsgMSwKICAgICAgICAgICAgICB0aGlzLl9zdGFzaFVzZWQgPSAwLAogICAgICAgICAgICAgIHRoaXMuX3N0YXNoQnl0ZVN0YXJ0ID0gMCwKICAgICAgICAgICAgICB0aGlzLl9wYXVzZWQgPSAhMCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLnJlc3VtZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIGlmICh0aGlzLl9wYXVzZWQpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fcGF1c2VkID0gITE7CiAgICAgICAgICAgICAgICAgIHZhciBlID0gdGhpcy5fcmVzdW1lRnJvbTsKICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzdW1lRnJvbSA9IDAsCiAgICAgICAgICAgICAgICAgIHRoaXMuX2ludGVybmFsU2VlayhlLCAhMCkKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5zZWVrID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHRoaXMuX3BhdXNlZCA9ICExLAogICAgICAgICAgICAgIHRoaXMuX3N0YXNoVXNlZCA9IDAsCiAgICAgICAgICAgICAgdGhpcy5fc3Rhc2hCeXRlU3RhcnQgPSAwLAogICAgICAgICAgICAgIHRoaXMuX2ludGVybmFsU2VlayhlLCAhMCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9pbnRlcm5hbFNlZWsgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgdGhpcy5fbG9hZGVyLmlzV29ya2luZygpICYmIHRoaXMuX2xvYWRlci5hYm9ydCgpLAogICAgICAgICAgICAgIHRoaXMuX2ZsdXNoU3Rhc2hCdWZmZXIodCksCiAgICAgICAgICAgICAgdGhpcy5fbG9hZGVyLmRlc3Ryb3koKSwKICAgICAgICAgICAgICB0aGlzLl9sb2FkZXIgPSBudWxsOwogICAgICAgICAgICAgIHZhciBpID0gewogICAgICAgICAgICAgICAgICBmcm9tOiBlLAogICAgICAgICAgICAgICAgICB0bzogLTEKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRSYW5nZSA9IHsKICAgICAgICAgICAgICAgICAgZnJvbTogaS5mcm9tLAogICAgICAgICAgICAgICAgICB0bzogLTEKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHRoaXMuX3NwZWVkU2FtcGxlci5yZXNldCgpLAogICAgICAgICAgICAgIHRoaXMuX3N0YXNoU2l6ZSA9IHRoaXMuX3N0YXNoSW5pdGlhbFNpemUsCiAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlTG9hZGVyKCksCiAgICAgICAgICAgICAgdGhpcy5fbG9hZGVyLm9wZW4odGhpcy5fZGF0YVNvdXJjZSwgaSksCiAgICAgICAgICAgICAgdGhpcy5fb25TZWVrZWQgJiYgdGhpcy5fb25TZWVrZWQoKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUudXBkYXRlVXJsID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGlmICghZSB8fCAic3RyaW5nIiAhPSB0eXBlb2YgZSB8fCAwID09PSBlLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IGguYigiVXJsIG11c3QgYmUgYSBub24tZW1wdHkgc3RyaW5nISIpOwogICAgICAgICAgICAgIHRoaXMuX2RhdGFTb3VyY2UudXJsID0gZQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX2V4cGFuZEJ1ZmZlciA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBmb3IgKHZhciB0ID0gdGhpcy5fc3Rhc2hTaXplOyB0ICsgMTA0ODU3NiA8IGU7ICkKICAgICAgICAgICAgICAgICAgdCAqPSAyOwogICAgICAgICAgICAgIGlmICgodCArPSAxMDQ4NTc2KSAhPT0gdGhpcy5fYnVmZmVyU2l6ZSkgewogICAgICAgICAgICAgICAgICB2YXIgaSA9IG5ldyBBcnJheUJ1ZmZlcih0KTsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXNoVXNlZCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5fc3Rhc2hCdWZmZXIsMCx0aGlzLl9zdGFzaFVzZWQpOwogICAgICAgICAgICAgICAgICAgICAgbmV3IFVpbnQ4QXJyYXkoaSwwLHQpLnNldChuLCAwKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHRoaXMuX3N0YXNoQnVmZmVyID0gaSwKICAgICAgICAgICAgICAgICAgdGhpcy5fYnVmZmVyU2l6ZSA9IHQKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fbm9ybWFsaXplU3BlZWQgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLl9zcGVlZE5vcm1hbGl6ZUxpc3QKICAgICAgICAgICAgICAgICwgaSA9IHQubGVuZ3RoIC0gMQogICAgICAgICAgICAgICAgLCBuID0gMAogICAgICAgICAgICAgICAgLCByID0gMAogICAgICAgICAgICAgICAgLCBzID0gaTsKICAgICAgICAgICAgICBpZiAoZSA8IHRbMF0pCiAgICAgICAgICAgICAgICAgIHJldHVybiB0WzBdOwogICAgICAgICAgICAgIGZvciAoOyByIDw9IHM7ICkgewogICAgICAgICAgICAgICAgICBpZiAoKG4gPSByICsgTWF0aC5mbG9vcigocyAtIHIpIC8gMikpID09PSBpIHx8IGUgPj0gdFtuXSAmJiBlIDwgdFtuICsgMV0pCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdFtuXTsKICAgICAgICAgICAgICAgICAgdFtuXSA8IGUgPyByID0gbiArIDEgOiBzID0gbiAtIDEKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fYWRqdXN0U3Rhc2hTaXplID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHZhciB0ID0gMDsKICAgICAgICAgICAgICAodCA9IHRoaXMuX2NvbmZpZy5pc0xpdmUgPyBlIC8gOCA6IGUgPCA1MTIgPyBlIDogZSA+PSA1MTIgJiYgZSA8PSAxMDI0ID8gTWF0aC5mbG9vcigxLjUgKiBlKSA6IDIgKiBlKSA+IDgxOTIgJiYgKHQgPSA4MTkyKTsKICAgICAgICAgICAgICB2YXIgaSA9IDEwMjQgKiB0ICsgMTA0ODU3NjsKICAgICAgICAgICAgICB0aGlzLl9idWZmZXJTaXplIDwgaSAmJiB0aGlzLl9leHBhbmRCdWZmZXIoaSksCiAgICAgICAgICAgICAgdGhpcy5fc3Rhc2hTaXplID0gMTAyNCAqIHQKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9kaXNwYXRjaENodW5rcyA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudFJhbmdlLnRvID0gdCArIGUuYnl0ZUxlbmd0aCAtIDEsCiAgICAgICAgICAgICAgdGhpcy5fb25EYXRhQXJyaXZhbChlLCB0KQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX29uVVJMUmVkaXJlY3QgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdGhpcy5fcmVkaXJlY3RlZFVSTCA9IGUsCiAgICAgICAgICAgICAgdGhpcy5fb25SZWRpcmVjdCAmJiB0aGlzLl9vblJlZGlyZWN0KGUpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fb25Db250ZW50TGVuZ3RoS25vd24gPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgZSAmJiB0aGlzLl9mdWxsUmVxdWVzdEZsYWcgJiYgKHRoaXMuX3RvdGFsTGVuZ3RoID0gZSwKICAgICAgICAgICAgICB0aGlzLl9mdWxsUmVxdWVzdEZsYWcgPSAhMSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vbkxvYWRlckNodW5rQXJyaXZhbCA9IGZ1bmN0aW9uKGUsIHQsIGkpIHsKICAgICAgICAgICAgICBpZiAoIXRoaXMuX29uRGF0YUFycml2YWwpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBoLmEoIklPQ29udHJvbGxlcjogTm8gZXhpc3RpbmcgY29uc3VtZXIgKG9uRGF0YUFycml2YWwpIGNhbGxiYWNrISIpOwogICAgICAgICAgICAgIGlmICghdGhpcy5fcGF1c2VkKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX2lzRWFybHlFb2ZSZWNvbm5lY3RpbmcgJiYgKHRoaXMuX2lzRWFybHlFb2ZSZWNvbm5lY3RpbmcgPSAhMSwKICAgICAgICAgICAgICAgICAgdGhpcy5fb25SZWNvdmVyZWRFYXJseUVvZiAmJiB0aGlzLl9vblJlY292ZXJlZEVhcmx5RW9mKCkpLAogICAgICAgICAgICAgICAgICB0aGlzLl9zcGVlZFNhbXBsZXIuYWRkQnl0ZXMoZS5ieXRlTGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgdmFyIG4gPSB0aGlzLl9zcGVlZFNhbXBsZXIubGFzdFNlY29uZEtCcHM7CiAgICAgICAgICAgICAgICAgIGlmICgwICE9PSBuKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgciA9IHRoaXMuX25vcm1hbGl6ZVNwZWVkKG4pOwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3BlZWROb3JtYWxpemVkICE9PSByICYmICh0aGlzLl9zcGVlZE5vcm1hbGl6ZWQgPSByLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWRqdXN0U3Rhc2hTaXplKHIpKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9lbmFibGVTdGFzaCkKICAgICAgICAgICAgICAgICAgICAgIGlmICgwID09PSB0aGlzLl9zdGFzaFVzZWQgJiYgMCA9PT0gdGhpcy5fc3Rhc2hCeXRlU3RhcnQgJiYgKHRoaXMuX3N0YXNoQnl0ZVN0YXJ0ID0gdCksCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGFzaFVzZWQgKyBlLmJ5dGVMZW5ndGggPD0gdGhpcy5fc3Rhc2hTaXplKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgKG8gPSBuZXcgVWludDhBcnJheSh0aGlzLl9zdGFzaEJ1ZmZlciwwLHRoaXMuX3N0YXNoU2l6ZSkpLnNldChuZXcgVWludDhBcnJheShlKSwgdGhpcy5fc3Rhc2hVc2VkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGFzaFVzZWQgKz0gZS5ieXRlTGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgIG8gPSBuZXcgVWludDhBcnJheSh0aGlzLl9zdGFzaEJ1ZmZlciwwLHRoaXMuX2J1ZmZlclNpemUpOwogICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zdGFzaFVzZWQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzID0gdGhpcy5fc3Rhc2hCdWZmZXIuc2xpY2UoMCwgdGhpcy5fc3Rhc2hVc2VkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChkID0gdGhpcy5fZGlzcGF0Y2hDaHVua3MocywgdGhpcy5fc3Rhc2hCeXRlU3RhcnQpKSA8IHMuYnl0ZUxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IG5ldyBVaW50OEFycmF5KHMsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5zZXQodSwgMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3Rhc2hVc2VkID0gdS5ieXRlTGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0YXNoQnl0ZVN0YXJ0ICs9IGQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGFzaFVzZWQgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3Rhc2hCeXRlU3RhcnQgKz0gZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3Rhc2hVc2VkICsgZS5ieXRlTGVuZ3RoID4gdGhpcy5fYnVmZmVyU2l6ZSAmJiAodGhpcy5fZXhwYW5kQnVmZmVyKHRoaXMuX3N0YXNoVXNlZCArIGUuYnl0ZUxlbmd0aCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8gPSBuZXcgVWludDhBcnJheSh0aGlzLl9zdGFzaEJ1ZmZlciwwLHRoaXMuX2J1ZmZlclNpemUpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5zZXQobmV3IFVpbnQ4QXJyYXkoZSksIHRoaXMuX3N0YXNoVXNlZCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0YXNoVXNlZCArPSBlLmJ5dGVMZW5ndGgKICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGQgPSB0aGlzLl9kaXNwYXRjaENodW5rcyhlLCB0KSkgPCBlLmJ5dGVMZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYSA9IGUuYnl0ZUxlbmd0aCAtIGQpID4gdGhpcy5fYnVmZmVyU2l6ZSAmJiAodGhpcy5fZXhwYW5kQnVmZmVyKGEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbyA9IG5ldyBVaW50OEFycmF5KHRoaXMuX3N0YXNoQnVmZmVyLDAsdGhpcy5fYnVmZmVyU2l6ZSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5zZXQobmV3IFVpbnQ4QXJyYXkoZSxkKSwgMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGFzaFVzZWQgKz0gYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0YXNoQnl0ZVN0YXJ0ID0gdCArIGQKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKDAgPT09IHRoaXMuX3N0YXNoVXNlZCkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGE7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoKGQgPSB0aGlzLl9kaXNwYXRjaENodW5rcyhlLCB0KSkgPCBlLmJ5dGVMZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgKGEgPSBlLmJ5dGVMZW5ndGggLSBkKSA+IHRoaXMuX2J1ZmZlclNpemUgJiYgdGhpcy5fZXhwYW5kQnVmZmVyKGEpLAogICAgICAgICAgICAgICAgICAgICAgICAgIChvID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5fc3Rhc2hCdWZmZXIsMCx0aGlzLl9idWZmZXJTaXplKSkuc2V0KG5ldyBVaW50OEFycmF5KGUsZCksIDApLAogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0YXNoVXNlZCArPSBhLAogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0YXNoQnl0ZVN0YXJ0ID0gdCArIGQKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBvLCBkOwogICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXNoVXNlZCArIGUuYnl0ZUxlbmd0aCA+IHRoaXMuX2J1ZmZlclNpemUgJiYgdGhpcy5fZXhwYW5kQnVmZmVyKHRoaXMuX3N0YXNoVXNlZCArIGUuYnl0ZUxlbmd0aCksCiAgICAgICAgICAgICAgICAgICAgICAobyA9IG5ldyBVaW50OEFycmF5KHRoaXMuX3N0YXNoQnVmZmVyLDAsdGhpcy5fYnVmZmVyU2l6ZSkpLnNldChuZXcgVWludDhBcnJheShlKSwgdGhpcy5fc3Rhc2hVc2VkKSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0YXNoVXNlZCArPSBlLmJ5dGVMZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAoZCA9IHRoaXMuX2Rpc3BhdGNoQ2h1bmtzKHRoaXMuX3N0YXNoQnVmZmVyLnNsaWNlKDAsIHRoaXMuX3N0YXNoVXNlZCksIHRoaXMuX3N0YXNoQnl0ZVN0YXJ0KSkgPCB0aGlzLl9zdGFzaFVzZWQgJiYgZCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdSA9IG5ldyBVaW50OEFycmF5KHRoaXMuX3N0YXNoQnVmZmVyLGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgIG8uc2V0KHUsIDApCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGFzaFVzZWQgLT0gZCwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0YXNoQnl0ZVN0YXJ0ICs9IGQKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9mbHVzaFN0YXNoQnVmZmVyID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGlmICh0aGlzLl9zdGFzaFVzZWQgPiAwKSB7CiAgICAgICAgICAgICAgICAgIHZhciB0ID0gdGhpcy5fc3Rhc2hCdWZmZXIuc2xpY2UoMCwgdGhpcy5fc3Rhc2hVc2VkKQogICAgICAgICAgICAgICAgICAgICwgaSA9IHRoaXMuX2Rpc3BhdGNoQ2h1bmtzKHQsIHRoaXMuX3N0YXNoQnl0ZVN0YXJ0KQogICAgICAgICAgICAgICAgICAgICwgbiA9IHQuYnl0ZUxlbmd0aCAtIGk7CiAgICAgICAgICAgICAgICAgIGlmIChpIDwgdC5ieXRlTGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSBuZXcgVWludDhBcnJheSh0aGlzLl9zdGFzaEJ1ZmZlciwwLHRoaXMuX2J1ZmZlclNpemUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBhID0gbmV3IFVpbnQ4QXJyYXkodCxpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcy5zZXQoYSwgMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0YXNoVXNlZCA9IGEuYnl0ZUxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3Rhc2hCeXRlU3RhcnQgKz0gaQogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgci5hLncodGhpcy5UQUcsIG4gKyAiIGJ5dGVzIHVuY29uc3VtZWQgZGF0YSByZW1haW4gd2hlbiBmbHVzaCBidWZmZXIsIGRyb3BwZWQiKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGFzaFVzZWQgPSAwLAogICAgICAgICAgICAgICAgICB0aGlzLl9zdGFzaEJ5dGVTdGFydCA9IDAsCiAgICAgICAgICAgICAgICAgIG4KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vbkxvYWRlckNvbXBsZXRlID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgIHRoaXMuX2ZsdXNoU3Rhc2hCdWZmZXIoITApLAogICAgICAgICAgICAgIHRoaXMuX29uQ29tcGxldGUgJiYgdGhpcy5fb25Db21wbGV0ZSh0aGlzLl9leHRyYURhdGEpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fb25Mb2FkZXJFcnJvciA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKHIuYS5lKHRoaXMuVEFHLCAiTG9hZGVyIGVycm9yLCBjb2RlID0gIiArIHQuY29kZSArICIsIG1zZyA9ICIgKyB0Lm1zZyksCiAgICAgICAgICAgICAgdGhpcy5fZmx1c2hTdGFzaEJ1ZmZlcighMSksCiAgICAgICAgICAgICAgdGhpcy5faXNFYXJseUVvZlJlY29ubmVjdGluZyAmJiAodGhpcy5faXNFYXJseUVvZlJlY29ubmVjdGluZyA9ICExLAogICAgICAgICAgICAgIGUgPSBhLmIuVU5SRUNPVkVSQUJMRV9FQVJMWV9FT0YpLAogICAgICAgICAgICAgIGUpIHsKICAgICAgICAgICAgICBjYXNlIGEuYi5FQVJMWV9FT0Y6CiAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fY29uZmlnLmlzTGl2ZSAmJiB0aGlzLl90b3RhbExlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzLl9jdXJyZW50UmFuZ2UudG8gKyAxOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgKGkgPCB0aGlzLl90b3RhbExlbmd0aCAmJiAoci5hLncodGhpcy5UQUcsICJDb25uZWN0aW9uIGxvc3QsIHRyeWluZyByZWNvbm5lY3QuLi4iKSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzRWFybHlFb2ZSZWNvbm5lY3RpbmcgPSAhMCwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2ludGVybmFsU2VlayhpLCAhMSkpKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGUgPSBhLmIuVU5SRUNPVkVSQUJMRV9FQVJMWV9FT0Y7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgYS5iLlVOUkVDT1ZFUkFCTEVfRUFSTFlfRU9GOgogICAgICAgICAgICAgIGNhc2UgYS5iLkNPTk5FQ1RJTkdfVElNRU9VVDoKICAgICAgICAgICAgICBjYXNlIGEuYi5IVFRQX1NUQVRVU19DT0RFX0lOVkFMSUQ6CiAgICAgICAgICAgICAgY2FzZSBhLmIuRVhDRVBUSU9OOgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoIXRoaXMuX29uRXJyb3IpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBoLmQoIklPRXhjZXB0aW9uOiAiICsgdC5tc2cpOwogICAgICAgICAgICAgIHRoaXMuX29uRXJyb3IoZSwgdCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUKICAgICAgfSgpOwogICAgICB0LmEgPSB5CiAgfQogICwgZnVuY3Rpb24oZSwgdCwgaSkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBuID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBmdW5jdGlvbiBlKCkge30KICAgICAgICAgIHJldHVybiBlLmluc3RhbGwgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZS5fX3Byb3RvX18gPSB0LAogICAgICAgICAgICAgICAgICBlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICwKICAgICAgICAgICAgICBPYmplY3QuYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgIGlmIChudWxsID09IGUpCiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY29udmVydCB1bmRlZmluZWQgb3IgbnVsbCB0byBvYmplY3QiKTsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgdCA9IE9iamVjdChlKSwgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gYXJndW1lbnRzW2ldOwogICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gbikKICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciByIGluIG4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBuW3JdKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiB0CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICwKICAgICAgICAgICAgICAiZnVuY3Rpb24iICE9IHR5cGVvZiBzZWxmLlByb21pc2UgJiYgaSgxNSkucG9seWZpbGwoKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZQogICAgICB9KCk7CiAgICAgIG4uaW5zdGFsbCgpLAogICAgICB0LmEgPSBuCiAgfQogICwgZnVuY3Rpb24oZSwgdCwgaSkgewogICAgICBmdW5jdGlvbiBuKGUpIHsKICAgICAgICAgIHZhciB0ID0ge307CiAgICAgICAgICBmdW5jdGlvbiBpKG4pIHsKICAgICAgICAgICAgICBpZiAodFtuXSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRbbl0uZXhwb3J0czsKICAgICAgICAgICAgICB2YXIgciA9IHRbbl0gPSB7CiAgICAgICAgICAgICAgICAgIGk6IG4sCiAgICAgICAgICAgICAgICAgIGw6ICExLAogICAgICAgICAgICAgICAgICBleHBvcnRzOiB7fQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgcmV0dXJuIGVbbl0uY2FsbChyLmV4cG9ydHMsIHIsIHIuZXhwb3J0cywgaSksCiAgICAgICAgICAgICAgci5sID0gITAsCiAgICAgICAgICAgICAgci5leHBvcnRzCiAgICAgICAgICB9CiAgICAgICAgICBpLm0gPSBlLAogICAgICAgICAgaS5jID0gdCwKICAgICAgICAgIGkuaSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICByZXR1cm4gZQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgaS5kID0gZnVuY3Rpb24oZSwgdCwgbikgewogICAgICAgICAgICAgIGkubyhlLCB0KSB8fCBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgdCwgewogICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICExLAogICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMCwKICAgICAgICAgICAgICAgICAgZ2V0OiBuCiAgICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGkuciA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgIl9fZXNNb2R1bGUiLCB7CiAgICAgICAgICAgICAgICAgIHZhbHVlOiAhMAogICAgICAgICAgICAgIH0pCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBpLm4gPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSBlICYmIGUuX19lc01vZHVsZSA/IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZS5kZWZhdWx0CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIDsKICAgICAgICAgICAgICByZXR1cm4gaS5kKHQsICJhIiwgdCksCiAgICAgICAgICAgICAgdAogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgaS5vID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGkucCA9ICIvIiwKICAgICAgICAgIGkub2UgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdGhyb3cgY29uc29sZS5lcnJvcihlKSwKICAgICAgICAgICAgICBlCiAgICAgICAgICB9CiAgICAgICAgICA7CiAgICAgICAgICB2YXIgbiA9IGkoaS5zID0gRU5UUllfTU9EVUxFKTsKICAgICAgICAgIHJldHVybiBuLmRlZmF1bHQgfHwgbgogICAgICB9CiAgICAgIGZ1bmN0aW9uIHIoZSkgewogICAgICAgICAgcmV0dXJuIChlICsgIiIpLnJlcGxhY2UoL1suPyorXiRbXF1cXCgpe318LV0vZywgIlxcJCYiKQogICAgICB9CiAgICAgIGZ1bmN0aW9uIHMoZSwgdCwgbikgewogICAgICAgICAgdmFyIHMgPSB7fTsKICAgICAgICAgIHNbbl0gPSBbXTsKICAgICAgICAgIHZhciBhID0gdC50b1N0cmluZygpCiAgICAgICAgICAgICwgbyA9IGEubWF0Y2goL15mdW5jdGlvblxzP1x3KlwoXHcrLFxzKlx3KyxccyooXHcrKVwpLyk7CiAgICAgICAgICBpZiAoIW8pCiAgICAgICAgICAgICAgcmV0dXJuIHM7CiAgICAgICAgICBmb3IgKHZhciBoLCBkID0gb1sxXSwgdSA9IG5ldyBSZWdFeHAoIihcXFxcbnxcXFcpIiArIHIoZCkgKyAiXFwoXFxzKigvXFwqLio/XFwqLyk/XFxzKi4qPyhbXFwufFxcLXxcXCt8XFx3fC98QF0rKS4qP1xcKSIsImciKTsgaCA9IHUuZXhlYyhhKTsgKQogICAgICAgICAgICAgICJkbGwtcmVmZXJlbmNlIiAhPT0gaFszXSAmJiBzW25dLnB1c2goaFszXSk7CiAgICAgICAgICBmb3IgKHUgPSBuZXcgUmVnRXhwKCJcXCgiICsgcihkKSArICdcXCgiKGRsbC1yZWZlcmVuY2VcXHMoW1xcLnxcXC18XFwrfFxcd3wvfEBdKykpIlxcKVxcKVxcKFxccyooL1xcKi4qP1xcKi8pP1xccyouKj8oW1xcLnxcXC18XFwrfFxcd3wvfEBdKykuKj9cXCknLCJnIik7IGggPSB1LmV4ZWMoYSk7ICkKICAgICAgICAgICAgICBlW2hbMl1dIHx8IChzW25dLnB1c2goaFsxXSksCiAgICAgICAgICAgICAgZVtoWzJdXSA9IGkoaFsxXSkubSksCiAgICAgICAgICAgICAgc1toWzJdXSA9IHNbaFsyXV0gfHwgW10sCiAgICAgICAgICAgICAgc1toWzJdXS5wdXNoKGhbNF0pOwogICAgICAgICAgZm9yICh2YXIgXywgYyA9IE9iamVjdC5rZXlzKHMpLCBsID0gMDsgbCA8IGMubGVuZ3RoOyBsKyspCiAgICAgICAgICAgICAgZm9yICh2YXIgZiA9IDA7IGYgPCBzW2NbbF1dLmxlbmd0aDsgZisrKQogICAgICAgICAgICAgICAgICBfID0gc1tjW2xdXVtmXSwKICAgICAgICAgICAgICAgICAgaXNOYU4oMSAqIF8pIHx8IChzW2NbbF1dW2ZdID0gMSAqIHNbY1tsXV1bZl0pOwogICAgICAgICAgcmV0dXJuIHMKICAgICAgfQogICAgICBmdW5jdGlvbiBhKGUpIHsKICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhlKS5yZWR1Y2UoKGZ1bmN0aW9uKHQsIGkpIHsKICAgICAgICAgICAgICByZXR1cm4gdCB8fCBlW2ldLmxlbmd0aCA+IDAKICAgICAgICAgIH0KICAgICAgICAgICksICExKQogICAgICB9CiAgICAgIGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgIHQgPSB0IHx8IHt9OwogICAgICAgICAgdmFyIHIgPSB7CiAgICAgICAgICAgICAgbWFpbjogaS5tCiAgICAgICAgICB9CiAgICAgICAgICAgICwgbyA9IHQuYWxsID8gewogICAgICAgICAgICAgIG1haW46IE9iamVjdC5rZXlzKHIubWFpbikKICAgICAgICAgIH0gOiBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHsKICAgICAgICAgICAgICAgICAgbWFpbjogW3RdCiAgICAgICAgICAgICAgfSwgbiA9IHsKICAgICAgICAgICAgICAgICAgbWFpbjogW10KICAgICAgICAgICAgICB9LCByID0gewogICAgICAgICAgICAgICAgICBtYWluOiB7fQogICAgICAgICAgICAgIH07IGEoaSk7ICkKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbyA9IE9iamVjdC5rZXlzKGkpLCBoID0gMDsgaCA8IG8ubGVuZ3RoOyBoKyspIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gb1toXQogICAgICAgICAgICAgICAgICAgICAgICAsIHUgPSBpW2RdLnBvcCgpOwogICAgICAgICAgICAgICAgICAgICAgaWYgKHJbZF0gPSByW2RdIHx8IHt9LAogICAgICAgICAgICAgICAgICAgICAgIXJbZF1bdV0gJiYgZVtkXVt1XSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJbZF1bdV0gPSAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICBuW2RdID0gbltkXSB8fCBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICBuW2RdLnB1c2godSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgXyA9IHMoZSwgZVtkXVt1XSwgZCksIGMgPSBPYmplY3Qua2V5cyhfKSwgbCA9IDA7IGwgPCBjLmxlbmd0aDsgbCsrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpW2NbbF1dID0gaVtjW2xdXSB8fCBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaVtjW2xdXSA9IGlbY1tsXV0uY29uY2F0KF9bY1tsXV0pCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gbgogICAgICAgICAgfShyLCBlKQogICAgICAgICAgICAsIGggPSAiIjsKICAgICAgICAgIE9iamVjdC5rZXlzKG8pLmZpbHRlcigoZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHJldHVybiAibWFpbiIgIT09IGUKICAgICAgICAgIH0KICAgICAgICAgICkpLmZvckVhY2goKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBmb3IgKHZhciB0ID0gMDsgb1tlXVt0XTsgKQogICAgICAgICAgICAgICAgICB0Kys7CiAgICAgICAgICAgICAgb1tlXS5wdXNoKHQpLAogICAgICAgICAgICAgIHJbZV1bdF0gPSAiKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgeyBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX187IH0pIiwKICAgICAgICAgICAgICBoID0gaCArICJ2YXIgIiArIGUgKyAiID0gKCIgKyBuLnRvU3RyaW5nKCkucmVwbGFjZSgiRU5UUllfTU9EVUxFIiwgSlNPTi5zdHJpbmdpZnkodCkpICsgIikoeyIgKyBvW2VdLm1hcCgoZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodCkgKyAiOiAiICsgcltlXVt0XS50b1N0cmluZygpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkpLmpvaW4oIiwiKSArICJ9KTtcbiIKICAgICAgICAgIH0KICAgICAgICAgICkpLAogICAgICAgICAgaCA9IGggKyAibmV3ICgoIiArIG4udG9TdHJpbmcoKS5yZXBsYWNlKCJFTlRSWV9NT0RVTEUiLCBKU09OLnN0cmluZ2lmeShlKSkgKyAiKSh7IiArIG8ubWFpbi5tYXAoKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZSkgKyAiOiAiICsgci5tYWluW2VdLnRvU3RyaW5nKCkKICAgICAgICAgIH0KICAgICAgICAgICkpLmpvaW4oIiwiKSArICJ9KSkoc2VsZik7IjsKICAgICAgICAgIHZhciBkID0gbmV3IHdpbmRvdy5CbG9iKFtoXSx7CiAgICAgICAgICAgICAgdHlwZTogInRleHQvamF2YXNjcmlwdCIKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKHQuYmFyZSkKICAgICAgICAgICAgICByZXR1cm4gZDsKICAgICAgICAgIHZhciB1ID0gKHdpbmRvdy5VUkwgfHwgd2luZG93LndlYmtpdFVSTCB8fCB3aW5kb3cubW96VVJMIHx8IHdpbmRvdy5tc1VSTCkuY3JlYXRlT2JqZWN0VVJMKGQpCiAgICAgICAgICAgICwgXyA9IG5ldyB3aW5kb3cuV29ya2VyKHUpOwogICAgICAgICAgcmV0dXJuIF8ub2JqZWN0VVJMID0gdSwKICAgICAgICAgIF8KICAgICAgfQogIH0KICAsIGZ1bmN0aW9uKGUsIHQsIGkpIHsKICAgICAgZS5leHBvcnRzID0gaSgxOSkuZGVmYXVsdAogIH0KICAsIGZ1bmN0aW9uKGUsIHQsIGkpIHsKICAgICAgKGZ1bmN0aW9uKHQsIGkpIHsKICAgICAgICAgIC8qIQoqIEBvdmVydmlldyBlczYtcHJvbWlzZSAtIGEgdGlueSBpbXBsZW1lbnRhdGlvbiBvZiBQcm9taXNlcy9BKy4KKiBAY29weXJpZ2h0IENvcHlyaWdodCAoYykgMjAxNCBZZWh1ZGEgS2F0eiwgVG9tIERhbGUsIFN0ZWZhbiBQZW5uZXIgYW5kIGNvbnRyaWJ1dG9ycyAoQ29udmVyc2lvbiB0byBFUzYgQVBJIGJ5IEpha2UgQXJjaGliYWxkKQoqIEBsaWNlbnNlICAgTGljZW5zZWQgdW5kZXIgTUlUIGxpY2Vuc2UKKiAgICAgICAgICAgIFNlZSBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vc3RlZmFucGVubmVyL2VzNi1wcm9taXNlL21hc3Rlci9MSUNFTlNFCiogQHZlcnNpb24gICB2NC4yLjgrMWU2OGRjZTYKKi8KICAgICAgICAgIHZhciBuOwogICAgICAgICAgbiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgICAgICBmdW5jdGlvbiBlKGUpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdmFyIG4gPSBBcnJheS5pc0FycmF5ID8gQXJyYXkuaXNBcnJheSA6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICJbb2JqZWN0IEFycmF5XSIgPT09IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICwgciA9IDAKICAgICAgICAgICAgICAgICwgcyA9IHZvaWQgMAogICAgICAgICAgICAgICAgLCBhID0gdm9pZCAwCiAgICAgICAgICAgICAgICAsIG8gPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgICAgIGZbcl0gPSBlLAogICAgICAgICAgICAgICAgICBmW3IgKyAxXSA9IHQsCiAgICAgICAgICAgICAgICAgIDIgPT09IChyICs9IDIpICYmIChhID8gYShwKSA6IGIoKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAsIGggPSAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDogdm9pZCAwCiAgICAgICAgICAgICAgICAsIGQgPSBoIHx8IHt9CiAgICAgICAgICAgICAgICAsIHUgPSBkLk11dGF0aW9uT2JzZXJ2ZXIgfHwgZC5XZWJLaXRNdXRhdGlvbk9ic2VydmVyCiAgICAgICAgICAgICAgICAsIF8gPSAidW5kZWZpbmVkIiA9PSB0eXBlb2Ygc2VsZiAmJiB2b2lkIDAgIT09IHQgJiYgIltvYmplY3QgcHJvY2Vzc10iID09PSB7fS50b1N0cmluZy5jYWxsKHQpCiAgICAgICAgICAgICAgICAsIGMgPSAidW5kZWZpbmVkIiAhPSB0eXBlb2YgVWludDhDbGFtcGVkQXJyYXkgJiYgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGltcG9ydFNjcmlwdHMgJiYgInVuZGVmaW5lZCIgIT0gdHlwZW9mIE1lc3NhZ2VDaGFubmVsOwogICAgICAgICAgICAgIGZ1bmN0aW9uIGwoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBlID0gc2V0VGltZW91dDsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUocCwgMSkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB2YXIgZiA9IG5ldyBBcnJheSgxZTMpOwogICAgICAgICAgICAgIGZ1bmN0aW9uIHAoKSB7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgcjsgZSArPSAyKQogICAgICAgICAgICAgICAgICAgICAgKDAsCiAgICAgICAgICAgICAgICAgICAgICBmW2VdKShmW2UgKyAxXSksCiAgICAgICAgICAgICAgICAgICAgICBmW2VdID0gdm9pZCAwLAogICAgICAgICAgICAgICAgICAgICAgZltlICsgMV0gPSB2b2lkIDA7CiAgICAgICAgICAgICAgICAgIHIgPSAwCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHZhciBtLCBnLCB2LCB5LCBiID0gdm9pZCAwOwogICAgICAgICAgICAgIGZ1bmN0aW9uIEUoZSwgdCkgewogICAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMKICAgICAgICAgICAgICAgICAgICAsIG4gPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcihSKTsKICAgICAgICAgICAgICAgICAgdm9pZCAwID09PSBuW0FdICYmIE0obik7CiAgICAgICAgICAgICAgICAgIHZhciByID0gaS5fc3RhdGU7CiAgICAgICAgICAgICAgICAgIGlmIChyKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IGFyZ3VtZW50c1tyIC0gMV07CiAgICAgICAgICAgICAgICAgICAgICBvKChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTyhyLCBuLCBzLCBpLl9yZXN1bHQpCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICApKQogICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgIEMoaSwgbiwgZSwgdCk7CiAgICAgICAgICAgICAgICAgIHJldHVybiBuCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGZ1bmN0aW9uIFMoZSkgewogICAgICAgICAgICAgICAgICBpZiAoZSAmJiAib2JqZWN0IiA9PSB0eXBlb2YgZSAmJiBlLmNvbnN0cnVjdG9yID09PSB0aGlzKQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGU7CiAgICAgICAgICAgICAgICAgIHZhciB0ID0gbmV3IHRoaXMoUik7CiAgICAgICAgICAgICAgICAgIHJldHVybiBUKHQsIGUpLAogICAgICAgICAgICAgICAgICB0CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIF8gPyBiID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0Lm5leHRUaWNrKHApCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIDogdSA/IChnID0gMCwKICAgICAgICAgICAgICB2ID0gbmV3IHUocCksCiAgICAgICAgICAgICAgeSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCIiKSwKICAgICAgICAgICAgICB2Lm9ic2VydmUoeSwgewogICAgICAgICAgICAgICAgICBjaGFyYWN0ZXJEYXRhOiAhMAogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIGIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgeS5kYXRhID0gZyA9ICsrZyAlIDIKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKSA6IGMgPyAoKG0gPSBuZXcgTWVzc2FnZUNoYW5uZWwpLnBvcnQxLm9ubWVzc2FnZSA9IHAsCiAgICAgICAgICAgICAgYiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gbS5wb3J0Mi5wb3N0TWVzc2FnZSgwKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApIDogYiA9IHZvaWQgMCA9PT0gaCA/IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBGdW5jdGlvbigicmV0dXJuIHRoaXMiKSgpLnJlcXVpcmUoInZlcnR4Iik7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwICE9PSAocyA9IGUucnVuT25Mb29wIHx8IGUucnVuT25Db250ZXh0KSA/IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHMocCkKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIDogbCgpCiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsKCkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0oKSA6IGwoKTsKICAgICAgICAgICAgICB2YXIgQSA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyKTsKICAgICAgICAgICAgICBmdW5jdGlvbiBSKCkge30KICAgICAgICAgICAgICBmdW5jdGlvbiBMKHQsIGksIG4pIHsKICAgICAgICAgICAgICAgICAgaS5jb25zdHJ1Y3RvciA9PT0gdC5jb25zdHJ1Y3RvciAmJiBuID09PSBFICYmIGkuY29uc3RydWN0b3IucmVzb2x2ZSA9PT0gUyA/IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICAgICAgICAgIDEgPT09IHQuX3N0YXRlID8gRChlLCB0Ll9yZXN1bHQpIDogMiA9PT0gdC5fc3RhdGUgPyBrKGUsIHQuX3Jlc3VsdCkgOiBDKHQsIHZvaWQgMCwgKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVChlLCB0KQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgKSwgKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gayhlLCB0KQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgKSkKICAgICAgICAgICAgICAgICAgfSh0LCBpKSA6IHZvaWQgMCA9PT0gbiA/IEQodCwgaSkgOiBlKG4pID8gZnVuY3Rpb24oZSwgdCwgaSkgewogICAgICAgICAgICAgICAgICAgICAgbygoZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgciA9IGZ1bmN0aW9uKGUsIHQsIGksIG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuY2FsbCh0LCBpLCBuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfShpLCB0LCAoZnVuY3Rpb24oaSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuIHx8IChuID0gITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQgIT09IGkgPyBUKGUsIGkpIDogRChlLCBpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgKSwgKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiB8fCAobiA9ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrKGUsIHQpKQogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICApLCBlLl9sYWJlbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgIW4gJiYgciAmJiAobiA9ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgIGsoZSwgcikpCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICApLCBlKQogICAgICAgICAgICAgICAgICB9KHQsIGksIG4pIDogRCh0LCBpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBmdW5jdGlvbiBUKGUsIHQpIHsKICAgICAgICAgICAgICAgICAgaWYgKGUgPT09IHQpCiAgICAgICAgICAgICAgICAgICAgICBrKGUsIG5ldyBUeXBlRXJyb3IoIllvdSBjYW5ub3QgcmVzb2x2ZSBhIHByb21pc2Ugd2l0aCBpdHNlbGYiKSk7CiAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHIgPSB0eXBlb2YgKG4gPSB0KSwKICAgICAgICAgICAgICAgICAgbnVsbCA9PT0gbiB8fCAib2JqZWN0IiAhPT0gciAmJiAiZnVuY3Rpb24iICE9PSByKQogICAgICAgICAgICAgICAgICAgICAgRChlLCB0KTsKICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHZvaWQgMDsKICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaSA9IHQudGhlbgogICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIGsoZSwgdCkKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIEwoZSwgdCwgaSkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB2YXIgbiwgcgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBmdW5jdGlvbiB3KGUpIHsKICAgICAgICAgICAgICAgICAgZS5fb25lcnJvciAmJiBlLl9vbmVycm9yKGUuX3Jlc3VsdCksCiAgICAgICAgICAgICAgICAgIEkoZSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZnVuY3Rpb24gRChlLCB0KSB7CiAgICAgICAgICAgICAgICAgIHZvaWQgMCA9PT0gZS5fc3RhdGUgJiYgKGUuX3Jlc3VsdCA9IHQsCiAgICAgICAgICAgICAgICAgIGUuX3N0YXRlID0gMSwKICAgICAgICAgICAgICAgICAgMCAhPT0gZS5fc3Vic2NyaWJlcnMubGVuZ3RoICYmIG8oSSwgZSkpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGZ1bmN0aW9uIGsoZSwgdCkgewogICAgICAgICAgICAgICAgICB2b2lkIDAgPT09IGUuX3N0YXRlICYmIChlLl9zdGF0ZSA9IDIsCiAgICAgICAgICAgICAgICAgIGUuX3Jlc3VsdCA9IHQsCiAgICAgICAgICAgICAgICAgIG8odywgZSkpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGZ1bmN0aW9uIEMoZSwgdCwgaSwgbikgewogICAgICAgICAgICAgICAgICB2YXIgciA9IGUuX3N1YnNjcmliZXJzCiAgICAgICAgICAgICAgICAgICAgLCBzID0gci5sZW5ndGg7CiAgICAgICAgICAgICAgICAgIGUuX29uZXJyb3IgPSBudWxsLAogICAgICAgICAgICAgICAgICByW3NdID0gdCwKICAgICAgICAgICAgICAgICAgcltzICsgMV0gPSBpLAogICAgICAgICAgICAgICAgICByW3MgKyAyXSA9IG4sCiAgICAgICAgICAgICAgICAgIDAgPT09IHMgJiYgZS5fc3RhdGUgJiYgbyhJLCBlKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBmdW5jdGlvbiBJKGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIHQgPSBlLl9zdWJzY3JpYmVycwogICAgICAgICAgICAgICAgICAgICwgaSA9IGUuX3N0YXRlOwogICAgICAgICAgICAgICAgICBpZiAoMCAhPT0gdC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIG4gPSB2b2lkIDAsIHIgPSB2b2lkIDAsIHMgPSBlLl9yZXN1bHQsIGEgPSAwOyBhIDwgdC5sZW5ndGg7IGEgKz0gMykKICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gdFthXSwKICAgICAgICAgICAgICAgICAgICAgICAgICByID0gdFthICsgaV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgbiA/IE8oaSwgbiwgciwgcykgOiByKHMpOwogICAgICAgICAgICAgICAgICAgICAgZS5fc3Vic2NyaWJlcnMubGVuZ3RoID0gMAogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGZ1bmN0aW9uIE8odCwgaSwgbiwgcikgewogICAgICAgICAgICAgICAgICB2YXIgcyA9IGUobikKICAgICAgICAgICAgICAgICAgICAsIGEgPSB2b2lkIDAKICAgICAgICAgICAgICAgICAgICAsIG8gPSB2b2lkIDAKICAgICAgICAgICAgICAgICAgICAsIGggPSAhMDsKICAgICAgICAgICAgICAgICAgaWYgKHMpIHsKICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IG4ocikKICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgbyA9IGUKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09PSBhKQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIGsoaSwgbmV3IFR5cGVFcnJvcigiQSBwcm9taXNlcyBjYWxsYmFjayBjYW5ub3QgcmV0dXJuIHRoYXQgc2FtZSBwcm9taXNlLiIpKQogICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgIGEgPSByOwogICAgICAgICAgICAgICAgICB2b2lkIDAgIT09IGkuX3N0YXRlIHx8IChzICYmIGggPyBUKGksIGEpIDogITEgPT09IGggPyBrKGksIG8pIDogMSA9PT0gdCA/IEQoaSwgYSkgOiAyID09PSB0ICYmIGsoaSwgYSkpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHZhciBQID0gMDsKICAgICAgICAgICAgICBmdW5jdGlvbiBNKGUpIHsKICAgICAgICAgICAgICAgICAgZVtBXSA9IFArKywKICAgICAgICAgICAgICAgICAgZS5fc3RhdGUgPSB2b2lkIDAsCiAgICAgICAgICAgICAgICAgIGUuX3Jlc3VsdCA9IHZvaWQgMCwKICAgICAgICAgICAgICAgICAgZS5fc3Vic2NyaWJlcnMgPSBbXQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB2YXIgeCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICBmdW5jdGlvbiBlKGUsIHQpIHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlQ29uc3RydWN0b3IgPSBlLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9taXNlID0gbmV3IGUoUiksCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByb21pc2VbQV0gfHwgTSh0aGlzLnByb21pc2UpLAogICAgICAgICAgICAgICAgICAgICAgbih0KSA/ICh0aGlzLmxlbmd0aCA9IHQubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVtYWluaW5nID0gdC5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXN1bHQgPSBuZXcgQXJyYXkodGhpcy5sZW5ndGgpLAogICAgICAgICAgICAgICAgICAgICAgMCA9PT0gdGhpcy5sZW5ndGggPyBEKHRoaXMucHJvbWlzZSwgdGhpcy5fcmVzdWx0KSA6ICh0aGlzLmxlbmd0aCA9IHRoaXMubGVuZ3RoIHx8IDAsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9lbnVtZXJhdGUodCksCiAgICAgICAgICAgICAgICAgICAgICAwID09PSB0aGlzLl9yZW1haW5pbmcgJiYgRCh0aGlzLnByb21pc2UsIHRoaXMuX3Jlc3VsdCkpKSA6IGsodGhpcy5wcm9taXNlLCBuZXcgRXJyb3IoIkFycmF5IE1ldGhvZHMgbXVzdCBiZSBwcm92aWRlZCBhbiBBcnJheSIpKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiBlLnByb3RvdHlwZS5fZW51bWVyYXRlID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgdCA9IDA7IHZvaWQgMCA9PT0gdGhpcy5fc3RhdGUgJiYgdCA8IGUubGVuZ3RoOyB0KyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZWFjaEVudHJ5KGVbdF0sIHQpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgLAogICAgICAgICAgICAgICAgICBlLnByb3RvdHlwZS5fZWFjaEVudHJ5ID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzLl9pbnN0YW5jZUNvbnN0cnVjdG9yCiAgICAgICAgICAgICAgICAgICAgICAgICwgbiA9IGkucmVzb2x2ZTsKICAgICAgICAgICAgICAgICAgICAgIGlmIChuID09PSBTKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSB2b2lkIDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgcyA9IHZvaWQgMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBhID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IGUudGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gZQogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAociA9PT0gRSAmJiB2b2lkIDAgIT09IGUuX3N0YXRlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXR0bGVkQXQoZS5fc3RhdGUsIHQsIGUuX3Jlc3VsdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVtYWluaW5nLS0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc3VsdFt0XSA9IGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaSA9PT0gQikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IG5ldyBpKFIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID8gayhvLCBzKSA6IEwobywgZSwgciksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3dpbGxTZXR0bGVBdChvLCB0KQogICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl93aWxsU2V0dGxlQXQobmV3IGkoKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0KGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSksIHQpCiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl93aWxsU2V0dGxlQXQobihlKSwgdCkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAsCiAgICAgICAgICAgICAgICAgIGUucHJvdG90eXBlLl9zZXR0bGVkQXQgPSBmdW5jdGlvbihlLCB0LCBpKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IHRoaXMucHJvbWlzZTsKICAgICAgICAgICAgICAgICAgICAgIHZvaWQgMCA9PT0gbi5fc3RhdGUgJiYgKHRoaXMuX3JlbWFpbmluZy0tLAogICAgICAgICAgICAgICAgICAgICAgMiA9PT0gZSA/IGsobiwgaSkgOiB0aGlzLl9yZXN1bHRbdF0gPSBpKSwKICAgICAgICAgICAgICAgICAgICAgIDAgPT09IHRoaXMuX3JlbWFpbmluZyAmJiBEKG4sIHRoaXMuX3Jlc3VsdCkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAsCiAgICAgICAgICAgICAgICAgIGUucHJvdG90eXBlLl93aWxsU2V0dGxlQXQgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgICBDKGUsIHZvaWQgMCwgKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaS5fc2V0dGxlZEF0KDEsIHQsIGUpCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICApLCAoZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpLl9zZXR0bGVkQXQoMiwgdCwgZSkKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICkpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgLAogICAgICAgICAgICAgICAgICBlCiAgICAgICAgICAgICAgfSgpCiAgICAgICAgICAgICAgICAsIEIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gdChlKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzW0FdID0gUCsrLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzdWx0ID0gdGhpcy5fc3RhdGUgPSB2b2lkIDAsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdWJzY3JpYmVycyA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgUiAhPT0gZSAmJiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgZSAmJiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJZb3UgbXVzdCBwYXNzIGEgcmVzb2x2ZXIgZnVuY3Rpb24gYXMgdGhlIGZpcnN0IGFyZ3VtZW50IHRvIHRoZSBwcm9taXNlIGNvbnN0cnVjdG9yIikKICAgICAgICAgICAgICAgICAgICAgIH0oKSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMgaW5zdGFuY2VvZiB0ID8gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQoKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQoZSwgdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLCAoZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayhlLCB0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrKGUsIHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSh0aGlzLCBlKSA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkZhaWxlZCB0byBjb25zdHJ1Y3QgJ1Byb21pc2UnOiBQbGVhc2UgdXNlIHRoZSAnbmV3JyBvcGVyYXRvciwgdGhpcyBvYmplY3QgY29uc3RydWN0b3IgY2Fubm90IGJlIGNhbGxlZCBhcyBhIGZ1bmN0aW9uLiIpCiAgICAgICAgICAgICAgICAgICAgICB9KCkpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIHQucHJvdG90eXBlLmNhdGNoID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudGhlbihudWxsLCBlKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICwKICAgICAgICAgICAgICAgICAgdC5wcm90b3R5cGUuZmluYWxseSA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gdGhpcy5jb25zdHJ1Y3RvcjsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlKHQpID8gdGhpcy50aGVuKChmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkucmVzb2x2ZSh0KCkpLnRoZW4oKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZQogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICApKQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgKSwgKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaS5yZXNvbHZlKHQoKSkudGhlbigoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGUKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgKSkKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICkpIDogdGhpcy50aGVuKHQsIHQpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgLAogICAgICAgICAgICAgICAgICB0CiAgICAgICAgICAgICAgfSgpOwogICAgICAgICAgICAgIHJldHVybiBCLnByb3RvdHlwZS50aGVuID0gRSwKICAgICAgICAgICAgICBCLmFsbCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyB4KHRoaXMsZSkucHJvbWlzZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAsCiAgICAgICAgICAgICAgQi5yYWNlID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICB2YXIgdCA9IHRoaXM7CiAgICAgICAgICAgICAgICAgIHJldHVybiBuKGUpID8gbmV3IHQoKGZ1bmN0aW9uKGksIG4pIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHIgPSBlLmxlbmd0aCwgcyA9IDA7IHMgPCByOyBzKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgdC5yZXNvbHZlKGVbc10pLnRoZW4oaSwgbikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICApKSA6IG5ldyB0KChmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdChuZXcgVHlwZUVycm9yKCJZb3UgbXVzdCBwYXNzIGFuIGFycmF5IHRvIHJhY2UuIikpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgLAogICAgICAgICAgICAgIEIucmVzb2x2ZSA9IFMsCiAgICAgICAgICAgICAgQi5yZWplY3QgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgIHZhciB0ID0gbmV3IHRoaXMoUik7CiAgICAgICAgICAgICAgICAgIHJldHVybiBrKHQsIGUpLAogICAgICAgICAgICAgICAgICB0CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICwKICAgICAgICAgICAgICBCLl9zZXRTY2hlZHVsZXIgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgIGEgPSBlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICwKICAgICAgICAgICAgICBCLl9zZXRBc2FwID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICBvID0gZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAsCiAgICAgICAgICAgICAgQi5fYXNhcCA9IG8sCiAgICAgICAgICAgICAgQi5wb2x5ZmlsbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICB2YXIgZSA9IHZvaWQgMDsKICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gaSkKICAgICAgICAgICAgICAgICAgICAgIGUgPSBpOwogICAgICAgICAgICAgICAgICBlbHNlIGlmICgidW5kZWZpbmVkIiAhPSB0eXBlb2Ygc2VsZikKICAgICAgICAgICAgICAgICAgICAgIGUgPSBzZWxmOwogICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBGdW5jdGlvbigicmV0dXJuIHRoaXMiKSgpCiAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJwb2x5ZmlsbCBmYWlsZWQgYmVjYXVzZSBnbG9iYWwgb2JqZWN0IGlzIHVuYXZhaWxhYmxlIGluIHRoaXMgZW52aXJvbm1lbnQiKQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB2YXIgdCA9IGUuUHJvbWlzZTsKICAgICAgICAgICAgICAgICAgaWYgKHQpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0LnJlc29sdmUoKSkKICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIltvYmplY3QgUHJvbWlzZV0iID09PSBuICYmICF0LmNhc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZS5Qcm9taXNlID0gQgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAsCiAgICAgICAgICAgICAgQi5Qcm9taXNlID0gQiwKICAgICAgICAgICAgICBCCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLmV4cG9ydHMgPSBuKCkKICAgICAgfQogICAgICApLmNhbGwodGhpcywgaSgxNiksIGkoMTcpKQogIH0KICAsIGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgdmFyIGksIG4sIHIgPSBlLmV4cG9ydHMgPSB7fTsKICAgICAgZnVuY3Rpb24gcygpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigic2V0VGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZCIpCiAgICAgIH0KICAgICAgZnVuY3Rpb24gYSgpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiY2xlYXJUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkIikKICAgICAgfQogICAgICBmdW5jdGlvbiBvKGUpIHsKICAgICAgICAgIGlmIChpID09PSBzZXRUaW1lb3V0KQogICAgICAgICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGUsIDApOwogICAgICAgICAgaWYgKChpID09PSBzIHx8ICFpKSAmJiBzZXRUaW1lb3V0KQogICAgICAgICAgICAgIHJldHVybiBpID0gc2V0VGltZW91dCwKICAgICAgICAgICAgICBzZXRUaW1lb3V0KGUsIDApOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICByZXR1cm4gaShlLCAwKQogICAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBpLmNhbGwobnVsbCwgZSwgMCkKICAgICAgICAgICAgICB9IGNhdGNoICh0KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBpLmNhbGwodGhpcywgZSwgMCkKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0KICAgICAgIWZ1bmN0aW9uKCkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpID0gImZ1bmN0aW9uIiA9PSB0eXBlb2Ygc2V0VGltZW91dCA/IHNldFRpbWVvdXQgOiBzCiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgaSA9IHMKICAgICAgICAgIH0KICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgbiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGNsZWFyVGltZW91dCA/IGNsZWFyVGltZW91dCA6IGEKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICBuID0gYQogICAgICAgICAgfQogICAgICB9KCk7CiAgICAgIHZhciBoLCBkID0gW10sIHUgPSAhMSwgXyA9IC0xOwogICAgICBmdW5jdGlvbiBjKCkgewogICAgICAgICAgdSAmJiBoICYmICh1ID0gITEsCiAgICAgICAgICBoLmxlbmd0aCA/IGQgPSBoLmNvbmNhdChkKSA6IF8gPSAtMSwKICAgICAgICAgIGQubGVuZ3RoICYmIGwoKSkKICAgICAgfQogICAgICBmdW5jdGlvbiBsKCkgewogICAgICAgICAgaWYgKCF1KSB7CiAgICAgICAgICAgICAgdmFyIGUgPSBvKGMpOwogICAgICAgICAgICAgIHUgPSAhMDsKICAgICAgICAgICAgICBmb3IgKHZhciB0ID0gZC5sZW5ndGg7IHQ7ICkgewogICAgICAgICAgICAgICAgICBmb3IgKGggPSBkLAogICAgICAgICAgICAgICAgICBkID0gW107ICsrXyA8IHQ7ICkKICAgICAgICAgICAgICAgICAgICAgIGggJiYgaFtfXS5ydW4oKTsKICAgICAgICAgICAgICAgICAgXyA9IC0xLAogICAgICAgICAgICAgICAgICB0ID0gZC5sZW5ndGgKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaCA9IG51bGwsCiAgICAgICAgICAgICAgdSA9ICExLAogICAgICAgICAgICAgIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgaWYgKG4gPT09IGNsZWFyVGltZW91dCkKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjbGVhclRpbWVvdXQoZSk7CiAgICAgICAgICAgICAgICAgIGlmICgobiA9PT0gYSB8fCAhbikgJiYgY2xlYXJUaW1lb3V0KQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4gPSBjbGVhclRpbWVvdXQsCiAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoZSk7CiAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICBuKGUpCiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4uY2FsbChudWxsLCBlKQogICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuLmNhbGwodGhpcywgZSkKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0oZSkKICAgICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBmKGUsIHQpIHsKICAgICAgICAgIHRoaXMuZnVuID0gZSwKICAgICAgICAgIHRoaXMuYXJyYXkgPSB0CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcCgpIHt9CiAgICAgIHIubmV4dFRpY2sgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICB2YXIgdCA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7CiAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpCiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgIHRbaSAtIDFdID0gYXJndW1lbnRzW2ldOwogICAgICAgICAgZC5wdXNoKG5ldyBmKGUsdCkpLAogICAgICAgICAgMSAhPT0gZC5sZW5ndGggfHwgdSB8fCBvKGwpCiAgICAgIH0KICAgICAgLAogICAgICBmLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHRoaXMuZnVuLmFwcGx5KG51bGwsIHRoaXMuYXJyYXkpCiAgICAgIH0KICAgICAgLAogICAgICByLnRpdGxlID0gImJyb3dzZXIiLAogICAgICByLmJyb3dzZXIgPSAhMCwKICAgICAgci5lbnYgPSB7fSwKICAgICAgci5hcmd2ID0gW10sCiAgICAgIHIudmVyc2lvbiA9ICIiLAogICAgICByLnZlcnNpb25zID0ge30sCiAgICAgIHIub24gPSBwLAogICAgICByLmFkZExpc3RlbmVyID0gcCwKICAgICAgci5vbmNlID0gcCwKICAgICAgci5vZmYgPSBwLAogICAgICByLnJlbW92ZUxpc3RlbmVyID0gcCwKICAgICAgci5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBwLAogICAgICByLmVtaXQgPSBwLAogICAgICByLnByZXBlbmRMaXN0ZW5lciA9IHAsCiAgICAgIHIucHJlcGVuZE9uY2VMaXN0ZW5lciA9IHAsCiAgICAgIHIubGlzdGVuZXJzID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgcmV0dXJuIFtdCiAgICAgIH0KICAgICAgLAogICAgICByLmJpbmRpbmcgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInByb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkIikKICAgICAgfQogICAgICAsCiAgICAgIHIuY3dkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gIi8iCiAgICAgIH0KICAgICAgLAogICAgICByLmNoZGlyID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQiKQogICAgICB9CiAgICAgICwKICAgICAgci51bWFzayA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIDAKICAgICAgfQogIH0KICAsIGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgdmFyIGk7CiAgICAgIGkgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0oKTsKICAgICAgdHJ5IHsKICAgICAgICAgIGkgPSBpIHx8IG5ldyBGdW5jdGlvbigicmV0dXJuIHRoaXMiKSgpCiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICJvYmplY3QiID09IHR5cGVvZiB3aW5kb3cgJiYgKGkgPSB3aW5kb3cpCiAgICAgIH0KICAgICAgZS5leHBvcnRzID0gaQogIH0KICAsIGZ1bmN0aW9uKGUsIHQsIGkpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBpLnIodCk7CiAgICAgIHZhciBuID0gaSg5KQogICAgICAgICwgciA9IGkoMTIpCiAgICAgICAgLCBzID0gaSgxMCkKICAgICAgICAsIGEgPSBpKDEpOwogICAgICB0LmRlZmF1bHQgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICB2YXIgdCA9IG51bGwKICAgICAgICAgICAgLCBpID0gZnVuY3Rpb24odCwgaSkgewogICAgICAgICAgICAgIGUucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBtc2c6ICJsb2djYXRfY2FsbGJhY2siLAogICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0LAogICAgICAgICAgICAgICAgICAgICAgbG9nY2F0OiBpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgICAgICAgLmJpbmQodGhpcyk7CiAgICAgICAgICBmdW5jdGlvbiBvKHQsIGkpIHsKICAgICAgICAgICAgICB2YXIgbiA9IHsKICAgICAgICAgICAgICAgICAgbXNnOiBhLmEuSU5JVF9TRUdNRU5ULAogICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0LAogICAgICAgICAgICAgICAgICAgICAgZGF0YTogaQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBlLnBvc3RNZXNzYWdlKG4sIFtpLmRhdGFdKQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gaCh0LCBpKSB7CiAgICAgICAgICAgICAgdmFyIG4gPSB7CiAgICAgICAgICAgICAgICAgIG1zZzogYS5hLk1FRElBX1NFR01FTlQsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHQsCiAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGUucG9zdE1lc3NhZ2UobiwgW2kuZGF0YV0pCiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBkKCkgewogICAgICAgICAgICAgIHZhciB0ID0gewogICAgICAgICAgICAgICAgICBtc2c6IGEuYS5MT0FESU5HX0NPTVBMRVRFCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBlLnBvc3RNZXNzYWdlKHQpCiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiB1KCkgewogICAgICAgICAgICAgIHZhciB0ID0gewogICAgICAgICAgICAgICAgICBtc2c6IGEuYS5SRUNPVkVSRURfRUFSTFlfRU9GCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBlLnBvc3RNZXNzYWdlKHQpCiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBfKHQpIHsKICAgICAgICAgICAgICB2YXIgaSA9IHsKICAgICAgICAgICAgICAgICAgbXNnOiBhLmEuTUVESUFfSU5GTywKICAgICAgICAgICAgICAgICAgZGF0YTogdAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgZS5wb3N0TWVzc2FnZShpKQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gYyh0KSB7CiAgICAgICAgICAgICAgdmFyIGkgPSB7CiAgICAgICAgICAgICAgICAgIG1zZzogYS5hLk1FVEFEQVRBX0FSUklWRUQsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHQKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGUucG9zdE1lc3NhZ2UoaSkKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGwodCkgewogICAgICAgICAgICAgIHZhciBpID0gewogICAgICAgICAgICAgICAgICBtc2c6IGEuYS5TQ1JJUFREQVRBX0FSUklWRUQsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHQKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGUucG9zdE1lc3NhZ2UoaSkKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGYodCkgewogICAgICAgICAgICAgIHZhciBpID0gewogICAgICAgICAgICAgICAgICBtc2c6IGEuYS5USU1FRF9JRDNfTUVUQURBVEFfQVJSSVZFRCwKICAgICAgICAgICAgICAgICAgZGF0YTogdAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgZS5wb3N0TWVzc2FnZShpKQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gcCh0KSB7CiAgICAgICAgICAgICAgdmFyIGkgPSB7CiAgICAgICAgICAgICAgICAgIG1zZzogYS5hLlBFU19QUklWQVRFX0RBVEFfREVTQ1JJUFRPUiwKICAgICAgICAgICAgICAgICAgZGF0YTogdAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgZS5wb3N0TWVzc2FnZShpKQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gbSh0KSB7CiAgICAgICAgICAgICAgdmFyIGkgPSB7CiAgICAgICAgICAgICAgICAgIG1zZzogYS5hLlBFU19QUklWQVRFX0RBVEFfQVJSSVZFRCwKICAgICAgICAgICAgICAgICAgZGF0YTogdAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgZS5wb3N0TWVzc2FnZShpKQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gZyh0KSB7CiAgICAgICAgICAgICAgdmFyIGkgPSB7CiAgICAgICAgICAgICAgICAgIG1zZzogYS5hLlNUQVRJU1RJQ1NfSU5GTywKICAgICAgICAgICAgICAgICAgZGF0YTogdAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgZS5wb3N0TWVzc2FnZShpKQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gdih0LCBpKSB7CiAgICAgICAgICAgICAgZS5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgIG1zZzogYS5hLklPX0VSUk9SLAogICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0LAogICAgICAgICAgICAgICAgICAgICAgaW5mbzogaQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHkodCwgaSkgewogICAgICAgICAgICAgIGUucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBtc2c6IGEuYS5ERU1VWF9FUlJPUiwKICAgICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgICAgdHlwZTogdCwKICAgICAgICAgICAgICAgICAgICAgIGluZm86IGkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pCiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBiKHQpIHsKICAgICAgICAgICAgICBlLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgbXNnOiBhLmEuUkVDT01NRU5EX1NFRUtQT0lOVCwKICAgICAgICAgICAgICAgICAgZGF0YTogdAogICAgICAgICAgICAgIH0pCiAgICAgICAgICB9CiAgICAgICAgICByLmEuaW5zdGFsbCgpLAogICAgICAgICAgZS5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgKGZ1bmN0aW9uKHIpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKHIuZGF0YS5jbWQpIHsKICAgICAgICAgICAgICBjYXNlICJpbml0IjoKICAgICAgICAgICAgICAgICAgKHQgPSBuZXcgcy5hKHIuZGF0YS5wYXJhbVswXSxyLmRhdGEucGFyYW1bMV0pKS5vbihhLmEuSU9fRVJST1IsIHYuYmluZCh0aGlzKSksCiAgICAgICAgICAgICAgICAgIHQub24oYS5hLkRFTVVYX0VSUk9SLCB5LmJpbmQodGhpcykpLAogICAgICAgICAgICAgICAgICB0Lm9uKGEuYS5JTklUX1NFR01FTlQsIG8uYmluZCh0aGlzKSksCiAgICAgICAgICAgICAgICAgIHQub24oYS5hLk1FRElBX1NFR01FTlQsIGguYmluZCh0aGlzKSksCiAgICAgICAgICAgICAgICAgIHQub24oYS5hLkxPQURJTkdfQ09NUExFVEUsIGQuYmluZCh0aGlzKSksCiAgICAgICAgICAgICAgICAgIHQub24oYS5hLlJFQ09WRVJFRF9FQVJMWV9FT0YsIHUuYmluZCh0aGlzKSksCiAgICAgICAgICAgICAgICAgIHQub24oYS5hLk1FRElBX0lORk8sIF8uYmluZCh0aGlzKSksCiAgICAgICAgICAgICAgICAgIHQub24oYS5hLk1FVEFEQVRBX0FSUklWRUQsIGMuYmluZCh0aGlzKSksCiAgICAgICAgICAgICAgICAgIHQub24oYS5hLlNDUklQVERBVEFfQVJSSVZFRCwgbC5iaW5kKHRoaXMpKSwKICAgICAgICAgICAgICAgICAgdC5vbihhLmEuVElNRURfSUQzX01FVEFEQVRBX0FSUklWRUQsIGYuYmluZCh0aGlzKSksCiAgICAgICAgICAgICAgICAgIHQub24oYS5hLlBFU19QUklWQVRFX0RBVEFfREVTQ1JJUFRPUiwgcC5iaW5kKHRoaXMpKSwKICAgICAgICAgICAgICAgICAgdC5vbihhLmEuUEVTX1BSSVZBVEVfREFUQV9BUlJJVkVELCBtLmJpbmQodGhpcykpLAogICAgICAgICAgICAgICAgICB0Lm9uKGEuYS5TVEFUSVNUSUNTX0lORk8sIGcuYmluZCh0aGlzKSksCiAgICAgICAgICAgICAgICAgIHQub24oYS5hLlJFQ09NTUVORF9TRUVLUE9JTlQsIGIuYmluZCh0aGlzKSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgImRlc3Ryb3kiOgogICAgICAgICAgICAgICAgICB0ICYmICh0LmRlc3Ryb3koKSwKICAgICAgICAgICAgICAgICAgdCA9IG51bGwpLAogICAgICAgICAgICAgICAgICBlLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICAgIG1zZzogImRlc3Ryb3llZCIKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgInN0YXJ0IjoKICAgICAgICAgICAgICAgICAgdC5zdGFydCgpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJzdG9wIjoKICAgICAgICAgICAgICAgICAgdC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgInNlZWsiOgogICAgICAgICAgICAgICAgICB0LnNlZWsoci5kYXRhLnBhcmFtKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAicGF1c2UiOgogICAgICAgICAgICAgICAgICB0LnBhdXNlKCk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgInJlc3VtZSI6CiAgICAgICAgICAgICAgICAgIHQucmVzdW1lKCk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgImxvZ2dpbmdfY29uZmlnIjoKICAgICAgICAgICAgICAgICAgdmFyIEUgPSByLmRhdGEucGFyYW07CiAgICAgICAgICAgICAgICAgIG4uYS5hcHBseUNvbmZpZyhFKSwKICAgICAgICAgICAgICAgICAgITAgPT09IEUuZW5hYmxlQ2FsbGJhY2sgPyBuLmEuYWRkTG9nTGlzdGVuZXIoaSkgOiBuLmEucmVtb3ZlTG9nTGlzdGVuZXIoaSkKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICApKQogICAgICB9CiAgfQogICwgZnVuY3Rpb24oZSwgdCwgaSkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGkucih0KTsKICAgICAgdmFyIG4gPSBpKDEyKQogICAgICAgICwgciA9IGkoMTEpCiAgICAgICAgLCBzID0gewogICAgICAgICAgZW5hYmxlV29ya2VyOiAhMSwKICAgICAgICAgIGVuYWJsZVN0YXNoQnVmZmVyOiAhMCwKICAgICAgICAgIHN0YXNoSW5pdGlhbFNpemU6IHZvaWQgMCwKICAgICAgICAgIGlzTGl2ZTogITEsCiAgICAgICAgICBsaXZlQnVmZmVyTGF0ZW5jeUNoYXNpbmc6ICExLAogICAgICAgICAgbGl2ZUJ1ZmZlckxhdGVuY3lNYXhMYXRlbmN5OiAxLjUsCiAgICAgICAgICBsaXZlQnVmZmVyTGF0ZW5jeU1pblJlbWFpbjogLjUsCiAgICAgICAgICBsYXp5TG9hZDogITAsCiAgICAgICAgICBsYXp5TG9hZE1heER1cmF0aW9uOiAxODAsCiAgICAgICAgICBsYXp5TG9hZFJlY292ZXJEdXJhdGlvbjogMzAsCiAgICAgICAgICBkZWZlckxvYWRBZnRlclNvdXJjZU9wZW46ICEwLAogICAgICAgICAgYXV0b0NsZWFudXBNYXhCYWNrd2FyZER1cmF0aW9uOiAxODAsCiAgICAgICAgICBhdXRvQ2xlYW51cE1pbkJhY2t3YXJkRHVyYXRpb246IDEyMCwKICAgICAgICAgIHN0YXRpc3RpY3NJbmZvUmVwb3J0SW50ZXJ2YWw6IDYwMCwKICAgICAgICAgIGZpeEF1ZGlvVGltZXN0YW1wR2FwOiAhMCwKICAgICAgICAgIGFjY3VyYXRlU2VlazogITEsCiAgICAgICAgICBzZWVrVHlwZTogInJhbmdlIiwKICAgICAgICAgIHNlZWtQYXJhbVN0YXJ0OiAiYnN0YXJ0IiwKICAgICAgICAgIHNlZWtQYXJhbUVuZDogImJlbmQiLAogICAgICAgICAgcmFuZ2VMb2FkWmVyb1N0YXJ0OiAhMSwKICAgICAgICAgIGN1c3RvbVNlZWtIYW5kbGVyOiB2b2lkIDAsCiAgICAgICAgICByZXVzZVJlZGlyZWN0ZWRVUkw6ICExLAogICAgICAgICAgaGVhZGVyczogdm9pZCAwLAogICAgICAgICAgY3VzdG9tTG9hZGVyOiB2b2lkIDAKICAgICAgfTsKICAgICAgZnVuY3Rpb24gYSgpIHsKICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCBzKQogICAgICB9CiAgICAgIHZhciBvID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBmdW5jdGlvbiBlKCkge30KICAgICAgICAgIHJldHVybiBlLnN1cHBvcnRNU0VIMjY0UGxheWJhY2sgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gd2luZG93Lk1lZGlhU291cmNlICYmIHdpbmRvdy5NZWRpYVNvdXJjZS5pc1R5cGVTdXBwb3J0ZWQoJ3ZpZGVvL21wNDsgY29kZWNzPSJhdmMxLjQyRTAxRSxtcDRhLjQwLjIiJykKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUuc3VwcG9ydE5ldHdvcmtTdHJlYW1JTyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHZhciBlID0gbmV3IHIuYSh7fSxhKCkpCiAgICAgICAgICAgICAgICAsIHQgPSBlLmxvYWRlclR5cGU7CiAgICAgICAgICAgICAgcmV0dXJuIGUuZGVzdHJveSgpLAogICAgICAgICAgICAgICJmZXRjaC1zdHJlYW0tbG9hZGVyIiA9PSB0IHx8ICJ4aHItbW96LWNodW5rZWQtbG9hZGVyIiA9PSB0CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLmdldE5ldHdvcmtMb2FkZXJUeXBlTmFtZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHZhciBlID0gbmV3IHIuYSh7fSxhKCkpCiAgICAgICAgICAgICAgICAsIHQgPSBlLmxvYWRlclR5cGU7CiAgICAgICAgICAgICAgcmV0dXJuIGUuZGVzdHJveSgpLAogICAgICAgICAgICAgIHQKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUuc3VwcG9ydE5hdGl2ZU1lZGlhUGxheWJhY2sgPSBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgbnVsbCA9PSBlLnZpZGVvRWxlbWVudCAmJiAoZS52aWRlb0VsZW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidmlkZW8iKSk7CiAgICAgICAgICAgICAgdmFyIGkgPSBlLnZpZGVvRWxlbWVudC5jYW5QbGF5VHlwZSh0KTsKICAgICAgICAgICAgICByZXR1cm4gInByb2JhYmx5IiA9PT0gaSB8fCAibWF5YmUiID09IGkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUuZ2V0RmVhdHVyZUxpc3QgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB2YXIgdCA9IHsKICAgICAgICAgICAgICAgICAgbXNlUGxheWJhY2s6ICExLAogICAgICAgICAgICAgICAgICBtc2VMaXZlUGxheWJhY2s6ICExLAogICAgICAgICAgICAgICAgICBuZXR3b3JrU3RyZWFtSU86ICExLAogICAgICAgICAgICAgICAgICBuZXR3b3JrTG9hZGVyTmFtZTogIiIsCiAgICAgICAgICAgICAgICAgIG5hdGl2ZU1QNEgyNjRQbGF5YmFjazogITEsCiAgICAgICAgICAgICAgICAgIG5hdGl2ZVdlYm1WUDhQbGF5YmFjazogITEsCiAgICAgICAgICAgICAgICAgIG5hdGl2ZVdlYm1WUDlQbGF5YmFjazogITEKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHJldHVybiB0Lm1zZVBsYXliYWNrID0gZS5zdXBwb3J0TVNFSDI2NFBsYXliYWNrKCksCiAgICAgICAgICAgICAgdC5uZXR3b3JrU3RyZWFtSU8gPSBlLnN1cHBvcnROZXR3b3JrU3RyZWFtSU8oKSwKICAgICAgICAgICAgICB0Lm5ldHdvcmtMb2FkZXJOYW1lID0gZS5nZXROZXR3b3JrTG9hZGVyVHlwZU5hbWUoKSwKICAgICAgICAgICAgICB0Lm1zZUxpdmVQbGF5YmFjayA9IHQubXNlUGxheWJhY2sgJiYgdC5uZXR3b3JrU3RyZWFtSU8sCiAgICAgICAgICAgICAgdC5uYXRpdmVNUDRIMjY0UGxheWJhY2sgPSBlLnN1cHBvcnROYXRpdmVNZWRpYVBsYXliYWNrKCd2aWRlby9tcDQ7IGNvZGVjcz0iYXZjMS40MjAwMUUsIG1wNGEuNDAuMiInKSwKICAgICAgICAgICAgICB0Lm5hdGl2ZVdlYm1WUDhQbGF5YmFjayA9IGUuc3VwcG9ydE5hdGl2ZU1lZGlhUGxheWJhY2soJ3ZpZGVvL3dlYm07IGNvZGVjcz0idnA4LjAsIHZvcmJpcyInKSwKICAgICAgICAgICAgICB0Lm5hdGl2ZVdlYm1WUDlQbGF5YmFjayA9IGUuc3VwcG9ydE5hdGl2ZU1lZGlhUGxheWJhY2soJ3ZpZGVvL3dlYm07IGNvZGVjcz0idnA5IicpLAogICAgICAgICAgICAgIHQKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUKICAgICAgfSgpCiAgICAgICAgLCBoID0gaSgyKQogICAgICAgICwgZCA9IGkoNikKICAgICAgICAsIHUgPSBpLm4oZCkKICAgICAgICAsIF8gPSBpKDApCiAgICAgICAgLCBjID0gaSg0KQogICAgICAgICwgbCA9IHsKICAgICAgICAgIEVSUk9SOiAiZXJyb3IiLAogICAgICAgICAgTE9BRElOR19DT01QTEVURTogImxvYWRpbmdfY29tcGxldGUiLAogICAgICAgICAgUkVDT1ZFUkVEX0VBUkxZX0VPRjogInJlY292ZXJlZF9lYXJseV9lb2YiLAogICAgICAgICAgTUVESUFfSU5GTzogIm1lZGlhX2luZm8iLAogICAgICAgICAgTUVUQURBVEFfQVJSSVZFRDogIm1ldGFkYXRhX2Fycml2ZWQiLAogICAgICAgICAgU0NSSVBUREFUQV9BUlJJVkVEOiAic2NyaXB0ZGF0YV9hcnJpdmVkIiwKICAgICAgICAgIFRJTUVEX0lEM19NRVRBREFUQV9BUlJJVkVEOiAidGltZWRfaWQzX21ldGFkYXRhX2Fycml2ZWQiLAogICAgICAgICAgUEVTX1BSSVZBVEVfREFUQV9ERVNDUklQVE9SOiAicGVzX3ByaXZhdGVfZGF0YV9kZXNjcmlwdG9yIiwKICAgICAgICAgIFBFU19QUklWQVRFX0RBVEFfQVJSSVZFRDogInBlc19wcml2YXRlX2RhdGFfYXJyaXZlZCIsCiAgICAgICAgICBTVEFUSVNUSUNTX0lORk86ICJzdGF0aXN0aWNzX2luZm8iCiAgICAgIH0KICAgICAgICAsIGYgPSBpKDEzKQogICAgICAgICwgcCA9IGkubihmKQogICAgICAgICwgbSA9IGkoOSkKICAgICAgICAsIGcgPSBpKDEwKQogICAgICAgICwgdiA9IGkoMSkKICAgICAgICAsIHkgPSBpKDgpCiAgICAgICAgLCBiID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBmdW5jdGlvbiBlKGUsIHQpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5UQUcgPSAiVHJhbnNtdXhlciIsCiAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlciA9IG5ldyB1LmEsCiAgICAgICAgICAgICAgdC5lbmFibGVXb3JrZXIgJiYgInVuZGVmaW5lZCIgIT0gdHlwZW9mIFdvcmtlcikKICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3dvcmtlciA9IHAoKSgxOCksCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl93b3JrZXJEZXN0cm95aW5nID0gITEsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl93b3JrZXIuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIHRoaXMuX29uV29ya2VyTWVzc2FnZS5iaW5kKHRoaXMpKSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3dvcmtlci5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY21kOiAiaW5pdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW06IFtlLCB0XQogICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmUgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgb25Mb2dnaW5nQ29uZmlnQ2hhbmdlZDogdGhpcy5fb25Mb2dnaW5nQ29uZmlnQ2hhbmdlZC5iaW5kKHRoaXMpCiAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgbS5hLnJlZ2lzdGVyTGlzdGVuZXIodGhpcy5lLm9uTG9nZ2luZ0NvbmZpZ0NoYW5nZWQpLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fd29ya2VyLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjbWQ6ICJsb2dnaW5nX2NvbmZpZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW06IG0uYS5nZXRDb25maWcoKQogICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoaSkgewogICAgICAgICAgICAgICAgICAgICAgXy5hLmUodGhpcy5UQUcsICJFcnJvciB3aGlsZSBpbml0aWFsaXplIHRyYW5zbXV4aW5nIHdvcmtlciwgZmFsbGJhY2sgdG8gaW5saW5lIHRyYW5zbXV4aW5nIiksCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl93b3JrZXIgPSBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29udHJvbGxlciA9IG5ldyBnLmEoZSx0KQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICB0aGlzLl9jb250cm9sbGVyID0gbmV3IGcuYShlLHQpOwogICAgICAgICAgICAgIGlmICh0aGlzLl9jb250cm9sbGVyKSB7CiAgICAgICAgICAgICAgICAgIHZhciBpID0gdGhpcy5fY29udHJvbGxlcjsKICAgICAgICAgICAgICAgICAgaS5vbih2LmEuSU9fRVJST1IsIHRoaXMuX29uSU9FcnJvci5iaW5kKHRoaXMpKSwKICAgICAgICAgICAgICAgICAgaS5vbih2LmEuREVNVVhfRVJST1IsIHRoaXMuX29uRGVtdXhFcnJvci5iaW5kKHRoaXMpKSwKICAgICAgICAgICAgICAgICAgaS5vbih2LmEuSU5JVF9TRUdNRU5ULCB0aGlzLl9vbkluaXRTZWdtZW50LmJpbmQodGhpcykpLAogICAgICAgICAgICAgICAgICBpLm9uKHYuYS5NRURJQV9TRUdNRU5ULCB0aGlzLl9vbk1lZGlhU2VnbWVudC5iaW5kKHRoaXMpKSwKICAgICAgICAgICAgICAgICAgaS5vbih2LmEuTE9BRElOR19DT01QTEVURSwgdGhpcy5fb25Mb2FkaW5nQ29tcGxldGUuYmluZCh0aGlzKSksCiAgICAgICAgICAgICAgICAgIGkub24odi5hLlJFQ09WRVJFRF9FQVJMWV9FT0YsIHRoaXMuX29uUmVjb3ZlcmVkRWFybHlFb2YuYmluZCh0aGlzKSksCiAgICAgICAgICAgICAgICAgIGkub24odi5hLk1FRElBX0lORk8sIHRoaXMuX29uTWVkaWFJbmZvLmJpbmQodGhpcykpLAogICAgICAgICAgICAgICAgICBpLm9uKHYuYS5NRVRBREFUQV9BUlJJVkVELCB0aGlzLl9vbk1ldGFEYXRhQXJyaXZlZC5iaW5kKHRoaXMpKSwKICAgICAgICAgICAgICAgICAgaS5vbih2LmEuU0NSSVBUREFUQV9BUlJJVkVELCB0aGlzLl9vblNjcmlwdERhdGFBcnJpdmVkLmJpbmQodGhpcykpLAogICAgICAgICAgICAgICAgICBpLm9uKHYuYS5USU1FRF9JRDNfTUVUQURBVEFfQVJSSVZFRCwgdGhpcy5fb25UaW1lZElEM01ldGFkYXRhQXJyaXZlZC5iaW5kKHRoaXMpKSwKICAgICAgICAgICAgICAgICAgaS5vbih2LmEuUEVTX1BSSVZBVEVfREFUQV9ERVNDUklQVE9SLCB0aGlzLl9vblBFU1ByaXZhdGVEYXRhRGVzY3JpcHRvci5iaW5kKHRoaXMpKSwKICAgICAgICAgICAgICAgICAgaS5vbih2LmEuUEVTX1BSSVZBVEVfREFUQV9BUlJJVkVELCB0aGlzLl9vblBFU1ByaXZhdGVEYXRhQXJyaXZlZC5iaW5kKHRoaXMpKSwKICAgICAgICAgICAgICAgICAgaS5vbih2LmEuU1RBVElTVElDU19JTkZPLCB0aGlzLl9vblN0YXRpc3RpY3NJbmZvLmJpbmQodGhpcykpLAogICAgICAgICAgICAgICAgICBpLm9uKHYuYS5SRUNPTU1FTkRfU0VFS1BPSU5ULCB0aGlzLl9vblJlY29tbWVuZFNlZWtwb2ludC5iaW5kKHRoaXMpKQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBlLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5fd29ya2VyID8gdGhpcy5fd29ya2VyRGVzdHJveWluZyB8fCAodGhpcy5fd29ya2VyRGVzdHJveWluZyA9ICEwLAogICAgICAgICAgICAgIHRoaXMuX3dvcmtlci5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgIGNtZDogImRlc3Ryb3kiCiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgbS5hLnJlbW92ZUxpc3RlbmVyKHRoaXMuZS5vbkxvZ2dpbmdDb25maWdDaGFuZ2VkKSwKICAgICAgICAgICAgICB0aGlzLmUgPSBudWxsKSA6ICh0aGlzLl9jb250cm9sbGVyLmRlc3Ryb3koKSwKICAgICAgICAgICAgICB0aGlzLl9jb250cm9sbGVyID0gbnVsbCksCiAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5yZW1vdmVBbGxMaXN0ZW5lcnMoKSwKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyID0gbnVsbAogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUub24gPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5hZGRMaXN0ZW5lcihlLCB0KQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUub2ZmID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgIHRoaXMuX2VtaXR0ZXIucmVtb3ZlTGlzdGVuZXIoZSwgdCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLmhhc1dvcmtlciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiBudWxsICE9IHRoaXMuX3dvcmtlcgogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX3dvcmtlciA/IHRoaXMuX3dvcmtlci5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgIGNtZDogInN0YXJ0IgogICAgICAgICAgICAgIH0pIDogdGhpcy5fY29udHJvbGxlci5zdGFydCgpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX3dvcmtlciA/IHRoaXMuX3dvcmtlci5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgIGNtZDogInN0b3AiCiAgICAgICAgICAgICAgfSkgOiB0aGlzLl9jb250cm9sbGVyLnN0b3AoKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuc2VlayA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB0aGlzLl93b3JrZXIgPyB0aGlzLl93b3JrZXIucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBjbWQ6ICJzZWVrIiwKICAgICAgICAgICAgICAgICAgcGFyYW06IGUKICAgICAgICAgICAgICB9KSA6IHRoaXMuX2NvbnRyb2xsZXIuc2VlayhlKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0aGlzLl93b3JrZXIgPyB0aGlzLl93b3JrZXIucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBjbWQ6ICJwYXVzZSIKICAgICAgICAgICAgICB9KSA6IHRoaXMuX2NvbnRyb2xsZXIucGF1c2UoKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUucmVzdW1lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5fd29ya2VyID8gdGhpcy5fd29ya2VyLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgY21kOiAicmVzdW1lIgogICAgICAgICAgICAgIH0pIDogdGhpcy5fY29udHJvbGxlci5yZXN1bWUoKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX29uSW5pdFNlZ21lbnQgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzOwogICAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICBpLl9lbWl0dGVyLmVtaXQodi5hLklOSVRfU0VHTUVOVCwgZSwgdCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vbk1lZGlhU2VnbWVudCA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICB2YXIgaSA9IHRoaXM7CiAgICAgICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIGkuX2VtaXR0ZXIuZW1pdCh2LmEuTUVESUFfU0VHTUVOVCwgZSwgdCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vbkxvYWRpbmdDb21wbGV0ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHZhciBlID0gdGhpczsKICAgICAgICAgICAgICBQcm9taXNlLnJlc29sdmUoKS50aGVuKChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgZS5fZW1pdHRlci5lbWl0KHYuYS5MT0FESU5HX0NPTVBMRVRFKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX29uUmVjb3ZlcmVkRWFybHlFb2YgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB2YXIgZSA9IHRoaXM7CiAgICAgICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIGUuX2VtaXR0ZXIuZW1pdCh2LmEuUkVDT1ZFUkVEX0VBUkxZX0VPRikKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vbk1lZGlhSW5mbyA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB2YXIgdCA9IHRoaXM7CiAgICAgICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHQuX2VtaXR0ZXIuZW1pdCh2LmEuTUVESUFfSU5GTywgZSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vbk1ldGFEYXRhQXJyaXZlZCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB2YXIgdCA9IHRoaXM7CiAgICAgICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHQuX2VtaXR0ZXIuZW1pdCh2LmEuTUVUQURBVEFfQVJSSVZFRCwgZSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vblNjcmlwdERhdGFBcnJpdmVkID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHZhciB0ID0gdGhpczsKICAgICAgICAgICAgICBQcm9taXNlLnJlc29sdmUoKS50aGVuKChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgdC5fZW1pdHRlci5lbWl0KHYuYS5TQ1JJUFREQVRBX0FSUklWRUQsIGUpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fb25UaW1lZElEM01ldGFkYXRhQXJyaXZlZCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB2YXIgdCA9IHRoaXM7CiAgICAgICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHQuX2VtaXR0ZXIuZW1pdCh2LmEuVElNRURfSUQzX01FVEFEQVRBX0FSUklWRUQsIGUpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fb25QRVNQcml2YXRlRGF0YURlc2NyaXB0b3IgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzOwogICAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICB0Ll9lbWl0dGVyLmVtaXQodi5hLlBFU19QUklWQVRFX0RBVEFfREVTQ1JJUFRPUiwgZSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vblBFU1ByaXZhdGVEYXRhQXJyaXZlZCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB2YXIgdCA9IHRoaXM7CiAgICAgICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHQuX2VtaXR0ZXIuZW1pdCh2LmEuUEVTX1BSSVZBVEVfREFUQV9BUlJJVkVELCBlKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX29uU3RhdGlzdGljc0luZm8gPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzOwogICAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICB0Ll9lbWl0dGVyLmVtaXQodi5hLlNUQVRJU1RJQ1NfSU5GTywgZSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vbklPRXJyb3IgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzOwogICAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICBpLl9lbWl0dGVyLmVtaXQodi5hLklPX0VSUk9SLCBlLCB0KQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX29uRGVtdXhFcnJvciA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICB2YXIgaSA9IHRoaXM7CiAgICAgICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIGkuX2VtaXR0ZXIuZW1pdCh2LmEuREVNVVhfRVJST1IsIGUsIHQpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fb25SZWNvbW1lbmRTZWVrcG9pbnQgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzOwogICAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICB0Ll9lbWl0dGVyLmVtaXQodi5hLlJFQ09NTUVORF9TRUVLUE9JTlQsIGUpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fb25Mb2dnaW5nQ29uZmlnQ2hhbmdlZCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB0aGlzLl93b3JrZXIgJiYgdGhpcy5fd29ya2VyLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgY21kOiAibG9nZ2luZ19jb25maWciLAogICAgICAgICAgICAgICAgICBwYXJhbTogZQogICAgICAgICAgICAgIH0pCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fb25Xb3JrZXJNZXNzYWdlID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHZhciB0ID0gZS5kYXRhCiAgICAgICAgICAgICAgICAsIGkgPSB0LmRhdGE7CiAgICAgICAgICAgICAgaWYgKCJkZXN0cm95ZWQiID09PSB0Lm1zZyB8fCB0aGlzLl93b3JrZXJEZXN0cm95aW5nKQogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fd29ya2VyRGVzdHJveWluZyA9ICExLAogICAgICAgICAgICAgICAgICB0aGlzLl93b3JrZXIudGVybWluYXRlKCksCiAgICAgICAgICAgICAgICAgIHZvaWQgKHRoaXMuX3dvcmtlciA9IG51bGwpOwogICAgICAgICAgICAgIHN3aXRjaCAodC5tc2cpIHsKICAgICAgICAgICAgICBjYXNlIHYuYS5JTklUX1NFR01FTlQ6CiAgICAgICAgICAgICAgY2FzZSB2LmEuTUVESUFfU0VHTUVOVDoKICAgICAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5lbWl0KHQubXNnLCBpLnR5cGUsIGkuZGF0YSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2Ugdi5hLkxPQURJTkdfQ09NUExFVEU6CiAgICAgICAgICAgICAgY2FzZSB2LmEuUkVDT1ZFUkVEX0VBUkxZX0VPRjoKICAgICAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5lbWl0KHQubXNnKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSB2LmEuTUVESUFfSU5GTzoKICAgICAgICAgICAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKGksIHkuYS5wcm90b3R5cGUpLAogICAgICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyLmVtaXQodC5tc2csIGkpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIHYuYS5NRVRBREFUQV9BUlJJVkVEOgogICAgICAgICAgICAgIGNhc2Ugdi5hLlNDUklQVERBVEFfQVJSSVZFRDoKICAgICAgICAgICAgICBjYXNlIHYuYS5USU1FRF9JRDNfTUVUQURBVEFfQVJSSVZFRDoKICAgICAgICAgICAgICBjYXNlIHYuYS5QRVNfUFJJVkFURV9EQVRBX0RFU0NSSVBUT1I6CiAgICAgICAgICAgICAgY2FzZSB2LmEuUEVTX1BSSVZBVEVfREFUQV9BUlJJVkVEOgogICAgICAgICAgICAgIGNhc2Ugdi5hLlNUQVRJU1RJQ1NfSU5GTzoKICAgICAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5lbWl0KHQubXNnLCBpKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSB2LmEuSU9fRVJST1I6CiAgICAgICAgICAgICAgY2FzZSB2LmEuREVNVVhfRVJST1I6CiAgICAgICAgICAgICAgICAgIHRoaXMuX2VtaXR0ZXIuZW1pdCh0Lm1zZywgaS50eXBlLCBpLmluZm8pOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIHYuYS5SRUNPTU1FTkRfU0VFS1BPSU5UOgogICAgICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyLmVtaXQodC5tc2csIGkpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJsb2djYXRfY2FsbGJhY2siOgogICAgICAgICAgICAgICAgICBfLmEuZW1pdHRlci5lbWl0KCJsb2ciLCBpLnR5cGUsIGkubG9nY2F0KQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUKICAgICAgfSgpCiAgICAgICAgLCBFID0gewogICAgICAgICAgRVJST1I6ICJlcnJvciIsCiAgICAgICAgICBTT1VSQ0VfT1BFTjogInNvdXJjZV9vcGVuIiwKICAgICAgICAgIFVQREFURV9FTkQ6ICJ1cGRhdGVfZW5kIiwKICAgICAgICAgIEJVRkZFUl9GVUxMOiAiYnVmZmVyX2Z1bGwiCiAgICAgIH0KICAgICAgICAsIFMgPSBpKDcpCiAgICAgICAgLCBBID0gaSgzKQogICAgICAgICwgUiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgZnVuY3Rpb24gZShlKSB7CiAgICAgICAgICAgICAgdGhpcy5UQUcgPSAiTVNFQ29udHJvbGxlciIsCiAgICAgICAgICAgICAgdGhpcy5fY29uZmlnID0gZSwKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyID0gbmV3IHUuYSwKICAgICAgICAgICAgICB0aGlzLl9jb25maWcuaXNMaXZlICYmIG51bGwgPT0gdGhpcy5fY29uZmlnLmF1dG9DbGVhbnVwU291cmNlQnVmZmVyICYmICh0aGlzLl9jb25maWcuYXV0b0NsZWFudXBTb3VyY2VCdWZmZXIgPSAhMCksCiAgICAgICAgICAgICAgdGhpcy5lID0gewogICAgICAgICAgICAgICAgICBvblNvdXJjZU9wZW46IHRoaXMuX29uU291cmNlT3Blbi5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgICBvblNvdXJjZUVuZGVkOiB0aGlzLl9vblNvdXJjZUVuZGVkLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICAgIG9uU291cmNlQ2xvc2U6IHRoaXMuX29uU291cmNlQ2xvc2UuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgICAgb25Tb3VyY2VCdWZmZXJFcnJvcjogdGhpcy5fb25Tb3VyY2VCdWZmZXJFcnJvci5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgICBvblNvdXJjZUJ1ZmZlclVwZGF0ZUVuZDogdGhpcy5fb25Tb3VyY2VCdWZmZXJVcGRhdGVFbmQuYmluZCh0aGlzKQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgdGhpcy5fbWVkaWFTb3VyY2UgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX21lZGlhU291cmNlT2JqZWN0VVJMID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9tZWRpYUVsZW1lbnQgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX2lzQnVmZmVyRnVsbCA9ICExLAogICAgICAgICAgICAgIHRoaXMuX2hhc1BlbmRpbmdFb3MgPSAhMSwKICAgICAgICAgICAgICB0aGlzLl9yZXF1aXJlU2V0TWVkaWFEdXJhdGlvbiA9ICExLAogICAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdNZWRpYUR1cmF0aW9uID0gMCwKICAgICAgICAgICAgICB0aGlzLl9wZW5kaW5nU291cmNlQnVmZmVySW5pdCA9IFtdLAogICAgICAgICAgICAgIHRoaXMuX21pbWVUeXBlcyA9IHsKICAgICAgICAgICAgICAgICAgdmlkZW86IG51bGwsCiAgICAgICAgICAgICAgICAgIGF1ZGlvOiBudWxsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB0aGlzLl9zb3VyY2VCdWZmZXJzID0gewogICAgICAgICAgICAgICAgICB2aWRlbzogbnVsbCwKICAgICAgICAgICAgICAgICAgYXVkaW86IG51bGwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHRoaXMuX2xhc3RJbml0U2VnbWVudHMgPSB7CiAgICAgICAgICAgICAgICAgIHZpZGVvOiBudWxsLAogICAgICAgICAgICAgICAgICBhdWRpbzogbnVsbAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgdGhpcy5fcGVuZGluZ1NlZ21lbnRzID0gewogICAgICAgICAgICAgICAgICB2aWRlbzogW10sCiAgICAgICAgICAgICAgICAgIGF1ZGlvOiBbXQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgdGhpcy5fcGVuZGluZ1JlbW92ZVJhbmdlcyA9IHsKICAgICAgICAgICAgICAgICAgdmlkZW86IFtdLAogICAgICAgICAgICAgICAgICBhdWRpbzogW10KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHRoaXMuX2lkckxpc3QgPSBuZXcgUy5hCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICh0aGlzLl9tZWRpYUVsZW1lbnQgfHwgdGhpcy5fbWVkaWFTb3VyY2UpICYmIHRoaXMuZGV0YWNoTWVkaWFFbGVtZW50KCksCiAgICAgICAgICAgICAgdGhpcy5lID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyLnJlbW92ZUFsbExpc3RlbmVycygpLAogICAgICAgICAgICAgIHRoaXMuX2VtaXR0ZXIgPSBudWxsCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyLmFkZExpc3RlbmVyKGUsIHQpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5yZW1vdmVMaXN0ZW5lcihlLCB0KQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuYXR0YWNoTWVkaWFFbGVtZW50ID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGlmICh0aGlzLl9tZWRpYVNvdXJjZSkKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEEuYSgiTWVkaWFTb3VyY2UgaGFzIGJlZW4gYXR0YWNoZWQgdG8gYW4gSFRNTE1lZGlhRWxlbWVudCEiKTsKICAgICAgICAgICAgICB2YXIgdCA9IHRoaXMuX21lZGlhU291cmNlID0gbmV3IHdpbmRvdy5NZWRpYVNvdXJjZTsKICAgICAgICAgICAgICB0LmFkZEV2ZW50TGlzdGVuZXIoInNvdXJjZW9wZW4iLCB0aGlzLmUub25Tb3VyY2VPcGVuKSwKICAgICAgICAgICAgICB0LmFkZEV2ZW50TGlzdGVuZXIoInNvdXJjZWVuZGVkIiwgdGhpcy5lLm9uU291cmNlRW5kZWQpLAogICAgICAgICAgICAgIHQuYWRkRXZlbnRMaXN0ZW5lcigic291cmNlY2xvc2UiLCB0aGlzLmUub25Tb3VyY2VDbG9zZSksCiAgICAgICAgICAgICAgdGhpcy5fbWVkaWFFbGVtZW50ID0gZSwKICAgICAgICAgICAgICB0aGlzLl9tZWRpYVNvdXJjZU9iamVjdFVSTCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKHRoaXMuX21lZGlhU291cmNlKSwKICAgICAgICAgICAgICBlLnNyYyA9IHRoaXMuX21lZGlhU291cmNlT2JqZWN0VVJMCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5kZXRhY2hNZWRpYUVsZW1lbnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5fbWVkaWFTb3VyY2UpIHsKICAgICAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLl9tZWRpYVNvdXJjZTsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgdCBpbiB0aGlzLl9zb3VyY2VCdWZmZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMuX3BlbmRpbmdTZWdtZW50c1t0XTsKICAgICAgICAgICAgICAgICAgICAgIGkuc3BsaWNlKDAsIGkubGVuZ3RoKSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdTZWdtZW50c1t0XSA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wZW5kaW5nUmVtb3ZlUmFuZ2VzW3RdID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RJbml0U2VnbWVudHNbdF0gPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSB0aGlzLl9zb3VyY2VCdWZmZXJzW3RdOwogICAgICAgICAgICAgICAgICAgICAgaWYgKG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoImNsb3NlZCIgIT09IGUucmVhZHlTdGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5yZW1vdmVTb3VyY2VCdWZmZXIobikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5hLmUodGhpcy5UQUcsIGUubWVzc2FnZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnJlbW92ZUV2ZW50TGlzdGVuZXIoImVycm9yIiwgdGhpcy5lLm9uU291cmNlQnVmZmVyRXJyb3IpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnJlbW92ZUV2ZW50TGlzdGVuZXIoInVwZGF0ZWVuZCIsIHRoaXMuZS5vblNvdXJjZUJ1ZmZlclVwZGF0ZUVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWltZVR5cGVzW3RdID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zb3VyY2VCdWZmZXJzW3RdID0gbnVsbAogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmICgib3BlbiIgPT09IGUucmVhZHlTdGF0ZSkKICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZS5lbmRPZlN0cmVhbSgpCiAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgXy5hLmUodGhpcy5UQUcsIGUubWVzc2FnZSkKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZS5yZW1vdmVFdmVudExpc3RlbmVyKCJzb3VyY2VvcGVuIiwgdGhpcy5lLm9uU291cmNlT3BlbiksCiAgICAgICAgICAgICAgICAgIGUucmVtb3ZlRXZlbnRMaXN0ZW5lcigic291cmNlZW5kZWQiLCB0aGlzLmUub25Tb3VyY2VFbmRlZCksCiAgICAgICAgICAgICAgICAgIGUucmVtb3ZlRXZlbnRMaXN0ZW5lcigic291cmNlY2xvc2UiLCB0aGlzLmUub25Tb3VyY2VDbG9zZSksCiAgICAgICAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdTb3VyY2VCdWZmZXJJbml0ID0gW10sCiAgICAgICAgICAgICAgICAgIHRoaXMuX2lzQnVmZmVyRnVsbCA9ICExLAogICAgICAgICAgICAgICAgICB0aGlzLl9pZHJMaXN0LmNsZWFyKCksCiAgICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhU291cmNlID0gbnVsbAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLl9tZWRpYUVsZW1lbnQgJiYgKHRoaXMuX21lZGlhRWxlbWVudC5zcmMgPSAiIiwKICAgICAgICAgICAgICB0aGlzLl9tZWRpYUVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCJzcmMiKSwKICAgICAgICAgICAgICB0aGlzLl9tZWRpYUVsZW1lbnQgPSBudWxsKSwKICAgICAgICAgICAgICB0aGlzLl9tZWRpYVNvdXJjZU9iamVjdFVSTCAmJiAod2luZG93LlVSTC5yZXZva2VPYmplY3RVUkwodGhpcy5fbWVkaWFTb3VyY2VPYmplY3RVUkwpLAogICAgICAgICAgICAgIHRoaXMuX21lZGlhU291cmNlT2JqZWN0VVJMID0gbnVsbCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLmFwcGVuZEluaXRTZWdtZW50ID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICAgIGlmICghdGhpcy5fbWVkaWFTb3VyY2UgfHwgIm9wZW4iICE9PSB0aGlzLl9tZWRpYVNvdXJjZS5yZWFkeVN0YXRlKQogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcGVuZGluZ1NvdXJjZUJ1ZmZlckluaXQucHVzaChlKSwKICAgICAgICAgICAgICAgICAgdm9pZCB0aGlzLl9wZW5kaW5nU2VnbWVudHNbZS50eXBlXS5wdXNoKGUpOwogICAgICAgICAgICAgIHZhciBpID0gZQogICAgICAgICAgICAgICAgLCBuID0gIiIgKyBpLmNvbnRhaW5lcjsKICAgICAgICAgICAgICBpLmNvZGVjICYmIGkuY29kZWMubGVuZ3RoID4gMCAmJiAobiArPSAiO2NvZGVjcz0iICsgaS5jb2RlYyk7CiAgICAgICAgICAgICAgdmFyIHIgPSAhMTsKICAgICAgICAgICAgICBpZiAoXy5hLnYodGhpcy5UQUcsICJSZWNlaXZlZCBJbml0aWFsaXphdGlvbiBTZWdtZW50LCBtaW1lVHlwZTogIiArIG4pLAogICAgICAgICAgICAgIHRoaXMuX2xhc3RJbml0U2VnbWVudHNbaS50eXBlXSA9IGksCiAgICAgICAgICAgICAgbiAhPT0gdGhpcy5fbWltZVR5cGVzW2kudHlwZV0pIHsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX21pbWVUeXBlc1tpLnR5cGVdKQogICAgICAgICAgICAgICAgICAgICAgXy5hLnYodGhpcy5UQUcsICJOb3RpY2U6ICIgKyBpLnR5cGUgKyAiIG1pbWVUeXBlIGNoYW5nZWQsIG9yaWdpbjogIiArIHRoaXMuX21pbWVUeXBlc1tpLnR5cGVdICsgIiwgdGFyZ2V0OiAiICsgbik7CiAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgciA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IHRoaXMuX3NvdXJjZUJ1ZmZlcnNbaS50eXBlXSA9IHRoaXMuX21lZGlhU291cmNlLmFkZFNvdXJjZUJ1ZmZlcihuKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBzLmFkZEV2ZW50TGlzdGVuZXIoImVycm9yIiwgdGhpcy5lLm9uU291cmNlQnVmZmVyRXJyb3IpLAogICAgICAgICAgICAgICAgICAgICAgICAgIHMuYWRkRXZlbnRMaXN0ZW5lcigidXBkYXRlZW5kIiwgdGhpcy5lLm9uU291cmNlQnVmZmVyVXBkYXRlRW5kKQogICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfLmEuZSh0aGlzLlRBRywgZS5tZXNzYWdlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIHRoaXMuX2VtaXR0ZXIuZW1pdChFLkVSUk9SLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGUuY29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnOiBlLm1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHRoaXMuX21pbWVUeXBlc1tpLnR5cGVdID0gbgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0IHx8IHRoaXMuX3BlbmRpbmdTZWdtZW50c1tpLnR5cGVdLnB1c2goaSksCiAgICAgICAgICAgICAgciB8fCB0aGlzLl9zb3VyY2VCdWZmZXJzW2kudHlwZV0gJiYgIXRoaXMuX3NvdXJjZUJ1ZmZlcnNbaS50eXBlXS51cGRhdGluZyAmJiB0aGlzLl9kb0FwcGVuZFNlZ21lbnRzKCksCiAgICAgICAgICAgICAgYy5hLnNhZmFyaSAmJiAiYXVkaW8vbXBlZyIgPT09IGkuY29udGFpbmVyICYmIGkubWVkaWFEdXJhdGlvbiA+IDAgJiYgKHRoaXMuX3JlcXVpcmVTZXRNZWRpYUR1cmF0aW9uID0gITAsCiAgICAgICAgICAgICAgdGhpcy5fcGVuZGluZ01lZGlhRHVyYXRpb24gPSBpLm1lZGlhRHVyYXRpb24gLyAxZTMsCiAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlTWVkaWFTb3VyY2VEdXJhdGlvbigpKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuYXBwZW5kTWVkaWFTZWdtZW50ID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHZhciB0ID0gZTsKICAgICAgICAgICAgICB0aGlzLl9wZW5kaW5nU2VnbWVudHNbdC50eXBlXS5wdXNoKHQpLAogICAgICAgICAgICAgIHRoaXMuX2NvbmZpZy5hdXRvQ2xlYW51cFNvdXJjZUJ1ZmZlciAmJiB0aGlzLl9uZWVkQ2xlYW51cFNvdXJjZUJ1ZmZlcigpICYmIHRoaXMuX2RvQ2xlYW51cFNvdXJjZUJ1ZmZlcigpOwogICAgICAgICAgICAgIHZhciBpID0gdGhpcy5fc291cmNlQnVmZmVyc1t0LnR5cGVdOwogICAgICAgICAgICAgICFpIHx8IGkudXBkYXRpbmcgfHwgdGhpcy5faGFzUGVuZGluZ1JlbW92ZVJhbmdlcygpIHx8IHRoaXMuX2RvQXBwZW5kU2VnbWVudHMoKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuc2VlayA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBmb3IgKHZhciB0IGluIHRoaXMuX3NvdXJjZUJ1ZmZlcnMpCiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zb3VyY2VCdWZmZXJzW3RdKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMuX3NvdXJjZUJ1ZmZlcnNbdF07CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIm9wZW4iID09PSB0aGlzLl9tZWRpYVNvdXJjZS5yZWFkeVN0YXRlKQogICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYWJvcnQoKQogICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5hLmUodGhpcy5UQUcsIGUubWVzc2FnZSkKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pZHJMaXN0LmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IHRoaXMuX3BlbmRpbmdTZWdtZW50c1t0XTsKICAgICAgICAgICAgICAgICAgICAgIGlmIChuLnNwbGljZSgwLCBuLmxlbmd0aCksCiAgICAgICAgICAgICAgICAgICAgICAiY2xvc2VkIiAhPT0gdGhpcy5fbWVkaWFTb3VyY2UucmVhZHlTdGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgaS5idWZmZXJlZC5sZW5ndGg7IHIrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IGkuYnVmZmVyZWQuc3RhcnQocikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIGEgPSBpLmJ1ZmZlcmVkLmVuZChyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGVuZGluZ1JlbW92ZVJhbmdlc1t0XS5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpLnVwZGF0aW5nIHx8IHRoaXMuX2RvUmVtb3ZlUmFuZ2VzKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgYy5hLnNhZmFyaSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IHRoaXMuX2xhc3RJbml0U2VnbWVudHNbdF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8gJiYgKHRoaXMuX3BlbmRpbmdTZWdtZW50c1t0XS5wdXNoKG8pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLnVwZGF0aW5nIHx8IHRoaXMuX2RvQXBwZW5kU2VnbWVudHMoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLmVuZE9mU3RyZWFtID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLl9tZWRpYVNvdXJjZQogICAgICAgICAgICAgICAgLCB0ID0gdGhpcy5fc291cmNlQnVmZmVyczsKICAgICAgICAgICAgICBlICYmICJvcGVuIiA9PT0gZS5yZWFkeVN0YXRlID8gdC52aWRlbyAmJiB0LnZpZGVvLnVwZGF0aW5nIHx8IHQuYXVkaW8gJiYgdC5hdWRpby51cGRhdGluZyA/IHRoaXMuX2hhc1BlbmRpbmdFb3MgPSAhMCA6ICh0aGlzLl9oYXNQZW5kaW5nRW9zID0gITEsCiAgICAgICAgICAgICAgZS5lbmRPZlN0cmVhbSgpKSA6IGUgJiYgImNsb3NlZCIgPT09IGUucmVhZHlTdGF0ZSAmJiB0aGlzLl9oYXNQZW5kaW5nU2VnbWVudHMoKSAmJiAodGhpcy5faGFzUGVuZGluZ0VvcyA9ICEwKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuZ2V0TmVhcmVzdEtleWZyYW1lID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pZHJMaXN0LmdldExhc3RTeW5jUG9pbnRCZWZvcmVEdHMoZSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9uZWVkQ2xlYW51cFNvdXJjZUJ1ZmZlciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIGlmICghdGhpcy5fY29uZmlnLmF1dG9DbGVhbnVwU291cmNlQnVmZmVyKQogICAgICAgICAgICAgICAgICByZXR1cm4gITE7CiAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLl9tZWRpYUVsZW1lbnQuY3VycmVudFRpbWU7CiAgICAgICAgICAgICAgZm9yICh2YXIgdCBpbiB0aGlzLl9zb3VyY2VCdWZmZXJzKSB7CiAgICAgICAgICAgICAgICAgIHZhciBpID0gdGhpcy5fc291cmNlQnVmZmVyc1t0XTsKICAgICAgICAgICAgICAgICAgaWYgKGkpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gaS5idWZmZXJlZDsKICAgICAgICAgICAgICAgICAgICAgIGlmIChuLmxlbmd0aCA+PSAxICYmIGUgLSBuLnN0YXJ0KDApID49IHRoaXMuX2NvbmZpZy5hdXRvQ2xlYW51cE1heEJhY2t3YXJkRHVyYXRpb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fZG9DbGVhbnVwU291cmNlQnVmZmVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLl9tZWRpYUVsZW1lbnQuY3VycmVudFRpbWU7CiAgICAgICAgICAgICAgZm9yICh2YXIgdCBpbiB0aGlzLl9zb3VyY2VCdWZmZXJzKSB7CiAgICAgICAgICAgICAgICAgIHZhciBpID0gdGhpcy5fc291cmNlQnVmZmVyc1t0XTsKICAgICAgICAgICAgICAgICAgaWYgKGkpIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIG4gPSBpLmJ1ZmZlcmVkLCByID0gITEsIHMgPSAwOyBzIDwgbi5sZW5ndGg7IHMrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhID0gbi5zdGFydChzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBvID0gbi5lbmQocyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEgPD0gZSAmJiBlIDwgbyArIDMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUgLSBhID49IHRoaXMuX2NvbmZpZy5hdXRvQ2xlYW51cE1heEJhY2t3YXJkRHVyYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoID0gZSAtIHRoaXMuX2NvbmZpZy5hdXRvQ2xlYW51cE1pbkJhY2t3YXJkRHVyYXRpb247CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wZW5kaW5nUmVtb3ZlUmFuZ2VzW3RdLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogaAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvIDwgZSAmJiAociA9ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wZW5kaW5nUmVtb3ZlUmFuZ2VzW3RdLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ6IG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICByICYmICFpLnVwZGF0aW5nICYmIHRoaXMuX2RvUmVtb3ZlUmFuZ2VzKCkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl91cGRhdGVNZWRpYVNvdXJjZUR1cmF0aW9uID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLl9zb3VyY2VCdWZmZXJzOwogICAgICAgICAgICAgIGlmICgwICE9PSB0aGlzLl9tZWRpYUVsZW1lbnQucmVhZHlTdGF0ZSAmJiAib3BlbiIgPT09IHRoaXMuX21lZGlhU291cmNlLnJlYWR5U3RhdGUgJiYgIShlLnZpZGVvICYmIGUudmlkZW8udXBkYXRpbmcgfHwgZS5hdWRpbyAmJiBlLmF1ZGlvLnVwZGF0aW5nKSkgewogICAgICAgICAgICAgICAgICB2YXIgdCA9IHRoaXMuX21lZGlhU291cmNlLmR1cmF0aW9uCiAgICAgICAgICAgICAgICAgICAgLCBpID0gdGhpcy5fcGVuZGluZ01lZGlhRHVyYXRpb247CiAgICAgICAgICAgICAgICAgIGkgPiAwICYmIChpc05hTih0KSB8fCBpID4gdCkgJiYgKF8uYS52KHRoaXMuVEFHLCAiVXBkYXRlIE1lZGlhU291cmNlIGR1cmF0aW9uIGZyb20gIiArIHQgKyAiIHRvICIgKyBpKSwKICAgICAgICAgICAgICAgICAgdGhpcy5fbWVkaWFTb3VyY2UuZHVyYXRpb24gPSBpKSwKICAgICAgICAgICAgICAgICAgdGhpcy5fcmVxdWlyZVNldE1lZGlhRHVyYXRpb24gPSAhMSwKICAgICAgICAgICAgICAgICAgdGhpcy5fcGVuZGluZ01lZGlhRHVyYXRpb24gPSAwCiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX2RvUmVtb3ZlUmFuZ2VzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgZSBpbiB0aGlzLl9wZW5kaW5nUmVtb3ZlUmFuZ2VzKQogICAgICAgICAgICAgICAgICBpZiAodGhpcy5fc291cmNlQnVmZmVyc1tlXSAmJiAhdGhpcy5fc291cmNlQnVmZmVyc1tlXS51cGRhdGluZykKICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHQgPSB0aGlzLl9zb3VyY2VCdWZmZXJzW2VdLCBpID0gdGhpcy5fcGVuZGluZ1JlbW92ZVJhbmdlc1tlXTsgaS5sZW5ndGggJiYgIXQudXBkYXRpbmc7ICkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gaS5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgIHQucmVtb3ZlKG4uc3RhcnQsIG4uZW5kKQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX2RvQXBwZW5kU2VnbWVudHMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB2YXIgZSA9IHRoaXMuX3BlbmRpbmdTZWdtZW50czsKICAgICAgICAgICAgICBmb3IgKHZhciB0IGluIGUpCiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zb3VyY2VCdWZmZXJzW3RdICYmICF0aGlzLl9zb3VyY2VCdWZmZXJzW3RdLnVwZGF0aW5nICYmIGVbdF0ubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBlW3RdLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaS50aW1lc3RhbXBPZmZzZXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IHRoaXMuX3NvdXJjZUJ1ZmZlcnNbdF0udGltZXN0YW1wT2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIHIgPSBpLnRpbWVzdGFtcE9mZnNldCAvIDFlMzsKICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmFicyhuIC0gcikgPiAuMSAmJiAoXy5hLnYodGhpcy5UQUcsICJVcGRhdGUgTVBFRyBhdWRpbyB0aW1lc3RhbXBPZmZzZXQgZnJvbSAiICsgbiArICIgdG8gIiArIHIpLAogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NvdXJjZUJ1ZmZlcnNbdF0udGltZXN0YW1wT2Zmc2V0ID0gciksCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGkudGltZXN0YW1wT2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIWkuZGF0YSB8fCAwID09PSBpLmRhdGEuYnl0ZUxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc291cmNlQnVmZmVyc1t0XS5hcHBlbmRCdWZmZXIoaS5kYXRhKSwKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0J1ZmZlckZ1bGwgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAidmlkZW8iID09PSB0ICYmIGkuaGFzT3duUHJvcGVydHkoImluZm8iKSAmJiB0aGlzLl9pZHJMaXN0LmFwcGVuZEFycmF5KGkuaW5mby5zeW5jUG9pbnRzKQogICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdTZWdtZW50c1t0XS51bnNoaWZ0KGkpLAogICAgICAgICAgICAgICAgICAgICAgICAgIDIyID09PSBlLmNvZGUgPyAodGhpcy5faXNCdWZmZXJGdWxsIHx8IHRoaXMuX2VtaXR0ZXIuZW1pdChFLkJVRkZFUl9GVUxMKSwKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0J1ZmZlckZ1bGwgPSAhMCkgOiAoXy5hLmUodGhpcy5UQUcsIGUubWVzc2FnZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5lbWl0KEUuRVJST1IsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogZS5jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2c6IGUubWVzc2FnZQogICAgICAgICAgICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fb25Tb3VyY2VPcGVuID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgaWYgKF8uYS52KHRoaXMuVEFHLCAiTWVkaWFTb3VyY2Ugb25Tb3VyY2VPcGVuIiksCiAgICAgICAgICAgICAgdGhpcy5fbWVkaWFTb3VyY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcigic291cmNlb3BlbiIsIHRoaXMuZS5vblNvdXJjZU9wZW4pLAogICAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdTb3VyY2VCdWZmZXJJbml0Lmxlbmd0aCA+IDApCiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGUgPSB0aGlzLl9wZW5kaW5nU291cmNlQnVmZmVySW5pdDsgZS5sZW5ndGg7ICkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSBlLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZEluaXRTZWdtZW50KHQsICEwKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5faGFzUGVuZGluZ1NlZ21lbnRzKCkgJiYgdGhpcy5fZG9BcHBlbmRTZWdtZW50cygpLAogICAgICAgICAgICAgIHRoaXMuX2VtaXR0ZXIuZW1pdChFLlNPVVJDRV9PUEVOKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX29uU291cmNlRW5kZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBfLmEudih0aGlzLlRBRywgIk1lZGlhU291cmNlIG9uU291cmNlRW5kZWQiKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX29uU291cmNlQ2xvc2UgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBfLmEudih0aGlzLlRBRywgIk1lZGlhU291cmNlIG9uU291cmNlQ2xvc2UiKSwKICAgICAgICAgICAgICB0aGlzLl9tZWRpYVNvdXJjZSAmJiBudWxsICE9IHRoaXMuZSAmJiAodGhpcy5fbWVkaWFTb3VyY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcigic291cmNlb3BlbiIsIHRoaXMuZS5vblNvdXJjZU9wZW4pLAogICAgICAgICAgICAgIHRoaXMuX21lZGlhU291cmNlLnJlbW92ZUV2ZW50TGlzdGVuZXIoInNvdXJjZWVuZGVkIiwgdGhpcy5lLm9uU291cmNlRW5kZWQpLAogICAgICAgICAgICAgIHRoaXMuX21lZGlhU291cmNlLnJlbW92ZUV2ZW50TGlzdGVuZXIoInNvdXJjZWNsb3NlIiwgdGhpcy5lLm9uU291cmNlQ2xvc2UpKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX2hhc1BlbmRpbmdTZWdtZW50cyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHZhciBlID0gdGhpcy5fcGVuZGluZ1NlZ21lbnRzOwogICAgICAgICAgICAgIHJldHVybiBlLnZpZGVvLmxlbmd0aCA+IDAgfHwgZS5hdWRpby5sZW5ndGggPiAwCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5faGFzUGVuZGluZ1JlbW92ZVJhbmdlcyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHZhciBlID0gdGhpcy5fcGVuZGluZ1JlbW92ZVJhbmdlczsKICAgICAgICAgICAgICByZXR1cm4gZS52aWRlby5sZW5ndGggPiAwIHx8IGUuYXVkaW8ubGVuZ3RoID4gMAogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX29uU291cmNlQnVmZmVyVXBkYXRlRW5kID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5fcmVxdWlyZVNldE1lZGlhRHVyYXRpb24gPyB0aGlzLl91cGRhdGVNZWRpYVNvdXJjZUR1cmF0aW9uKCkgOiB0aGlzLl9oYXNQZW5kaW5nUmVtb3ZlUmFuZ2VzKCkgPyB0aGlzLl9kb1JlbW92ZVJhbmdlcygpIDogdGhpcy5faGFzUGVuZGluZ1NlZ21lbnRzKCkgPyB0aGlzLl9kb0FwcGVuZFNlZ21lbnRzKCkgOiB0aGlzLl9oYXNQZW5kaW5nRW9zICYmIHRoaXMuZW5kT2ZTdHJlYW0oKSwKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyLmVtaXQoRS5VUERBVEVfRU5EKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX29uU291cmNlQnVmZmVyRXJyb3IgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgXy5hLmUodGhpcy5UQUcsICJTb3VyY2VCdWZmZXIgRXJyb3I6ICIgKyBlKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZQogICAgICB9KCkKICAgICAgICAsIEwgPSBpKDUpCiAgICAgICAgLCBUID0gewogICAgICAgICAgTkVUV09SS19FUlJPUjogIk5ldHdvcmtFcnJvciIsCiAgICAgICAgICBNRURJQV9FUlJPUjogIk1lZGlhRXJyb3IiLAogICAgICAgICAgT1RIRVJfRVJST1I6ICJPdGhlckVycm9yIgogICAgICB9CiAgICAgICAgLCB3ID0gewogICAgICAgICAgTkVUV09SS19FWENFUFRJT046IGguYi5FWENFUFRJT04sCiAgICAgICAgICBORVRXT1JLX1NUQVRVU19DT0RFX0lOVkFMSUQ6IGguYi5IVFRQX1NUQVRVU19DT0RFX0lOVkFMSUQsCiAgICAgICAgICBORVRXT1JLX1RJTUVPVVQ6IGguYi5DT05ORUNUSU5HX1RJTUVPVVQsCiAgICAgICAgICBORVRXT1JLX1VOUkVDT1ZFUkFCTEVfRUFSTFlfRU9GOiBoLmIuVU5SRUNPVkVSQUJMRV9FQVJMWV9FT0YsCiAgICAgICAgICBNRURJQV9NU0VfRVJST1I6ICJNZWRpYU1TRUVycm9yIiwKICAgICAgICAgIE1FRElBX0ZPUk1BVF9FUlJPUjogTC5hLkZPUk1BVF9FUlJPUiwKICAgICAgICAgIE1FRElBX0ZPUk1BVF9VTlNVUFBPUlRFRDogTC5hLkZPUk1BVF9VTlNVUFBPUlRFRCwKICAgICAgICAgIE1FRElBX0NPREVDX1VOU1VQUE9SVEVEOiBMLmEuQ09ERUNfVU5TVVBQT1JURUQKICAgICAgfQogICAgICAgICwgRCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgZnVuY3Rpb24gZShlLCB0KSB7CiAgICAgICAgICAgICAgdGhpcy5UQUcgPSAiTVNFUGxheWVyIiwKICAgICAgICAgICAgICB0aGlzLl90eXBlID0gIk1TRVBsYXllciIsCiAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlciA9IG5ldyB1LmEsCiAgICAgICAgICAgICAgdGhpcy5fY29uZmlnID0gYSgpLAogICAgICAgICAgICAgICJvYmplY3QiID09IHR5cGVvZiB0ICYmIE9iamVjdC5hc3NpZ24odGhpcy5fY29uZmlnLCB0KTsKICAgICAgICAgICAgICB2YXIgaSA9IGUudHlwZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgIGlmICgibXNlIiAhPT0gaSAmJiAibXBlZ3RzIiAhPT0gaSAmJiAibTJ0cyIgIT09IGkgJiYgImZsdiIgIT09IGkpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBBLmIoIk1TRVBsYXllciByZXF1aXJlcyBhbiBtcGVndHMvbTJ0cy9mbHYgTWVkaWFEYXRhU291cmNlIGlucHV0ISIpOwogICAgICAgICAgICAgICEwID09PSBlLmlzTGl2ZSAmJiAodGhpcy5fY29uZmlnLmlzTGl2ZSA9ICEwKSwKICAgICAgICAgICAgICB0aGlzLmUgPSB7CiAgICAgICAgICAgICAgICAgIG9udkxvYWRlZE1ldGFkYXRhOiB0aGlzLl9vbnZMb2FkZWRNZXRhZGF0YS5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgICBvbnZTZWVraW5nOiB0aGlzLl9vbnZTZWVraW5nLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICAgIG9udkNhblBsYXk6IHRoaXMuX29udkNhblBsYXkuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgICAgb252U3RhbGxlZDogdGhpcy5fb252U3RhbGxlZC5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgICBvbnZQcm9ncmVzczogdGhpcy5fb252UHJvZ3Jlc3MuYmluZCh0aGlzKQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2VsZi5wZXJmb3JtYW5jZSAmJiBzZWxmLnBlcmZvcm1hbmNlLm5vdyA/IHRoaXMuX25vdyA9IHNlbGYucGVyZm9ybWFuY2Uubm93LmJpbmQoc2VsZi5wZXJmb3JtYW5jZSkgOiB0aGlzLl9ub3cgPSBEYXRlLm5vdywKICAgICAgICAgICAgICB0aGlzLl9wZW5kaW5nU2Vla1RpbWUgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RTZXRUaW1lID0gITEsCiAgICAgICAgICAgICAgdGhpcy5fc2Vla3BvaW50UmVjb3JkID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9wcm9ncmVzc0NoZWNrZXIgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX21lZGlhRGF0YVNvdXJjZSA9IGUsCiAgICAgICAgICAgICAgdGhpcy5fbWVkaWFFbGVtZW50ID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9tc2VjdGwgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX3RyYW5zbXV4ZXIgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX21zZVNvdXJjZU9wZW5lZCA9ICExLAogICAgICAgICAgICAgIHRoaXMuX2hhc1BlbmRpbmdMb2FkID0gITEsCiAgICAgICAgICAgICAgdGhpcy5fcmVjZWl2ZWRDYW5QbGF5ID0gITEsCiAgICAgICAgICAgICAgdGhpcy5fbWVkaWFJbmZvID0gbnVsbCwKICAgICAgICAgICAgICB0aGlzLl9zdGF0aXN0aWNzSW5mbyA9IG51bGw7CiAgICAgICAgICAgICAgdmFyIG4gPSBjLmEuY2hyb21lICYmIChjLmEudmVyc2lvbi5tYWpvciA8IDUwIHx8IDUwID09PSBjLmEudmVyc2lvbi5tYWpvciAmJiBjLmEudmVyc2lvbi5idWlsZCA8IDI2NjEpOwogICAgICAgICAgICAgIHRoaXMuX2Fsd2F5c1NlZWtLZXlmcmFtZSA9ICEhKG4gfHwgYy5hLm1zZWRnZSB8fCBjLmEubXNpZSksCiAgICAgICAgICAgICAgdGhpcy5fYWx3YXlzU2Vla0tleWZyYW1lICYmICh0aGlzLl9jb25maWcuYWNjdXJhdGVTZWVrID0gITEpCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIG51bGwgIT0gdGhpcy5fcHJvZ3Jlc3NDaGVja2VyICYmICh3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aGlzLl9wcm9ncmVzc0NoZWNrZXIpLAogICAgICAgICAgICAgIHRoaXMuX3Byb2dyZXNzQ2hlY2tlciA9IG51bGwpLAogICAgICAgICAgICAgIHRoaXMuX3RyYW5zbXV4ZXIgJiYgdGhpcy51bmxvYWQoKSwKICAgICAgICAgICAgICB0aGlzLl9tZWRpYUVsZW1lbnQgJiYgdGhpcy5kZXRhY2hNZWRpYUVsZW1lbnQoKSwKICAgICAgICAgICAgICB0aGlzLmUgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX21lZGlhRGF0YVNvdXJjZSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5yZW1vdmVBbGxMaXN0ZW5lcnMoKSwKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyID0gbnVsbAogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUub24gPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzOwogICAgICAgICAgICAgIGUgPT09IGwuTUVESUFfSU5GTyA/IG51bGwgIT0gdGhpcy5fbWVkaWFJbmZvICYmIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICBpLl9lbWl0dGVyLmVtaXQobC5NRURJQV9JTkZPLCBpLm1lZGlhSW5mbykKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKSkgOiBlID09PSBsLlNUQVRJU1RJQ1NfSU5GTyAmJiBudWxsICE9IHRoaXMuX3N0YXRpc3RpY3NJbmZvICYmIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICBpLl9lbWl0dGVyLmVtaXQobC5TVEFUSVNUSUNTX0lORk8sIGkuc3RhdGlzdGljc0luZm8pCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkpLAogICAgICAgICAgICAgIHRoaXMuX2VtaXR0ZXIuYWRkTGlzdGVuZXIoZSwgdCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLm9mZiA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyLnJlbW92ZUxpc3RlbmVyKGUsIHQpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5hdHRhY2hNZWRpYUVsZW1lbnQgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzOwogICAgICAgICAgICAgIGlmICh0aGlzLl9tZWRpYUVsZW1lbnQgPSBlLAogICAgICAgICAgICAgIGUuYWRkRXZlbnRMaXN0ZW5lcigibG9hZGVkbWV0YWRhdGEiLCB0aGlzLmUub252TG9hZGVkTWV0YWRhdGEpLAogICAgICAgICAgICAgIGUuYWRkRXZlbnRMaXN0ZW5lcigic2Vla2luZyIsIHRoaXMuZS5vbnZTZWVraW5nKSwKICAgICAgICAgICAgICBlLmFkZEV2ZW50TGlzdGVuZXIoImNhbnBsYXkiLCB0aGlzLmUub252Q2FuUGxheSksCiAgICAgICAgICAgICAgZS5hZGRFdmVudExpc3RlbmVyKCJzdGFsbGVkIiwgdGhpcy5lLm9udlN0YWxsZWQpLAogICAgICAgICAgICAgIGUuYWRkRXZlbnRMaXN0ZW5lcigicHJvZ3Jlc3MiLCB0aGlzLmUub252UHJvZ3Jlc3MpLAogICAgICAgICAgICAgIHRoaXMuX21zZWN0bCA9IG5ldyBSKHRoaXMuX2NvbmZpZyksCiAgICAgICAgICAgICAgdGhpcy5fbXNlY3RsLm9uKEUuVVBEQVRFX0VORCwgdGhpcy5fb25tc2VVcGRhdGVFbmQuYmluZCh0aGlzKSksCiAgICAgICAgICAgICAgdGhpcy5fbXNlY3RsLm9uKEUuQlVGRkVSX0ZVTEwsIHRoaXMuX29ubXNlQnVmZmVyRnVsbC5iaW5kKHRoaXMpKSwKICAgICAgICAgICAgICB0aGlzLl9tc2VjdGwub24oRS5TT1VSQ0VfT1BFTiwgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICB0Ll9tc2VTb3VyY2VPcGVuZWQgPSAhMCwKICAgICAgICAgICAgICAgICAgdC5faGFzUGVuZGluZ0xvYWQgJiYgKHQuX2hhc1BlbmRpbmdMb2FkID0gITEsCiAgICAgICAgICAgICAgICAgIHQubG9hZCgpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKSwKICAgICAgICAgICAgICB0aGlzLl9tc2VjdGwub24oRS5FUlJPUiwgKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgdC5fZW1pdHRlci5lbWl0KGwuRVJST1IsIFQuTUVESUFfRVJST1IsIHcuTUVESUFfTVNFX0VSUk9SLCBlKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKSwKICAgICAgICAgICAgICB0aGlzLl9tc2VjdGwuYXR0YWNoTWVkaWFFbGVtZW50KGUpLAogICAgICAgICAgICAgIG51bGwgIT0gdGhpcy5fcGVuZGluZ1NlZWtUaW1lKQogICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgZS5jdXJyZW50VGltZSA9IHRoaXMuX3BlbmRpbmdTZWVrVGltZSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdTZWVrVGltZSA9IG51bGwKICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLmRldGFjaE1lZGlhRWxlbWVudCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudCAmJiAodGhpcy5fbXNlY3RsLmRldGFjaE1lZGlhRWxlbWVudCgpLAogICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJsb2FkZWRtZXRhZGF0YSIsIHRoaXMuZS5vbnZMb2FkZWRNZXRhZGF0YSksCiAgICAgICAgICAgICAgdGhpcy5fbWVkaWFFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoInNlZWtpbmciLCB0aGlzLmUub252U2Vla2luZyksCiAgICAgICAgICAgICAgdGhpcy5fbWVkaWFFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNhbnBsYXkiLCB0aGlzLmUub252Q2FuUGxheSksCiAgICAgICAgICAgICAgdGhpcy5fbWVkaWFFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoInN0YWxsZWQiLCB0aGlzLmUub252U3RhbGxlZCksCiAgICAgICAgICAgICAgdGhpcy5fbWVkaWFFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoInByb2dyZXNzIiwgdGhpcy5lLm9udlByb2dyZXNzKSwKICAgICAgICAgICAgICB0aGlzLl9tZWRpYUVsZW1lbnQgPSBudWxsKSwKICAgICAgICAgICAgICB0aGlzLl9tc2VjdGwgJiYgKHRoaXMuX21zZWN0bC5kZXN0cm95KCksCiAgICAgICAgICAgICAgdGhpcy5fbXNlY3RsID0gbnVsbCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB2YXIgZSA9IHRoaXM7CiAgICAgICAgICAgICAgaWYgKCF0aGlzLl9tZWRpYUVsZW1lbnQpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBBLmEoIkhUTUxNZWRpYUVsZW1lbnQgbXVzdCBiZSBhdHRhY2hlZCBiZWZvcmUgbG9hZCgpISIpOwogICAgICAgICAgICAgIGlmICh0aGlzLl90cmFuc211eGVyKQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQS5hKCJNU0VQbGF5ZXIubG9hZCgpIGhhcyBiZWVuIGNhbGxlZCwgcGxlYXNlIGNhbGwgdW5sb2FkKCkgZmlyc3QhIik7CiAgICAgICAgICAgICAgdGhpcy5faGFzUGVuZGluZ0xvYWQgfHwgKHRoaXMuX2NvbmZpZy5kZWZlckxvYWRBZnRlclNvdXJjZU9wZW4gJiYgITEgPT09IHRoaXMuX21zZVNvdXJjZU9wZW5lZCA/IHRoaXMuX2hhc1BlbmRpbmdMb2FkID0gITAgOiAodGhpcy5fbWVkaWFFbGVtZW50LnJlYWR5U3RhdGUgPiAwICYmICh0aGlzLl9yZXF1ZXN0U2V0VGltZSA9ICEwLAogICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudC5jdXJyZW50VGltZSA9IDApLAogICAgICAgICAgICAgIHRoaXMuX3RyYW5zbXV4ZXIgPSBuZXcgYih0aGlzLl9tZWRpYURhdGFTb3VyY2UsdGhpcy5fY29uZmlnKSwKICAgICAgICAgICAgICB0aGlzLl90cmFuc211eGVyLm9uKHYuYS5JTklUX1NFR01FTlQsIChmdW5jdGlvbih0LCBpKSB7CiAgICAgICAgICAgICAgICAgIGUuX21zZWN0bC5hcHBlbmRJbml0U2VnbWVudChpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKSwKICAgICAgICAgICAgICB0aGlzLl90cmFuc211eGVyLm9uKHYuYS5NRURJQV9TRUdNRU5ULCAoZnVuY3Rpb24odCwgaSkgewogICAgICAgICAgICAgICAgICBpZiAoZS5fbXNlY3RsLmFwcGVuZE1lZGlhU2VnbWVudChpKSwKICAgICAgICAgICAgICAgICAgZS5fY29uZmlnLmxhenlMb2FkICYmICFlLl9jb25maWcuaXNMaXZlKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IGUuX21lZGlhRWxlbWVudC5jdXJyZW50VGltZTsKICAgICAgICAgICAgICAgICAgICAgIGkuaW5mby5lbmREdHMgPj0gMWUzICogKG4gKyBlLl9jb25maWcubGF6eUxvYWRNYXhEdXJhdGlvbikgJiYgbnVsbCA9PSBlLl9wcm9ncmVzc0NoZWNrZXIgJiYgKF8uYS52KGUuVEFHLCAiTWF4aW11bSBidWZmZXJpbmcgZHVyYXRpb24gZXhjZWVkZWQsIHN1c3BlbmQgdHJhbnNtdXhpbmcgdGFzayIpLAogICAgICAgICAgICAgICAgICAgICAgZS5fc3VzcGVuZFRyYW5zbXV4ZXIoKSkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKSwKICAgICAgICAgICAgICB0aGlzLl90cmFuc211eGVyLm9uKHYuYS5MT0FESU5HX0NPTVBMRVRFLCAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIGUuX21zZWN0bC5lbmRPZlN0cmVhbSgpLAogICAgICAgICAgICAgICAgICBlLl9lbWl0dGVyLmVtaXQobC5MT0FESU5HX0NPTVBMRVRFKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKSwKICAgICAgICAgICAgICB0aGlzLl90cmFuc211eGVyLm9uKHYuYS5SRUNPVkVSRURfRUFSTFlfRU9GLCAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIGUuX2VtaXR0ZXIuZW1pdChsLlJFQ09WRVJFRF9FQVJMWV9FT0YpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkpLAogICAgICAgICAgICAgIHRoaXMuX3RyYW5zbXV4ZXIub24odi5hLklPX0VSUk9SLCAoZnVuY3Rpb24odCwgaSkgewogICAgICAgICAgICAgICAgICBlLl9lbWl0dGVyLmVtaXQobC5FUlJPUiwgVC5ORVRXT1JLX0VSUk9SLCB0LCBpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKSwKICAgICAgICAgICAgICB0aGlzLl90cmFuc211eGVyLm9uKHYuYS5ERU1VWF9FUlJPUiwgKGZ1bmN0aW9uKHQsIGkpIHsKICAgICAgICAgICAgICAgICAgZS5fZW1pdHRlci5lbWl0KGwuRVJST1IsIFQuTUVESUFfRVJST1IsIHQsIHsKICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IC0xLAogICAgICAgICAgICAgICAgICAgICAgbXNnOiBpCiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkpLAogICAgICAgICAgICAgIHRoaXMuX3RyYW5zbXV4ZXIub24odi5hLk1FRElBX0lORk8sIChmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICAgIGUuX21lZGlhSW5mbyA9IHQsCiAgICAgICAgICAgICAgICAgIGUuX2VtaXR0ZXIuZW1pdChsLk1FRElBX0lORk8sIE9iamVjdC5hc3NpZ24oe30sIHQpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKSwKICAgICAgICAgICAgICB0aGlzLl90cmFuc211eGVyLm9uKHYuYS5NRVRBREFUQV9BUlJJVkVELCAoZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgICBlLl9lbWl0dGVyLmVtaXQobC5NRVRBREFUQV9BUlJJVkVELCB0KQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKSwKICAgICAgICAgICAgICB0aGlzLl90cmFuc211eGVyLm9uKHYuYS5TQ1JJUFREQVRBX0FSUklWRUQsIChmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICAgIGUuX2VtaXR0ZXIuZW1pdChsLlNDUklQVERBVEFfQVJSSVZFRCwgdCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKSksCiAgICAgICAgICAgICAgdGhpcy5fdHJhbnNtdXhlci5vbih2LmEuVElNRURfSUQzX01FVEFEQVRBX0FSUklWRUQsIChmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICAgIGUuX2VtaXR0ZXIuZW1pdChsLlRJTUVEX0lEM19NRVRBREFUQV9BUlJJVkVELCB0KQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKSwKICAgICAgICAgICAgICB0aGlzLl90cmFuc211eGVyLm9uKHYuYS5QRVNfUFJJVkFURV9EQVRBX0RFU0NSSVBUT1IsIChmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICAgIGUuX2VtaXR0ZXIuZW1pdChsLlBFU19QUklWQVRFX0RBVEFfREVTQ1JJUFRPUiwgdCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKSksCiAgICAgICAgICAgICAgdGhpcy5fdHJhbnNtdXhlci5vbih2LmEuUEVTX1BSSVZBVEVfREFUQV9BUlJJVkVELCAoZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgICBlLl9lbWl0dGVyLmVtaXQobC5QRVNfUFJJVkFURV9EQVRBX0FSUklWRUQsIHQpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkpLAogICAgICAgICAgICAgIHRoaXMuX3RyYW5zbXV4ZXIub24odi5hLlNUQVRJU1RJQ1NfSU5GTywgKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgZS5fc3RhdGlzdGljc0luZm8gPSBlLl9maWxsU3RhdGlzdGljc0luZm8odCksCiAgICAgICAgICAgICAgICAgIGUuX2VtaXR0ZXIuZW1pdChsLlNUQVRJU1RJQ1NfSU5GTywgT2JqZWN0LmFzc2lnbih7fSwgZS5fc3RhdGlzdGljc0luZm8pKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKSwKICAgICAgICAgICAgICB0aGlzLl90cmFuc211eGVyLm9uKHYuYS5SRUNPTU1FTkRfU0VFS1BPSU5ULCAoZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgICBlLl9tZWRpYUVsZW1lbnQgJiYgIWUuX2NvbmZpZy5hY2N1cmF0ZVNlZWsgJiYgKGUuX3JlcXVlc3RTZXRUaW1lID0gITAsCiAgICAgICAgICAgICAgICAgIGUuX21lZGlhRWxlbWVudC5jdXJyZW50VGltZSA9IHQgLyAxZTMpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkpLAogICAgICAgICAgICAgIHRoaXMuX3RyYW5zbXV4ZXIub3BlbigpKSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLnVubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudCAmJiB0aGlzLl9tZWRpYUVsZW1lbnQucGF1c2UoKSwKICAgICAgICAgICAgICB0aGlzLl9tc2VjdGwgJiYgdGhpcy5fbXNlY3RsLnNlZWsoMCksCiAgICAgICAgICAgICAgdGhpcy5fdHJhbnNtdXhlciAmJiAodGhpcy5fdHJhbnNtdXhlci5jbG9zZSgpLAogICAgICAgICAgICAgIHRoaXMuX3RyYW5zbXV4ZXIuZGVzdHJveSgpLAogICAgICAgICAgICAgIHRoaXMuX3RyYW5zbXV4ZXIgPSBudWxsKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tZWRpYUVsZW1lbnQucGxheSgpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudC5wYXVzZSgpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJ0eXBlIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90eXBlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgImJ1ZmZlcmVkIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tZWRpYUVsZW1lbnQuYnVmZmVyZWQKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAiZHVyYXRpb24iLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21lZGlhRWxlbWVudC5kdXJhdGlvbgogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJ2b2x1bWUiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21lZGlhRWxlbWVudC52b2x1bWUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICB0aGlzLl9tZWRpYUVsZW1lbnQudm9sdW1lID0gZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJtdXRlZCIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbWVkaWFFbGVtZW50Lm11dGVkCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fbWVkaWFFbGVtZW50Lm11dGVkID0gZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJjdXJyZW50VGltZSIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbWVkaWFFbGVtZW50ID8gdGhpcy5fbWVkaWFFbGVtZW50LmN1cnJlbnRUaW1lIDogMAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudCA/IHRoaXMuX2ludGVybmFsU2VlayhlKSA6IHRoaXMuX3BlbmRpbmdTZWVrVGltZSA9IGUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAibWVkaWFJbmZvIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCB0aGlzLl9tZWRpYUluZm8pCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgInN0YXRpc3RpY3NJbmZvIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsID09IHRoaXMuX3N0YXRpc3RpY3NJbmZvICYmICh0aGlzLl9zdGF0aXN0aWNzSW5mbyA9IHt9KSwKICAgICAgICAgICAgICAgICAgdGhpcy5fc3RhdGlzdGljc0luZm8gPSB0aGlzLl9maWxsU3RhdGlzdGljc0luZm8odGhpcy5fc3RhdGlzdGljc0luZm8pLAogICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHt9LCB0aGlzLl9zdGF0aXN0aWNzSW5mbykKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgZS5wcm90b3R5cGUuX2ZpbGxTdGF0aXN0aWNzSW5mbyA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBpZiAoZS5wbGF5ZXJUeXBlID0gdGhpcy5fdHlwZSwKICAgICAgICAgICAgICAhKHRoaXMuX21lZGlhRWxlbWVudCBpbnN0YW5jZW9mIEhUTUxWaWRlb0VsZW1lbnQpKQogICAgICAgICAgICAgICAgICByZXR1cm4gZTsKICAgICAgICAgICAgICB2YXIgdCA9ICEwCiAgICAgICAgICAgICAgICAsIGkgPSAwCiAgICAgICAgICAgICAgICAsIG4gPSAwOwogICAgICAgICAgICAgIGlmICh0aGlzLl9tZWRpYUVsZW1lbnQuZ2V0VmlkZW9QbGF5YmFja1F1YWxpdHkpIHsKICAgICAgICAgICAgICAgICAgdmFyIHIgPSB0aGlzLl9tZWRpYUVsZW1lbnQuZ2V0VmlkZW9QbGF5YmFja1F1YWxpdHkoKTsKICAgICAgICAgICAgICAgICAgaSA9IHIudG90YWxWaWRlb0ZyYW1lcywKICAgICAgICAgICAgICAgICAgbiA9IHIuZHJvcHBlZFZpZGVvRnJhbWVzCiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgIG51bGwgIT0gdGhpcy5fbWVkaWFFbGVtZW50LndlYmtpdERlY29kZWRGcmFtZUNvdW50ID8gKGkgPSB0aGlzLl9tZWRpYUVsZW1lbnQud2Via2l0RGVjb2RlZEZyYW1lQ291bnQsCiAgICAgICAgICAgICAgICAgIG4gPSB0aGlzLl9tZWRpYUVsZW1lbnQud2Via2l0RHJvcHBlZEZyYW1lQ291bnQpIDogdCA9ICExOwogICAgICAgICAgICAgIHJldHVybiB0ICYmIChlLmRlY29kZWRGcmFtZXMgPSBpLAogICAgICAgICAgICAgIGUuZHJvcHBlZEZyYW1lcyA9IG4pLAogICAgICAgICAgICAgIGUKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vbm1zZVVwZGF0ZUVuZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHZhciBlID0gdGhpcy5fbWVkaWFFbGVtZW50LmJ1ZmZlcmVkCiAgICAgICAgICAgICAgICAsIHQgPSB0aGlzLl9tZWRpYUVsZW1lbnQuY3VycmVudFRpbWU7CiAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbmZpZy5pc0xpdmUgJiYgdGhpcy5fY29uZmlnLmxpdmVCdWZmZXJMYXRlbmN5Q2hhc2luZyAmJiBlLmxlbmd0aCA+IDAgJiYgIXRoaXMuX21lZGlhRWxlbWVudC5wYXVzZWQpIHsKICAgICAgICAgICAgICAgICAgdmFyIGkgPSBlLmVuZChlLmxlbmd0aCAtIDEpOwogICAgICAgICAgICAgICAgICBpZiAoaSA+IHRoaXMuX2NvbmZpZy5saXZlQnVmZmVyTGF0ZW5jeU1heExhdGVuY3kgJiYgaSAtIHQgPiB0aGlzLl9jb25maWcubGl2ZUJ1ZmZlckxhdGVuY3lNYXhMYXRlbmN5KSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IGkgLSB0aGlzLl9jb25maWcubGl2ZUJ1ZmZlckxhdGVuY3lNaW5SZW1haW47CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRUaW1lID0gbgogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICh0aGlzLl9jb25maWcubGF6eUxvYWQgJiYgIXRoaXMuX2NvbmZpZy5pc0xpdmUpIHsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgciA9IDAsIHMgPSAwOyBzIDwgZS5sZW5ndGg7IHMrKykgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBlLnN0YXJ0KHMpCiAgICAgICAgICAgICAgICAgICAgICAgICwgbyA9IGUuZW5kKHMpOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGEgPD0gdCAmJiB0IDwgbykgewogICAgICAgICAgICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IG87CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICByID49IHQgKyB0aGlzLl9jb25maWcubGF6eUxvYWRNYXhEdXJhdGlvbiAmJiBudWxsID09IHRoaXMuX3Byb2dyZXNzQ2hlY2tlciAmJiAoXy5hLnYodGhpcy5UQUcsICJNYXhpbXVtIGJ1ZmZlcmluZyBkdXJhdGlvbiBleGNlZWRlZCwgc3VzcGVuZCB0cmFuc211eGluZyB0YXNrIiksCiAgICAgICAgICAgICAgICAgIHRoaXMuX3N1c3BlbmRUcmFuc211eGVyKCkpCiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX29ubXNlQnVmZmVyRnVsbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIF8uYS52KHRoaXMuVEFHLCAiTVNFIFNvdXJjZUJ1ZmZlciBpcyBmdWxsLCBzdXNwZW5kIHRyYW5zbXV4aW5nIHRhc2siKSwKICAgICAgICAgICAgICBudWxsID09IHRoaXMuX3Byb2dyZXNzQ2hlY2tlciAmJiB0aGlzLl9zdXNwZW5kVHJhbnNtdXhlcigpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fc3VzcGVuZFRyYW5zbXV4ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0aGlzLl90cmFuc211eGVyICYmICh0aGlzLl90cmFuc211eGVyLnBhdXNlKCksCiAgICAgICAgICAgICAgbnVsbCA9PSB0aGlzLl9wcm9ncmVzc0NoZWNrZXIgJiYgKHRoaXMuX3Byb2dyZXNzQ2hlY2tlciA9IHdpbmRvdy5zZXRJbnRlcnZhbCh0aGlzLl9jaGVja1Byb2dyZXNzQW5kUmVzdW1lLmJpbmQodGhpcyksIDFlMykpKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX2NoZWNrUHJvZ3Jlc3NBbmRSZXN1bWUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBlID0gdGhpcy5fbWVkaWFFbGVtZW50LmN1cnJlbnRUaW1lLCB0ID0gdGhpcy5fbWVkaWFFbGVtZW50LmJ1ZmZlcmVkLCBpID0gITEsIG4gPSAwOyBuIDwgdC5sZW5ndGg7IG4rKykgewogICAgICAgICAgICAgICAgICB2YXIgciA9IHQuc3RhcnQobikKICAgICAgICAgICAgICAgICAgICAsIHMgPSB0LmVuZChuKTsKICAgICAgICAgICAgICAgICAgaWYgKGUgPj0gciAmJiBlIDwgcykgewogICAgICAgICAgICAgICAgICAgICAgZSA+PSBzIC0gdGhpcy5fY29uZmlnLmxhenlMb2FkUmVjb3ZlckR1cmF0aW9uICYmIChpID0gITApOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpICYmICh3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aGlzLl9wcm9ncmVzc0NoZWNrZXIpLAogICAgICAgICAgICAgIHRoaXMuX3Byb2dyZXNzQ2hlY2tlciA9IG51bGwsCiAgICAgICAgICAgICAgaSAmJiAoXy5hLnYodGhpcy5UQUcsICJDb250aW51ZSBsb2FkaW5nIGZyb20gcGF1c2VkIHBvc2l0aW9uIiksCiAgICAgICAgICAgICAgdGhpcy5fdHJhbnNtdXhlci5yZXN1bWUoKSkpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5faXNUaW1lcG9pbnRCdWZmZXJlZCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBmb3IgKHZhciB0ID0gdGhpcy5fbWVkaWFFbGVtZW50LmJ1ZmZlcmVkLCBpID0gMDsgaSA8IHQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgdmFyIG4gPSB0LnN0YXJ0KGkpCiAgICAgICAgICAgICAgICAgICAgLCByID0gdC5lbmQoaSk7CiAgICAgICAgICAgICAgICAgIGlmIChlID49IG4gJiYgZSA8IHIpCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5faW50ZXJuYWxTZWVrID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHZhciB0ID0gdGhpcy5faXNUaW1lcG9pbnRCdWZmZXJlZChlKQogICAgICAgICAgICAgICAgLCBpID0gITEKICAgICAgICAgICAgICAgICwgbiA9IDA7CiAgICAgICAgICAgICAgaWYgKGUgPCAxICYmIHRoaXMuX21lZGlhRWxlbWVudC5idWZmZXJlZC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIHZhciByID0gdGhpcy5fbWVkaWFFbGVtZW50LmJ1ZmZlcmVkLnN0YXJ0KDApOwogICAgICAgICAgICAgICAgICAociA8IDEgJiYgZSA8IHIgfHwgYy5hLnNhZmFyaSkgJiYgKGkgPSAhMCwKICAgICAgICAgICAgICAgICAgbiA9IGMuYS5zYWZhcmkgPyAuMSA6IHIpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChpKQogICAgICAgICAgICAgICAgICB0aGlzLl9yZXF1ZXN0U2V0VGltZSA9ICEwLAogICAgICAgICAgICAgICAgICB0aGlzLl9tZWRpYUVsZW1lbnQuY3VycmVudFRpbWUgPSBuOwogICAgICAgICAgICAgIGVsc2UgaWYgKHQpIHsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2Fsd2F5c1NlZWtLZXlmcmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSB0aGlzLl9tc2VjdGwuZ2V0TmVhcmVzdEtleWZyYW1lKE1hdGguZmxvb3IoMWUzICogZSkpOwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVxdWVzdFNldFRpbWUgPSAhMCwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudC5jdXJyZW50VGltZSA9IG51bGwgIT0gcyA/IHMuZHRzIC8gMWUzIDogZQogICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RTZXRUaW1lID0gITAsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tZWRpYUVsZW1lbnQuY3VycmVudFRpbWUgPSBlOwogICAgICAgICAgICAgICAgICBudWxsICE9IHRoaXMuX3Byb2dyZXNzQ2hlY2tlciAmJiB0aGlzLl9jaGVja1Byb2dyZXNzQW5kUmVzdW1lKCkKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgbnVsbCAhPSB0aGlzLl9wcm9ncmVzc0NoZWNrZXIgJiYgKHdpbmRvdy5jbGVhckludGVydmFsKHRoaXMuX3Byb2dyZXNzQ2hlY2tlciksCiAgICAgICAgICAgICAgICAgIHRoaXMuX3Byb2dyZXNzQ2hlY2tlciA9IG51bGwpLAogICAgICAgICAgICAgICAgICB0aGlzLl9tc2VjdGwuc2VlayhlKSwKICAgICAgICAgICAgICAgICAgdGhpcy5fdHJhbnNtdXhlci5zZWVrKE1hdGguZmxvb3IoMWUzICogZSkpLAogICAgICAgICAgICAgICAgICB0aGlzLl9jb25maWcuYWNjdXJhdGVTZWVrICYmICh0aGlzLl9yZXF1ZXN0U2V0VGltZSA9ICEwLAogICAgICAgICAgICAgICAgICB0aGlzLl9tZWRpYUVsZW1lbnQuY3VycmVudFRpbWUgPSBlKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX2NoZWNrQW5kQXBwbHlVbmJ1ZmZlcmVkU2Vla3BvaW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuX3NlZWtwb2ludFJlY29yZCkKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3NlZWtwb2ludFJlY29yZC5yZWNvcmRUaW1lIDw9IHRoaXMuX25vdygpIC0gMTAwKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IHRoaXMuX21lZGlhRWxlbWVudC5jdXJyZW50VGltZTsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlZWtwb2ludFJlY29yZCA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc1RpbWVwb2ludEJ1ZmZlcmVkKGUpIHx8IChudWxsICE9IHRoaXMuX3Byb2dyZXNzQ2hlY2tlciAmJiAod2luZG93LmNsZWFyVGltZW91dCh0aGlzLl9wcm9ncmVzc0NoZWNrZXIpLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvZ3Jlc3NDaGVja2VyID0gbnVsbCksCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tc2VjdGwuc2VlayhlKSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zbXV4ZXIuc2VlayhNYXRoLmZsb29yKDFlMyAqIGUpKSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NvbmZpZy5hY2N1cmF0ZVNlZWsgJiYgKHRoaXMuX3JlcXVlc3RTZXRUaW1lID0gITAsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tZWRpYUVsZW1lbnQuY3VycmVudFRpbWUgPSBlKSkKICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dCh0aGlzLl9jaGVja0FuZEFwcGx5VW5idWZmZXJlZFNlZWtwb2ludC5iaW5kKHRoaXMpLCA1MCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9jaGVja0FuZFJlc3VtZVN0dWNrUGxheWJhY2sgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLl9tZWRpYUVsZW1lbnQ7CiAgICAgICAgICAgICAgaWYgKGUgfHwgIXRoaXMuX3JlY2VpdmVkQ2FuUGxheSB8fCB0LnJlYWR5U3RhdGUgPCAyKSB7CiAgICAgICAgICAgICAgICAgIHZhciBpID0gdC5idWZmZXJlZDsKICAgICAgICAgICAgICAgICAgaS5sZW5ndGggPiAwICYmIHQuY3VycmVudFRpbWUgPCBpLnN0YXJ0KDApICYmIChfLmEudyh0aGlzLlRBRywgIlBsYXliYWNrIHNlZW1zIHN0dWNrIGF0ICIgKyB0LmN1cnJlbnRUaW1lICsgIiwgc2VlayB0byAiICsgaS5zdGFydCgwKSksCiAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RTZXRUaW1lID0gITAsCiAgICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudC5jdXJyZW50VGltZSA9IGkuc3RhcnQoMCksCiAgICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJwcm9ncmVzcyIsIHRoaXMuZS5vbnZQcm9ncmVzcykpCiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJwcm9ncmVzcyIsIHRoaXMuZS5vbnZQcm9ncmVzcykKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vbnZMb2FkZWRNZXRhZGF0YSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBudWxsICE9IHRoaXMuX3BlbmRpbmdTZWVrVGltZSAmJiAodGhpcy5fbWVkaWFFbGVtZW50LmN1cnJlbnRUaW1lID0gdGhpcy5fcGVuZGluZ1NlZWtUaW1lLAogICAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdTZWVrVGltZSA9IG51bGwpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fb252U2Vla2luZyA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB2YXIgdCA9IHRoaXMuX21lZGlhRWxlbWVudC5jdXJyZW50VGltZQogICAgICAgICAgICAgICAgLCBpID0gdGhpcy5fbWVkaWFFbGVtZW50LmJ1ZmZlcmVkOwogICAgICAgICAgICAgIGlmICh0aGlzLl9yZXF1ZXN0U2V0VGltZSkKICAgICAgICAgICAgICAgICAgdGhpcy5fcmVxdWVzdFNldFRpbWUgPSAhMTsKICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgaWYgKHQgPCAxICYmIGkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBpLnN0YXJ0KDApOwogICAgICAgICAgICAgICAgICAgICAgaWYgKG4gPCAxICYmIHQgPCBuIHx8IGMuYS5zYWZhcmkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlcXVlc3RTZXRUaW1lID0gITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAodGhpcy5fbWVkaWFFbGVtZW50LmN1cnJlbnRUaW1lID0gYy5hLnNhZmFyaSA/IC4xIDogbikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNUaW1lcG9pbnRCdWZmZXJlZCh0KSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2Fsd2F5c1NlZWtLZXlmcmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByID0gdGhpcy5fbXNlY3RsLmdldE5lYXJlc3RLZXlmcmFtZShNYXRoLmZsb29yKDFlMyAqIHQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsICE9IHIgJiYgKHRoaXMuX3JlcXVlc3RTZXRUaW1lID0gITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWVkaWFFbGVtZW50LmN1cnJlbnRUaW1lID0gci5kdHMgLyAxZTMpCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBudWxsICE9IHRoaXMuX3Byb2dyZXNzQ2hlY2tlciAmJiB0aGlzLl9jaGVja1Byb2dyZXNzQW5kUmVzdW1lKCkKICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZWVrcG9pbnRSZWNvcmQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vla1BvaW50OiB0LAogICAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZFRpbWU6IHRoaXMuX25vdygpCiAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQodGhpcy5fY2hlY2tBbmRBcHBseVVuYnVmZmVyZWRTZWVrcG9pbnQuYmluZCh0aGlzKSwgNTApCiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuX29udkNhblBsYXkgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgdGhpcy5fcmVjZWl2ZWRDYW5QbGF5ID0gITAsCiAgICAgICAgICAgICAgdGhpcy5fbWVkaWFFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNhbnBsYXkiLCB0aGlzLmUub252Q2FuUGxheSkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vbnZTdGFsbGVkID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIHRoaXMuX2NoZWNrQW5kUmVzdW1lU3R1Y2tQbGF5YmFjayghMCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLl9vbnZQcm9ncmVzcyA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICB0aGlzLl9jaGVja0FuZFJlc3VtZVN0dWNrUGxheWJhY2soKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZQogICAgICB9KCkKICAgICAgICAsIGsgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGZ1bmN0aW9uIGUoZSwgdCkgewogICAgICAgICAgICAgIHRoaXMuVEFHID0gIk5hdGl2ZVBsYXllciIsCiAgICAgICAgICAgICAgdGhpcy5fdHlwZSA9ICJOYXRpdmVQbGF5ZXIiLAogICAgICAgICAgICAgIHRoaXMuX2VtaXR0ZXIgPSBuZXcgdS5hLAogICAgICAgICAgICAgIHRoaXMuX2NvbmZpZyA9IGEoKSwKICAgICAgICAgICAgICAib2JqZWN0IiA9PSB0eXBlb2YgdCAmJiBPYmplY3QuYXNzaWduKHRoaXMuX2NvbmZpZywgdCk7CiAgICAgICAgICAgICAgdmFyIGkgPSBlLnR5cGUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICBpZiAoIm1zZSIgPT09IGkgfHwgIm1wZWd0cyIgPT09IGkgfHwgIm0ydHMiID09PSBpIHx8ICJmbHYiID09PSBpKQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQS5iKCJOYXRpdmVQbGF5ZXIgZG9lcyd0IHN1cHBvcnQgbXNlL21wZWd0cy9tMnRzL2ZsdiBNZWRpYURhdGFTb3VyY2UgaW5wdXQhIik7CiAgICAgICAgICAgICAgaWYgKGUuaGFzT3duUHJvcGVydHkoInNlZ21lbnRzIikpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBBLmIoIk5hdGl2ZVBsYXllcigiICsgZS50eXBlICsgIikgZG9lc24ndCBzdXBwb3J0IG11bHRpcGFydCBwbGF5YmFjayEiKTsKICAgICAgICAgICAgICB0aGlzLmUgPSB7CiAgICAgICAgICAgICAgICAgIG9udkxvYWRlZE1ldGFkYXRhOiB0aGlzLl9vbnZMb2FkZWRNZXRhZGF0YS5iaW5kKHRoaXMpCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB0aGlzLl9wZW5kaW5nU2Vla1RpbWUgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX3N0YXRpc3RpY3NSZXBvcnRlciA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fbWVkaWFEYXRhU291cmNlID0gZSwKICAgICAgICAgICAgICB0aGlzLl9tZWRpYUVsZW1lbnQgPSBudWxsCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudCAmJiAodGhpcy51bmxvYWQoKSwKICAgICAgICAgICAgICB0aGlzLmRldGFjaE1lZGlhRWxlbWVudCgpKSwKICAgICAgICAgICAgICB0aGlzLmUgPSBudWxsLAogICAgICAgICAgICAgIHRoaXMuX21lZGlhRGF0YVNvdXJjZSA9IG51bGwsCiAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5yZW1vdmVBbGxMaXN0ZW5lcnMoKSwKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyID0gbnVsbAogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUub24gPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzOwogICAgICAgICAgICAgIGUgPT09IGwuTUVESUFfSU5GTyA/IG51bGwgIT0gdGhpcy5fbWVkaWFFbGVtZW50ICYmIDAgIT09IHRoaXMuX21lZGlhRWxlbWVudC5yZWFkeVN0YXRlICYmIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICBpLl9lbWl0dGVyLmVtaXQobC5NRURJQV9JTkZPLCBpLm1lZGlhSW5mbykKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKSkgOiBlID09PSBsLlNUQVRJU1RJQ1NfSU5GTyAmJiBudWxsICE9IHRoaXMuX21lZGlhRWxlbWVudCAmJiAwICE9PSB0aGlzLl9tZWRpYUVsZW1lbnQucmVhZHlTdGF0ZSAmJiBQcm9taXNlLnJlc29sdmUoKS50aGVuKChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgaS5fZW1pdHRlci5lbWl0KGwuU1RBVElTVElDU19JTkZPLCBpLnN0YXRpc3RpY3NJbmZvKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApKSwKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyLmFkZExpc3RlbmVyKGUsIHQpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5yZW1vdmVMaXN0ZW5lcihlLCB0KQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUuYXR0YWNoTWVkaWFFbGVtZW50ID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGlmICh0aGlzLl9tZWRpYUVsZW1lbnQgPSBlLAogICAgICAgICAgICAgIGUuYWRkRXZlbnRMaXN0ZW5lcigibG9hZGVkbWV0YWRhdGEiLCB0aGlzLmUub252TG9hZGVkTWV0YWRhdGEpLAogICAgICAgICAgICAgIG51bGwgIT0gdGhpcy5fcGVuZGluZ1NlZWtUaW1lKQogICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgZS5jdXJyZW50VGltZSA9IHRoaXMuX3BlbmRpbmdTZWVrVGltZSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdTZWVrVGltZSA9IG51bGwKICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLmRldGFjaE1lZGlhRWxlbWVudCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudCAmJiAodGhpcy5fbWVkaWFFbGVtZW50LnNyYyA9ICIiLAogICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoInNyYyIpLAogICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJsb2FkZWRtZXRhZGF0YSIsIHRoaXMuZS5vbnZMb2FkZWRNZXRhZGF0YSksCiAgICAgICAgICAgICAgdGhpcy5fbWVkaWFFbGVtZW50ID0gbnVsbCksCiAgICAgICAgICAgICAgbnVsbCAhPSB0aGlzLl9zdGF0aXN0aWNzUmVwb3J0ZXIgJiYgKHdpbmRvdy5jbGVhckludGVydmFsKHRoaXMuX3N0YXRpc3RpY3NSZXBvcnRlciksCiAgICAgICAgICAgICAgdGhpcy5fc3RhdGlzdGljc1JlcG9ydGVyID0gbnVsbCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBpZiAoIXRoaXMuX21lZGlhRWxlbWVudCkKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEEuYSgiSFRNTE1lZGlhRWxlbWVudCBtdXN0IGJlIGF0dGFjaGVkIGJlZm9yZSBsb2FkKCkhIik7CiAgICAgICAgICAgICAgdGhpcy5fbWVkaWFFbGVtZW50LnNyYyA9IHRoaXMuX21lZGlhRGF0YVNvdXJjZS51cmwsCiAgICAgICAgICAgICAgdGhpcy5fbWVkaWFFbGVtZW50LnJlYWR5U3RhdGUgPiAwICYmICh0aGlzLl9tZWRpYUVsZW1lbnQuY3VycmVudFRpbWUgPSAwKSwKICAgICAgICAgICAgICB0aGlzLl9tZWRpYUVsZW1lbnQucHJlbG9hZCA9ICJhdXRvIiwKICAgICAgICAgICAgICB0aGlzLl9tZWRpYUVsZW1lbnQubG9hZCgpLAogICAgICAgICAgICAgIHRoaXMuX3N0YXRpc3RpY3NSZXBvcnRlciA9IHdpbmRvdy5zZXRJbnRlcnZhbCh0aGlzLl9yZXBvcnRTdGF0aXN0aWNzSW5mby5iaW5kKHRoaXMpLCB0aGlzLl9jb25maWcuc3RhdGlzdGljc0luZm9SZXBvcnRJbnRlcnZhbCkKICAgICAgICAgIH0KICAgICAgICAgICwKICAgICAgICAgIGUucHJvdG90eXBlLnVubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudCAmJiAodGhpcy5fbWVkaWFFbGVtZW50LnNyYyA9ICIiLAogICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoInNyYyIpKSwKICAgICAgICAgICAgICBudWxsICE9IHRoaXMuX3N0YXRpc3RpY3NSZXBvcnRlciAmJiAod2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy5fc3RhdGlzdGljc1JlcG9ydGVyKSwKICAgICAgICAgICAgICB0aGlzLl9zdGF0aXN0aWNzUmVwb3J0ZXIgPSBudWxsKQogICAgICAgICAgfQogICAgICAgICAgLAogICAgICAgICAgZS5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tZWRpYUVsZW1lbnQucGxheSgpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudC5wYXVzZSgpCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJ0eXBlIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90eXBlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgImJ1ZmZlcmVkIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tZWRpYUVsZW1lbnQuYnVmZmVyZWQKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAiZHVyYXRpb24iLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21lZGlhRWxlbWVudC5kdXJhdGlvbgogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJ2b2x1bWUiLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21lZGlhRWxlbWVudC52b2x1bWUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICB0aGlzLl9tZWRpYUVsZW1lbnQudm9sdW1lID0gZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJtdXRlZCIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbWVkaWFFbGVtZW50Lm11dGVkCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fbWVkaWFFbGVtZW50Lm11dGVkID0gZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICAgICAgfSksCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJjdXJyZW50VGltZSIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbWVkaWFFbGVtZW50ID8gdGhpcy5fbWVkaWFFbGVtZW50LmN1cnJlbnRUaW1lIDogMAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhRWxlbWVudCA/IHRoaXMuX21lZGlhRWxlbWVudC5jdXJyZW50VGltZSA9IGUgOiB0aGlzLl9wZW5kaW5nU2Vla1RpbWUgPSBlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgIm1lZGlhSW5mbyIsIHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICB2YXIgZSA9IHsKICAgICAgICAgICAgICAgICAgICAgIG1pbWVUeXBlOiAodGhpcy5fbWVkaWFFbGVtZW50IGluc3RhbmNlb2YgSFRNTEF1ZGlvRWxlbWVudCA/ICJhdWRpby8iIDogInZpZGVvLyIpICsgdGhpcy5fbWVkaWFEYXRhU291cmNlLnR5cGUKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21lZGlhRWxlbWVudCAmJiAoZS5kdXJhdGlvbiA9IE1hdGguZmxvb3IoMWUzICogdGhpcy5fbWVkaWFFbGVtZW50LmR1cmF0aW9uKSwKICAgICAgICAgICAgICAgICAgdGhpcy5fbWVkaWFFbGVtZW50IGluc3RhbmNlb2YgSFRNTFZpZGVvRWxlbWVudCAmJiAoZS53aWR0aCA9IHRoaXMuX21lZGlhRWxlbWVudC52aWRlb1dpZHRoLAogICAgICAgICAgICAgICAgICBlLmhlaWdodCA9IHRoaXMuX21lZGlhRWxlbWVudC52aWRlb0hlaWdodCkpLAogICAgICAgICAgICAgICAgICBlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6ICEwCiAgICAgICAgICB9KSwKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgInN0YXRpc3RpY3NJbmZvIiwgewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHZhciBlID0gewogICAgICAgICAgICAgICAgICAgICAgcGxheWVyVHlwZTogdGhpcy5fdHlwZSwKICAgICAgICAgICAgICAgICAgICAgIHVybDogdGhpcy5fbWVkaWFEYXRhU291cmNlLnVybAogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICBpZiAoISh0aGlzLl9tZWRpYUVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MVmlkZW9FbGVtZW50KSkKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlOwogICAgICAgICAgICAgICAgICB2YXIgdCA9ICEwCiAgICAgICAgICAgICAgICAgICAgLCBpID0gMAogICAgICAgICAgICAgICAgICAgICwgbiA9IDA7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9tZWRpYUVsZW1lbnQuZ2V0VmlkZW9QbGF5YmFja1F1YWxpdHkpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciByID0gdGhpcy5fbWVkaWFFbGVtZW50LmdldFZpZGVvUGxheWJhY2tRdWFsaXR5KCk7CiAgICAgICAgICAgICAgICAgICAgICBpID0gci50b3RhbFZpZGVvRnJhbWVzLAogICAgICAgICAgICAgICAgICAgICAgbiA9IHIuZHJvcHBlZFZpZGVvRnJhbWVzCiAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSB0aGlzLl9tZWRpYUVsZW1lbnQud2Via2l0RGVjb2RlZEZyYW1lQ291bnQgPyAoaSA9IHRoaXMuX21lZGlhRWxlbWVudC53ZWJraXREZWNvZGVkRnJhbWVDb3VudCwKICAgICAgICAgICAgICAgICAgICAgIG4gPSB0aGlzLl9tZWRpYUVsZW1lbnQud2Via2l0RHJvcHBlZEZyYW1lQ291bnQpIDogdCA9ICExOwogICAgICAgICAgICAgICAgICByZXR1cm4gdCAmJiAoZS5kZWNvZGVkRnJhbWVzID0gaSwKICAgICAgICAgICAgICAgICAgZS5kcm9wcGVkRnJhbWVzID0gbiksCiAgICAgICAgICAgICAgICAgIGUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAKICAgICAgICAgIH0pLAogICAgICAgICAgZS5wcm90b3R5cGUuX29udkxvYWRlZE1ldGFkYXRhID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIG51bGwgIT0gdGhpcy5fcGVuZGluZ1NlZWtUaW1lICYmICh0aGlzLl9tZWRpYUVsZW1lbnQuY3VycmVudFRpbWUgPSB0aGlzLl9wZW5kaW5nU2Vla1RpbWUsCiAgICAgICAgICAgICAgdGhpcy5fcGVuZGluZ1NlZWtUaW1lID0gbnVsbCksCiAgICAgICAgICAgICAgdGhpcy5fZW1pdHRlci5lbWl0KGwuTUVESUFfSU5GTywgdGhpcy5tZWRpYUluZm8pCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlLnByb3RvdHlwZS5fcmVwb3J0U3RhdGlzdGljc0luZm8gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0aGlzLl9lbWl0dGVyLmVtaXQobC5TVEFUSVNUSUNTX0lORk8sIHRoaXMuc3RhdGlzdGljc0luZm8pCiAgICAgICAgICB9CiAgICAgICAgICAsCiAgICAgICAgICBlCiAgICAgIH0oKTsKICAgICAgbi5hLmluc3RhbGwoKTsKICAgICAgdmFyIEMgPSB7CiAgICAgICAgICBjcmVhdGVQbGF5ZXI6IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICB2YXIgaSA9IGU7CiAgICAgICAgICAgICAgaWYgKG51bGwgPT0gaSB8fCAib2JqZWN0IiAhPSB0eXBlb2YgaSkKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEEuYigiTWVkaWFEYXRhU291cmNlIG11c3QgYmUgYW4gamF2YXNjcmlwdCBvYmplY3QhIik7CiAgICAgICAgICAgICAgaWYgKCFpLmhhc093blByb3BlcnR5KCJ0eXBlIikpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBBLmIoIk1lZGlhRGF0YVNvdXJjZSBtdXN0IGhhcyB0eXBlIGZpZWxkIHRvIGluZGljYXRlIHZpZGVvIGZpbGUgdHlwZSEiKTsKICAgICAgICAgICAgICBzd2l0Y2ggKGkudHlwZSkgewogICAgICAgICAgICAgIGNhc2UgIm1zZSI6CiAgICAgICAgICAgICAgY2FzZSAibXBlZ3RzIjoKICAgICAgICAgICAgICBjYXNlICJtMnRzIjoKICAgICAgICAgICAgICBjYXNlICJmbHYiOgogICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEQoaSx0KTsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGsoaSx0KQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBpc1N1cHBvcnRlZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG8uc3VwcG9ydE1TRUgyNjRQbGF5YmFjaygpCiAgICAgICAgICB9LAogICAgICAgICAgZ2V0RmVhdHVyZUxpc3Q6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiBvLmdldEZlYXR1cmVMaXN0KCkKICAgICAgICAgIH0KICAgICAgfTsKICAgICAgQy5CYXNlTG9hZGVyID0gaC5hLAogICAgICBDLkxvYWRlclN0YXR1cyA9IGguYywKICAgICAgQy5Mb2FkZXJFcnJvcnMgPSBoLmIsCiAgICAgIEMuRXZlbnRzID0gbCwKICAgICAgQy5FcnJvclR5cGVzID0gVCwKICAgICAgQy5FcnJvckRldGFpbHMgPSB3LAogICAgICBDLk1TRVBsYXllciA9IEQsCiAgICAgIEMuTmF0aXZlUGxheWVyID0gaywKICAgICAgQy5Mb2dnaW5nQ29udHJvbCA9IG0uYSwKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEMsICJ2ZXJzaW9uIiwgewogICAgICAgICAgZW51bWVyYWJsZTogITAsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiAiMS42LjciCiAgICAgICAgICB9CiAgICAgIH0pOwogICAgICB0LmRlZmF1bHQgPSBDCiAgfQogIF0pCn0KKSk7Cg==",e=document.createElement("script");e.innerHTML=atob(i),document.body.appendChild(e);let o=`
                    if (mpegts.getFeatureList().mseLivePlayback) {
                        const videoElement = document.getElementById("feed");
                        const player = mpegts.createPlayer({
                            type: "flv", // could also be mpegts, m2ts, flv
                            isLive: false,
                            url: "${l}",
                        });
                        player.attachMediaElement(videoElement);
                        player.load();
                        player.play();
                    }`,t=document.createElement("script");t.innerHTML=o,document.body.appendChild(t)})})},0))});yg("OIso++ \u5DF2\u542F\u52A8\u3002");if(GM_getValue("firTime","true")==="true"){GM_setValue("firTime","false");let g=document.createElement("div");g.id="welcome",g.style.position="fixed",g.style.top="0",g.style.left="0",g.style.width="100%",g.style.height="100%",g.style.background="rgba(0, 0, 0, 0.5)",g.style.backdropFilter="blur(5px)",g.style.transition="opacity 0.5s",g.style.opacity="0",g.style.zIndex="1000",setTimeout(()=>{g.style.opacity="1"},0),document.body.appendChild(g);let I=document.createElement("div");I.id="welcomeBox",I.style.position="fixed",I.style.top="30%",I.style.left="50%",I.style.transform="translate(-50%, -50%)",I.style.width="620px",I.style.height="400px",I.style.background="white",I.style.borderRadius="10px",I.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.5)",I.style.transition="opacity 0.5s",I.style.opacity="0",I.style.zIndex="1001",setTimeout(()=>{I.style.opacity="1"},0),document.body.appendChild(I);let C=document.createElement("div");C.id="welcomeBoxTitle",C.style.position="absolute",C.style.top="0",C.style.left="0",C.style.width="100%",C.style.height="50px",C.style.lineHeight="50px",C.style.textAlign="center",C.style.fontSize="20px",C.style.fontWeight="bold",C.style.color="white",C.style.background="linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3)",C.style.backgroundSize="600%",C.style.animation="gradient 15s ease infinite",C.innerHTML="\u6B22\u8FCE\u4F7F\u7528 OIso++ \uFF01",I.appendChild(C);let A=document.createElement("div");A.id="welcomeBoxContent",A.style.position="absolute",A.style.top="50px",A.style.left="0",A.style.width="100%",A.style.height="350px",A.style.padding="20px",A.style.boxSizing="border-box",A.style.fontSize="16px",A.style.color="black",A.innerHTML='OIso++ \u662F\u4E00\u4E2AOIer\u7684\u597D\u5E2E\u624B\uFF0C\u5B83\u53EF\u4EE5\u5728\u6D1B\u8C37\u7B49\u7F51\u7AD9\u4E0A\u63D0\u4F9BOI\u68C0\u7D22\u7B49\u66F4\u591A\u670D\u52A1\u3002<br/>\u5B83\u53EF\u4EE5\u8BA9\u60A8\u67E5\u770B\u5E76\u53C2\u4E0E\u5E16\u5B50\u6295\u7968\u3001\u5728\u4EFB\u4F55\u5730\u65B9\u6309\u4E0B Ctrl + Alt \u6765\u5524\u8D77\u8D85\u7EA7\u9762\u677F\uFF0C\u8FD8\u80FD\u652F\u6301\u663E\u793A\u5934\u50CF\u6302\u4EF6\u3002<br/>\u6B64\u754C\u9762\u5C06\u4E0D\u4F1A\u518D\u663E\u793A\u3002\u5F3A\u70C8\u5EFA\u8BAE\u65B0\u624B\u67E5\u770B\u6216\u6536\u85CF<a style="color:blue" href="https://www.amzcd.top/posts/ex-OIso-guide/">\u65B0\u624B\u6307\u5357</a>\uFF0C\u91CC\u9762\u5305\u542B\u4E86\u66F4\u591A\u5173\u4E8EOIso++\u7684\u7528\u6CD5\u8BF4\u660E\u3002',I.appendChild(A);let l=document.createElement("div");l.id="welcomeBoxButton",l.style.position="absolute",l.style.bottom="20px",l.style.right="20px",l.style.width="80px",l.style.height="40px",l.style.lineHeight="40px",l.style.textAlign="center",l.style.fontSize="16px",l.style.fontWeight="bold",l.style.color="white",l.style.background="linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3)",l.style.backgroundSize="600%",l.style.animation="gradient 15s ease infinite",l.style.borderRadius="10px",l.style.cursor="pointer",l.innerHTML="\u786E\u5B9A",l.onclick=function(){g.style.opacity="0",I.style.opacity="0",setTimeout(()=>{document.body.removeChild(g),document.body.removeChild(I)},500)},I.appendChild(l);let e=`https://online.oiso.cf/rewards/tamper/report/${document.querySelector(".avatar").src.match(/\/(\d+)\./)[1]}`;$g(e,o=>{o.code===200?A.innerHTML+="<br/><br/>\u8FD9\u662F\u60A8\u7B2C\u4E00\u6B21\u4F7F\u7528 OIso++ \uFF0C\u611F\u8C22\u60A8\u7684\u652F\u6301\uFF01<b>5</b> \u79EF\u5206\u5DF2\u7ECF\u53D1\u653E\u5230\u60A8\u7684\u8D26\u6237\u4E2D\u3002":A.innerHTML+="<br/><br/>\u611F\u8C22\u60A8\u7EE7\u7EED\u9009\u62E9\u4F7F\u7528 OIso++ \uFF01"})}})();
/*!
 * Live2D Widget
 * https://github.com/stevenjoezhang/live2d-widget
 */

